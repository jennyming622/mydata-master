/*
 almond 0.3.3 Copyright jQuery Foundation and other contributors.
 Released under MIT license, http://github.com/requirejs/almond/LICENSE
*/
var separation="|-|",MobileUtils={unregisterFunction:function(G){"string"==typeof func&&delete window[G]},count:(new Date).getTime(),registerFunction:function(G){if("function"==typeof G){MobileUtils.count++;var q="mobilejscbf"+MobileUtils.count;window[q]=function(){G.apply(this,arguments);delete window[q]};return q}return"string"==typeof G?G:""},supportTwidAndroid:function(){return"undefined"!=typeof this.androidInterface&&"function"==typeof this.androidInterface.GetVersion},toNumber:function(G){return"number"!=
typeof G?(G=parseInt(G),isNaN(G)?0:G):G},androidInterface:window.twidMobile||window.mobile};function mobileAndTabletcheck(){var G=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(G=!0);return G}
function TwcaCryptoLibAlertDialog(){this.show=function(G,q,K,p,O,B){if(!document.getElementById("dialogoverlay")){var x=document.createElement("DIV");x.id="dialogoverlay";document.body.appendChild(x)}if(!document.getElementById("dialogbox")){x=document.createElement("DIV");x.id="dialogbox";var D=document.createElement("DIV");D.id="dialogboxhead";var A=document.createElement("DIV");A.id="dialogboxbody";var a=document.createElement("DIV");a.id="dialogboxfoot";x.appendChild(D);x.appendChild(A);x.appendChild(a);
document.body.appendChild(x)}x=window.innerWidth;var f=window.innerHeight;if(void 0===x||void 0===f)x=document.documentElement.clientWidth,f=document.documentElement.clientHeight;var d=Math.max(Math.min(.35*x,420),280),F=document.getElementById("dialogoverlay"),k=document.getElementById("dialogbox");D=document.getElementById("dialogboxhead");A=document.getElementById("dialogboxbody");a=document.getElementById("dialogboxfoot");F.style.display="block";F.style.height=f+"px";F.style.opacity=.8;F.style.position=
"fixed";F.style.top="0px";F.style.left="0px";F.style.background="#000";F.style.width="100%";F.style.zIndex=10;k.style.display="block";k.style.left=x/2-d/2+"px";k.style.top=.15*f+"px";k.style.position="fixed";k.style.background="#FFF";k.style.width=d+"px";k.style.zIndex=10;k.style.border="solid";k.style.borderWidth="1px";k.style.borderColor="#000000";k.style.borderTopLeftRadius="5px";k.style.borderTopRightRadius="5px";k.style.borderBottomLeftRadius="5px";k.style.borderBottomRightRadius="5px";D.style.background=
"#E2E2E2";D.style.borderColor="#000000";D.style.color="#666666";D.style.fontWeight="bold";D.style.font.size="19px";D.style.padding="10px";D.style.borderTopLeftRadius="5px";D.style.borderTopRightRadius="5px";D.style.textAlign="center";A.style.font.size="18px";A.style.color="#717171";A.style.textAlign="center";a.style.background="#E2E2E2";a.style.borderColor="#000000";a.style.font.size="10px";a.style.height="35px";a.style.lineHeight="35px";a.style.textAlign="center";a.style.borderBottomLeftRadius="5px";
a.style.borderBottomRightRadius="5px";twcaDialogParams=B;document.getElementById("dialogboxhead").innerHTML=G;document.getElementById("dialogboxbody").innerHTML="<br/>&nbsp;&nbsp;"+q+"<br/>&nbsp;&nbsp;"+K+'&nbsp;<input id="twcaCryptoLibInput" type="password"/><br/><br/>';document.getElementById("dialogboxfoot").innerHTML='<input type="button" id="twcaCryptoLibAlertDialogBtnCancel" value="'+p+'" onclick="twcaCryptoLibAlertDialog.cancel(twcaDialogParams);" style="width:'+.25*d+'px;" /> &nbsp; <input id="twcaCryptoLibAlertDialogBtnOK" type="button" value="'+
O+'" onclick="twcaCryptoLibAlertDialog.ok(twcaDialogParams);" style="width:'+.25*d+'px;" />';document.getElementById("twcaCryptoLibInput").addEventListener("keyup",function(a){a.preventDefault();13==a.keyCode&&document.getElementById("twcaCryptoLibAlertDialogBtnOK").click();27==a.keyCode&&document.getElementById("twcaCryptoLibAlertDialogBtnCancel").click()});document.getElementById("twcaCryptoLibInput").focus()};this.ok=function(G){twcaDialogParams=null;document.getElementById("dialogbox").style.display=
"none";document.getElementById("dialogoverlay").style.display="none";"SelectSignerEx"==G[0]?G[10].SelectSignerEx(G[1],G[2],G[3],document.getElementById("twcaCryptoLibInput").value,G[5],G[6],G[7],G[8],G[9]):"SelectSignerExFromChild"==G[0]&&G[10].SelectSignerEx(G[1],G[2],G[3],document.getElementById("twcaCryptoLibInput").value,G[5],G[6],G[7],G[8],G[9])};this.cancel=function(G){twcaDialogParams=null;document.getElementById("dialogbox").style.display="none";document.getElementById("dialogoverlay").style.display=
"none";"SelectSignerEx"==G[0]?G[10].callback(G[9],5070,"\u4f7f\u7528\u8005\u6309\u4e0b\u53d6\u6d88",""):"SelectSignerExFromChild"==G[0]&&G[10].callback(G[9],5070,"\u4f7f\u7528\u8005\u6309\u4e0b\u53d6\u6d88","")}}var support_amd;
try{support_amd=define.amd}catch(G){(function(q,K){"function"===typeof define&&define.amd?define([],K):q.forge=K()})(this,function(){var q,K,p;(function(O){function B(a,n){var z,c,h=n&&n.split("/"),m=b.map,r=m&&m["*"]||{};if(a){a=a.split("/");var l=a.length-1;b.nodeIdCompat&&t.test(a[l])&&(a[l]=a[l].replace(t,""));"."===a[0].charAt(0)&&h&&(l=h.slice(0,h.length-1),a=l.concat(a));for(l=0;l<a.length;l++){var e=a[l];"."===e?(a.splice(l,1),--l):".."===e&&0!==l&&(1!==l||".."!==a[2])&&".."!==a[l-1]&&0<l&&
(a.splice(l-1,2),l-=2)}a=a.join("/")}if((h||r)&&m){e=a.split("/");for(l=e.length;0<l;--l){var y=e.slice(0,l).join("/");if(h)for(c=h.length;0<c;--c)if(z=m[h.slice(0,c).join("/")])if(z=z[y]){var g=z;var d=l;break}if(g)break;if(!w&&r&&r[y]){var w=r[y];var k=l}}!g&&w&&(g=w,d=k);g&&(e.splice(0,d,g),a=e.join("/"))}return a}function x(a,b){return function(){var n=g.call(arguments,0);"string"!==typeof n[0]&&1===n.length&&n.push(null);return F.apply(O,n.concat([a,b]))}}function D(a){return function(b){return B(b,
a)}}function A(a){return function(b){k[a]=b}}function a(a){if(u.call(e,a)){var b=e[a];delete e[a];c[a]=!0;n.apply(O,b)}if(!u.call(k,a)&&!u.call(c,a))throw Error("No "+a);return k[a]}function f(a){var b=a?a.indexOf("!"):-1;if(-1<b){var n=a.substring(0,b);a=a.substring(b+1,a.length)}return[n,a]}function d(a){return function(){return b&&b.config&&b.config[a]||{}}}var F,k={},e={},b={},c={},u=Object.prototype.hasOwnProperty,g=[].slice,t=/\.js$/;var w=function(b,n){var z=f(b),c=z[0],h=n[1];b=z[1];if(c){c=
B(c,h);var m=a(c)}c?b=m&&m.normalize?m.normalize(b,D(h)):B(b,h):(b=B(b,h),z=f(b),c=z[0],b=z[1],c&&(m=a(c)));return{f:c?c+"!"+b:b,n:b,pr:c,p:m}};var z={require:function(a){return x(a)},exports:function(a){var b=k[a];return"undefined"!==typeof b?b:k[a]={}},module:function(a){return{id:a,uri:"",exports:k[a],config:d(a)}}};var n=function(b,n,v,g){var h,m=[];var r=typeof v;var l=(g=g||b)?f(g):[];if("undefined"===r||"function"===r){n=!n.length&&v.length?["require","exports","module"]:n;for(h=0;h<n.length;h+=
1){var y=w(n[h],l);r=y.f;if("require"===r)m[h]=z.require(b);else if("exports"===r){m[h]=z.exports(b);var E=!0}else if("module"===r)var J=m[h]=z.module(b);else if(u.call(k,r)||u.call(e,r)||u.call(c,r))m[h]=a(r);else if(y.p)y.p.load(y.n,x(g,!0),A(r),{}),m[h]=k[r];else throw Error(b+" missing "+r);}n=v?v.apply(k[b],m):void 0;b&&(J&&J.exports!==O&&J.exports!==k[b]?k[b]=J.exports:n===O&&E||(k[b]=n))}else b&&(k[b]=v)};q=K=F=function(c,e,v,g,h){if("string"===typeof c)return z[c]?z[c](e):a(w(c,e?f(e):[]).f);
if(!c.splice){b=c;b.deps&&F(b.deps,b.callback);if(!e)return;e.splice?(c=e,e=v,v=null):c=O}e=e||function(){};"function"===typeof v&&(v=g,g=h);g?n(O,c,e,v):setTimeout(function(){n(O,c,e,v)},4);return F};F.config=function(a){return F(a)};q._defined=k;p=function(a,b,n){if("string"!==typeof a)throw Error("See almond README: incorrect module build, no module name");b.splice||(n=b,b=[]);u.call(k,a)||u.call(e,a)||(e[a]=[a,b,n])};p.amd={jQuery:!0}})();p("node_modules/almond/almond",function(){});(function(){function q(a){function f(a){this.data=
"";this.read=0;if("string"===typeof a)this.data=a;else if(d.isArrayBuffer(a)||d.isArrayBufferView(a)){a=new Uint8Array(a);try{this.data=String.fromCharCode.apply(null,a)}catch(r){for(var b=0;b<a.length;++b)this.putByte(a[b])}}else if(a instanceof f||"object"===typeof a&&"string"===typeof a.data&&"number"===typeof a.read)this.data=a.data,this.read=a.read;this._constructedStringLength=0}var d=a.util=a.util||{};(function(){if("undefined"!==typeof process&&process.nextTick)d.nextTick=process.nextTick,
d.setImmediate="function"===typeof setImmediate?setImmediate:d.nextTick;else if("function"===typeof setImmediate)d.setImmediate=function(){return setImmediate.apply(void 0,arguments)},d.nextTick=function(a){return setImmediate(a)};else{d.setImmediate=function(a){setTimeout(a,0)};if("undefined"!==typeof window&&"function"===typeof window.postMessage){var a=[];d.setImmediate=function(b){a.push(b);1===a.length&&window.postMessage("forge.setImmediate","*")};window.addEventListener("message",function(b){b.source===
window&&"forge.setImmediate"===b.data&&(b.stopPropagation(),b=a.slice(),a.length=0,b.forEach(function(a){a()}))},!0)}if("undefined"!==typeof MutationObserver){var b=Date.now(),c=!0,e=document.createElement("div");a=[];(new MutationObserver(function(){var b=a.slice();a.length=0;b.forEach(function(a){a()})})).observe(e,{attributes:!0});var v=d.setImmediate;d.setImmediate=function(n){15<Date.now()-b?(b=Date.now(),v(n)):(a.push(n),1===a.length&&e.setAttribute("a",c=!c))}}d.nextTick=d.setImmediate}})();
d.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};d.isArrayBuffer=function(a){return"undefined"!==typeof ArrayBuffer&&a instanceof ArrayBuffer};d.isArrayBufferView=function(a){return a&&d.isArrayBuffer(a.buffer)&&void 0!==a.byteLength};d.ByteBuffer=f;d.ByteStringBuffer=f;d.ByteStringBuffer.prototype._optimizeConstructedString=function(a){this._constructedStringLength+=a;4096<this._constructedStringLength&&(this.data.substr(0,1),this._constructedStringLength=
0)};d.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};d.ByteStringBuffer.prototype.isEmpty=function(){return 0>=this.length()};d.ByteStringBuffer.prototype.putByte=function(a){return this.putBytes(String.fromCharCode(a))};d.ByteStringBuffer.prototype.fillWithByte=function(a,b){a=String.fromCharCode(a);for(var n=this.data;0<b;)b&1&&(n+=a),b>>>=1,0<b&&(a+=a);this.data=n;this._optimizeConstructedString(b);return this};d.ByteStringBuffer.prototype.putBytes=function(a){this.data+=
a;this._optimizeConstructedString(a.length);return this};d.ByteStringBuffer.prototype.putString=function(a){return this.putBytes(d.encodeUtf8(a))};d.ByteStringBuffer.prototype.putInt16=function(a){return this.putBytes(String.fromCharCode(a>>8&255)+String.fromCharCode(a&255))};d.ByteStringBuffer.prototype.putInt24=function(a){return this.putBytes(String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(a&255))};d.ByteStringBuffer.prototype.putInt32=function(a){return this.putBytes(String.fromCharCode(a>>
24&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(a&255))};d.ByteStringBuffer.prototype.putInt16Le=function(a){return this.putBytes(String.fromCharCode(a&255)+String.fromCharCode(a>>8&255))};d.ByteStringBuffer.prototype.putInt24Le=function(a){return this.putBytes(String.fromCharCode(a&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(a>>16&255))};d.ByteStringBuffer.prototype.putInt32Le=function(a){return this.putBytes(String.fromCharCode(a&255)+String.fromCharCode(a>>
8&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>24&255))};d.ByteStringBuffer.prototype.putInt=function(a,b){var n="";do b-=8,n+=String.fromCharCode(a>>b&255);while(0<b);return this.putBytes(n)};d.ByteStringBuffer.prototype.putSignedInt=function(a,b){0>a&&(a+=2<<b-1);return this.putInt(a,b)};d.ByteStringBuffer.prototype.putBuffer=function(a){return this.putBytes(a.getBytes())};d.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};d.ByteStringBuffer.prototype.getInt16=
function(){var a=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);this.read+=2;return a};d.ByteStringBuffer.prototype.getInt24=function(){var a=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);this.read+=3;return a};d.ByteStringBuffer.prototype.getInt32=function(){var a=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);this.read+=
4;return a};d.ByteStringBuffer.prototype.getInt16Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;this.read+=2;return a};d.ByteStringBuffer.prototype.getInt24Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;this.read+=3;return a};d.ByteStringBuffer.prototype.getInt32Le=function(){var a=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+
2)<<16^this.data.charCodeAt(this.read+3)<<24;this.read+=4;return a};d.ByteStringBuffer.prototype.getInt=function(a){var b=0;do b=(b<<8)+this.data.charCodeAt(this.read++),a-=8;while(0<a);return b};d.ByteStringBuffer.prototype.getSignedInt=function(a){var b=this.getInt(a);a=2<<a-2;b>=a&&(b-=a<<1);return b};d.ByteStringBuffer.prototype.getBytes=function(a){if(a){a=Math.min(this.length(),a);var b=this.data.slice(this.read,this.read+a);this.read+=a}else 0===a?b="":(b=0===this.read?this.data:this.data.slice(this.read),
this.clear());return b};d.ByteStringBuffer.prototype.bytes=function(a){return"undefined"===typeof a?this.data.slice(this.read):this.data.slice(this.read,this.read+a)};d.ByteStringBuffer.prototype.at=function(a){return this.data.charCodeAt(this.read+a)};d.ByteStringBuffer.prototype.setAt=function(a,b){this.data=this.data.substr(0,this.read+a)+String.fromCharCode(b)+this.data.substr(this.read+a+1);return this};d.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-
1)};d.ByteStringBuffer.prototype.copy=function(){var a=d.createBuffer(this.data);a.read=this.read;return a};d.ByteStringBuffer.prototype.compact=function(){0<this.read&&(this.data=this.data.slice(this.read),this.read=0);return this};d.ByteStringBuffer.prototype.clear=function(){this.data="";this.read=0;return this};d.ByteStringBuffer.prototype.truncate=function(a){a=Math.max(0,this.length()-a);this.data=this.data.substr(this.read,a);this.read=0;return this};d.ByteStringBuffer.prototype.toHex=function(){for(var a=
"",b=this.read;b<this.data.length;++b){var c=this.data.charCodeAt(b);16>c&&(a+="0");a+=c.toString(16)}return a};d.ByteStringBuffer.prototype.toString=function(){return d.decodeUtf8(this.bytes())};d.DataBuffer=function(a,b){b=b||{};this.read=b.readOffset||0;this.growSize=b.growSize||1024;var c=d.isArrayBuffer(a),n=d.isArrayBufferView(a);c||n?(this.data=c?new DataView(a):new DataView(a.buffer,a.byteOffset,a.byteLength),this.write="writeOffset"in b?b.writeOffset:this.data.byteLength):(this.data=new DataView(new ArrayBuffer(0)),
this.write=0,null!==a&&void 0!==a&&this.putBytes(a),"writeOffset"in b&&(this.write=b.writeOffset))};d.DataBuffer.prototype.length=function(){return this.write-this.read};d.DataBuffer.prototype.isEmpty=function(){return 0>=this.length()};d.DataBuffer.prototype.accommodate=function(a,b){if(this.length()>=a)return this;b=Math.max(b||this.growSize,a);var c=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+b);n.set(c);this.data=new DataView(n.buffer);
return this};d.DataBuffer.prototype.putByte=function(a){this.accommodate(1);this.data.setUint8(this.write++,a);return this};d.DataBuffer.prototype.fillWithByte=function(a,b){this.accommodate(b);for(var c=0;c<b;++c)this.data.setUint8(a);return this};d.DataBuffer.prototype.putBytes=function(a,b){if(d.isArrayBufferView(a)){var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength),n=c.byteLength-c.byteOffset;this.accommodate(n);var e=new Uint8Array(this.data.buffer,this.write);e.set(c);this.write+=n;return this}if(d.isArrayBuffer(a))return c=
new Uint8Array(a),this.accommodate(c.byteLength),e=new Uint8Array(this.data.buffer),e.set(c,this.write),this.write+=c.byteLength,this;if(a instanceof d.DataBuffer||"object"===typeof a&&"number"===typeof a.read&&"number"===typeof a.write&&d.isArrayBufferView(a.data))return c=new Uint8Array(a.data.byteLength,a.read,a.length()),this.accommodate(c.byteLength),e=new Uint8Array(a.data.byteLength,this.write),e.set(c),this.write+=c.byteLength,this;a instanceof d.ByteStringBuffer&&(a=a.data,b="binary");b=
b||"binary";if("string"===typeof a){if("hex"===b)return this.accommodate(Math.ceil(a.length/2)),c=new Uint8Array(this.data.buffer,this.write),this.write+=d.binary.hex.decode(a,c,this.write),this;if("base64"===b)return this.accommodate(3*Math.ceil(a.length/4)),c=new Uint8Array(this.data.buffer,this.write),this.write+=d.binary.base64.decode(a,c,this.write),this;"utf8"===b&&(a=d.encodeUtf8(a),b="binary");if("binary"===b||"raw"===b)return this.accommodate(a.length),c=new Uint8Array(this.data.buffer,this.write),
this.write+=d.binary.raw.decode(c),this;if("utf16"===b)return this.accommodate(2*a.length),c=new Uint16Array(this.data.buffer,this.write),this.write+=d.text.utf16.encode(c),this;throw Error("Invalid encoding: "+b);}throw Error("Invalid parameter: "+a);};d.DataBuffer.prototype.putBuffer=function(a){this.putBytes(a);a.clear();return this};d.DataBuffer.prototype.putString=function(a){return this.putBytes(a,"utf16")};d.DataBuffer.prototype.putInt16=function(a){this.accommodate(2);this.data.setInt16(this.write,
a);this.write+=2;return this};d.DataBuffer.prototype.putInt24=function(a){this.accommodate(3);this.data.setInt16(this.write,a>>8&65535);this.data.setInt8(this.write,a>>16&255);this.write+=3;return this};d.DataBuffer.prototype.putInt32=function(a){this.accommodate(4);this.data.setInt32(this.write,a);this.write+=4;return this};d.DataBuffer.prototype.putInt16Le=function(a){this.accommodate(2);this.data.setInt16(this.write,a,!0);this.write+=2;return this};d.DataBuffer.prototype.putInt24Le=function(a){this.accommodate(3);
this.data.setInt8(this.write,a>>16&255);this.data.setInt16(this.write,a>>8&65535,!0);this.write+=3;return this};d.DataBuffer.prototype.putInt32Le=function(a){this.accommodate(4);this.data.setInt32(this.write,a,!0);this.write+=4;return this};d.DataBuffer.prototype.putInt=function(a,b){this.accommodate(b/8);do b-=8,this.data.setInt8(this.write++,a>>b&255);while(0<b);return this};d.DataBuffer.prototype.putSignedInt=function(a,b){this.accommodate(b/8);0>a&&(a+=2<<b-1);return this.putInt(a,b)};d.DataBuffer.prototype.getByte=
function(){return this.data.getInt8(this.read++)};d.DataBuffer.prototype.getInt16=function(){var a=this.data.getInt16(this.read);this.read+=2;return a};d.DataBuffer.prototype.getInt24=function(){var a=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);this.read+=3;return a};d.DataBuffer.prototype.getInt32=function(){var a=this.data.getInt32(this.read);this.read+=4;return a};d.DataBuffer.prototype.getInt16Le=function(){var a=this.data.getInt16(this.read,!0);this.read+=2;return a};d.DataBuffer.prototype.getInt24Le=
function(){var a=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;this.read+=3;return a};d.DataBuffer.prototype.getInt32Le=function(){var a=this.data.getInt32(this.read,!0);this.read+=4;return a};d.DataBuffer.prototype.getInt=function(a){var b=0;do b=(b<<8)+this.data.getInt8(this.read++),a-=8;while(0<a);return b};d.DataBuffer.prototype.getSignedInt=function(a){var b=this.getInt(a);a=2<<a-2;b>=a&&(b-=a<<1);return b};d.DataBuffer.prototype.getBytes=function(a){if(a){a=Math.min(this.length(),
a);var b=this.data.slice(this.read,this.read+a);this.read+=a}else 0===a?b="":(b=0===this.read?this.data:this.data.slice(this.read),this.clear());return b};d.DataBuffer.prototype.bytes=function(a){return"undefined"===typeof a?this.data.slice(this.read):this.data.slice(this.read,this.read+a)};d.DataBuffer.prototype.at=function(a){return this.data.getUint8(this.read+a)};d.DataBuffer.prototype.setAt=function(a,b){this.data.setUint8(a,b);return this};d.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-
1)};d.DataBuffer.prototype.copy=function(){return new d.DataBuffer(this)};d.DataBuffer.prototype.compact=function(){if(0<this.read){var a=new Uint8Array(this.data.buffer,this.read),b=new Uint8Array(a.byteLength);b.set(a);this.data=new DataView(b);this.write-=this.read;this.read=0}return this};d.DataBuffer.prototype.clear=function(){this.data=new DataView(new ArrayBuffer(0));this.read=this.write=0;return this};d.DataBuffer.prototype.truncate=function(a){this.write=Math.max(0,this.length()-a);this.read=
Math.min(this.read,this.write);return this};d.DataBuffer.prototype.toHex=function(){for(var a="",b=this.read;b<this.data.byteLength;++b){var c=this.data.getUint8(b);16>c&&(a+="0");a+=c.toString(16)}return a};d.DataBuffer.prototype.toString=function(a){var b=new Uint8Array(this.data,this.read,this.length());a=a||"utf8";if("binary"===a||"raw"===a)return d.binary.raw.encode(b);if("hex"===a)return d.binary.hex.encode(b);if("base64"===a)return d.binary.base64.encode(b);if("utf8"===a)return d.text.utf8.decode(b);
if("utf16"===a)return d.text.utf16.decode(b);throw Error("Invalid encoding: "+a);};d.createBuffer=function(a,b){void 0!==a&&"utf8"===(b||"raw")&&(a=d.encodeUtf8(a));return new d.ByteBuffer(a)};d.fillString=function(a,b){for(var c="";0<b;)b&1&&(c+=a),b>>>=1,0<b&&(a+=a);return c};d.xorBytes=function(a,b,c){for(var n="",e,r="",h=0,m=0;0<c;--c,++h)e=a.charCodeAt(h)^b.charCodeAt(h),10<=m&&(n+=r,r="",m=0),r+=String.fromCharCode(e),++m;return n+r};d.hexToBytes=function(a){var b="",c=0;a.length&1&&(c=1,b+=
String.fromCharCode(parseInt(a[0],16)));for(;c<a.length;c+=2)b+=String.fromCharCode(parseInt(a.substr(c,2),16));return b};d.bytesToHex=function(a){return d.createBuffer(a).toHex()};d.int32ToBytes=function(a){return String.fromCharCode(a>>24&255)+String.fromCharCode(a>>16&255)+String.fromCharCode(a>>8&255)+String.fromCharCode(a&255)};var F=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,
29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];d.encode64=function(a,b){for(var c="",n="",e,g,h,m=0;m<a.length;)e=a.charCodeAt(m++),g=a.charCodeAt(m++),h=a.charCodeAt(m++),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e>>2),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((e&3)<<4|g>>4),isNaN(g)?c+="==":(c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((g&15)<<2|h>>6),c+=isNaN(h)?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h&
63)),b&&c.length>b&&(n+=c.substr(0,b)+"\r\n",c=c.substr(b));return n+c};d.decode64=function(a){a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");for(var b="",c,e,v,g,h=0;h<a.length;)c=F[a.charCodeAt(h++)-43],e=F[a.charCodeAt(h++)-43],v=F[a.charCodeAt(h++)-43],g=F[a.charCodeAt(h++)-43],b+=String.fromCharCode(c<<2|e>>4),64!==v&&(b+=String.fromCharCode((e&15)<<4|v>>2),64!==g&&(b+=String.fromCharCode((v&3)<<6|g)));return b};d.encodeUtf8=function(a){return unescape(encodeURIComponent(a))};d.decodeUtf8=function(a){return decodeURIComponent(escape(a))};
d.binary={raw:{},hex:{},base64:{}};d.binary.raw.encode=function(a){return String.fromCharCode.apply(null,a)};d.binary.raw.decode=function(a,b,c){var n=b;n||(n=new Uint8Array(a.length));for(var e=c=c||0,r=0;r<a.length;++r)n[e++]=a.charCodeAt(r);return b?e-c:n};d.binary.hex.encode=d.bytesToHex;d.binary.hex.decode=function(a,b,c){var n=b;n||(n=new Uint8Array(Math.ceil(a.length/2)));c=c||0;var e=0,r=c;a.length&1&&(e=1,n[r++]=parseInt(a[0],16));for(;e<a.length;e+=2)n[r++]=parseInt(a.substr(e,2),16);return b?
r-c:n};d.binary.base64.encode=function(a,b){for(var c="",n="",e,g,h,m=0;m<a.byteLength;)e=a[m++],g=a[m++],h=a[m++],c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e>>2),c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((e&3)<<4|g>>4),isNaN(g)?c+="==":(c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt((g&15)<<2|h>>6),c+=isNaN(h)?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h&63)),
b&&c.length>b&&(n+=c.substr(0,b)+"\r\n",c=c.substr(b));return n+c};d.binary.base64.decode=function(a,b,c){var n=b;n||(n=new Uint8Array(3*Math.ceil(a.length/4)));a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");c=c||0;for(var e,g,h,m,r=0,l=c;r<a.length;)e=F[a.charCodeAt(r++)-43],g=F[a.charCodeAt(r++)-43],h=F[a.charCodeAt(r++)-43],m=F[a.charCodeAt(r++)-43],n[l++]=e<<2|g>>4,64!==h&&(n[l++]=(g&15)<<4|h>>2,64!==m&&(n[l++]=(h&3)<<6|m));return b?l-c:n.subarray(0,l)};d.text={utf8:{},utf16:{}};d.text.utf8.encode=function(a,
b,c){a=d.encodeUtf8(a);var n=b;n||(n=new Uint8Array(a.length));for(var e=c=c||0,g=0;g<a.length;++g)n[e++]=a.charCodeAt(g);return b?e-c:n};d.text.utf8.decode=function(a){return d.decodeUtf8(String.fromCharCode.apply(null,a))};d.text.utf16.encode=function(a,b,c){var n=b;n||(n=new Uint8Array(2*a.length));for(var e=new Uint16Array(n.buffer),g=c=c||0,h=c,m=0;m<a.length;++m)e[h++]=a.charCodeAt(m),g+=2;return b?g-c:n};d.text.utf16.decode=function(a){return String.fromCharCode.apply(null,new Uint16Array(a.buffer))};
d.deflate=function(a,b,c){b=d.decode64(a.deflate(d.encode64(b)).rval);c&&(a=2,b.charCodeAt(1)&32&&(a=6),b=b.substring(a,b.length-4));return b};d.inflate=function(a,b,c){a=a.inflate(d.encode64(b)).rval;return null===a?null:d.decode64(a)};var k=function(a,b,c){if(!a)throw Error("WebStorage not available.");null===c?a=a.removeItem(b):(c=d.encode64(JSON.stringify(c)),a=a.setItem(b,c));if("undefined"!==typeof a&&!0!==a.rval)throw b=Error(a.error.message),b.id=a.error.id,b.name=a.error.name,b;},e=function(a,
b){if(!a)throw Error("WebStorage not available.");var c=a.getItem(b);if(a.init)if(null===c.rval){if(c.error){var n=Error(c.error.message);n.id=c.error.id;n.name=c.error.name;throw n;}c=null}else c=c.rval;null!==c&&(c=JSON.parse(d.decode64(c)));return c},b=function(a,b,c,g){var n=e(a,b);null===n&&(n={});n[c]=g;k(a,b,n)},c=function(a,b,c){a=e(a,b);null!==a&&(a=c in a?a[c]:null);return a},u=function(a,b,c){var n=e(a,b);if(null!==n&&c in n){delete n[c];c=!0;for(var g in n){c=!1;break}c&&(n=null);k(a,
b,n)}},g=function(a,b){k(a,b,null)},t=function(a,b,c){var n=null;"undefined"===typeof c&&(c=["web","flash"]);var e=!1,g=null,h;for(h in c){var m=c[h];try{if("flash"===m||"both"===m){if(null===b[0])throw Error("Flash local storage not available.");n=a.apply(this,b);e="flash"===m}if("web"===m||"both"===m)b[0]=localStorage,n=a.apply(this,b),e=!0}catch(C){g=C}if(e)break}if(!e)throw g;return n};d.setItem=function(a,c,e,g,v){t(b,arguments,v)};d.getItem=function(a,b,e,g){return t(c,arguments,g)};d.removeItem=
function(a,b,c,e){t(u,arguments,e)};d.clearItems=function(a,b,c){t(g,arguments,c)};d.parseUrl=function(a){var b=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;b.lastIndex=0;b=b.exec(a);if(a=null===b?null:{full:a,scheme:b[1],host:b[2],port:b[3],path:b[4]})a.fullHost=a.host,a.port?80!==a.port&&"http"===a.scheme?a.fullHost+=":"+a.port:443!==a.port&&"https"===a.scheme&&(a.fullHost+=":"+a.port):"http"===a.scheme?a.port=80:"https"===a.scheme&&(a.port=443),a.full=a.scheme+"://"+a.fullHost;return a};var w=null;
d.getQueryVariables=function(a){var b=function(a){var b={};a=a.split("&");for(var c=0;c<a.length;c++){var n=a[c].indexOf("=");if(0<n){var h=a[c].substring(0,n);n=a[c].substring(n+1)}else h=a[c],n=null;h in b||(b[h]=[]);h in Object.prototype||null===n||b[h].push(unescape(n))}return b};"undefined"===typeof a?(null===w&&(w="undefined"!==typeof window&&window.location&&window.location.search?b(window.location.search.substring(1)):{}),a=w):a=b(a);return a};d.parseFragment=function(a){var b=a,c="",e=a.indexOf("?");
0<e&&(b=a.substring(0,e),c=a.substring(e+1));a=b.split("/");0<a.length&&""===a[0]&&a.shift();e=""===c?{}:d.getQueryVariables(c);return{pathString:b,queryString:c,path:a,query:e}};d.makeRequest=function(a){var b=d.parseFragment(a),c={path:b.pathString,query:b.queryString,getPath:function(a){return"undefined"===typeof a?b.path:b.path[a]},getQuery:function(a,c){if("undefined"===typeof a)var n=b.query;else(n=b.query[a])&&"undefined"!==typeof c&&(n=n[c]);return n},getQueryLast:function(a,b){var n=c.getQuery(a);
return n?n[n.length-1]:b}};return c};d.makeLink=function(a,b,c){a=jQuery.isArray(a)?a.join("/"):a;b=jQuery.param(b||{});c=c||"";return a+(0<b.length?"?"+b:"")+(0<c.length?"#"+c:"")};d.setPath=function(a,b,c){if("object"===typeof a&&null!==a)for(var n=0,e=b.length;n<e;){var g=b[n++];if(n==e)a[g]=c;else{var h=g in a;if(!h||h&&"object"!==typeof a[g]||h&&null===a[g])a[g]={};a=a[g]}}};d.getPath=function(a,b,c){for(var n=0,e=b.length,g=!0;g&&n<e&&"object"===typeof a&&null!==a;){var h=b[n++];(g=h in a)&&
(a=a[h])}return g?a:c};d.deletePath=function(a,b){if("object"===typeof a&&null!==a)for(var c=0,n=b.length;c<n;){var e=b[c++];if(c==n)delete a[e];else{if(!(e in a)||"object"!==typeof a[e]||null===a[e])break;a=a[e]}}};d.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};d.format=function(a){var b=/%./g,c,e,g=0,d=[];for(e=0;c=b.exec(a);)switch(e=a.substring(e,b.lastIndex-2),0<e.length&&d.push(e),e=b.lastIndex,c=c[0][1],c){case "s":case "o":g<arguments.length?d.push(arguments[g++ +
1]):d.push("<?>");break;case "%":d.push("%");break;default:d.push("<%"+c+"?>")}d.push(a.substring(e));return d.join("")};d.formatNumber=function(a,b,c,e){var n=isNaN(b=Math.abs(b))?2:b;b=void 0===c?",":c;e=void 0===e?".":e;c=0>a?"-":"";var g=parseInt(a=Math.abs(+a||0).toFixed(n),10)+"",h=3<g.length?g.length%3:0;return c+(h?g.substr(0,h)+e:"")+g.substr(h).replace(/(\d{3})(?=\d)/g,"$1"+e)+(n?b+Math.abs(a-g).toFixed(n).slice(2):"")};d.formatSize=function(a){return a=1073741824<=a?d.formatNumber(a/1073741824,
2,".","")+" GiB":1048576<=a?d.formatNumber(a/1048576,2,".","")+" MiB":1024<=a?d.formatNumber(a/1024,0)+" KiB":d.formatNumber(a,0)+" bytes"};d.bytesFromIP=function(a){return-1!==a.indexOf(".")?d.bytesFromIPv4(a):-1!==a.indexOf(":")?d.bytesFromIPv6(a):null};d.bytesFromIPv4=function(a){a=a.split(".");if(4!==a.length)return null;for(var b=d.createBuffer(),c=0;c<a.length;++c){var e=parseInt(a[c],10);if(isNaN(e))return null;b.putByte(e)}return b.getBytes()};d.bytesFromIPv6=function(a){var b=0;a=a.split(":").filter(function(a){0===
a.length&&++b;return!0});for(var c=2*(8-a.length+b),e=d.createBuffer(),g=0;8>g;++g)if(a[g]&&0!==a[g].length){var E=d.hexToBytes(a[g]);2>E.length&&e.putByte(0);e.putBytes(E)}else e.fillWithByte(0,c),c=0;return e.getBytes()};d.bytesToIP=function(a){return 4===a.length?d.bytesToIPv4(a):16===a.length?d.bytesToIPv6(a):null};d.bytesToIPv4=function(a){if(4!==a.length)return null;for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b.join(".")};d.bytesToIPv6=function(a){if(16!==a.length)return null;
for(var b=[],c=[],e=0,g=0;g<a.length;g+=2){for(var E=d.bytesToHex(a[g]+a[g+1]);"0"===E[0]&&"0"!==E;)E=E.substr(1);if("0"===E){var h=c[c.length-1],m=b.length;h&&m===h.end+1?(h.end=m,h.end-h.start>c[e].end-c[e].start&&(e=c.length-1)):c.push({start:m,end:m})}b.push(E)}0<c.length&&(a=c[e],0<a.end-a.start&&(b.splice(a.start,a.end-a.start+1,""),0===a.start&&b.unshift(""),7===a.end&&b.push("")));return b.join(":")};d.estimateCores=function(a,b){function c(a,m,v){if(0===m){var h=Math.floor(a.reduce(function(a,
b){return a+b},0)/a.length);d.cores=Math.max(1,h);URL.revokeObjectURL(g);return b(null,d.cores)}e(v,function(b,h){a.push(n(v,h));c(a,m-1,v)})}function e(a,b){for(var c=[],m=[],h=0;h<a;++h){var e=new Worker(g);e.addEventListener("message",function(h){m.push(h.data);if(m.length===a){for(h=0;h<a;++h)c[h].terminate();b(null,m)}});c.push(e)}for(h=0;h<a;++h)c[h].postMessage(h)}function n(a,b){for(var c=[],m=0;m<a;++m)for(var h=b[m],e=c[m]=[],n=0;n<a;++n)if(m!==n){var g=b[n];(h.st>g.st&&h.st<g.et||g.st>
h.st&&g.st<h.et)&&e.push(n)}return c.reduce(function(a,b){return Math.max(a,b.length)},0)}"function"===typeof a&&(b=a,a={});a=a||{};if("cores"in d&&!a.update)return b(null,d.cores);if("undefined"!==typeof navigator&&"hardwareConcurrency"in navigator&&0<navigator.hardwareConcurrency)return d.cores=navigator.hardwareConcurrency,b(null,d.cores);if("undefined"===typeof Worker)return d.cores=1,b(null,d.cores);if("undefined"===typeof Blob)return d.cores=2,b(null,d.cores);var g=URL.createObjectURL(new Blob(["(",
function(){self.addEventListener("message",function(a){a=Date.now();for(var b=a+4;Date.now()<b;);self.postMessage({st:a,et:b})})}.toString(),")()"],{type:"application/javascript"}));c([],5,16)}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.util)return d.util;
d.defined.util=!0;for(var k=0;k<f.length;++k)f[k](d);return d.util}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/util",["require","module"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){a.cipher=a.cipher||{};a.cipher.algorithms=a.cipher.algorithms||{};a.cipher.createCipher=function(d,f){var k=
d;"string"===typeof k&&(k=a.cipher.getAlgorithm(k))&&(k=k());if(!k)throw Error("Unsupported algorithm: "+d);return new a.cipher.BlockCipher({algorithm:k,key:f,decrypt:!1})};a.cipher.createDecipher=function(d,f){var k=d;"string"===typeof k&&(k=a.cipher.getAlgorithm(k))&&(k=k());if(!k)throw Error("Unsupported algorithm: "+d);return new a.cipher.BlockCipher({algorithm:k,key:f,decrypt:!0})};a.cipher.registerAlgorithm=function(d,f){d=d.toUpperCase();a.cipher.algorithms[d]=f};a.cipher.getAlgorithm=function(d){d=
d.toUpperCase();return d in a.cipher.algorithms?a.cipher.algorithms[d]:null};var f=a.cipher.BlockCipher=function(a){this.algorithm=a.algorithm;this.mode=this.algorithm.mode;this.blockSize=this.mode.blockSize;this._finish=!1;this.output=this._input=null;this._op=a.decrypt?this.mode.decrypt:this.mode.encrypt;this._decrypt=a.decrypt;this.algorithm.initialize(a)};f.prototype.start=function(d){d=d||{};var f={},k;for(k in d)f[k]=d[k];f.decrypt=this._decrypt;this._finish=!1;this._input=a.util.createBuffer();
this.output=d.output||a.util.createBuffer();this.mode.start(f)};f.prototype.update=function(a){for(a&&this._input.putBuffer(a);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};f.prototype.finish=function(a){!a||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(d){return a(this.blockSize,d,!1)},this.mode.unpad=function(d){return a(this.blockSize,d,!0)});var d={};d.decrypt=this._decrypt;d.overflow=this._input.length()%this.blockSize;
if(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,d))return!1;this._finish=!0;this.update();return this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,d)||this.mode.afterFinish&&!this.mode.afterFinish(this.output,d)?!1:!0}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);
d=d||{};d.defined=d.defined||{};if(d.defined.cipher)return d.cipher;d.defined.cipher=!0;for(var k=0;k<f.length;++k)f[k](d);return d.cipher}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/cipher",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(e){"string"===
typeof e&&(e=a.util.createBuffer(e));if(a.util.isArray(e)&&4<e.length){var b=e;e=a.util.createBuffer();for(var c=0;c<b.length;++c)e.putByte(b[c])}a.util.isArray(e)||(e=[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);return e}function d(a){a[a.length-1]=a[a.length-1]+1&4294967295}function F(a){return[a/4294967296|0,a&4294967295]}a.cipher=a.cipher||{};var k=a.cipher.modes=a.cipher.modes||{};k.ecb=function(a){a=a||{};this.name="ECB";this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=
this.blockSize/4;this._inBlock=Array(this._ints);this._outBlock=Array(this._ints)};k.ecb.prototype.start=function(a){};k.ecb.prototype.encrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&0<a.length()))return!0;for(c=0;c<this._ints;++c)this._inBlock[c]=a.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._outBlock[c])};k.ecb.prototype.decrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&0<a.length()))return!0;for(c=0;c<this._ints;++c)this._inBlock[c]=
a.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._outBlock[c])};k.ecb.prototype.pad=function(a,b){var c=a.length()===this.blockSize?this.blockSize:this.blockSize-a.length();a.fillWithByte(c,c);return!0};k.ecb.prototype.unpad=function(a,b){if(0<b.overflow)return!1;var c=a.length();c=a.at(c-1);if(c>this.blockSize<<2)return!1;a.truncate(c);return!0};k.cbc=function(a){a=a||{};this.name="CBC";this.cipher=a.cipher;this.blockSize=a.blockSize||16;this._ints=
this.blockSize/4;this._inBlock=Array(this._ints);this._outBlock=Array(this._ints)};k.cbc.prototype.start=function(a){if(null===a.iv){if(!this._prev)throw Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in a)this._iv=f(a.iv),this._prev=this._iv.slice(0);else throw Error("Invalid IV parameter.");};k.cbc.prototype.encrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&0<a.length()))return!0;for(c=0;c<this._ints;++c)this._inBlock[c]=this._prev[c]^a.getInt32();this.cipher.encrypt(this._inBlock,
this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._outBlock[c]);this._prev=this._outBlock};k.cbc.prototype.decrypt=function(a,b,c){if(a.length()<this.blockSize&&!(c&&0<a.length()))return!0;for(c=0;c<this._ints;++c)this._inBlock[c]=a.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(c=0;c<this._ints;++c)b.putInt32(this._prev[c]^this._outBlock[c]);this._prev=this._inBlock.slice(0)};k.cbc.prototype.pad=function(a,b){var c=a.length()===this.blockSize?this.blockSize:this.blockSize-
a.length();a.fillWithByte(c,c);return!0};k.cbc.prototype.unpad=function(a,b){if(0<b.overflow)return!1;var c=a.length();c=a.at(c-1);if(c>this.blockSize<<2)return!1;a.truncate(c);return!0};k.cfb=function(e){e=e||{};this.name="CFB";this.cipher=e.cipher;this.blockSize=e.blockSize||16;this._ints=this.blockSize/4;this._inBlock=null;this._outBlock=Array(this._ints);this._partialBlock=Array(this._ints);this._partialOutput=a.util.createBuffer();this._partialBytes=0};k.cfb.prototype.start=function(a){if(!("iv"in
a))throw Error("Invalid IV parameter.");this._iv=f(a.iv);this._inBlock=this._iv.slice(0);this._partialBytes=0};k.cfb.prototype.encrypt=function(a,b,c){var e=a.length();if(0===e)return!0;this.cipher.encrypt(this._inBlock,this._outBlock);if(0===this._partialBytes&&e>=this.blockSize)for(var g=0;g<this._ints;++g)this._inBlock[g]=a.getInt32()^this._outBlock[g],b.putInt32(this._inBlock[g]);else{var d=(this.blockSize-e)%this.blockSize;0<d&&(d=this.blockSize-d);this._partialOutput.clear();for(g=0;g<this._ints;++g)this._partialBlock[g]=
a.getInt32()^this._outBlock[g],this._partialOutput.putInt32(this._partialBlock[g]);if(0<d)a.read-=this.blockSize;else for(g=0;g<this._ints;++g)this._inBlock[g]=this._partialBlock[g];0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes);if(0<d&&!c)return b.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;b.putBytes(this._partialOutput.getBytes(e-this._partialBytes));this._partialBytes=0}};k.cfb.prototype.decrypt=function(a,b,c){var e=a.length();
if(0===e)return!0;this.cipher.encrypt(this._inBlock,this._outBlock);if(0===this._partialBytes&&e>=this.blockSize)for(var g=0;g<this._ints;++g)this._inBlock[g]=a.getInt32(),b.putInt32(this._inBlock[g]^this._outBlock[g]);else{var d=(this.blockSize-e)%this.blockSize;0<d&&(d=this.blockSize-d);this._partialOutput.clear();for(g=0;g<this._ints;++g)this._partialBlock[g]=a.getInt32(),this._partialOutput.putInt32(this._partialBlock[g]^this._outBlock[g]);if(0<d)a.read-=this.blockSize;else for(g=0;g<this._ints;++g)this._inBlock[g]=
this._partialBlock[g];0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes);if(0<d&&!c)return b.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;b.putBytes(this._partialOutput.getBytes(e-this._partialBytes));this._partialBytes=0}};k.ofb=function(e){e=e||{};this.name="OFB";this.cipher=e.cipher;this.blockSize=e.blockSize||16;this._ints=this.blockSize/4;this._inBlock=null;this._outBlock=Array(this._ints);this._partialOutput=a.util.createBuffer();this._partialBytes=
0};k.ofb.prototype.start=function(a){if(!("iv"in a))throw Error("Invalid IV parameter.");this._iv=f(a.iv);this._inBlock=this._iv.slice(0);this._partialBytes=0};k.ofb.prototype.encrypt=function(a,b,c){var e=a.length();if(0===a.length())return!0;this.cipher.encrypt(this._inBlock,this._outBlock);if(0===this._partialBytes&&e>=this.blockSize)for(var g=0;g<this._ints;++g)b.putInt32(a.getInt32()^this._outBlock[g]),this._inBlock[g]=this._outBlock[g];else{var d=(this.blockSize-e)%this.blockSize;0<d&&(d=this.blockSize-
d);this._partialOutput.clear();for(g=0;g<this._ints;++g)this._partialOutput.putInt32(a.getInt32()^this._outBlock[g]);if(0<d)a.read-=this.blockSize;else for(g=0;g<this._ints;++g)this._inBlock[g]=this._outBlock[g];0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes);if(0<d&&!c)return b.putBytes(this._partialOutput.getBytes(d-this._partialBytes)),this._partialBytes=d,!0;b.putBytes(this._partialOutput.getBytes(e-this._partialBytes));this._partialBytes=0}};k.ofb.prototype.decrypt=k.ofb.prototype.encrypt;
k.ctr=function(e){e=e||{};this.name="CTR";this.cipher=e.cipher;this.blockSize=e.blockSize||16;this._ints=this.blockSize/4;this._inBlock=null;this._outBlock=Array(this._ints);this._partialOutput=a.util.createBuffer();this._partialBytes=0};k.ctr.prototype.start=function(a){if(!("iv"in a))throw Error("Invalid IV parameter.");this._iv=f(a.iv);this._inBlock=this._iv.slice(0);this._partialBytes=0};k.ctr.prototype.encrypt=function(a,b,c){var e=a.length();if(0===e)return!0;this.cipher.encrypt(this._inBlock,
this._outBlock);if(0===this._partialBytes&&e>=this.blockSize)for(var g=0;g<this._ints;++g)b.putInt32(a.getInt32()^this._outBlock[g]);else{var k=(this.blockSize-e)%this.blockSize;0<k&&(k=this.blockSize-k);this._partialOutput.clear();for(g=0;g<this._ints;++g)this._partialOutput.putInt32(a.getInt32()^this._outBlock[g]);0<k&&(a.read-=this.blockSize);0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes);if(0<k&&!c)return b.putBytes(this._partialOutput.getBytes(k-this._partialBytes)),this._partialBytes=
k,!0;b.putBytes(this._partialOutput.getBytes(e-this._partialBytes));this._partialBytes=0}d(this._inBlock)};k.ctr.prototype.decrypt=k.ctr.prototype.encrypt;k.gcm=function(e){e=e||{};this.name="GCM";this.cipher=e.cipher;this.blockSize=e.blockSize||16;this._ints=this.blockSize/4;this._inBlock=Array(this._ints);this._outBlock=Array(this._ints);this._partialOutput=a.util.createBuffer();this._partialBytes=0;this._R=3774873600};k.gcm.prototype.start=function(e){if(!("iv"in e))throw Error("Invalid IV parameter.");
var b=a.util.createBuffer(e.iv);this._cipherLength=0;var c="additionalData"in e?a.util.createBuffer(e.additionalData):a.util.createBuffer();this._tagLength="tagLength"in e?e.tagLength:128;this._tag=null;if(e.decrypt&&(this._tag=a.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw Error("Authentication tag does not match tag length.");this._hashBlock=Array(this._ints);this.tag=null;this._hashSubkey=Array(this._ints);this.cipher.encrypt([0,0,0,0],this._hashSubkey);this.componentBits=
4;this._m=this.generateHashTable(this._hashSubkey,this.componentBits);e=b.length();if(12===e)this._j0=[b.getInt32(),b.getInt32(),b.getInt32(),1];else{for(this._j0=[0,0,0,0];0<b.length();)this._j0=this.ghash(this._hashSubkey,this._j0,[b.getInt32(),b.getInt32(),b.getInt32(),b.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(F(8*e)))}this._inBlock=this._j0.slice(0);d(this._inBlock);this._partialBytes=0;c=a.util.createBuffer(c);this._aDataLength=F(8*c.length());(b=c.length()%this.blockSize)&&
c.fillWithByte(0,this.blockSize-b);for(this._s=[0,0,0,0];0<c.length();)this._s=this.ghash(this._hashSubkey,this._s,[c.getInt32(),c.getInt32(),c.getInt32(),c.getInt32()])};k.gcm.prototype.encrypt=function(a,b,c){var e=a.length();if(0===e)return!0;this.cipher.encrypt(this._inBlock,this._outBlock);if(0===this._partialBytes&&e>=this.blockSize){for(var g=0;g<this._ints;++g)b.putInt32(this._outBlock[g]^=a.getInt32());this._cipherLength+=this.blockSize}else{var k=(this.blockSize-e)%this.blockSize;0<k&&(k=
this.blockSize-k);this._partialOutput.clear();for(g=0;g<this._ints;++g)this._partialOutput.putInt32(a.getInt32()^this._outBlock[g]);if(0===k||c){c?(g=e%this.blockSize,this._cipherLength+=g,this._partialOutput.truncate(this.blockSize-g)):this._cipherLength+=this.blockSize;for(g=0;g<this._ints;++g)this._outBlock[g]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}0<this._partialBytes&&this._partialOutput.getBytes(this._partialBytes);if(0<k&&!c)return a.read-=this.blockSize,b.putBytes(this._partialOutput.getBytes(k-
this._partialBytes)),this._partialBytes=k,!0;b.putBytes(this._partialOutput.getBytes(e-this._partialBytes));this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock);d(this._inBlock)};k.gcm.prototype.decrypt=function(a,b,c){var e=a.length();if(e<this.blockSize&&!(c&&0<e))return!0;this.cipher.encrypt(this._inBlock,this._outBlock);d(this._inBlock);this._hashBlock[0]=a.getInt32();this._hashBlock[1]=a.getInt32();this._hashBlock[2]=a.getInt32();this._hashBlock[3]=a.getInt32();this._s=
this.ghash(this._hashSubkey,this._s,this._hashBlock);for(a=0;a<this._ints;++a)b.putInt32(this._outBlock[a]^this._hashBlock[a]);this._cipherLength=e<this.blockSize?this._cipherLength+e%this.blockSize:this._cipherLength+this.blockSize};k.gcm.prototype.afterFinish=function(e,b){var c=!0;b.decrypt&&b.overflow&&e.truncate(this.blockSize-b.overflow);this.tag=a.util.createBuffer();var d=this._aDataLength.concat(F(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,d);d=[];this.cipher.encrypt(this._j0,
d);for(var g=0;g<this._ints;++g)this.tag.putInt32(this._s[g]^d[g]);this.tag.truncate(this.tag.length()%(this._tagLength/8));b.decrypt&&this.tag.bytes()!==this._tag&&(c=!1);return c};k.gcm.prototype.multiply=function(a,b){for(var c=[0,0,0,0],e=b.slice(0),g=0;128>g;++g)a[g/32|0]&1<<31-g%32&&(c[0]^=e[0],c[1]^=e[1],c[2]^=e[2],c[3]^=e[3]),this.pow(e,e);return c};k.gcm.prototype.pow=function(a,b){for(var c=a[3]&1,e=3;0<e;--e)b[e]=a[e]>>>1|(a[e-1]&1)<<31;b[0]=a[0]>>>1;c&&(b[0]^=this._R)};k.gcm.prototype.tableMultiply=
function(a){for(var b=[0,0,0,0],c=0;32>c;++c){var e=this._m[c][a[c/8|0]>>>4*(7-c%8)&15];b[0]^=e[0];b[1]^=e[1];b[2]^=e[2];b[3]^=e[3]}return b};k.gcm.prototype.ghash=function(a,b,c){b[0]^=c[0];b[1]^=c[1];b[2]^=c[2];b[3]^=c[3];return this.tableMultiply(b)};k.gcm.prototype.generateHashTable=function(a,b){var c=8/b,e=4*c;c*=16;for(var g=Array(c),d=0;d<c;++d){var k=[0,0,0,0];k[d/e|0]=1<<b-1<<(e-1-d%e)*b;g[d]=this.generateSubHashTable(this.multiply(k,a),b)}return g};k.gcm.prototype.generateSubHashTable=
function(a,b){var c=1<<b,e=c>>>1,g=Array(c);g[e]=a.slice(0);for(var d=e>>>1;0<d;)this.pow(g[2*d],g[d]=[]),d>>=1;for(d=2;d<e;){for(var k=1;k<d;++k){var f=g[d],n=g[k];g[d+k]=[f[0]^n[0],f[1]^n[1],f[2]^n[2],f[3]^n[3]]}d*=2}g[0]=[0,0,0,0];for(d=e+1;d<c;++d)k=g[d^e],g[d]=[a[0]^k[0],a[1]^k[1],a[2]^k[2],a[3]^k[3]];return g}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,
f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.cipherModes)return d.cipherModes;d.defined.cipherModes=!0;for(var k=0;k<f.length;++k)f[k](d);return d.cipherModes}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/cipherModes",["require","module","./util"],function(){D.apply(null,
Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(b,c){a.cipher.registerAlgorithm(b,function(){return new a.aes.Algorithm(b,c)})}function d(){b=!0;t=[0,1,2,4,8,16,32,64,128,27,54];for(var a=Array(256),c=0;128>c;++c)a[c]=c<<1,a[c+128]=c+128<<1^283;u=Array(256);g=Array(256);w=Array(4);z=Array(4);for(c=0;4>c;++c)w[c]=Array(256),z[c]=Array(256);var e=0,v=0;for(c=0;256>c;++c){var d=v^v<<1^v<<2^v<<3^v<<4;d=d>>8^d&255^99;u[e]=d;g[d]=e;var h=a[d];var m=a[e];var C=a[m];var l=
a[C];h^=h<<24^d<<16^d<<8^d;C=(m^C^l)<<24^(e^l)<<16^(e^C^l)<<8^e^m^l;for(var k=0;4>k;++k)w[k][e]=h,z[k][d]=C,h=h<<24|h>>>8,C=C<<24|C>>>8;0===e?e=v=1:(e=m^a[a[a[m^l]]],v^=a[a[v]])}}function F(a,b){for(var e=a.slice(0),n,g=1,h=e.length,m=c*(h+6+1),d=h;d<m;++d)n=e[d-1],0===d%h?(n=u[n>>>16&255]<<24^u[n>>>8&255]<<16^u[n&255]<<8^u[n>>>24]^t[g]<<24,g++):6<h&&4===d%h&&(n=u[n>>>24]<<24^u[n>>>16&255]<<16^u[n>>>8&255]<<8^u[n&255]),e[d]=e[d-h]^n;if(b){g=z[0];h=z[1];var l=z[2],r=z[3],k=e.slice(0);m=e.length;d=
0;for(var J=m-c;d<m;d+=c,J-=c)if(0===d||d===m-c)k[d]=e[J],k[d+1]=e[J+3],k[d+2]=e[J+2],k[d+3]=e[J+1];else for(var w=0;w<c;++w)n=e[J+w],k[d+(3&-w)]=g[u[n>>>24]]^h[u[n>>>16&255]]^l[u[n>>>8&255]]^r[u[n&255]];e=k}return e}function k(a,b,c,e){var n=a.length/4-1;if(e){var h=z[0];var m=z[1];var d=z[2];var l=z[3];var v=g}else h=w[0],m=w[1],d=w[2],l=w[3],v=u;var r=b[0]^a[0];var J=b[e?3:1]^a[1];var k=b[2]^a[2];b=b[e?1:3]^a[3];for(var y=3,f=1;f<n;++f){var t=h[r>>>24]^m[J>>>16&255]^d[k>>>8&255]^l[b&255]^a[++y];
var F=h[J>>>24]^m[k>>>16&255]^d[b>>>8&255]^l[r&255]^a[++y];var p=h[k>>>24]^m[b>>>16&255]^d[r>>>8&255]^l[J&255]^a[++y];b=h[b>>>24]^m[r>>>16&255]^d[J>>>8&255]^l[k&255]^a[++y];r=t;J=F;k=p}c[0]=v[r>>>24]<<24^v[J>>>16&255]<<16^v[k>>>8&255]<<8^v[b&255]^a[++y];c[e?3:1]=v[J>>>24]<<24^v[k>>>16&255]<<16^v[b>>>8&255]<<8^v[r&255]^a[++y];c[2]=v[k>>>24]<<24^v[b>>>16&255]<<16^v[r>>>8&255]<<8^v[J&255]^a[++y];c[e?1:3]=v[b>>>24]<<24^v[r>>>16&255]<<16^v[J>>>8&255]<<8^v[k&255]^a[++y]}function e(b){b=b||{};var c="AES-"+
(b.mode||"CBC").toUpperCase();var e=b.decrypt?a.cipher.createDecipher(c,b.key):a.cipher.createCipher(c,b.key);var n=e.start;e.start=function(b,c){var m=null;c instanceof a.util.ByteBuffer&&(m=c,c={});c=c||{};c.output=m;c.iv=b;n.call(e,c)};return e}a.aes=a.aes||{};a.aes.startEncrypting=function(a,b,c,g){a=e({key:a,output:c,decrypt:!1,mode:g});a.start(b);return a};a.aes.createEncryptionCipher=function(a,b){return e({key:a,output:null,decrypt:!1,mode:b})};a.aes.startDecrypting=function(a,b,c,g){a=e({key:a,
output:c,decrypt:!0,mode:g});a.start(b);return a};a.aes.createDecryptionCipher=function(a,b){return e({key:a,output:null,decrypt:!0,mode:b})};a.aes.Algorithm=function(a,c){b||d();var e=this;e.name=a;e.mode=new c({blockSize:16,cipher:{encrypt:function(a,b){return k(e._w,a,b,!1)},decrypt:function(a,b){return k(e._w,a,b,!0)}}});e._init=!1};a.aes.Algorithm.prototype.initialize=function(b){if(!this._init){var c=b.key;if("string"===typeof c&&(16===c.length||24===c.length||32===c.length))c=a.util.createBuffer(c);
else if(a.util.isArray(c)&&(16===c.length||24===c.length||32===c.length)){var e=c;c=a.util.createBuffer();for(var n=0;n<e.length;++n)c.putByte(e[n])}if(!a.util.isArray(c)){e=c;c=[];var g=e.length();if(16===g||24===g||32===g)for(g>>>=2,n=0;n<g;++n)c.push(e.getInt32())}if(!a.util.isArray(c)||4!==c.length&&6!==c.length&&8!==c.length)throw Error("Invalid key parameter.");e=-1!==["CFB","OFB","CTR","GCM"].indexOf(this.mode.name);this._w=F(c,b.decrypt&&!e);this._init=!0}};a.aes._expandKey=function(a,c){b||
d();return F(a,c)};a.aes._updateBlock=k;f("AES-ECB",a.cipher.modes.ecb);f("AES-CBC",a.cipher.modes.cbc);f("AES-CFB",a.cipher.modes.cfb);f("AES-OFB",a.cipher.modes.ofb);f("AES-CTR",a.cipher.modes.ctr);f("AES-GCM",a.cipher.modes.gcm);var b=!1,c=4,u,g,t,w,z}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);
d=d||{};d.defined=d.defined||{};if(d.defined.aes)return d.aes;d.defined.aes=!0;for(var k=0;k<f.length;++k)f[k](d);return d.aes}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/aes",["require","module","./cipher","./cipherModes","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){a.pki=a.pki||
{};a=a.pki.oids=a.oids=a.oids||{};a["1.2.840.113549.1.1.1"]="rsaEncryption";a.rsaEncryption="1.2.840.113549.1.1.1";a["1.2.840.113549.1.1.4"]="md5WithRSAEncryption";a.md5WithRSAEncryption="1.2.840.113549.1.1.4";a["1.2.840.113549.1.1.5"]="sha1WithRSAEncryption";a.sha1WithRSAEncryption="1.2.840.113549.1.1.5";a["1.2.840.113549.1.1.7"]="RSAES-OAEP";a["RSAES-OAEP"]="1.2.840.113549.1.1.7";a["1.2.840.113549.1.1.8"]="mgf1";a.mgf1="1.2.840.113549.1.1.8";a["1.2.840.113549.1.1.9"]="pSpecified";a.pSpecified="1.2.840.113549.1.1.9";
a["1.2.840.113549.1.1.10"]="RSASSA-PSS";a["RSASSA-PSS"]="1.2.840.113549.1.1.10";a["1.2.840.113549.1.1.11"]="sha256WithRSAEncryption";a.sha256WithRSAEncryption="1.2.840.113549.1.1.11";a["1.2.840.113549.1.1.12"]="sha384WithRSAEncryption";a.sha384WithRSAEncryption="1.2.840.113549.1.1.12";a["1.2.840.113549.1.1.13"]="sha512WithRSAEncryption";a.sha512WithRSAEncryption="1.2.840.113549.1.1.13";a["1.3.14.3.2.7"]="desCBC";a.desCBC="1.3.14.3.2.7";a["1.3.14.3.2.26"]="sha1";a.sha1="1.3.14.3.2.26";a["2.16.840.1.101.3.4.2.1"]=
"sha256";a.sha256="2.16.840.1.101.3.4.2.1";a["2.16.840.1.101.3.4.2.2"]="sha384";a.sha384="2.16.840.1.101.3.4.2.2";a["2.16.840.1.101.3.4.2.3"]="sha512";a.sha512="2.16.840.1.101.3.4.2.3";a["1.2.840.113549.2.5"]="md5";a.md5="1.2.840.113549.2.5";a["1.2.840.113549.1.7.1"]="data";a.data="1.2.840.113549.1.7.1";a["1.2.840.113549.1.7.2"]="signedData";a.signedData="1.2.840.113549.1.7.2";a["1.2.840.113549.1.7.3"]="envelopedData";a.envelopedData="1.2.840.113549.1.7.3";a["1.2.840.113549.1.7.4"]="signedAndEnvelopedData";
a.signedAndEnvelopedData="1.2.840.113549.1.7.4";a["1.2.840.113549.1.7.5"]="digestedData";a.digestedData="1.2.840.113549.1.7.5";a["1.2.840.113549.1.7.6"]="encryptedData";a.encryptedData="1.2.840.113549.1.7.6";a["1.2.840.113549.1.9.1"]="emailAddress";a.emailAddress="1.2.840.113549.1.9.1";a["1.2.840.113549.1.9.2"]="unstructuredName";a.unstructuredName="1.2.840.113549.1.9.2";a["1.2.840.113549.1.9.3"]="contentType";a.contentType="1.2.840.113549.1.9.3";a["1.2.840.113549.1.9.4"]="messageDigest";a.messageDigest=
"1.2.840.113549.1.9.4";a["1.2.840.113549.1.9.5"]="signingTime";a.signingTime="1.2.840.113549.1.9.5";a["1.2.840.113549.1.9.6"]="counterSignature";a.counterSignature="1.2.840.113549.1.9.6";a["1.2.840.113549.1.9.7"]="challengePdw";a.challengePdw="1.2.840.113549.1.9.7";a["1.2.840.113549.1.9.8"]="unstructuredAddress";a.unstructuredAddress="1.2.840.113549.1.9.8";a["1.2.840.113549.1.9.14"]="extensionRequest";a.extensionRequest="1.2.840.113549.1.9.14";a["1.2.840.113549.1.9.20"]="friendlyName";a.friendlyName=
"1.2.840.113549.1.9.20";a["1.2.840.113549.1.9.21"]="localKeyId";a.localKeyId="1.2.840.113549.1.9.21";a["1.2.840.113549.1.9.22.1"]="x509Certificate";a.x509Certificate="1.2.840.113549.1.9.22.1";a["1.2.840.113549.1.12.10.1.1"]="keyBag";a.keyBag="1.2.840.113549.1.12.10.1.1";a["1.2.840.113549.1.12.10.1.2"]="pkcs8ShroudedKeyBag";a.pkcs8ShroudedKeyBag="1.2.840.113549.1.12.10.1.2";a["1.2.840.113549.1.12.10.1.3"]="certBag";a.certBag="1.2.840.113549.1.12.10.1.3";a["1.2.840.113549.1.12.10.1.4"]="crlBag";a.crlBag=
"1.2.840.113549.1.12.10.1.4";a["1.2.840.113549.1.12.10.1.5"]="secretBag";a.secretBag="1.2.840.113549.1.12.10.1.5";a["1.2.840.113549.1.12.10.1.6"]="safeContentsBag";a.safeContentsBag="1.2.840.113549.1.12.10.1.6";a["1.2.840.113549.1.5.13"]="pkcs5PBES2";a.pkcs5PBES2="1.2.840.113549.1.5.13";a["1.2.840.113549.1.5.12"]="pkcs5PBKDF2";a.pkcs5PBKDF2="1.2.840.113549.1.5.12";a["1.2.840.113549.1.12.1.1"]="pbeWithSHAAnd128BitRC4";a.pbeWithSHAAnd128BitRC4="1.2.840.113549.1.12.1.1";a["1.2.840.113549.1.12.1.2"]=
"pbeWithSHAAnd40BitRC4";a.pbeWithSHAAnd40BitRC4="1.2.840.113549.1.12.1.2";a["1.2.840.113549.1.12.1.3"]="pbeWithSHAAnd3-KeyTripleDES-CBC";a["pbeWithSHAAnd3-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.3";a["1.2.840.113549.1.12.1.4"]="pbeWithSHAAnd2-KeyTripleDES-CBC";a["pbeWithSHAAnd2-KeyTripleDES-CBC"]="1.2.840.113549.1.12.1.4";a["1.2.840.113549.1.12.1.5"]="pbeWithSHAAnd128BitRC2-CBC";a["pbeWithSHAAnd128BitRC2-CBC"]="1.2.840.113549.1.12.1.5";a["1.2.840.113549.1.12.1.6"]="pbewithSHAAnd40BitRC2-CBC";a["pbewithSHAAnd40BitRC2-CBC"]=
"1.2.840.113549.1.12.1.6";a["1.2.840.113549.2.7"]="hmacWithSHA1";a.hmacWithSHA1="1.2.840.113549.2.7";a["1.2.840.113549.2.8"]="hmacWithSHA224";a.hmacWithSHA224="1.2.840.113549.2.8";a["1.2.840.113549.2.9"]="hmacWithSHA256";a.hmacWithSHA256="1.2.840.113549.2.9";a["1.2.840.113549.2.10"]="hmacWithSHA384";a.hmacWithSHA384="1.2.840.113549.2.10";a["1.2.840.113549.2.11"]="hmacWithSHA512";a.hmacWithSHA512="1.2.840.113549.2.11";a["1.2.840.113549.3.7"]="des-EDE3-CBC";a["des-EDE3-CBC"]="1.2.840.113549.3.7";a["2.16.840.1.101.3.4.1.2"]=
"aes128-CBC";a["aes128-CBC"]="2.16.840.1.101.3.4.1.2";a["2.16.840.1.101.3.4.1.22"]="aes192-CBC";a["aes192-CBC"]="2.16.840.1.101.3.4.1.22";a["2.16.840.1.101.3.4.1.42"]="aes256-CBC";a["aes256-CBC"]="2.16.840.1.101.3.4.1.42";a["2.5.4.3"]="commonName";a.commonName="2.5.4.3";a["2.5.4.5"]="serialName";a.serialName="2.5.4.5";a["2.5.4.6"]="countryName";a.countryName="2.5.4.6";a["2.5.4.7"]="localityName";a.localityName="2.5.4.7";a["2.5.4.8"]="stateOrProvinceName";a.stateOrProvinceName="2.5.4.8";a["2.5.4.10"]=
"organizationName";a.organizationName="2.5.4.10";a["2.5.4.11"]="organizationalUnitName";a.organizationalUnitName="2.5.4.11";a["2.16.840.1.113730.1.1"]="nsCertType";a.nsCertType="2.16.840.1.113730.1.1";a["2.5.29.1"]="authorityKeyIdentifier";a["2.5.29.2"]="keyAttributes";a["2.5.29.3"]="certificatePolicies";a["2.5.29.4"]="keyUsageRestriction";a["2.5.29.5"]="policyMapping";a["2.5.29.6"]="subtreesConstraint";a["2.5.29.7"]="subjectAltName";a["2.5.29.8"]="issuerAltName";a["2.5.29.9"]="subjectDirectoryAttributes";
a["2.5.29.10"]="basicConstraints";a["2.5.29.11"]="nameConstraints";a["2.5.29.12"]="policyConstraints";a["2.5.29.13"]="basicConstraints";a["2.5.29.14"]="subjectKeyIdentifier";a.subjectKeyIdentifier="2.5.29.14";a["2.5.29.15"]="keyUsage";a.keyUsage="2.5.29.15";a["2.5.29.16"]="privateKeyUsagePeriod";a["2.5.29.17"]="subjectAltName";a.subjectAltName="2.5.29.17";a["2.5.29.18"]="issuerAltName";a.issuerAltName="2.5.29.18";a["2.5.29.19"]="basicConstraints";a.basicConstraints="2.5.29.19";a["2.5.29.20"]="cRLNumber";
a["2.5.29.21"]="cRLReason";a["2.5.29.22"]="expirationDate";a["2.5.29.23"]="instructionCode";a["2.5.29.24"]="invalidityDate";a["2.5.29.25"]="cRLDistributionPoints";a["2.5.29.26"]="issuingDistributionPoint";a["2.5.29.27"]="deltaCRLIndicator";a["2.5.29.28"]="issuingDistributionPoint";a["2.5.29.29"]="certificateIssuer";a["2.5.29.30"]="nameConstraints";a["2.5.29.31"]="cRLDistributionPoints";a.cRLDistributionPoints="2.5.29.31";a["2.5.29.32"]="certificatePolicies";a.certificatePolicies="2.5.29.32";a["2.5.29.33"]=
"policyMappings";a["2.5.29.34"]="policyConstraints";a["2.5.29.35"]="authorityKeyIdentifier";a.authorityKeyIdentifier="2.5.29.35";a["2.5.29.36"]="policyConstraints";a["2.5.29.37"]="extKeyUsage";a.extKeyUsage="2.5.29.37";a["2.5.29.46"]="freshestCRL";a["2.5.29.54"]="inhibitAnyPolicy";a["1.3.6.1.4.1.11129.2.4.2"]="timestampList";a.timestampList="1.3.6.1.4.1.11129.2.4.2";a["1.3.6.1.5.5.7.1.1"]="authorityInfoAccess";a.authorityInfoAccess="1.3.6.1.5.5.7.1.1";a["1.3.6.1.5.5.7.3.1"]="serverAuth";a.serverAuth=
"1.3.6.1.5.5.7.3.1";a["1.3.6.1.5.5.7.3.2"]="clientAuth";a.clientAuth="1.3.6.1.5.5.7.3.2";a["1.3.6.1.5.5.7.3.3"]="codeSigning";a.codeSigning="1.3.6.1.5.5.7.3.3";a["1.3.6.1.5.5.7.3.4"]="emailProtection";a.emailProtection="1.3.6.1.5.5.7.3.4";a["1.3.6.1.5.5.7.3.8"]="timeStamping";a.timeStamping="1.3.6.1.5.5.7.3.8"}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=
function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.oids)return d.oids;d.defined.oids=!0;for(var k=0;k<f.length;++k)f[k](d);return d.oids}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/oids",["require","module"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){var f=
a.asn1=a.asn1||{};f.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};f.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};f.create=function(d,e,b,c){if(a.util.isArray(c)){for(var k=[],g=0;g<c.length;++g)void 0!==c[g]&&k.push(c[g]);c=k}return{tagClass:d,type:e,constructed:b,composed:b||a.util.isArray(c),
value:c}};var d=f.getBerValueLength=function(a){var e=a.getByte();if(128!==e)return e&128?a.getInt((e&127)<<3):e};f.fromDer=function(k,e){void 0===e&&(e=!0);"string"===typeof k&&(k=a.util.createBuffer(k));if(2>k.length()){var b=Error("Too few bytes to parse DER.");b.bytes=k.length();throw b;}var c=k.getByte();b=c&192;var u=c&31,g=d(k);if(k.length()<g){if(e)throw b=Error("Too few bytes to read ASN.1 value."),b.detail=k.length()+" < "+g,b;g=k.length()}var t=32===(c&32);var w=t;if(!w&&b===f.Class.UNIVERSAL&&
u===f.Type.BITSTRING&&1<g){var z=k.read;if(0===k.getByte()&&(c=k.getByte(),c&=192,c===f.Class.UNIVERSAL||c===f.Class.CONTEXT_SPECIFIC))try{if(w=d(k)===g-(k.read-z))++z,--g}catch(n){}k.read=z}if(w)if(w=[],void 0===g)for(;;){if(k.bytes(2)===String.fromCharCode(0,0)){k.getBytes(2);break}w.push(f.fromDer(k,e))}else for(z=k.length();0<g;)w.push(f.fromDer(k,e)),g-=z-k.length(),z=k.length();else{if(void 0===g){if(e)throw Error("Non-constructed ASN.1 object of indefinite length.");g=k.length()}if(u===f.Type.BMPSTRING)for(w=
"",z=0;z<g;z+=2)w+=String.fromCharCode(k.getInt16());else w=k.getBytes(g)}return f.create(b,u,t,w)};f.toDer=function(d){var e=a.util.createBuffer(),b=d.tagClass|d.type,c=a.util.createBuffer();if(d.composed){d.constructed?b|=32:c.putByte(0);for(var k=0;k<d.value.length;++k)void 0!==d.value[k]&&c.putBuffer(f.toDer(d.value[k]))}else if(d.type===f.Type.BMPSTRING)for(k=0;k<d.value.length;++k)c.putInt16(d.value.charCodeAt(k));else d.type===f.Type.INTEGER&&1<d.value.length&&(0===d.value.charCodeAt(0)&&0===
(d.value.charCodeAt(1)&128)||255===d.value.charCodeAt(0)&&128===(d.value.charCodeAt(1)&128))?c.putBytes(d.value.substr(1)):c.putBytes(d.value);e.putByte(b);if(127>=c.length())e.putByte(c.length()&127);else{k=c.length();d="";do d+=String.fromCharCode(k&255),k>>>=8;while(0<k);e.putByte(d.length|128);for(k=d.length-1;0<=k;--k)e.putByte(d.charCodeAt(k))}e.putBuffer(c);return e};f.oidToDer=function(d){d=d.split(".");var e=a.util.createBuffer();e.putByte(40*parseInt(d[0],10)+parseInt(d[1],10));for(var b,
c,k,g,f=2;f<d.length;++f){b=!0;c=[];k=parseInt(d[f],10);do g=k&127,k>>>=7,b||(g|=128),c.push(g),b=!1;while(0<k);for(b=c.length-1;0<=b;--b)e.putByte(c[b])}return e};f.derToOid=function(d){"string"===typeof d&&(d=a.util.createBuffer(d));var e=d.getByte();var b=Math.floor(e/40)+"."+e%40;for(var c=0;0<d.length();)e=d.getByte(),c<<=7,e&128?c+=e&127:(b+="."+(c+e),c=0);return b};f.utcTimeToDate=function(a){var e=new Date,b=parseInt(a.substr(0,2),10);b=50<=b?1900+b:2E3+b;var c=parseInt(a.substr(2,2),10)-
1,d=parseInt(a.substr(4,2),10),g=parseInt(a.substr(6,2),10),k=parseInt(a.substr(8,2),10),w=0;if(11<a.length){var f=a.charAt(10),n=10;"+"!==f&&"-"!==f&&(w=parseInt(a.substr(10,2),10),n+=2)}e.setUTCFullYear(b,c,d);e.setUTCHours(g,k,w,0);n&&(f=a.charAt(n),"+"===f||"-"===f)&&(b=parseInt(a.substr(n+1,2),10),a=parseInt(a.substr(n+4,2),10),a=6E4*(60*b+a),"+"===f?e.setTime(+e-a):e.setTime(+e+a));return e};f.generalizedTimeToDate=function(a){var e=new Date,b=parseInt(a.substr(0,4),10),c=parseInt(a.substr(4,
2),10)-1,d=parseInt(a.substr(6,2),10),g=parseInt(a.substr(8,2),10),k=parseInt(a.substr(10,2),10),w=parseInt(a.substr(12,2),10),f=0,n=0,r=!1;"Z"===a.charAt(a.length-1)&&(r=!0);var y=a.length-5,v=a.charAt(y);if("+"===v||"-"===v)n=parseInt(a.substr(y+1,2),10),y=parseInt(a.substr(y+4,2),10),n=6E4*(60*n+y),"+"===v&&(n*=-1),r=!0;"."===a.charAt(14)&&(f=1E3*parseFloat(a.substr(14),10));r?(e.setUTCFullYear(b,c,d),e.setUTCHours(g,k,w,f),e.setTime(+e+n)):(e.setFullYear(b,c,d),e.setHours(g,k,w,f));return e};
f.dateToUtcTime=function(a){if("string"===typeof a)return a;var e="",b=[];b.push((""+a.getUTCFullYear()).substr(2));b.push(""+(a.getUTCMonth()+1));b.push(""+a.getUTCDate());b.push(""+a.getUTCHours());b.push(""+a.getUTCMinutes());b.push(""+a.getUTCSeconds());for(a=0;a<b.length;++a)2>b[a].length&&(e+="0"),e+=b[a];return e+"Z"};f.dateToGeneralizedTime=function(a){if("string"===typeof a)return a;var e="",b=[];b.push(""+a.getUTCFullYear());b.push(""+(a.getUTCMonth()+1));b.push(""+a.getUTCDate());b.push(""+
a.getUTCHours());b.push(""+a.getUTCMinutes());b.push(""+a.getUTCSeconds());for(a=0;a<b.length;++a)2>b[a].length&&(e+="0"),e+=b[a];return e+"Z"};f.integerToDer=function(d){var e=a.util.createBuffer();if(-128<=d&&128>d)return e.putSignedInt(d,8);if(-32768<=d&&32768>d)return e.putSignedInt(d,16);if(-8388608<=d&&8388608>d)return e.putSignedInt(d,24);if(-2147483648<=d&&2147483648>d)return e.putSignedInt(d,32);e=Error("Integer too large; max is 32-bits.");e.integer=d;throw e;};f.derToInteger=function(d){"string"===
typeof d&&(d=a.util.createBuffer(d));var e=8*d.length();if(32<e)throw Error("Integer too large; max is 32-bits.");return d.getSignedInt(e)};f.validate=function(d,e,b,c){var k=!1;if(d.tagClass!==e.tagClass&&"undefined"!==typeof e.tagClass||d.type!==e.type&&"undefined"!==typeof e.type)c&&(d.tagClass!==e.tagClass&&c.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+d.tagClass+'"'),d.type!==e.type&&c.push("["+e.name+'] Expected type "'+e.type+'", got "'+d.type+'"'));else if(d.constructed===
e.constructed||"undefined"===typeof e.constructed){k=!0;if(e.value&&a.util.isArray(e.value))for(var g=0,t=0;k&&t<e.value.length;++t)k=e.value[t].optional||!1,d.value[g]&&((k=f.validate(d.value[g],e.value[t],b,c))?++g:e.value[t].optional&&(k=!0)),!k&&c&&c.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+d.value.length+'"');k&&b&&(e.capture&&(b[e.capture]=d.value),e.captureAsn1&&(b[e.captureAsn1]=d))}else c&&c.push("["+e.name+'] Expected constructed "'+
e.constructed+'", got "'+d.constructed+'"');return k};var F=/[^\\u0000-\\u00ff]/;f.prettyPrint=function(d,e,b){var c="";e=e||0;b=b||2;0<e&&(c+="\n");for(var k="",g=0;g<e*b;++g)k+=" ";c+=k+"Tag: ";switch(d.tagClass){case f.Class.UNIVERSAL:c+="Universal:";break;case f.Class.APPLICATION:c+="Application:";break;case f.Class.CONTEXT_SPECIFIC:c+="Context-Specific:";break;case f.Class.PRIVATE:c+="Private:"}if(d.tagClass===f.Class.UNIVERSAL)switch(c+=d.type,d.type){case f.Type.NONE:c+=" (None)";break;case f.Type.BOOLEAN:c+=
" (Boolean)";break;case f.Type.BITSTRING:c+=" (Bit string)";break;case f.Type.INTEGER:c+=" (Integer)";break;case f.Type.OCTETSTRING:c+=" (Octet string)";break;case f.Type.NULL:c+=" (Null)";break;case f.Type.OID:c+=" (Object Identifier)";break;case f.Type.ODESC:c+=" (Object Descriptor)";break;case f.Type.EXTERNAL:c+=" (External or Instance of)";break;case f.Type.REAL:c+=" (Real)";break;case f.Type.ENUMERATED:c+=" (Enumerated)";break;case f.Type.EMBEDDED:c+=" (Embedded PDV)";break;case f.Type.UTF8:c+=
" (UTF8)";break;case f.Type.ROID:c+=" (Relative Object Identifier)";break;case f.Type.SEQUENCE:c+=" (Sequence)";break;case f.Type.SET:c+=" (Set)";break;case f.Type.PRINTABLESTRING:c+=" (Printable String)";break;case f.Type.IA5String:c+=" (IA5String (ASCII))";break;case f.Type.UTCTIME:c+=" (UTC time)";break;case f.Type.GENERALIZEDTIME:c+=" (Generalized time)";break;case f.Type.BMPSTRING:c+=" (BMP String)"}else c+=d.type;c=c+"\n"+(k+"Constructed: "+d.constructed+"\n");if(d.composed){var t=0,w="";for(g=
0;g<d.value.length;++g)void 0!==d.value[g]&&(t+=1,w+=f.prettyPrint(d.value[g],e+1,b),g+1<d.value.length&&(w+=","));c+=k+"Sub values: "+t+w}else if(c+=k+"Value: ",d.type===f.Type.OID&&(e=f.derToOid(d.value),c+=e,a.pki&&a.pki.oids&&e in a.pki.oids&&(c+=" ("+a.pki.oids[e]+") ")),d.type===f.Type.INTEGER)try{c+=f.derToInteger(d.value)}catch(z){c+="0x"+a.util.bytesToHex(d.value)}else d.type===f.Type.OCTETSTRING?(F.test(d.value)||(c+="("+d.value+") "),c+="0x"+a.util.bytesToHex(d.value)):c=d.type===f.Type.UTF8?
c+a.util.decodeUtf8(d.value):d.type===f.Type.PRINTABLESTRING||d.type===f.Type.IA5String?c+d.value:F.test(d.value)?c+("0x"+a.util.bytesToHex(d.value)):0===d.value.length?c+"[null]":c+d.value;return c}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.asn1)return d.asn1;
d.defined.asn1=!0;for(var k=0;k<f.length;++k)f[k](d);return d.asn1}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/asn1",["require","module","./util","./oids"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(){k=String.fromCharCode(128);k+=a.util.fillString(String.fromCharCode(0),64);
e=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,1,6,11,0,5,10,15,4,9,14,3,8,13,2,7,12,5,8,11,14,1,4,7,10,13,0,3,6,9,12,15,2,0,7,14,5,12,3,10,1,8,15,6,13,4,11,2,9];b=[7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21];c=Array(64);for(var g=0;64>g;++g)c[g]=Math.floor(4294967296*Math.abs(Math.sin(g+1)));u=!0}function d(a,d,w){for(var g,n,r,f,v,E,h,m=w.length();64<=m;){n=a.h0;r=a.h1;f=a.h2;
v=a.h3;for(h=0;16>h;++h)d[h]=w.getInt32Le(),g=v^r&(f^v),g=n+g+c[h]+d[h],E=b[h],n=v,v=f,f=r,r+=g<<E|g>>>32-E;for(;32>h;++h)g=f^v&(r^f),g=n+g+c[h]+d[e[h]],E=b[h],n=v,v=f,f=r,r+=g<<E|g>>>32-E;for(;48>h;++h)g=r^f^v,g=n+g+c[h]+d[e[h]],E=b[h],n=v,v=f,f=r,r+=g<<E|g>>>32-E;for(;64>h;++h)g=f^(r|~v),g=n+g+c[h]+d[e[h]],E=b[h],n=v,v=f,f=r,r+=g<<E|g>>>32-E;a.h0=a.h0+n|0;a.h1=a.h1+r|0;a.h2=a.h2+f|0;a.h3=a.h3+v|0;m-=64}}var F=a.md5=a.md5||{};a.md=a.md||{};a.md.algorithms=a.md.algorithms||{};a.md.md5=a.md.algorithms.md5=
F;F.create=function(){u||f();var b=null,c=a.util.createBuffer(),e=Array(16),z={algorithm:"md5",blockLength:64,digestLength:16,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){z.messageLength=0;z.fullMessageLength=z.messageLength64=[];for(var e=z.messageLengthSize/4,d=0;d<e;++d)z.fullMessageLength.push(0);c=a.util.createBuffer();b={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878};return z}};z.start();z.update=function(g,r){"utf8"===r&&(g=a.util.encodeUtf8(g));var n=
g.length;z.messageLength+=n;n=[n/4294967296>>>0,n>>>0];for(var v=z.fullMessageLength.length-1;0<=v;--v)z.fullMessageLength[v]+=n[1],n[1]=n[0]+(z.fullMessageLength[v]/4294967296>>>0),z.fullMessageLength[v]>>>=0,n[0]=n[1]/4294967296>>>0;c.putBytes(g);d(b,e,c);(2048<c.read||0===c.length())&&c.compact();return z};z.digest=function(){var g=a.util.createBuffer();g.putBytes(c.bytes());g.putBytes(k.substr(0,z.blockLength-(z.fullMessageLength[z.fullMessageLength.length-1]+z.messageLengthSize&z.blockLength-
1)));for(var r,f=0,v=z.fullMessageLength.length-1;0<=v;--v)r=8*z.fullMessageLength[v]+f,f=r/4294967296>>>0,g.putInt32Le(r>>>0);r={h0:b.h0,h1:b.h1,h2:b.h2,h3:b.h3};d(r,e,g);g=a.util.createBuffer();g.putInt32Le(r.h0);g.putInt32Le(r.h1);g.putInt32Le(r.h2);g.putInt32Le(r.h3);return g};return z};var k=null,e=null,b=null,c=null,u=!1}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,
D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.md5)return d.md5;d.defined.md5=!0;for(var k=0;k<f.length;++k)f[k](d);return d.md5}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/md5",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,
0))})})();(function(){function q(a){function f(a,b,c){for(var e,g,d,f,k,n,r,y,v=c.length();64<=v;){g=a.h0;d=a.h1;f=a.h2;k=a.h3;n=a.h4;for(y=0;16>y;++y)e=c.getInt32(),b[y]=e,r=k^d&(f^k),e=(g<<5|g>>>27)+r+n+1518500249+e,n=k,k=f,f=(d<<30|d>>>2)>>>0,d=g,g=e;for(;20>y;++y)e=b[y-3]^b[y-8]^b[y-14]^b[y-16],e=e<<1|e>>>31,b[y]=e,r=k^d&(f^k),e=(g<<5|g>>>27)+r+n+1518500249+e,n=k,k=f,f=(d<<30|d>>>2)>>>0,d=g,g=e;for(;32>y;++y)e=b[y-3]^b[y-8]^b[y-14]^b[y-16],e=e<<1|e>>>31,b[y]=e,r=d^f^k,e=(g<<5|g>>>27)+r+n+1859775393+
e,n=k,k=f,f=(d<<30|d>>>2)>>>0,d=g,g=e;for(;40>y;++y)e=b[y-6]^b[y-16]^b[y-28]^b[y-32],e=e<<2|e>>>30,b[y]=e,r=d^f^k,e=(g<<5|g>>>27)+r+n+1859775393+e,n=k,k=f,f=(d<<30|d>>>2)>>>0,d=g,g=e;for(;60>y;++y)e=b[y-6]^b[y-16]^b[y-28]^b[y-32],e=e<<2|e>>>30,b[y]=e,r=d&f|k&(d^f),e=(g<<5|g>>>27)+r+n+2400959708+e,n=k,k=f,f=(d<<30|d>>>2)>>>0,d=g,g=e;for(;80>y;++y)e=b[y-6]^b[y-16]^b[y-28]^b[y-32],e=e<<2|e>>>30,b[y]=e,r=d^f^k,e=(g<<5|g>>>27)+r+n+3395469782+e,n=k,k=f,f=(d<<30|d>>>2)>>>0,d=g,g=e;a.h0=a.h0+g|0;a.h1=a.h1+
d|0;a.h2=a.h2+f|0;a.h3=a.h3+k|0;a.h4=a.h4+n|0;v-=64}}var d=a.sha1=a.sha1||{};a.md=a.md||{};a.md.algorithms=a.md.algorithms||{};a.md.sha1=a.md.algorithms.sha1=d;d.create=function(){k||(F=String.fromCharCode(128),F+=a.util.fillString(String.fromCharCode(0),64),k=!0);var e=null,b=a.util.createBuffer(),c=Array(80),d={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){d.messageLength=0;d.fullMessageLength=d.messageLength64=[];for(var c=
d.messageLengthSize/4,f=0;f<c;++f)d.fullMessageLength.push(0);b=a.util.createBuffer();e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520};return d}};d.start();d.update=function(g,k){"utf8"===k&&(g=a.util.encodeUtf8(g));var w=g.length;d.messageLength+=w;w=[w/4294967296>>>0,w>>>0];for(var z=d.fullMessageLength.length-1;0<=z;--z)d.fullMessageLength[z]+=w[1],w[1]=w[0]+(d.fullMessageLength[z]/4294967296>>>0),d.fullMessageLength[z]>>>=0,w[0]=w[1]/4294967296>>>0;b.putBytes(g);f(e,c,
b);(2048<b.read||0===b.length())&&b.compact();return d};d.digest=function(){var g=a.util.createBuffer();g.putBytes(b.bytes());g.putBytes(F.substr(0,d.blockLength-(d.fullMessageLength[d.fullMessageLength.length-1]+d.messageLengthSize&d.blockLength-1)));for(var k,w,z=8*d.fullMessageLength[0],n=0;n<d.fullMessageLength.length-1;++n)k=8*d.fullMessageLength[n+1],w=k/4294967296>>>0,z+=w,g.putInt32(z>>>0),z=k>>>0;g.putInt32(z);k={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};f(k,c,g);g=a.util.createBuffer();g.putInt32(k.h0);
g.putInt32(k.h1);g.putInt32(k.h2);g.putInt32(k.h3);g.putInt32(k.h4);return g};return d};var F=null,k=!1}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.sha1)return d.sha1;d.defined.sha1=!0;for(var k=0;k<f.length;++k)f[k](d);return d.sha1}},A=p;p=
function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/sha1",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(a,c,d){for(var b,f,w,k,n,r,y,v,E,h,m,C,l,L=d.length();64<=L;){for(n=0;16>n;++n)c[n]=d.getInt32();for(;64>n;++n)b=c[n-2],b=(b>>>17|b<<15)^(b>>>19|b<<13)^b>>>10,f=
c[n-15],f=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,c[n]=b+c[n-7]+f+c[n-16]|0;r=a.h0;y=a.h1;v=a.h2;E=a.h3;h=a.h4;m=a.h5;C=a.h6;l=a.h7;for(n=0;64>n;++n)b=(h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7),w=C^h&(m^C),f=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),k=r&y|v&(r^y),b=l+b+w+e[n]+c[n],f+=k,l=C,C=m,m=h,h=E+b>>>0,E=v,v=y,y=r,r=b+f>>>0;a.h0=a.h0+r|0;a.h1=a.h1+y|0;a.h2=a.h2+v|0;a.h3=a.h3+E|0;a.h4=a.h4+h|0;a.h5=a.h5+m|0;a.h6=a.h6+C|0;a.h7=a.h7+l|0;L-=64}}var d=a.sha256=a.sha256||{};a.md=a.md||{};a.md.algorithms=
a.md.algorithms||{};a.md.sha256=a.md.algorithms.sha256=d;d.create=function(){k||(F=String.fromCharCode(128),F+=a.util.fillString(String.fromCharCode(0),64),e=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,
666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],k=!0);var b=null,c=a.util.createBuffer(),d=Array(64),g={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,
start:function(){g.messageLength=0;g.fullMessageLength=g.messageLength64=[];for(var e=g.messageLengthSize/4,d=0;d<e;++d)g.fullMessageLength.push(0);c=a.util.createBuffer();b={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225};return g}};g.start();g.update=function(e,w){"utf8"===w&&(e=a.util.encodeUtf8(e));var k=e.length;g.messageLength+=k;k=[k/4294967296>>>0,k>>>0];for(var n=g.fullMessageLength.length-1;0<=n;--n)g.fullMessageLength[n]+=
k[1],k[1]=k[0]+(g.fullMessageLength[n]/4294967296>>>0),g.fullMessageLength[n]>>>=0,k[0]=k[1]/4294967296>>>0;c.putBytes(e);f(b,d,c);(2048<c.read||0===c.length())&&c.compact();return g};g.digest=function(){var e=a.util.createBuffer();e.putBytes(c.bytes());e.putBytes(F.substr(0,g.blockLength-(g.fullMessageLength[g.fullMessageLength.length-1]+g.messageLengthSize&g.blockLength-1)));for(var k,z,n=8*g.fullMessageLength[0],r=0;r<g.fullMessageLength.length-1;++r)k=8*g.fullMessageLength[r+1],z=k/4294967296>>>
0,n+=z,e.putInt32(n>>>0),n=k>>>0;e.putInt32(n);k={h0:b.h0,h1:b.h1,h2:b.h2,h3:b.h3,h4:b.h4,h5:b.h5,h6:b.h6,h7:b.h7};f(k,d,e);e=a.util.createBuffer();e.putInt32(k.h0);e.putInt32(k.h1);e.putInt32(k.h2);e.putInt32(k.h3);e.putInt32(k.h4);e.putInt32(k.h5);e.putInt32(k.h6);e.putInt32(k.h7);return e};return g};var F=null,k=!1,e=null}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=
function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.sha256)return d.sha256;d.defined.sha256=!0;for(var k=0;k<f.length;++k)f[k](d);return d.sha256}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/sha256",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,
0))})})();(function(){function q(a){function f(a,c,e){for(var d,g,n,f,k,v,E,h,m,C,l,L,t,J,P,M,u,F,p,q,U,x,H,I,R,V=e.length();128<=V;){for(R=0;16>R;++R)c[R][0]=e.getInt32()>>>0,c[R][1]=e.getInt32()>>>0;for(;80>R;++R)k=c[R-2],m=k[0],k=k[1],d=((m>>>19|k<<13)^(k>>>29|m<<3)^m>>>6)>>>0,g=((m<<13|k>>>19)^(k<<3|m>>>29)^(m<<26|k>>>6))>>>0,k=c[R-15],m=k[0],k=k[1],n=((m>>>1|k<<31)^(m>>>8|k<<24)^m>>>7)>>>0,f=((m<<31|k>>>1)^(m<<24|k>>>8)^(m<<25|k>>>7))>>>0,m=c[R-7],C=c[R-16],k=g+m[1]+f+C[1],c[R][0]=d+m[0]+n+C[0]+
(k/4294967296>>>0)>>>0,c[R][1]=k>>>0;m=a[0][0];C=a[0][1];l=a[1][0];L=a[1][1];t=a[2][0];J=a[2][1];P=a[3][0];M=a[3][1];u=a[4][0];F=a[4][1];p=a[5][0];q=a[5][1];U=a[6][0];x=a[6][1];H=a[7][0];I=a[7][1];for(R=0;80>R;++R)d=((u>>>14|F<<18)^(u>>>18|F<<14)^(F>>>9|u<<23))>>>0,k=((u<<18|F>>>14)^(u<<14|F>>>18)^(F<<23|u>>>9))>>>0,g=(U^u&(p^U))>>>0,v=(x^F&(q^x))>>>0,n=((m>>>28|C<<4)^(C>>>2|m<<30)^(C>>>7|m<<25))>>>0,f=((m<<4|C>>>28)^(C<<30|m>>>2)^(C<<25|m>>>7))>>>0,E=(m&l|t&(m^l))>>>0,h=(C&L|J&(C^L))>>>0,k=I+k+v+
b[R][1]+c[R][1],d=H+d+g+b[R][0]+c[R][0]+(k/4294967296>>>0)>>>0,g=k>>>0,k=f+h,n=n+E+(k/4294967296>>>0)>>>0,f=k>>>0,H=U,I=x,U=p,x=q,p=u,q=F,k=M+g,u=P+d+(k/4294967296>>>0)>>>0,F=k>>>0,P=t,M=J,t=l,J=L,l=m,L=C,k=g+f,m=d+n+(k/4294967296>>>0)>>>0,C=k>>>0;k=a[0][1]+C;a[0][0]=a[0][0]+m+(k/4294967296>>>0)>>>0;a[0][1]=k>>>0;k=a[1][1]+L;a[1][0]=a[1][0]+l+(k/4294967296>>>0)>>>0;a[1][1]=k>>>0;k=a[2][1]+J;a[2][0]=a[2][0]+t+(k/4294967296>>>0)>>>0;a[2][1]=k>>>0;k=a[3][1]+M;a[3][0]=a[3][0]+P+(k/4294967296>>>0)>>>0;
a[3][1]=k>>>0;k=a[4][1]+F;a[4][0]=a[4][0]+u+(k/4294967296>>>0)>>>0;a[4][1]=k>>>0;k=a[5][1]+q;a[5][0]=a[5][0]+p+(k/4294967296>>>0)>>>0;a[5][1]=k>>>0;k=a[6][1]+x;a[6][0]=a[6][0]+U+(k/4294967296>>>0)>>>0;a[6][1]=k>>>0;k=a[7][1]+I;a[7][0]=a[7][0]+H+(k/4294967296>>>0)>>>0;a[7][1]=k>>>0;V-=128}}var d=a.sha512=a.sha512||{};a.md=a.md||{};a.md.algorithms=a.md.algorithms||{};a.md.sha512=a.md.algorithms.sha512=d;var F=a.sha384=a.sha512.sha384=a.sha512.sha384||{};F.create=function(){return d.create("SHA-384")};
a.md.sha384=a.md.algorithms.sha384=F;a.sha512.sha256=a.sha512.sha256||{create:function(){return d.create("SHA-512/256")}};a.md["sha512/256"]=a.md.algorithms["sha512/256"]=a.sha512.sha256;a.sha512.sha224=a.sha512.sha224||{create:function(){return d.create("SHA-512/224")}};a.md["sha512/224"]=a.md.algorithms["sha512/224"]=a.sha512.sha224;d.create=function(d){e||(k=String.fromCharCode(128),k+=a.util.fillString(String.fromCharCode(0),128),b=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],
[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,
3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],
[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,
4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],c={"SHA-512":[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],"SHA-384":[[3418070365,
3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],"SHA-512/256":[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],"SHA-512/224":[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],
[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]]},e=!0);"undefined"===typeof d&&(d="SHA-512");if(!(d in c))throw Error("Invalid SHA-512 algorithm: "+d);for(var g=c[d],t=null,w=a.util.createBuffer(),z=Array(80),n=0;80>n;++n)z[n]=Array(2);var r={algorithm:d.replace("-","").toLowerCase(),blockLength:128,digestLength:64,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){r.messageLength=0;r.fullMessageLength=r.messageLength128=[];for(var b=r.messageLengthSize/
4,c=0;c<b;++c)r.fullMessageLength.push(0);w=a.util.createBuffer();t=Array(g.length);for(c=0;c<g.length;++c)t[c]=g[c].slice(0);return r}};r.start();r.update=function(b,c){"utf8"===c&&(b=a.util.encodeUtf8(b));var e=b.length;r.messageLength+=e;e=[e/4294967296>>>0,e>>>0];for(var h=r.fullMessageLength.length-1;0<=h;--h)r.fullMessageLength[h]+=e[1],e[1]=e[0]+(r.fullMessageLength[h]/4294967296>>>0),r.fullMessageLength[h]>>>=0,e[0]=e[1]/4294967296>>>0;w.putBytes(b);f(t,z,w);(2048<w.read||0===w.length())&&
w.compact();return r};r.digest=function(){var b=a.util.createBuffer();b.putBytes(w.bytes());b.putBytes(k.substr(0,r.blockLength-(r.fullMessageLength[r.fullMessageLength.length-1]+r.messageLengthSize&r.blockLength-1)));for(var c,e,h=8*r.fullMessageLength[0],m=0;m<r.fullMessageLength.length-1;++m)c=8*r.fullMessageLength[m+1],e=c/4294967296>>>0,h+=e,b.putInt32(h>>>0),h=c>>>0;b.putInt32(h);c=Array(t.length);for(m=0;m<t.length;++m)c[m]=t[m].slice(0);f(c,z,b);b=a.util.createBuffer();e="SHA-512"===d?c.length:
"SHA-384"===d?c.length-2:c.length-4;for(m=0;m<e;++m)b.putInt32(c[m][0]),m===e-1&&"SHA-512/224"===d||b.putInt32(c[m][1]);return b};return r};var k=null,e=!1,b=null,c=null}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.sha512)return d.sha512;d.defined.sha512=
!0;for(var k=0;k<f.length;++k)f[k](d);return d.sha512}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/sha512",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){a.md=a.md||{};a.md.algorithms={md5:a.md5,sha1:a.sha1,sha256:a.sha256};a.md.md5=a.md5;a.md.sha1=a.sha1;a.md.sha256=
a.sha256}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.md)return d.md;d.defined.md=!0;for(var k=0;k<f.length;++k)f[k](d);return d.md}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,
0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/md","require module ./md5 ./sha1 ./sha256 ./sha512".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){(a.hmac=a.hmac||{}).create=function(){var f=null,d=null,F=null,k={start:function(e,b){if(null!==e)if("string"===typeof e)if(e=e.toLowerCase(),e in a.md.algorithms)f=a.md.algorithms[e].create();else throw Error('Unknown hash algorithm "'+e+'"');else f=e;if(null!==b){if("string"===
typeof b)b=a.util.createBuffer(b);else if(a.util.isArray(b)){var c=b;b=a.util.createBuffer();for(var k=0;k<c.length;++k)b.putByte(c[k])}var g=b.length();g>f.blockLength&&(f.start(),f.update(b.bytes()),b=f.digest());d=a.util.createBuffer();F=a.util.createBuffer();g=b.length();for(k=0;k<g;++k)c=b.at(k),d.putByte(54^c),F.putByte(92^c);if(g<f.blockLength)for(c=f.blockLength-g,k=0;k<c;++k)d.putByte(54),F.putByte(92);d=d.bytes();F=F.bytes()}f.start();f.update(d)},update:function(a){f.update(a)},getMac:function(){var a=
f.digest().bytes();f.start();f.update(F);f.update(a);return f.digest()}};k.digest=k.getMac;return k}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.hmac)return d.hmac;d.defined.hmac=!0;for(var k=0;k<f.length;++k)f[k](d);return d.hmac}},A=p;p=function(a,
f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/hmac",["require","module","./md","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(a){for(var d=a.name+": ",e=[],b=function(a,b){return" "+b},c=0;c<a.values.length;++c)e.push(a.values[c].replace(/^(\S+\r\n)/,b));d+=e.join(",")+"\r\n";e=0;a=-1;for(c=
0;c<d.length;++c,++e)if(65<e&&-1!==a)e=d[a],","===e?(++a,d=d.substr(0,a)+"\r\n "+d.substr(a)):d=d.substr(0,a)+"\r\n"+e+d.substr(a+1),e=c-a-1,a=-1,++c;else if(" "===d[c]||"\t"===d[c]||","===d[c])a=c;return d}var d=a.pem=a.pem||{};d.encode=function(d,k){k=k||{};var e="-----BEGIN "+d.type+"-----\r\n";if(d.procType){var b={name:"Proc-Type",values:[String(d.procType.version),d.procType.type]};e+=f(b)}d.contentDomain&&(b={name:"Content-Domain",values:[d.contentDomain]},e+=f(b));d.dekInfo&&(b={name:"DEK-Info",
values:[d.dekInfo.algorithm]},d.dekInfo.parameters&&b.values.push(d.dekInfo.parameters),e+=f(b));if(d.headers)for(b=0;b<d.headers.length;++b)e+=f(d.headers[b]);d.procType&&(e+="\r\n");e+=a.util.encode64(d.body,k.maxline||64)+"\r\n";return e+="-----END "+d.type+"-----\r\n"};d.decode=function(d){for(var f=[],e=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,b=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,c=/\r?\n/,u;;){u=e.exec(d);if(!u)break;
var g={type:u[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:a.util.decode64(u[3])};f.push(g);if(u[2]){for(var t=u[2].split(c),w=0;u&&w<t.length;){u=t[w].replace(/\s+$/,"");for(var z=w+1;z<t.length;++z){var n=t[z];if(!/\s/.test(n[0]))break;u+=n;w=z}if(u=u.match(b)){z={name:u[1],values:[]};n=u[2].split(",");for(var r=0;r<n.length;++r)z.values.push(n[r].replace(/^\s+/,""));if(g.procType)if(g.contentDomain||"Content-Domain"!==z.name)if(g.dekInfo||"DEK-Info"!==z.name)g.headers.push(z);
else{if(0===z.values.length)throw Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');g.dekInfo={algorithm:n[0],parameters:n[1]||null}}else g.contentDomain=n[0]||"";else{if("Proc-Type"!==z.name)throw Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==z.values.length)throw Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');g.procType={version:n[0],type:n[1]}}}++w}if("ENCRYPTED"===
g.procType&&!g.dekInfo)throw Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".');}}if(0===f.length)throw Error("Invalid PEM formatted message.");return f}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(e){return a(e)}).concat(q);d=d||{};d.defined=d.defined||{};
if(d.defined.pem)return d.pem;d.defined.pem=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pem}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/pem",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(b,c){a.cipher.registerAlgorithm(b,function(){return new a.des.Algorithm(b,
c)})}function d(a,d,f,y){var n=32===a.length?3:9;y=3===n?y?[30,-2,-2]:[0,32,2]:y?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var r=d[0],h=d[1];d=(r>>>4^h)&252645135;h^=d;r^=d<<4;d=(r>>>16^h)&65535;h^=d;r^=d<<16;d=(h>>>2^r)&858993459;r^=d;h^=d<<2;d=(h>>>8^r)&16711935;r^=d;h^=d<<8;d=(r>>>1^h)&1431655765;h^=d;r^=d<<1;r=r<<1|r>>>31;h=h<<1|h>>>31;for(var m=0;m<n;m+=3){for(var C=y[m+1],l=y[m+2],L=y[m];L!=C;L+=l){var z=h^a[L],J=(h>>>4|h<<28)^a[L+1];d=r;r=h;h=d^(e[z>>>24&63]|c[z>>>16&63]|g[z>>>
8&63]|w[z&63]|k[J>>>24&63]|b[J>>>16&63]|u[J>>>8&63]|t[J&63])}d=r;r=h;h=d}r=r>>>1|r<<31;h=h>>>1|h<<31;d=(r>>>1^h)&1431655765;h^=d;r^=d<<1;d=(h>>>8^r)&16711935;r^=d;h^=d<<8;d=(h>>>2^r)&858993459;r^=d;h^=d<<2;d=(r>>>16^h)&65535;h^=d;r^=d<<16;d=(r>>>4^h)&252645135;f[0]=r^d<<4;f[1]=h^d}function F(b){b=b||{};var c="DES-"+(b.mode||"CBC").toUpperCase();var d=b.decrypt?a.cipher.createDecipher(c,b.key):a.cipher.createCipher(c,b.key);var e=d.start;d.start=function(b,c){var h=null;c instanceof a.util.ByteBuffer&&
(h=c,c={});c=c||{};c.output=h;c.iv=b;e.call(d,c)};return d}a.des=a.des||{};a.des.startEncrypting=function(a,b,c,d){a=F({key:a,output:c,decrypt:!1,mode:d||(null===b?"ECB":"CBC")});a.start(b);return a};a.des.createEncryptionCipher=function(a,b){return F({key:a,output:null,decrypt:!1,mode:b})};a.des.startDecrypting=function(a,b,c,d){a=F({key:a,output:c,decrypt:!0,mode:d||(null===b?"ECB":"CBC")});a.start(b);return a};a.des.createDecryptionCipher=function(a,b){return F({key:a,output:null,decrypt:!0,mode:b})};
a.des.Algorithm=function(a,b){var c=this;c.name=a;c.mode=new b({blockSize:8,cipher:{encrypt:function(a,b){return d(c._keys,a,b,!1)},decrypt:function(a,b){return d(c._keys,a,b,!0)}}});c._init=!1};a.des.Algorithm.prototype.initialize=function(b){if(!this._init){b=a.util.createBuffer(b.key);if(0===this.name.indexOf("3DES")&&24!==b.length())throw Error("Invalid Triple-DES key size: "+8*b.length());for(var c=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,
536936960,536936964],d=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],e=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],g=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],f=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],h=[0,1024,32,1056,0,1024,32,1056,
33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],m=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],C=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],l=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],k=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,
1032,268436488,1024,268436480,1032,268436488],w=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],J=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],P=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],M=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],z=8<b.length()?3:1,t=[],u=[0,0,1,1,1,1,1,1,0,
1,1,1,1,1,1,0],F=0,p,q=0;q<z;q++){var H=b.getInt32(),I=b.getInt32();p=(H>>>4^I)&252645135;I^=p;H^=p<<4;p=(I>>>-16^H)&65535;H^=p;I^=p<<-16;p=(H>>>2^I)&858993459;I^=p;H^=p<<2;p=(I>>>-16^H)&65535;H^=p;I^=p<<-16;p=(H>>>1^I)&1431655765;I^=p;H^=p<<1;p=(I>>>8^H)&16711935;H^=p;I^=p<<8;p=(H>>>1^I)&1431655765;I^=p;H^=p<<1;p=H<<8|I>>>20&240;H=I<<24|I<<8&16711680|I>>>8&65280|I>>>24&240;I=p;for(var R=0;R<u.length;++R){u[R]?(H=H<<2|H>>>26,I=I<<2|I>>>26):(H=H<<1|H>>>27,I=I<<1|I>>>27);H&=-15;I&=-15;var V=c[H>>>28]|
d[H>>>24&15]|e[H>>>20&15]|g[H>>>16&15]|f[H>>>12&15]|h[H>>>8&15]|m[H>>>4&15],x=C[I>>>28]|l[I>>>24&15]|k[I>>>20&15]|w[I>>>16&15]|J[I>>>12&15]|P[I>>>8&15]|M[I>>>4&15];p=(x>>>16^V)&65535;t[F++]=V^p;t[F++]=x^p<<16}}this._keys=t;this._init=!0}};f("DES-ECB",a.cipher.modes.ecb);f("DES-CBC",a.cipher.modes.cbc);f("DES-CFB",a.cipher.modes.cfb);f("DES-OFB",a.cipher.modes.ofb);f("DES-CTR",a.cipher.modes.ctr);f("3DES-ECB",a.cipher.modes.ecb);f("3DES-CBC",a.cipher.modes.cbc);f("3DES-CFB",a.cipher.modes.cfb);f("3DES-OFB",
a.cipher.modes.ofb);f("3DES-CTR",a.cipher.modes.ctr);var k=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],
e=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,
1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],b=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,
134348800,134218248,520,134348800,131592,8,134348808,131584],c=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],u=[256,34078976,34078720,1107296512,524288,256,1073741824,
34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,
34078976,1073742080],g=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,
541081600,536870912,4194320,536887312],t=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,
2048,2097154],w=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696]}
if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.des)return d.des;d.defined.des=!0;for(var k=0;k<f.length;++k)f[k](d);return d.des}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,
0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/des",["require","module","./cipher","./cipherModes","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){var f=a.pkcs5=a.pkcs5||{},d="undefined"!==typeof process&&process.versions&&process.versions.node,F;d&&!a.disableNativeCode&&(F=K("crypto"));a.pbkdf2=f.pbkdf2=function(f,e,b,c,u,g){function k(){if(h>n)return g(null,v);y.start(null,null);y.update(e);y.update(a.util.int32ToBytes(h));
m=E=y.digest().getBytes();C=2;w()}function w(){if(C<=b)return y.start(null,null),y.update(E),l=y.digest().getBytes(),m=a.util.xorBytes(m,l,z),E=l,++C,a.util.setImmediate(w);v+=h<n?m:m.substr(0,r);++h;k()}"function"===typeof u&&(g=u,u=null);if(d&&!a.disableNativeCode&&F.pbkdf2&&(null===u||"object"!==typeof u)&&(4<F.pbkdf2Sync.length||!u||"sha1"===u))return"string"!==typeof u&&(u="sha1"),e=new Buffer(e,"binary"),g?4===F.pbkdf2Sync.length?F.pbkdf2(f,e,b,c,function(a,b){if(a)return g(a);g(null,b.toString("binary"))}):
F.pbkdf2(f,e,b,c,u,function(a,b){if(a)return g(a);g(null,b.toString("binary"))}):4===F.pbkdf2Sync.length?F.pbkdf2Sync(f,e,b,c).toString("binary"):F.pbkdf2Sync(f,e,b,c,u).toString("binary");if("undefined"===typeof u||null===u)u=a.md.sha1.create();if("string"===typeof u){if(!(u in a.md.algorithms))throw Error("Unknown hash algorithm: "+u);u=a.md[u].create()}var z=u.digestLength;if(c>4294967295*z){f=Error("Derived key is too long.");if(g)return g(f);throw f;}var n=Math.ceil(c/z),r=c-(n-1)*z,y=a.hmac.create();
y.start(u,f);var v="",E;if(!g){for(var h=1;h<=n;++h){y.start(null,null);y.update(e);y.update(a.util.int32ToBytes(h));var m=E=y.digest().getBytes();for(var C=2;C<=b;++C){y.start(null,null);y.update(E);var l=y.digest().getBytes();m=a.util.xorBytes(m,l,z);E=l}v+=h<n?m:m.substr(0,r)}return v}h=1;k()}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=
x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.pbkdf2)return d.pbkdf2;d.defined.pbkdf2=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pbkdf2}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/pbkdf2",["require","module","./hmac","./md","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();
(function(){function q(a){var f="undefined"!==typeof process&&process.versions&&process.versions.node,d=null;a.disableNativeCode||!f||process.versions["node-webkit"]||(d=K("crypto"));(a.prng=a.prng||{}).create=function(f){function k(a){if(32<=c.pools[0].messageLength)return e(),a();c.seedFile(32-c.pools[0].messageLength<<5,function(b,d){if(b)return a(b);c.collect(d);e();a()})}function e(){var a=c.plugin.md.create();a.update(c.pools[0].digest().getBytes());c.pools[0].start();for(var b=1,d=1;32>d;++d)b=
31===b?2147483648:b<<2,0===b%c.reseeds&&(a.update(c.pools[d].digest().getBytes()),c.pools[d].start());b=a.digest().getBytes();a.start();a.update(b);a=a.digest().getBytes();c.key=c.plugin.formatKey(b);c.seed=c.plugin.formatSeed(a);c.reseeds=4294967295===c.reseeds?0:c.reseeds+1;c.generated=0}function b(b){var c=null;if("undefined"!==typeof window){var d=window.crypto||window.msCrypto;d&&d.getRandomValues&&(c=function(a){return d.getRandomValues(a)})}var e=a.util.createBuffer();if(c)for(;e.length()<
b;){var g=Math.max(1,Math.min(b-e.length(),65536)/4),f=new Uint32Array(Math.floor(g));try{for(c(f),g=0;g<f.length;++g)e.putInt32(f[g])}catch(v){if(!("undefined"!==typeof QuotaExceededError&&v instanceof QuotaExceededError))throw v;}}if(e.length()<b)for(c=Math.floor(65536*getRandomValues());e.length()<b;)for(g=16807*(c&65535),c=16807*(c>>16),g+=(c&32767)<<16,g+=c>>15,g=(g&2147483647)+(g>>31),c=g&4294967295,g=0;3>g;++g)f=c>>>(g<<3),f^=Math.floor(256*getRandomValues()),e.putByte(String.fromCharCode(f&255));
return e.getBytes(b)}var c={plugin:f,key:null,seed:null,time:null,reseeds:0,generated:0};f=f.md;for(var u=Array(32),g=0;32>g;++g)u[g]=f.create();c.pools=u;c.pool=0;c.generate=function(b,d){function e(h){if(h)return d(h);if(E.length()>=b)return d(null,E.getBytes(b));1048575<c.generated&&(c.key=null);if(null===c.key)return a.util.nextTick(function(){k(e)});h=g(c.key,c.seed);c.generated+=h.length;E.putBytes(h);c.key=w(g(c.key,f(c.seed)));c.seed=v(g(c.key,c.seed));a.util.setImmediate(e)}if(!d)return c.generateSync(b);
var g=c.plugin.cipher,f=c.plugin.increment,w=c.plugin.formatKey,v=c.plugin.formatSeed,E=a.util.createBuffer();c.key=null;e()};c.generateSync=function(b){var d=c.plugin.cipher,g=c.plugin.increment,n=c.plugin.formatKey,f=c.plugin.formatSeed;c.key=null;for(var k=a.util.createBuffer();k.length()<b;){1048575<c.generated&&(c.key=null);null===c.key&&(32<=c.pools[0].messageLength||c.collect(c.seedFileSync(32-c.pools[0].messageLength<<5)),e());var v=d(c.key,c.seed);c.generated+=v.length;k.putBytes(v);c.key=
n(d(c.key,g(c.seed)));c.seed=f(d(c.key,c.seed))}return k.getBytes(b)};d?(c.seedFile=function(a,b){d.randomBytes(a,function(a,c){if(a)return b(a);b(null,c.toString())})},c.seedFileSync=function(a){return d.randomBytes(a).toString()}):(c.seedFile=function(a,c){try{c(null,b(a))}catch(z){c(z)}},c.seedFileSync=b);c.collect=function(a){for(var b=a.length,d=0;d<b;++d)c.pools[c.pool].update(a.substr(d,1)),c.pool=31===c.pool?0:c.pool+1};c.collectInt=function(a,b){for(var d="",e=0;e<b;e+=8)d+=String.fromCharCode(a>>
e&255);c.collect(d)};c.registerWorker=function(a){a===self?c.seedFile=function(a,b){function c(a){a=a.data;a.forge&&a.forge.prng&&(self.removeEventListener("message",c),b(a.forge.prng.err,a.forge.prng.bytes))}self.addEventListener("message",c);self.postMessage({forge:{prng:{needed:a}}})}:a.addEventListener("message",function(b){b=b.data;b.forge&&b.forge.prng&&c.seedFile(b.forge.prng.needed,function(b,c){a.postMessage({forge:{prng:{err:b,bytes:c}}})})})};return c}}if("function"!==typeof p)if("object"===
typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.prng)return d.prng;d.defined.prng=!0;for(var k=0;k<f.length;++k)f[k](d);return d.prng}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,
Array.prototype.slice.call(arguments,0))};p("js/prng",["require","module","./md","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){a.random&&a.random.getBytes||function(f){function d(){var b=a.prng.create(p);b.getBytes=function(a,c){return b.generate(a,c)};b.getBytesSync=function(a){return b.generate(a)};return b}var p={},k=Array(4),e=a.util.createBuffer();p.formatKey=function(b){var c=a.util.createBuffer(b);b=Array(4);b[0]=c.getInt32();b[1]=
c.getInt32();b[2]=c.getInt32();b[3]=c.getInt32();return a.aes._expandKey(b,!1)};p.formatSeed=function(b){var c=a.util.createBuffer(b);b=Array(4);b[0]=c.getInt32();b[1]=c.getInt32();b[2]=c.getInt32();b[3]=c.getInt32();return b};p.cipher=function(b,c){a.aes._updateBlock(b,c,k,!1);e.putInt32(k[0]);e.putInt32(k[1]);e.putInt32(k[2]);e.putInt32(k[3]);return e.getBytes()};p.increment=function(a){++a[3];return a};p.md=a.md.sha256;var b=d(),c="undefined"!==typeof process&&process.versions&&process.versions.node,
u=null;if("undefined"!==typeof window){var g=window.crypto||window.msCrypto;g&&g.getRandomValues&&(u=function(a){return g.getRandomValues(a)})}if(a.disableNativeCode||!c&&!u){b.collectInt(+new Date,32);if("undefined"!==typeof navigator){c="";for(var t in navigator)try{"string"==typeof navigator[t]&&(c+=navigator[t])}catch(w){}b.collect(c);c=null}f&&(f().mousemove(function(a){b.collectInt(a.clientX,16);b.collectInt(a.clientY,16)}),f().keypress(function(a){b.collectInt(a.charCode,8)}))}if(a.random)for(t in b)a.random[t]=
b[t];else a.random=b;a.random.createInstance=d}("undefined"!==typeof jQuery?jQuery:null)}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.random)return d.random;d.defined.random=!0;for(var k=0;k<f.length;++k)f[k](d);return d.random}},A=p;p=function(a,
f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/random","require module ./aes ./md ./prng ./util".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){var f=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,
109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,
122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],d=[1,2,3,5];a.rc2=a.rc2||{};a.rc2.expandKey=function(d,e){"string"===typeof d&&(d=a.util.createBuffer(d));e=e||128;var b=d,c=d.length(),k=e,g=Math.ceil(k/8);k=255>>(k&7);var t;for(t=c;128>t;t++)b.putByte(f[b.at(t-1)+b.at(t-c)&255]);b.setAt(128-
g,f[b.at(128-g)&k]);for(t=127-g;0<=t;t--)b.setAt(t,f[b.at(t+1)^b.at(t+g)]);return b};var p=function(f,e,b){var c=!1,k=null,g=null,t=null,w,z,n=[];f=a.rc2.expandKey(f,e);for(w=0;64>w;w++)n.push(f.getInt16Le());if(b){var r=function(a){for(w=0;4>w;w++){a[w]+=n[z]+(a[(w+3)%4]&a[(w+2)%4])+(~a[(w+3)%4]&a[(w+1)%4]);var b=a[w],c=d[w];a[w]=b<<c&65535|(b&65535)>>16-c;z++}};var y=function(a){for(w=0;4>w;w++)a[w]+=n[a[(w+3)%4]&63]}}else r=function(a){for(w=3;0<=w;w--){var b=a[w],c=d[w];a[w]=(b&65535)>>c|b<<16-
c&65535;a[w]-=n[z]+(a[(w+3)%4]&a[(w+2)%4])+(~a[(w+3)%4]&a[(w+1)%4]);z--}},y=function(a){for(w=3;0<=w;w--)a[w]-=n[a[(w+3)%4]&63]};var v=null;return v={start:function(b,h){b&&"string"===typeof b&&(b=a.util.createBuffer(b));c=!1;k=a.util.createBuffer();g=h||new a.util.createBuffer;t=b;v.output=g},update:function(a){for(c||k.putBuffer(a);8<=k.length();){a=[[5,r],[1,y],[6,r],[1,y],[5,r]];var h=[];for(w=0;4>w;w++){var m=k.getInt16Le();null!==t&&(b?m^=t.getInt16Le():t.putInt16Le(m));h.push(m&65535)}z=b?
0:63;for(m=0;m<a.length;m++)for(var d=0;d<a[m][0];d++)a[m][1](h);for(w=0;4>w;w++)null!==t&&(b?t.putInt16Le(h[w]):h[w]^=t.getInt16Le()),g.putInt16Le(h[w])}},finish:function(a){var h=!0;if(b)if(a)h=a(8,k,!b);else{var m=8===k.length()?8:8-k.length();k.fillWithByte(m,m)}h&&(c=!0,v.update());!b&&(h=0===k.length())&&(a?h=a(8,g,!b):(a=g.length(),m=g.at(a-1),m>a?h=!1:g.truncate(m)));return h}}};a.rc2.startEncrypting=function(d,e,b){d=a.rc2.createEncryptionCipher(d,128);d.start(e,b);return d};a.rc2.createEncryptionCipher=
function(a,d){return p(a,d,!0)};a.rc2.startDecrypting=function(d,e,b){d=a.rc2.createDecryptionCipher(d,128);d.start(e,b);return d};a.rc2.createDecryptionCipher=function(a,d){return p(a,d,!1)}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.rc2)return d.rc2;
d.defined.rc2=!0;for(var k=0;k<f.length;++k)f[k](d);return d.rc2}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/rc2",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(a,b,c){this.data=[];null!=a&&("number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=
typeof a?this.fromString(a,256):this.fromString(a,b))}function d(){return new f(null)}function p(a,b,c,m,h,d){for(;0<=--d;){var l=b*this.data[a++]+c.data[m]+h;h=Math.floor(l/67108864);c.data[m++]=l&67108863}return h}function k(a,b,c,m,h,d){var l=b&32767;for(b>>=15;0<=--d;){var e=this.data[a]&32767,g=this.data[a++]>>15,n=b*e+g*l;e=l*e+((n&32767)<<15)+c.data[m]+(h&1073741823);h=(e>>>30)+(n>>>15)+b*g+(h>>>30);c.data[m++]=e&1073741823}return h}function e(a,b,c,m,h,d){var l=b&16383;for(b>>=14;0<=--d;){var e=
this.data[a]&16383,g=this.data[a++]>>14,n=b*e+g*l;e=l*e+((n&16383)<<14)+c.data[m]+h;h=(e>>28)+(n>>14)+b*g;c.data[m++]=e&268435455}return h}function b(a,b){var c=C[a.charCodeAt(b)];return null==c?-1:c}function c(a){var b=d();b.fromInt(a);return b}function u(a){var b=1,c;0!=(c=a>>>16)&&(a=c,b+=16);0!=(c=a>>8)&&(a=c,b+=8);0!=(c=a>>4)&&(a=c,b+=4);0!=(c=a>>2)&&(a=c,b+=2);0!=a>>1&&(b+=1);return b}function g(a){this.m=a}function t(a){this.m=a;this.mp=a.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>
15;this.um=(1<<a.DB-15)-1;this.mt2=2*a.t}function w(a,b){return a&b}function z(a,b){return a|b}function n(a,b){return a^b}function r(a,b){return a&~b}function y(){}function v(a){return a}function E(a){this.r2=d();this.q3=d();f.ONE.dlShiftTo(2*a.t,this.r2);this.mu=this.r2.divide(a);this.m=a}function h(){return{nextBytes:function(a){for(var b=0;b<a.length;++b)a[b]=Math.floor(256*getRandomValues())}}}if("undefined"===typeof navigator){f.prototype.am=e;var m=28}else"Microsoft Internet Explorer"==navigator.appName?
(f.prototype.am=k,m=30):"Netscape"!=navigator.appName?(f.prototype.am=p,m=26):(f.prototype.am=e,m=28);f.prototype.DB=m;f.prototype.DM=(1<<m)-1;f.prototype.DV=1<<m;f.prototype.FV=Math.pow(2,52);f.prototype.F1=52-m;f.prototype.F2=2*m-52;var C=[],l;m=48;for(l=0;9>=l;++l)C[m++]=l;m=97;for(l=10;36>l;++l)C[m++]=l;m=65;for(l=10;36>l;++l)C[m++]=l;g.prototype.convert=function(a){return 0>a.s||0<=a.compareTo(this.m)?a.mod(this.m):a};g.prototype.revert=function(a){return a};g.prototype.reduce=function(a){a.divRemTo(this.m,
null,a)};g.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};g.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};t.prototype.convert=function(a){var b=d();a.abs().dlShiftTo(this.m.t,b);b.divRemTo(this.m,null,b);0>a.s&&0<b.compareTo(f.ZERO)&&this.m.subTo(b,b);return b};t.prototype.revert=function(a){var b=d();a.copyTo(b);this.reduce(b);return b};t.prototype.reduce=function(a){for(;a.t<=this.mt2;)a.data[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=a.data[b]&32767,m=c*this.mpl+
((c*this.mph+(a.data[b]>>15)*this.mpl&this.um)<<15)&a.DM;c=b+this.m.t;for(a.data[c]+=this.m.am(0,m,a,b,0,this.m.t);a.data[c]>=a.DV;)a.data[c]-=a.DV,a.data[++c]++}a.clamp();a.drShiftTo(this.m.t,a);0<=a.compareTo(this.m)&&a.subTo(this.m,a)};t.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};t.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};f.prototype.copyTo=function(a){for(var b=this.t-1;0<=b;--b)a.data[b]=this.data[b];a.t=this.t;a.s=this.s};f.prototype.fromInt=function(a){this.t=
1;this.s=0>a?-1:0;0<a?this.data[0]=a:-1>a?this.data[0]=a+this.DV:this.t=0};f.prototype.fromString=function(a,c){if(16==c)var m=4;else if(8==c)m=3;else if(256==c)m=8;else if(2==c)m=1;else if(32==c)m=5;else if(4==c)m=2;else{this.fromRadix(a,c);return}this.s=this.t=0;for(var h=a.length,d=!1,l=0;0<=--h;){var e=8==m?a[h]&255:b(a,h);0>e?"-"==a.charAt(h)&&(d=!0):(d=!1,0==l?this.data[this.t++]=e:l+m>this.DB?(this.data[this.t-1]|=(e&(1<<this.DB-l)-1)<<l,this.data[this.t++]=e>>this.DB-l):this.data[this.t-1]|=
e<<l,l+=m,l>=this.DB&&(l-=this.DB))}8==m&&0!=(a[0]&128)&&(this.s=-1,0<l&&(this.data[this.t-1]|=(1<<this.DB-l)-1<<l));this.clamp();d&&f.ZERO.subTo(this,this)};f.prototype.clamp=function(){for(var a=this.s&this.DM;0<this.t&&this.data[this.t-1]==a;)--this.t};f.prototype.dlShiftTo=function(a,b){var c;for(c=this.t-1;0<=c;--c)b.data[c+a]=this.data[c];for(c=a-1;0<=c;--c)b.data[c]=0;b.t=this.t+a;b.s=this.s};f.prototype.drShiftTo=function(a,b){for(var c=a;c<this.t;++c)b.data[c-a]=this.data[c];b.t=Math.max(this.t-
a,0);b.s=this.s};f.prototype.lShiftTo=function(a,b){var c=a%this.DB,m=this.DB-c,h=(1<<m)-1,d=Math.floor(a/this.DB),l=this.s<<c&this.DM,e;for(e=this.t-1;0<=e;--e)b.data[e+d+1]=this.data[e]>>m|l,l=(this.data[e]&h)<<c;for(e=d-1;0<=e;--e)b.data[e]=0;b.data[d]=l;b.t=this.t+d+1;b.s=this.s;b.clamp()};f.prototype.rShiftTo=function(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)b.t=0;else{var m=a%this.DB,h=this.DB-m,d=(1<<m)-1;b.data[0]=this.data[c]>>m;for(var l=c+1;l<this.t;++l)b.data[l-c-1]|=(this.data[l]&
d)<<h,b.data[l-c]=this.data[l]>>m;0<m&&(b.data[this.t-c-1]|=(this.s&d)<<h);b.t=this.t-c;b.clamp()}};f.prototype.subTo=function(a,b){for(var c=0,m=0,h=Math.min(a.t,this.t);c<h;)m+=this.data[c]-a.data[c],b.data[c++]=m&this.DM,m>>=this.DB;if(a.t<this.t){for(m-=a.s;c<this.t;)m+=this.data[c],b.data[c++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;c<a.t;)m-=a.data[c],b.data[c++]=m&this.DM,m>>=this.DB;m-=a.s}b.s=0>m?-1:0;-1>m?b.data[c++]=this.DV+m:0<m&&(b.data[c++]=m);b.t=c;b.clamp()};f.prototype.multiplyTo=
function(a,b){var c=this.abs(),m=a.abs(),h=c.t;for(b.t=h+m.t;0<=--h;)b.data[h]=0;for(h=0;h<m.t;++h)b.data[h+c.t]=c.am(0,m.data[h],b,h,0,c.t);b.s=0;b.clamp();this.s!=a.s&&f.ZERO.subTo(b,b)};f.prototype.squareTo=function(a){for(var b=this.abs(),c=a.t=2*b.t;0<=--c;)a.data[c]=0;for(c=0;c<b.t-1;++c){var m=b.am(c,b.data[c],a,2*c,0,1);(a.data[c+b.t]+=b.am(c+1,2*b.data[c],a,2*c+1,m,b.t-c-1))>=b.DV&&(a.data[c+b.t]-=b.DV,a.data[c+b.t+1]=1)}0<a.t&&(a.data[a.t-1]+=b.am(c,b.data[c],a,2*c,0,1));a.s=0;a.clamp()};
f.prototype.divRemTo=function(a,b,c){var m=a.abs();if(!(0>=m.t)){var h=this.abs();if(h.t<m.t)null!=b&&b.fromInt(0),null!=c&&this.copyTo(c);else{null==c&&(c=d());var l=d(),e=this.s;a=a.s;var g=this.DB-u(m.data[m.t-1]);0<g?(m.lShiftTo(g,l),h.lShiftTo(g,c)):(m.copyTo(l),h.copyTo(c));m=l.t;h=l.data[m-1];if(0!=h){var n=h*(1<<this.F1)+(1<m?l.data[m-2]>>this.F2:0),v=this.FV/n;n=(1<<this.F1)/n;var C=1<<this.F2,k=c.t,r=k-m,J=null==b?d():b;l.dlShiftTo(r,J);0<=c.compareTo(J)&&(c.data[c.t++]=1,c.subTo(J,c));
f.ONE.dlShiftTo(m,J);for(J.subTo(l,l);l.t<m;)l.data[l.t++]=0;for(;0<=--r;){var E=c.data[--k]==h?this.DM:Math.floor(c.data[k]*v+(c.data[k-1]+C)*n);if((c.data[k]+=l.am(0,E,c,r,0,m))<E)for(l.dlShiftTo(r,J),c.subTo(J,c);c.data[k]<--E;)c.subTo(J,c)}null!=b&&(c.drShiftTo(m,b),e!=a&&f.ZERO.subTo(b,b));c.t=m;c.clamp();0<g&&c.rShiftTo(g,c);0>e&&f.ZERO.subTo(c,c)}}}};f.prototype.invDigit=function(){if(1>this.t)return 0;var a=this.data[0];if(0==(a&1))return 0;var b=a&3;b=b*(2-(a&15)*b)&15;b=b*(2-(a&255)*b)&
255;b=b*(2-((a&65535)*b&65535))&65535;b=b*(2-a*b%this.DV)%this.DV;return 0<b?this.DV-b:-b};f.prototype.isEven=function(){return 0==(0<this.t?this.data[0]&1:this.s)};f.prototype.exp=function(a,b){if(4294967295<a||1>a)return f.ONE;var c=d(),m=d(),h=b.convert(this),l=u(a)-1;for(h.copyTo(c);0<=--l;)if(b.sqrTo(c,m),0<(a&1<<l))b.mulTo(m,h,c);else{var e=c;c=m;m=e}return b.revert(c)};f.prototype.toString=function(a){if(0>this.s)return"-"+this.negate().toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==
a)a=1;else if(32==a)a=5;else if(4==a)a=2;else return this.toRadix(a);var b=(1<<a)-1,c,m=!1,h="",d=this.t,l=this.DB-d*this.DB%a;if(0<d--)for(l<this.DB&&0<(c=this.data[d]>>l)&&(m=!0,h="0123456789abcdefghijklmnopqrstuvwxyz".charAt(c));0<=d;)l<a?(c=(this.data[d]&(1<<l)-1)<<a-l,c|=this.data[--d]>>(l+=this.DB-a)):(c=this.data[d]>>(l-=a)&b,0>=l&&(l+=this.DB,--d)),0<c&&(m=!0),m&&(h+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(c));return m?h:"0"};f.prototype.negate=function(){var a=d();f.ZERO.subTo(this,
a);return a};f.prototype.abs=function(){return 0>this.s?this.negate():this};f.prototype.compareTo=function(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;b=c-a.t;if(0!=b)return 0>this.s?-b:b;for(;0<=--c;)if(0!=(b=this.data[c]-a.data[c]))return b;return 0};f.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+u(this.data[this.t-1]^this.s&this.DM)};f.prototype.mod=function(a){var b=d();this.abs().divRemTo(a,null,b);0>this.s&&0<b.compareTo(f.ZERO)&&a.subTo(b,b);return b};f.prototype.modPowInt=
function(a,b){var c=256>a||b.isEven()?new g(b):new t(b);return this.exp(a,c)};f.ZERO=c(0);f.ONE=c(1);y.prototype.convert=v;y.prototype.revert=v;y.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c)};y.prototype.sqrTo=function(a,b){a.squareTo(b)};E.prototype.convert=function(a){if(0>a.s||a.t>2*this.m.t)return a.mod(this.m);if(0>a.compareTo(this.m))return a;var b=d();a.copyTo(b);this.reduce(b);return b};E.prototype.revert=function(a){return a};E.prototype.reduce=function(a){a.drShiftTo(this.m.t-1,this.r2);
a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>a.compareTo(this.r2);)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);0<=a.compareTo(this.m);)a.subTo(this.m,a)};E.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c);this.reduce(c)};E.prototype.sqrTo=function(a,b){a.squareTo(b);this.reduce(b)};var L=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,
137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],N=67108864/L[L.length-1];f.prototype.chunkSize=function(a){return Math.floor(Math.LN2*this.DB/Math.log(a))};f.prototype.toRadix=function(a){null==a&&(a=10);if(0==this.signum()||2>a||36<a)return"0";var b=this.chunkSize(a);b=Math.pow(a,b);var m=
c(b),h=d(),l=d(),e="";for(this.divRemTo(m,h,l);0<h.signum();)e=(b+l.intValue()).toString(a).substr(1)+e,h.divRemTo(m,h,l);return l.intValue().toString(a)+e};f.prototype.fromRadix=function(a,c){this.fromInt(0);null==c&&(c=10);for(var m=this.chunkSize(c),h=Math.pow(c,m),d=!1,l=0,e=0,g=0;g<a.length;++g){var n=b(a,g);0>n?"-"==a.charAt(g)&&0==this.signum()&&(d=!0):(e=c*e+n,++l>=m&&(this.dMultiply(h),this.dAddOffset(e,0),e=l=0))}0<l&&(this.dMultiply(Math.pow(c,l)),this.dAddOffset(e,0));d&&f.ZERO.subTo(this,
this)};f.prototype.fromNumber=function(a,b,c){if("number"==typeof b)if(2>a)this.fromInt(1);else for(this.fromNumber(a,c),this.testBit(a-1)||this.bitwiseTo(f.ONE.shiftLeft(a-1),z,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(b);)this.dAddOffset(2,0),this.bitLength()>a&&this.subTo(f.ONE.shiftLeft(a-1),this);else{c=[];var m=a&7;c.length=(a>>3)+1;b.nextBytes(c);c[0]=0<m?c[0]&(1<<m)-1:0;this.fromString(c,256)}};f.prototype.bitwiseTo=function(a,b,c){var m,h=Math.min(a.t,this.t);for(m=
0;m<h;++m)c.data[m]=b(this.data[m],a.data[m]);if(a.t<this.t){var l=a.s&this.DM;for(m=h;m<this.t;++m)c.data[m]=b(this.data[m],l);c.t=this.t}else{l=this.s&this.DM;for(m=h;m<a.t;++m)c.data[m]=b(l,a.data[m]);c.t=a.t}c.s=b(this.s,a.s);c.clamp()};f.prototype.changeBit=function(a,b){var c=f.ONE.shiftLeft(a);this.bitwiseTo(c,b,c);return c};f.prototype.addTo=function(a,b){for(var c=0,m=0,h=Math.min(a.t,this.t);c<h;)m+=this.data[c]+a.data[c],b.data[c++]=m&this.DM,m>>=this.DB;if(a.t<this.t){for(m+=a.s;c<this.t;)m+=
this.data[c],b.data[c++]=m&this.DM,m>>=this.DB;m+=this.s}else{for(m+=this.s;c<a.t;)m+=a.data[c],b.data[c++]=m&this.DM,m>>=this.DB;m+=a.s}b.s=0>m?-1:0;0<m?b.data[c++]=m:-1>m&&(b.data[c++]=this.DV+m);b.t=c;b.clamp()};f.prototype.dMultiply=function(a){this.data[this.t]=this.am(0,a-1,this,0,0,this.t);++this.t;this.clamp()};f.prototype.dAddOffset=function(a,b){if(0!=a){for(;this.t<=b;)this.data[this.t++]=0;for(this.data[b]+=a;this.data[b]>=this.DV;)this.data[b]-=this.DV,++b>=this.t&&(this.data[this.t++]=
0),++this.data[b]}};f.prototype.multiplyLowerTo=function(a,b,c){var m=Math.min(this.t+a.t,b);c.s=0;for(c.t=m;0<m;)c.data[--m]=0;var h;for(h=c.t-this.t;m<h;++m)c.data[m+this.t]=this.am(0,a.data[m],c,m,0,this.t);for(h=Math.min(a.t,b);m<h;++m)this.am(0,a.data[m],c,m,0,b-m);c.clamp()};f.prototype.multiplyUpperTo=function(a,b,c){--b;var m=c.t=this.t+a.t-b;for(c.s=0;0<=--m;)c.data[m]=0;for(m=Math.max(b-this.t,0);m<a.t;++m)c.data[this.t+m-b]=this.am(b-m,a.data[m],c,0,0,this.t+m-b);c.clamp();c.drShiftTo(1,
c)};f.prototype.modInt=function(a){if(0>=a)return 0;var b=this.DV%a,c=0>this.s?a-1:0;if(0<this.t)if(0==b)c=this.data[0]%a;else for(var m=this.t-1;0<=m;--m)c=(b*c+this.data[m])%a;return c};f.prototype.millerRabin=function(a){var b=this.subtract(f.ONE),c=b.getLowestSetBit();if(0>=c)return!1;for(var m=b.shiftRight(c),l=h(),d,e=0;e<a;++e){do d=new f(this.bitLength(),l);while(0>=d.compareTo(f.ONE)||0<=d.compareTo(b));d=d.modPow(m,this);if(0!=d.compareTo(f.ONE)&&0!=d.compareTo(b)){for(var g=1;g++<c&&0!=
d.compareTo(b);)if(d=d.modPowInt(2,this),0==d.compareTo(f.ONE))return!1;if(0!=d.compareTo(b))return!1}}return!0};f.prototype.clone=function(){var a=d();this.copyTo(a);return a};f.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]};f.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24};f.prototype.shortValue=
function(){return 0==this.t?this.s:this.data[0]<<16>>16};f.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this.data[0]?0:1};f.prototype.toByteArray=function(){var a=this.t,b=[];b[0]=this.s;var c=this.DB-a*this.DB%8,m,h=0;if(0<a--)for(c<this.DB&&(m=this.data[a]>>c)!=(this.s&this.DM)>>c&&(b[h++]=m|this.s<<this.DB-c);0<=a;)if(8>c?(m=(this.data[a]&(1<<c)-1)<<8-c,m|=this.data[--a]>>(c+=this.DB-8)):(m=this.data[a]>>(c-=8)&255,0>=c&&(c+=this.DB,--a)),0!=(m&128)&&(m|=-256),0==h&&
(this.s&128)!=(m&128)&&++h,0<h||m!=this.s)b[h++]=m;return b};f.prototype.equals=function(a){return 0==this.compareTo(a)};f.prototype.min=function(a){return 0>this.compareTo(a)?this:a};f.prototype.max=function(a){return 0<this.compareTo(a)?this:a};f.prototype.and=function(a){var b=d();this.bitwiseTo(a,w,b);return b};f.prototype.or=function(a){var b=d();this.bitwiseTo(a,z,b);return b};f.prototype.xor=function(a){var b=d();this.bitwiseTo(a,n,b);return b};f.prototype.andNot=function(a){var b=d();this.bitwiseTo(a,
r,b);return b};f.prototype.not=function(){for(var a=d(),b=0;b<this.t;++b)a.data[b]=this.DM&~this.data[b];a.t=this.t;a.s=~this.s;return a};f.prototype.shiftLeft=function(a){var b=d();0>a?this.rShiftTo(-a,b):this.lShiftTo(a,b);return b};f.prototype.shiftRight=function(a){var b=d();0>a?this.lShiftTo(-a,b):this.rShiftTo(a,b);return b};f.prototype.getLowestSetBit=function(){for(var a=0;a<this.t;++a)if(0!=this.data[a]){var b=a*this.DB;a=this.data[a];if(0==a)a=-1;else{var c=0;0==(a&65535)&&(a>>=16,c+=16);
0==(a&255)&&(a>>=8,c+=8);0==(a&15)&&(a>>=4,c+=4);0==(a&3)&&(a>>=2,c+=2);0==(a&1)&&++c;a=c}return b+a}return 0>this.s?this.t*this.DB:-1};f.prototype.bitCount=function(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c){for(var m=this.data[c]^b,h=0;0!=m;)m&=m-1,++h;a+=h}return a};f.prototype.testBit=function(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this.data[b]&1<<a%this.DB)};f.prototype.setBit=function(a){return this.changeBit(a,z)};f.prototype.clearBit=function(a){return this.changeBit(a,
r)};f.prototype.flipBit=function(a){return this.changeBit(a,n)};f.prototype.add=function(a){var b=d();this.addTo(a,b);return b};f.prototype.subtract=function(a){var b=d();this.subTo(a,b);return b};f.prototype.multiply=function(a){var b=d();this.multiplyTo(a,b);return b};f.prototype.divide=function(a){var b=d();this.divRemTo(a,b,null);return b};f.prototype.remainder=function(a){var b=d();this.divRemTo(a,null,b);return b};f.prototype.divideAndRemainder=function(a){var b=d(),c=d();this.divRemTo(a,b,
c);return[b,c]};f.prototype.modPow=function(a,b){var m=a.bitLength(),h=c(1);if(0>=m)return h;var l=18>m?1:48>m?3:144>m?4:768>m?5:6;var e=8>m?new g(b):b.isEven()?new E(b):new t(b);var n=[],f=3,v=l-1,C=(1<<l)-1;n[1]=e.convert(this);if(1<l)for(m=d(),e.sqrTo(n[1],m);f<=C;)n[f]=d(),e.mulTo(m,n[f-2],n[f]),f+=2;var k=a.t-1,r=!0,w=d();for(m=u(a.data[k])-1;0<=k;){if(m>=v)var y=a.data[k]>>m-v&C;else y=(a.data[k]&(1<<m+1)-1)<<v-m,0<k&&(y|=a.data[k-1]>>this.DB+m-v);for(f=l;0==(y&1);)y>>=1,--f;0>(m-=f)&&(m+=this.DB,
--k);if(r)n[y].copyTo(h),r=!1;else{for(;1<f;)e.sqrTo(h,w),e.sqrTo(w,h),f-=2;0<f?e.sqrTo(h,w):(f=h,h=w,w=f);e.mulTo(w,n[y],h)}for(;0<=k&&0==(a.data[k]&1<<m);)e.sqrTo(h,w),f=h,h=w,w=f,0>--m&&(m=this.DB-1,--k)}return e.revert(h)};f.prototype.modInverse=function(a){var b=a.isEven();if(this.isEven()&&b||0==a.signum())return f.ZERO;for(var m=a.clone(),h=this.clone(),d=c(1),l=c(0),e=c(0),g=c(1);0!=m.signum();){for(;m.isEven();)m.rShiftTo(1,m),b?(d.isEven()&&l.isEven()||(d.addTo(this,d),l.subTo(a,l)),d.rShiftTo(1,
d)):l.isEven()||l.subTo(a,l),l.rShiftTo(1,l);for(;h.isEven();)h.rShiftTo(1,h),b?(e.isEven()&&g.isEven()||(e.addTo(this,e),g.subTo(a,g)),e.rShiftTo(1,e)):g.isEven()||g.subTo(a,g),g.rShiftTo(1,g);0<=m.compareTo(h)?(m.subTo(h,m),b&&d.subTo(e,d),l.subTo(g,l)):(h.subTo(m,h),b&&e.subTo(d,e),g.subTo(l,g))}if(0!=h.compareTo(f.ONE))return f.ZERO;if(0<=g.compareTo(a))return g.subtract(a);if(0>g.signum())g.addTo(a,g);else return g;return 0>g.signum()?g.add(a):g};f.prototype.pow=function(a){return this.exp(a,
new y)};f.prototype.gcd=function(a){var b=0>this.s?this.negate():this.clone();a=0>a.s?a.negate():a.clone();if(0>b.compareTo(a)){var c=b;b=a;a=c}c=b.getLowestSetBit();var m=a.getLowestSetBit();if(0>m)return b;c<m&&(m=c);0<m&&(b.rShiftTo(m,b),a.rShiftTo(m,a));for(;0<b.signum();)0<(c=b.getLowestSetBit())&&b.rShiftTo(c,b),0<(c=a.getLowestSetBit())&&a.rShiftTo(c,a),0<=b.compareTo(a)?(b.subTo(a,b),b.rShiftTo(1,b)):(a.subTo(b,a),a.rShiftTo(1,a));0<m&&a.lShiftTo(m,a);return a};f.prototype.isProbablePrime=
function(a){var b,c=this.abs();if(1==c.t&&c.data[0]<=L[L.length-1]){for(b=0;b<L.length;++b)if(c.data[0]==L[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<L.length;){for(var m=L[b],h=b+1;h<L.length&&m<N;)m*=L[h++];for(m=c.modInt(m);b<h;)if(0==m%L[b++])return!1}return c.millerRabin(a)};a.jsbn=a.jsbn||{};a.jsbn.BigInteger=f}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,
D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.jsbn)return d.jsbn;d.defined.jsbn=!0;for(var k=0;k<f.length;++k)f[k](d);return d.jsbn}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/jsbn",["require","module"],function(){D.apply(null,Array.prototype.slice.call(arguments,
0))})})();(function(){function q(a){function f(d,f,e){e||(e=a.md.sha1.create());for(var b="",c=Math.ceil(f/e.digestLength),k=0;k<c;++k){var g=String.fromCharCode(k>>24&255,k>>16&255,k>>8&255,k&255);e.start();e.update(d+g);b+=e.digest().getBytes()}return b.substring(0,f)}var d=a.pkcs1=a.pkcs1||{};d.encode_rsa_oaep=function(d,k,e,b,c){if("string"===typeof e){var u=e;var g=b||void 0;var t=c||void 0}else if(e&&(u=e.label||void 0,g=e.seed||void 0,t=e.md||void 0,e.mgf1&&e.mgf1.md))var w=e.mgf1.md;t?t.start():
t=a.md.sha1.create();w||(w=t);d=Math.ceil(d.n.bitLength()/8);e=d-2*t.digestLength-2;if(k.length>e)throw w=Error("RSAES-OAEP input message length is too long."),w.length=k.length,w.maxLength=e,w;u||(u="");t.update(u,"raw");u=t.digest();b="";e-=k.length;for(c=0;c<e;c++)b+="\x00";k=u.getBytes()+b+"\u0001"+k;if(!g)g=a.random.getBytes(t.digestLength);else if(g.length!==t.digestLength)throw w=Error("Invalid RSAES-OAEP seed. The seed length must match the digest length."),w.seedLength=g.length,w.digestLength=
t.digestLength,w;d=f(g,d-t.digestLength-1,w);k=a.util.xorBytes(k,d,k.length);t=f(k,t.digestLength,w);return"\x00"+a.util.xorBytes(g,t,g.length)+k};d.decode_rsa_oaep=function(d,k,e,b){if("string"===typeof e){var c=e;var u=b||void 0}else if(e&&(c=e.label||void 0,u=e.md||void 0,e.mgf1&&e.mgf1.md))var g=e.mgf1.md;e=Math.ceil(d.n.bitLength()/8);if(k.length!==e)throw g=Error("RSAES-OAEP encoded message length is invalid."),g.length=k.length,g.expectedLength=e,g;void 0===u?u=a.md.sha1.create():u.start();
g||(g=u);if(e<2*u.digestLength+2)throw Error("RSAES-OAEP key is too short for the hash function.");c||(c="");u.update(c,"raw");c=u.digest().getBytes();d=k.charAt(0);b=k.substring(1,u.digestLength+1);k=k.substring(1+u.digestLength);var t=f(k,u.digestLength,g);b=a.util.xorBytes(b,t,b.length);g=f(b,e-u.digestLength-1,g);k=a.util.xorBytes(k,g,k.length);e=k.substring(0,u.digestLength);g="\x00"!==d;for(d=0;d<u.digestLength;++d)g|=c.charAt(d)!==e.charAt(d);c=1;for(u=d=u.digestLength;u<k.length;u++)e=k.charCodeAt(u),
b=e&1^1,g|=e&(c?65534:0),c&=b,d+=c;if(g||1!==k.charCodeAt(d))throw Error("Invalid RSAES-OAEP padding.");return k.substring(d+1)}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.pkcs1)return d.pkcs1;d.defined.pkcs1=!0;for(var k=0;k<f.length;++k)f[k](d);
return d.pkcs1}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/pkcs1",["require","module","./util","./random","./sha1"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(a,b,c,e){return"workers"in c?p(a,b,c,e):d(a,b,c,e)}function d(b,c,g,f){var n=k(b,c),v=0,r=e(n.bitLength());"millerRabinTests"in
g&&(r=g.millerRabinTests);var h=10;"maxBlockTime"in g&&(h=g.maxBlockTime);var m=+new Date;do{n.bitLength()>b&&(n=k(b,c));if(n.isProbablePrime(r))return f(null,n);n.dAddOffset(u[v++%8],0)}while(0>h||+new Date-m<h);a.util.setImmediate(function(){d(b,c,g,f)})}function p(b,e,g,f){function n(){function a(a){if(!E){--n;var l=a.data;if(l.found){for(a=0;a<d.length;++a)d[a].terminate();E=!0;return f(null,new c(l.prime,16))}v.bitLength()>b&&(v=k(b,e));l=v.toString(16);a.target.postMessage({hex:l,workLoad:h});
v.dAddOffset(m,0)}}r=Math.max(1,r);for(var d=[],g=0;g<r;++g)d[g]=new Worker(C);var n=r;for(g=0;g<r;++g)d[g].addEventListener("message",a);var E=!1}if("undefined"===typeof Worker)return d(b,e,g,f);var v=k(b,e),r=g.workers,h=g.workLoad||100,m=30*h/8,C=g.workerScript||"forge/prime.worker.js";if(-1===r)return a.util.estimateCores(function(a,b){a&&(b=2);r=b-1;n()});n()}function k(a,b){var d=new c(a,b),e=a-1;d.testBit(e)||d.bitwiseTo(c.ONE.shiftLeft(e),t,d);d.dAddOffset(31-d.mod(g).byteValue(),0);return d}
function e(a){return 100>=a?27:150>=a?18:200>=a?15:250>=a?12:300>=a?9:350>=a?8:400>=a?7:500>=a?6:600>=a?5:800>=a?4:1250>=a?3:2}if(!a.prime){var b=a.prime=a.prime||{},c=a.jsbn.BigInteger,u=[6,4,2,4,2,4,6,2],g=new c(null);g.fromInt(30);var t=function(a,b){return a|b};b.generateProbablePrime=function(b,c,d){"function"===typeof c&&(d=c,c={});c=c||{};var e=c.algorithm||"PRIMEINC";"string"===typeof e&&(e={name:e});e.options=e.options||{};var g=c.prng||a.random;c={nextBytes:function(a){for(var b=g.getBytesSync(a.length),
c=0;c<a.length;++c)a[c]=b.charCodeAt(c)}};if("PRIMEINC"===e.name)return f(b,c,e.options,d);throw Error("Invalid prime generation algorithm: "+e.name);}}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.prime)return d.prime;d.defined.prime=!0;for(var k=
0;k<f.length;++k)f[k](d);return d.prime}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/prime",["require","module","./util","./jsbn","./random"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(b,c,h){var m=a.util.createBuffer();c=Math.ceil(c.n.bitLength()/8);if(b.length>c-11)throw m=Error("Message is too long for PKCS#1 v1.5 padding."),
m.length=b.length,m.max=c-11,m;m.putByte(0);m.putByte(h);c=c-3-b.length;if(0===h||1===h){h=0===h?0:255;for(var d=0;d<c;++d)m.putByte(h)}else for(;0<c;){var l=0,e=a.random.getBytes(c);for(d=0;d<c;++d)h=e.charCodeAt(d),0===h?++l:m.putByte(h);c=l}m.putByte(0);m.putBytes(b);return m}function d(b,c,h,d){c=Math.ceil(c.n.bitLength()/8);b=a.util.createBuffer(b);var m=b.getByte(),l=b.getByte();if(0!==m||h&&0!==l&&1!==l||!h&&2!=l||h&&0===l&&"undefined"===typeof d)throw Error("Encryption block is invalid.");
h=0;if(0===l)for(h=c-3-d,d=0;d<h;++d){if(0!==b.getByte())throw Error("Encryption block is invalid.");}else if(1===l)for(h=0;1<b.length();){if(255!==b.getByte()){--b.read;break}++h}else if(2===l)for(h=0;1<b.length();){if(0===b.getByte()){--b.read;break}++h}if(0!==b.getByte()||h!==c-3-b.length())throw Error("Encryption block is invalid.");return b.getBytes()}function p(b,c,h){function m(){d(b.pBits,function(a,c){if(a)return h(a);b.p=c;if(null!==b.q)return l(a,b.q);d(b.qBits,l)})}function d(b,c){a.prime.generateProbablePrime(b,
e,c)}function l(a,c){if(a)return h(a);b.q=c;if(0>b.p.compareTo(b.q)){var e=b.p;b.p=b.q;b.q=e}0!==b.p.subtract(g.ONE).gcd(b.e).compareTo(g.ONE)?(b.p=null,m()):0!==b.q.subtract(g.ONE).gcd(b.e).compareTo(g.ONE)?(b.q=null,d(b.qBits,l)):(b.p1=b.p.subtract(g.ONE),b.q1=b.q.subtract(g.ONE),b.phi=b.p1.multiply(b.q1),0!==b.phi.gcd(b.e).compareTo(g.ONE)?(b.p=b.q=null,m()):(b.n=b.p.multiply(b.q),b.n.bitLength()!==b.bits?(b.q=null,d(b.qBits,l)):(e=b.e.modInverse(b.phi),b.keys={privateKey:w.rsa.setPrivateKey(b.n,
b.e,e,b.p,b.q,e.mod(b.p1),e.mod(b.q1),b.q.modInverse(b.p)),publicKey:w.rsa.setPublicKey(b.n,b.e)},h(null,b.keys))))}"function"===typeof c&&(h=c,c={});c=c||{};var e={algorithm:{name:c.algorithm||"PRIMEINC",options:{workers:c.workers||2,workLoad:c.workLoad||100,workerScript:c.workerScript}}};"prng"in c&&(e.prng=c.prng);m()}function k(b){b=b.toString(16);"8"<=b[0]&&(b="00"+b);b=a.util.hexToBytes(b);return 1<b.length&&(0===b.charCodeAt(0)&&0===(b.charCodeAt(1)&128)||255===b.charCodeAt(0)&&128===(b.charCodeAt(1)&
128))?b.substr(1):b}function e(a){return 100>=a?27:150>=a?18:200>=a?15:250>=a?12:300>=a?9:350>=a?8:400>=a?7:500>=a?6:600>=a?5:800>=a?4:1250>=a?3:2}function b(a){return"undefined"!==typeof window&&"object"===typeof window.crypto&&"object"===typeof window.crypto.subtle&&"function"===typeof window.crypto.subtle[a]}function c(a){return"undefined"!==typeof window&&"object"===typeof window.msCrypto&&"object"===typeof window.msCrypto.subtle&&"function"===typeof window.msCrypto.subtle[a]}function u(b){b=
a.util.hexToBytes(b.toString(16));for(var c=new Uint8Array(b.length),m=0;m<b.length;++m)c[m]=b.charCodeAt(m);return c}if("undefined"===typeof g)var g=a.jsbn.BigInteger;var t=a.asn1;a.pki=a.pki||{};a.pki.rsa=a.rsa=a.rsa||{};var w=a.pki,z=[6,4,2,4,2,4,6,2],n={name:"PrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",
tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},r={name:"RSAPrivateKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},
{name:"RSAPrivateKey.modulus",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},
{name:"RSAPrivateKey.prime2",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},y=
{name:"RSAPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:t.Class.UNIVERSAL,type:t.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},v=a.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",
tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:t.Class.UNIVERSAL,type:t.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:t.Class.UNIVERSAL,type:t.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},E=function(a){if(a.algorithm in
w.oids)var b=w.oids[a.algorithm];else throw b=Error("Unknown message digest algorithm."),b.algorithm=a.algorithm,b;var c=t.oidToDer(b).getBytes();b=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);var m=t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[]);m.value.push(t.create(t.Class.UNIVERSAL,t.Type.OID,!1,c));m.value.push(t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,""));a=t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,a.digest().getBytes());b.value.push(m);b.value.push(a);return t.toDer(b).getBytes()},
h=function(b,c,h){if(h)return b.modPow(c.e,c.n);if(!c.p||!c.q)return b.modPow(c.d,c.n);c.dP||(c.dP=c.d.mod(c.p.subtract(g.ONE)));c.dQ||(c.dQ=c.d.mod(c.q.subtract(g.ONE)));c.qInv||(c.qInv=c.q.modInverse(c.p));do h=new g(a.util.bytesToHex(a.random.getBytes(c.n.bitLength()/8)),16);while(0<=h.compareTo(c.n)||!h.gcd(c.n).equals(g.ONE));b=b.multiply(h.modPow(c.e,c.n)).mod(c.n);var m=b.mod(c.p).modPow(c.dP,c.p);for(b=b.mod(c.q).modPow(c.dQ,c.q);0>m.compareTo(b);)m=m.add(c.p);b=m.subtract(b).multiply(c.qInv).mod(c.p).multiply(c.q).add(b);
return b=b.multiply(h.modInverse(c.n)).mod(c.n)};w.rsa.encrypt=function(b,c,d){var m=d,l=Math.ceil(c.n.bitLength()/8);!1!==d&&!0!==d?(m=2===d,d=f(b,c,d)):(d=a.util.createBuffer(),d.putBytes(b));b=new g(d.toHex(),16);c=h(b,c,m).toString(16);m=a.util.createBuffer();for(l-=Math.ceil(c.length/2);0<l;)m.putByte(0),--l;m.putBytes(a.util.hexToBytes(c));return m.getBytes()};w.rsa.decrypt=function(b,c,l,e){var m=Math.ceil(c.n.bitLength()/8);if(b.length!==m)throw c=Error("Encrypted message length is invalid."),
c.length=b.length,c.expected=m,c;b=new g(a.util.createBuffer(b).toHex(),16);if(0<=b.compareTo(c.n))throw Error("Encrypted message is invalid.");b=h(b,c,l).toString(16);var n=a.util.createBuffer();for(m-=Math.ceil(b.length/2);0<m;)n.putByte(0),--m;n.putBytes(a.util.hexToBytes(b));return!1!==e?d(n.getBytes(),c,l):n.getBytes()};w.rsa.createKeyPairGenerationState=function(b,c,h){"string"===typeof b&&(b=parseInt(b,10));b=b||2048;h=h||{};var m=h.prng||a.random,d={nextBytes:function(a){for(var b=m.getBytesSync(a.length),
c=0;c<a.length;++c)a[c]=b.charCodeAt(c)}};h=h.algorithm||"PRIMEINC";if("PRIMEINC"===h)b={algorithm:h,state:0,bits:b,rng:d,eInt:c||65537,e:new g(null),p:null,q:null,qBits:b>>1,pBits:b-(b>>1),pqState:0,num:null,keys:null},b.e.fromInt(b.eInt);else throw Error("Invalid key generation algorithm: "+h);return b};w.rsa.stepKeyPairGenerationState=function(a,b){"algorithm"in a||(a.algorithm="PRIMEINC");var c=new g(null);c.fromInt(30);for(var h=0,d=function(a,b){return a|b},m=+new Date,n,f=0;null===a.keys&&
(0>=b||f<b);){if(0===a.state){n=null===a.p?a.pBits:a.qBits;var v=n-1;0===a.pqState?(a.num=new g(n,a.rng),a.num.testBit(v)||a.num.bitwiseTo(g.ONE.shiftLeft(v),d,a.num),a.num.dAddOffset(31-a.num.mod(c).byteValue(),0),h=0,++a.pqState):1===a.pqState?a.num.bitLength()>n?a.pqState=0:a.num.isProbablePrime(e(a.num.bitLength()))?++a.pqState:a.num.dAddOffset(z[h++%8],0):2===a.pqState?a.pqState=0===a.num.subtract(g.ONE).gcd(a.e).compareTo(g.ONE)?3:0:3===a.pqState&&(a.pqState=0,null===a.p?a.p=a.num:a.q=a.num,
null!==a.p&&null!==a.q&&++a.state,a.num=null)}else 1===a.state?(0>a.p.compareTo(a.q)&&(a.num=a.p,a.p=a.q,a.q=a.num),++a.state):2===a.state?(a.p1=a.p.subtract(g.ONE),a.q1=a.q.subtract(g.ONE),a.phi=a.p1.multiply(a.q1),++a.state):3===a.state?0===a.phi.gcd(a.e).compareTo(g.ONE)?++a.state:(a.p=null,a.q=null,a.state=0):4===a.state?(a.n=a.p.multiply(a.q),a.n.bitLength()===a.bits?++a.state:(a.q=null,a.state=0)):5===a.state&&(n=a.e.modInverse(a.phi),a.keys={privateKey:w.rsa.setPrivateKey(a.n,a.e,n,a.p,a.q,
n.mod(a.p1),n.mod(a.q1),a.q.modInverse(a.p)),publicKey:w.rsa.setPublicKey(a.n,a.e)});n=+new Date;f+=n-m;m=n}return null!==a.keys};w.rsa.generateKeyPair=function(h,d,l,e){1===arguments.length?"object"===typeof h?(l=h,h=void 0):"function"===typeof h&&(e=h,h=void 0):2===arguments.length?"number"===typeof h?"function"===typeof d?(e=d,d=void 0):"number"!==typeof d&&(l=d,d=void 0):(l=h,e=d,d=h=void 0):3===arguments.length&&("number"===typeof d?"function"===typeof l&&(e=l,l=void 0):(e=l,l=d,d=void 0));l=
l||{};void 0===h&&(h=l.bits||2048);void 0===d&&(d=l.e||65537);if(!a.disableNativeCode&&e&&256<=h&&16384>=h&&(65537===d||3===d)){if(b("generateKey")&&b("exportKey"))return window.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:h,publicExponent:u(d),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return window.crypto.subtle.exportKey("pkcs8",a.privateKey)})["catch"](function(a){e(a)}).then(function(b){b&&(b=w.privateKeyFromAsn1(t.fromDer(a.util.createBuffer(b))),e(null,
{privateKey:b,publicKey:w.setRsaPublicKey(b.n,b.e)}))});if(c("generateKey")&&c("exportKey")){var m=window.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:h,publicExponent:u(d),hash:{name:"SHA-256"}},!0,["sign","verify"]);m.oncomplete=function(b){b=window.msCrypto.subtle.exportKey("pkcs8",b.target.result.privateKey);b.oncomplete=function(b){b=w.privateKeyFromAsn1(t.fromDer(a.util.createBuffer(b.target.result)));e(null,{privateKey:b,publicKey:w.setRsaPublicKey(b.n,b.e)})};b.onerror=
function(a){e(a)}};m.onerror=function(a){e(a)};return}}m=w.rsa.createKeyPairGenerationState(h,d,l);if(!e)return w.rsa.stepKeyPairGenerationState(m,0),m.keys;p(m,l,e)};w.setRsaPublicKey=w.rsa.setPublicKey=function(b,c){var h={n:b,e:c,encrypt:function(b,c,d){"string"===typeof c?c=c.toUpperCase():void 0===c&&(c="RSAES-PKCS1-V1_5");if("RSAES-PKCS1-V1_5"===c)c={encode:function(a,b,c){return f(a,b,2).getBytes()}};else if("RSA-OAEP"===c||"RSAES-OAEP"===c)c={encode:function(b,c){return a.pkcs1.encode_rsa_oaep(c,
b,d)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(c))c={encode:function(a){return a}};else if("string"===typeof c)throw Error('Unsupported encryption scheme: "'+c+'".');b=c.encode(b,h,!0);return w.rsa.encrypt(b,h,!0)},verify:function(a,b,c){"string"===typeof c?c=c.toUpperCase():void 0===c&&(c="RSASSA-PKCS1-V1_5");if("RSASSA-PKCS1-V1_5"===c)c={verify:function(a,b){b=d(b,h,!0);var c=t.fromDer(b);return a===c.value[1].value}};else if("NONE"===c||"NULL"===c||null===c)c={verify:function(a,b){b=d(b,
h,!0);return a===b}};b=w.rsa.decrypt(b,h,!0,!1);return c.verify(a,b,h.n.bitLength())}};return h};w.setRsaPrivateKey=w.rsa.setPrivateKey=function(b,c,h,e,g,n,f,v){var m={n:b,e:c,d:h,p:e,q:g,dP:n,dQ:f,qInv:v,decrypt:function(b,c,h){"string"===typeof c?c=c.toUpperCase():void 0===c&&(c="RSAES-PKCS1-V1_5");b=w.rsa.decrypt(b,m,!1,!1);if("RSAES-PKCS1-V1_5"===c)c={decode:d};else if("RSA-OAEP"===c||"RSAES-OAEP"===c)c={decode:function(b,c){return a.pkcs1.decode_rsa_oaep(c,b,h)}};else if(-1!==["RAW","NONE",
"NULL",null].indexOf(c))c={decode:function(a){return a}};else throw Error('Unsupported encryption scheme: "'+c+'".');return c.decode(b,m,!1)},sign:function(a,b){var c=!1;"string"===typeof b&&(b=b.toUpperCase());if(void 0===b||"RSASSA-PKCS1-V1_5"===b)b={encode:E},c=1;else if("NONE"===b||"NULL"===b||null===b)b={encode:function(){return a}},c=1;var h=b.encode(a,m.n.bitLength());return w.rsa.encrypt(h,m,c)}};return m};w.wrapRsaPrivateKey=function(a){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,
[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(0).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(w.oids.rsaEncryption).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.OCTETSTRING,!1,t.toDer(a).getBytes())])};w.privateKeyFromAsn1=function(b){var c={},h=[];t.validate(b,n,c,h)&&(b=t.fromDer(a.util.createBuffer(c.privateKey)));c={};h=[];if(!t.validate(b,r,c,h))throw c=Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey."),
c.errors=h,c;h=a.util.createBuffer(c.privateKeyModulus).toHex();b=a.util.createBuffer(c.privateKeyPublicExponent).toHex();var d=a.util.createBuffer(c.privateKeyPrivateExponent).toHex();var m=a.util.createBuffer(c.privateKeyPrime1).toHex();var e=a.util.createBuffer(c.privateKeyPrime2).toHex();var f=a.util.createBuffer(c.privateKeyExponent1).toHex();var v=a.util.createBuffer(c.privateKeyExponent2).toHex();c=a.util.createBuffer(c.privateKeyCoefficient).toHex();return w.setRsaPrivateKey(new g(h,16),new g(b,
16),new g(d,16),new g(m,16),new g(e,16),new g(f,16),new g(v,16),new g(c,16))};w.privateKeyToAsn1=w.privateKeyToRSAPrivateKey=function(a){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,t.integerToDer(0).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.n)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.e)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.d)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.p)),t.create(t.Class.UNIVERSAL,
t.Type.INTEGER,!1,k(a.q)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.dP)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.dQ)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.qInv))])};w.publicKeyFromAsn1=function(b){var c={},h=[];if(t.validate(b,v,c,h)){h=t.derToOid(c.publicKeyOid);if(h!==w.oids.rsaEncryption)throw c=Error("Cannot read public key. Unknown OID."),c.oid=h,c;b=c.rsaPublicKey}h=[];if(!t.validate(b,y,c,h))throw c=Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey."),
c.errors=h,c;h=a.util.createBuffer(c.publicKeyModulus).toHex();c=a.util.createBuffer(c.publicKeyExponent).toHex();return w.setRsaPublicKey(new g(h,16),new g(c,16))};w.publicKeyToAsn1=w.publicKeyToSubjectPublicKeyInfo=function(a){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.OID,!1,t.oidToDer(w.oids.rsaEncryption).getBytes()),t.create(t.Class.UNIVERSAL,t.Type.NULL,!1,"")]),t.create(t.Class.UNIVERSAL,t.Type.BITSTRING,
!1,[w.publicKeyToRSAPublicKey(a)])])};w.publicKeyToRSAPublicKey=function(a){return t.create(t.Class.UNIVERSAL,t.Type.SEQUENCE,!0,[t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.n)),t.create(t.Class.UNIVERSAL,t.Type.INTEGER,!1,k(a.e))])}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||
{};d.defined=d.defined||{};if(d.defined.rsa)return d.rsa;d.defined.rsa=!0;for(var k=0;k<f.length;++k)f[k](d);return d.rsa}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/rsa","require module ./asn1 ./jsbn ./oids ./pkcs1 ./prime ./random ./util".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(a,
b){return a.start().update(b).digest().getBytes()}function d(a){if(a){var c=b.oids[e.derToOid(a)];if(!c)throw c=Error("Unsupported PRF OID."),c.oid=a,c.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],c;}else c="hmacWithSHA1";return p(c)}function p(b){var c=a.md;switch(b){case "hmacWithSHA224":c=a.md.sha512;case "hmacWithSHA1":case "hmacWithSHA256":case "hmacWithSHA384":case "hmacWithSHA512":b=b.substr(8).toLowerCase();break;default:throw c=Error("Unsupported PRF algorithm."),
c.algorithm=b,c.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],c;}return c[b].create()}if("undefined"===typeof k)var k=a.jsbn.BigInteger;var e=a.asn1,b=a.pki=a.pki||{};b.pbe=a.pbe=a.pbe||{};var c=b.oids,u={name:"EncryptedPrivateKeyInfo",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",
tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},g={name:"PBES2Algorithms",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:e.Class.UNIVERSAL,
type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},
{name:"PBES2Algorithms.params.keyLength",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",
tagClass:e.Class.UNIVERSAL,type:e.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},t={name:"pkcs-12PbeParams",tagClass:e.Class.UNIVERSAL,type:e.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:e.Class.UNIVERSAL,type:e.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:e.Class.UNIVERSAL,type:e.Type.INTEGER,constructed:!1,
capture:"iterations"}]};b.encryptPrivateKeyInfo=function(d,g,n){n=n||{};n.saltSize=n.saltSize||8;n.count=n.count||2048;n.algorithm=n.algorithm||"aes128";n.prfAlgorithm=n.prfAlgorithm||"sha1";var f=a.random.getBytesSync(n.saltSize),k=n.count,v=e.integerToDer(k),E;if(0===n.algorithm.indexOf("aes")||"des"===n.algorithm){switch(n.algorithm){case "aes128":var h=E=16;var m=c["aes128-CBC"];var C=a.aes.createEncryptionCipher;break;case "aes192":E=24;h=16;m=c["aes192-CBC"];C=a.aes.createEncryptionCipher;break;
case "aes256":E=32;h=16;m=c["aes256-CBC"];C=a.aes.createEncryptionCipher;break;case "des":h=E=8;m=c.desCBC;C=a.des.createEncryptionCipher;break;default:throw f=Error("Cannot encrypt private key. Unknown encryption algorithm."),f.algorithm=n.algorithm,f;}n="hmacWith"+n.prfAlgorithm.toUpperCase();var l=p(n);l=a.pkcs5.pbkdf2(g,f,k,E,l);g=a.random.getBytesSync(h);k=C(l);k.start(g);k.update(e.toDer(d));k.finish();d=k.output.getBytes();f=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,
e.Type.OCTETSTRING,!1,f),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,v.getBytes())]);"hmacWithSHA1"!==n&&f.value.push(e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,a.util.hexToBytes(E.toString(16))),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(b.oids[n]).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.NULL,!1,"")]));f=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(c.pkcs5PBES2).getBytes()),e.create(e.Class.UNIVERSAL,
e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(c.pkcs5PBKDF2).getBytes()),f]),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(m).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,g)])])])}else if("3des"===n.algorithm)E=24,m=new a.util.ByteBuffer(f),l=b.pbe.generatePkcs12Key(g,m,1,k,E),g=b.pbe.generatePkcs12Key(g,m,2,k,E),k=a.des.createEncryptionCipher(l),k.start(g),
k.update(e.toDer(d)),k.finish(),d=k.output.getBytes(),f=e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OID,!1,e.oidToDer(c["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),e.create(e.Class.UNIVERSAL,e.Type.SEQUENCE,!0,[e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,f),e.create(e.Class.UNIVERSAL,e.Type.INTEGER,!1,v.getBytes())])]);else throw f=Error("Cannot encrypt private key. Unknown encryption algorithm."),f.algorithm=n.algorithm,f;return e.create(e.Class.UNIVERSAL,
e.Type.SEQUENCE,!0,[f,e.create(e.Class.UNIVERSAL,e.Type.OCTETSTRING,!1,d)])};b.decryptPrivateKeyInfo=function(c,d){var g=null,f={},k=[];if(!e.validate(c,u,f,k))throw g=Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo."),g.errors=k,g;k=e.derToOid(f.encryptionOid);k=b.pbe.getCipher(k,f.encryptionParams,d);f=a.util.createBuffer(f.encryptedData);k.update(f);k.finish()&&(g=e.fromDer(k.output));return g};b.encryptedPrivateKeyToPem=function(b,c){var d={type:"ENCRYPTED PRIVATE KEY",
body:e.toDer(b).getBytes()};return a.pem.encode(d,{maxline:c})};b.encryptedPrivateKeyFromPem=function(b){b=a.pem.decode(b)[0];if("ENCRYPTED PRIVATE KEY"!==b.type){var c=Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');c.headerType=b.type;throw c;}if(b.procType&&"ENCRYPTED"===b.procType.type)throw Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return e.fromDer(b.body)};b.encryptRsaPrivateKey=function(c,d,g){g=g||{};
if(!g.legacy)return c=b.wrapRsaPrivateKey(b.privateKeyToAsn1(c)),c=b.encryptPrivateKeyInfo(c,d,g),b.encryptedPrivateKeyToPem(c);switch(g.algorithm){case "aes128":g="AES-128-CBC";var n=16;var f=a.random.getBytesSync(16);var v=a.aes.createEncryptionCipher;break;case "aes192":g="AES-192-CBC";n=24;f=a.random.getBytesSync(16);v=a.aes.createEncryptionCipher;break;case "aes256":g="AES-256-CBC";n=32;f=a.random.getBytesSync(16);v=a.aes.createEncryptionCipher;break;case "3des":g="DES-EDE3-CBC";n=24;f=a.random.getBytesSync(8);
v=a.des.createEncryptionCipher;break;case "des":g="DES-CBC";n=8;f=a.random.getBytesSync(8);v=a.des.createEncryptionCipher;break;default:throw c=Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+g.algorithm+'".'),c.algorithm=g.algorithm,c;}d=a.pbe.opensslDeriveBytes(d,f.substr(0,8),n);d=v(d);d.start(f);d.update(e.toDer(b.privateKeyToAsn1(c)));d.finish();c={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:g,parameters:a.util.bytesToHex(f).toUpperCase()},
body:d.output.getBytes()};return a.pem.encode(c)};b.decryptRsaPrivateKey=function(c,d){var g=null,f=a.pem.decode(c)[0];if("ENCRYPTED PRIVATE KEY"!==f.type&&"PRIVATE KEY"!==f.type&&"RSA PRIVATE KEY"!==f.type)throw g=Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".'),g.headerType=g,g;if(f.procType&&"ENCRYPTED"===f.procType.type){switch(f.dekInfo.algorithm){case "DES-CBC":var k=8;var v=a.des.createDecryptionCipher;break;
case "DES-EDE3-CBC":k=24;v=a.des.createDecryptionCipher;break;case "AES-128-CBC":k=16;v=a.aes.createDecryptionCipher;break;case "AES-192-CBC":k=24;v=a.aes.createDecryptionCipher;break;case "AES-256-CBC":k=32;v=a.aes.createDecryptionCipher;break;case "RC2-40-CBC":k=5;v=function(b){return a.rc2.createDecryptionCipher(b,40)};break;case "RC2-64-CBC":k=8;v=function(b){return a.rc2.createDecryptionCipher(b,64)};break;case "RC2-128-CBC":k=16;v=function(b){return a.rc2.createDecryptionCipher(b,128)};break;
default:throw g=Error('Could not decrypt private key; unsupported encryption algorithm "'+f.dekInfo.algorithm+'".'),g.algorithm=f.dekInfo.algorithm,g;}var E=a.util.hexToBytes(f.dekInfo.parameters);k=a.pbe.opensslDeriveBytes(d,E.substr(0,8),k);v=v(k);v.start(E);v.update(a.util.createBuffer(f.body));if(v.finish())g=v.output.getBytes();else return g}else g=f.body;g="ENCRYPTED PRIVATE KEY"===f.type?b.decryptPrivateKeyInfo(e.fromDer(g),d):e.fromDer(g);null!==g&&(g=b.privateKeyFromAsn1(g));return g};b.pbe.generatePkcs12Key=
function(b,c,d,e,g,f){var n,h;if("undefined"===typeof f||null===f)f=a.md.sha1.create();var m=f.digestLength,v=f.blockLength,l=new a.util.ByteBuffer,k=new a.util.ByteBuffer;if(null!==b&&void 0!==b){for(h=0;h<b.length;h++)k.putInt16(b.charCodeAt(h));k.putInt16(0)}b=k.length();var r=c.length(),y=new a.util.ByteBuffer;y.fillWithByte(d,v);var w=v*Math.ceil(r/v);d=new a.util.ByteBuffer;for(h=0;h<w;h++)d.putByte(c.at(h%r));w=v*Math.ceil(b/v);c=new a.util.ByteBuffer;for(h=0;h<w;h++)c.putByte(k.at(h%b));k=
d;k.putBuffer(c);c=Math.ceil(g/m);for(d=1;d<=c;d++){w=new a.util.ByteBuffer;w.putBytes(y.bytes());w.putBytes(k.bytes());for(h=0;h<e;h++)f.start(),f.update(w.getBytes()),w=f.digest();var t=new a.util.ByteBuffer;for(h=0;h<v;h++)t.putByte(w.at(h%m));var u=Math.ceil(r/v)+Math.ceil(b/v),z=new a.util.ByteBuffer;for(n=0;n<u;n++){var p=new a.util.ByteBuffer(k.getBytes(v)),q=511;for(h=t.length()-1;0<=h;h--)q>>=8,q+=t.at(h)+p.at(h),p.setAt(h,q&255);z.putBuffer(p)}k=z;l.putBuffer(w)}l.truncate(l.length()-g);
return l};b.pbe.getCipher=function(a,c,d){switch(a){case b.oids.pkcs5PBES2:return b.pbe.getCipherForPBES2(a,c,d);case b.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case b.oids["pbewithSHAAnd40BitRC2-CBC"]:return b.pbe.getCipherForPKCS12PBE(a,c,d);default:throw c=Error("Cannot read encrypted PBE data block. Unsupported OID."),c.oid=a,c.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],c;}};b.pbe.getCipherForPBES2=function(c,f,n){var k={};c=[];if(!e.validate(f,g,
k,c)){var y=Error("Cannot read pdw-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");y.errors=c;throw y;}c=e.derToOid(k.kdfOid);if(c!==b.oids.pkcs5PBKDF2)throw y=Error("Cannot read encrypted private key. Unsupported key derivation function OID."),y.oid=c,y.supportedOids=["pkcs5PBKDF2"],y;c=e.derToOid(k.encOid);if(c!==b.oids["aes128-CBC"]&&c!==b.oids["aes192-CBC"]&&c!==b.oids["aes256-CBC"]&&c!==b.oids["des-EDE3-CBC"]&&c!==b.oids.desCBC)throw y=Error("Cannot read encrypted private key. Unsupported encryption scheme OID."),
y.oid=c,y.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],y;f=k.kdfSalt;var v=a.util.createBuffer(k.kdfIterationCount);v=v.getInt(v.length()<<3);switch(b.oids[c]){case "aes128-CBC":var E=16;y=a.aes.createDecryptionCipher;break;case "aes192-CBC":E=24;y=a.aes.createDecryptionCipher;break;case "aes256-CBC":E=32;y=a.aes.createDecryptionCipher;break;case "des-EDE3-CBC":E=24;y=a.des.createDecryptionCipher;break;case "desCBC":E=8,y=a.des.createDecryptionCipher}c=d(k.prfOid);
n=a.pkcs5.pbkdf2(n,f,v,E,c);k=k.encIv;y=y(n);y.start(k);return y};b.pbe.getCipherForPKCS12PBE=function(c,g,f){var n={},k=[];if(!e.validate(g,t,n,k))throw f=Error("Cannot read pdw-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo."),f.errors=k,f;k=a.util.createBuffer(n.salt);g=a.util.createBuffer(n.iterations);g=g.getInt(g.length()<<3);switch(c){case b.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:var v=24;var E=8;c=a.des.startDecrypting;break;case b.oids["pbewithSHAAnd40BitRC2-CBC"]:v=
5;E=8;c=function(b,c){var h=a.rc2.createDecryptionCipher(b,40);h.start(c,null);return h};break;default:throw f=Error("Cannot read PKCS #12 PBE data block. Unsupported OID."),f.oid=c,f;}n=d(n.prfOid);v=b.pbe.generatePkcs12Key(f,k,1,g,v,n);n.start();f=b.pbe.generatePkcs12Key(f,k,2,g,E,n);return c(v,f)};b.pbe.opensslDeriveBytes=function(b,c,d,e){if("undefined"===typeof e||null===e)e=a.md.md5.create();null===c&&(c="");for(var g=[f(e,b+c)],n=16,k=1;n<d;++k,n+=16)g.push(f(e,g[k-1]+b+c));return g.join("").substr(0,
d)}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.pbe)return d.pbe;d.defined.pbe=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pbe}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,
0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/pbe","require module ./aes ./asn1 ./des ./md ./oids ./pem ./pbkdf2 ./random ./rc2 ./rsa ./util".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){var f=a.asn1,d=a.pkcs7asn1=a.pkcs7asn1||{};a.pkcs7=a.pkcs7||{};a.pkcs7.asn1=d;a={name:"ContentInfo",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:f.Class.UNIVERSAL,
type:f.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};d.contentInfoValidator=a;var p={name:"EncryptedContentInfo",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:f.Class.UNIVERSAL,
type:f.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:f.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};d.envelopedDataValidator={name:"EnvelopedData",
tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:f.Class.UNIVERSAL,type:f.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(p)};d.encryptedDataValidator={name:"EncryptedData",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,
constructed:!1,capture:"version"}].concat(p)};d.signedDataValidator={name:"SignedData",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:f.Class.UNIVERSAL,type:f.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},a,{name:"SignedData.Certificates",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},
{name:"SignedData.CertificateRevocationLists",tagClass:f.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:f.Class.UNIVERSAL,type:f.Type.SET,capture:"signerInfos",optional:!0,value:[{name:"SignerInfo",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,
constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,capture:"digestAlgorithm"},
{name:"SignerInfo.digestAlgorithm.parameter",tagClass:f.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:f.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:f.Class.UNIVERSAL,type:f.Type.OCTETSTRING,
constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:f.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]}]}]};d.recipientInfoValidator={name:"RecipientInfo",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,
constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:f.Class.UNIVERSAL,type:f.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:f.Class.UNIVERSAL,type:f.Type.OID,constructed:!1,
capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:f.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:f.Class.UNIVERSAL,type:f.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);
d=d||{};d.defined=d.defined||{};if(d.defined.pkcs7asn1)return d.pkcs7asn1;d.defined.pkcs7asn1=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pkcs7asn1}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/pkcs7asn1",["require","module","./asn1","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){a.mgf=
a.mgf||{};(a.mgf.mgf1=a.mgf1=a.mgf1||{}).create=function(f){return{generate:function(d,p){for(var k=new a.util.ByteBuffer,e=Math.ceil(p/f.digestLength),b=0;b<e;b++){var c=new a.util.ByteBuffer;c.putInt32(b);f.start();f.update(d+c.getBytes());k.putBuffer(f.digest())}k.truncate(k.length()-p);return k.getBytes()}}}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=
function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.mgf1)return d.mgf1;d.defined.mgf1=!0;for(var k=0;k<f.length;++k)f[k](d);return d.mgf1}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/mgf1",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();
(function(){function q(a){a.mgf=a.mgf||{};a.mgf.mgf1=a.mgf1}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.mgf)return d.mgf;d.defined.mgf=!0;for(var k=0;k<f.length;++k)f[k](d);return d.mgf}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):
a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/mgf",["require","module","./mgf1"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){(a.pss=a.pss||{}).create=function(f){3===arguments.length&&(f={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var d=f.md,p=f.mgf,k=d.digestLength,e=f.salt||null;"string"===typeof e&&(e=a.util.createBuffer(e));
if("saltLength"in f)var b=f.saltLength;else if(null!==e)b=e.length();else throw Error("Salt length not specified or specific salt not given.");if(null!==e&&e.length()!==b)throw Error("Given salt length does not match length of given salt.");var c=f.prng||a.random;return{encode:function(f,g){var t=g-1,w=Math.ceil(t/8),u=f.digest().getBytes();if(w<k+b+2)throw Error("Message is too long to encrypt.");var n=null===e?c.getBytesSync(b):e.bytes();var r=new a.util.ByteBuffer;r.fillWithByte(0,8);r.putBytes(u);
r.putBytes(n);d.start();d.update(r.getBytes());u=d.digest().getBytes();r=new a.util.ByteBuffer;r.fillWithByte(0,w-b-k-2);r.putByte(1);r.putBytes(n);var y=r.getBytes(),v=w-k-1,E=p.generate(u,v);n="";for(r=0;r<v;r++)n+=String.fromCharCode(y.charCodeAt(r)^E.charCodeAt(r));t=65280>>8*w-t&255;n=String.fromCharCode(n.charCodeAt(0)&~t)+n.substr(1);return n+u+String.fromCharCode(188)},verify:function(c,e,f){var g=f-1;f=Math.ceil(g/8);e=e.substr(-f);if(f<k+b+2)throw Error("Inconsistent parameters to PSS signature verification.");
if(188!==e.charCodeAt(f-1))throw Error("Encoded message does not end in 0xBC.");var t=f-k-1,n=e.substr(0,t);e=e.substr(t,k);var r=65280>>8*f-g&255;if(0!==(n.charCodeAt(0)&r))throw Error("Bits beyond keysize not zero as expected.");var y=p.generate(e,t),v="";for(g=0;g<t;g++)v+=String.fromCharCode(n.charCodeAt(g)^y.charCodeAt(g));v=String.fromCharCode(v.charCodeAt(0)&~r)+v.substr(1);f=f-k-b-2;for(g=0;g<f;g++)if(0!==v.charCodeAt(g))throw Error("Leftmost octets not zero as expected");if(1!==v.charCodeAt(f))throw Error("Inconsistent PSS signature, 0x01 marker not found");
f=v.substr(-b);t=new a.util.ByteBuffer;t.fillWithByte(0,8);t.putBytes(c);t.putBytes(f);d.start();d.update(t.getBytes());c=d.digest().getBytes();return e===c}}}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.pss)return d.pss;d.defined.pss=!0;for(var k=
0;k<f.length;++k)f[k](d);return d.pss}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/pss",["require","module","./random","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(a,b){"string"===typeof b&&(b={shortName:b});for(var c=null,d,e=0;null===c&&e<a.attributes.length;++e)d=a.attributes[e],
b.type&&b.type===d.type?c=d:b.name&&b.name===d.name?c=d:b.shortName&&b.shortName===d.shortName&&(c=d);return c}function d(b){var d=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]);b=b.attributes;for(var h=0;h<b.length;++h){var m=b[h];var e=m.value,l=c.Type.PRINTABLESTRING;"valueTagClass"in m&&(l=m.valueTagClass,l===c.Type.UTF8&&(e=a.util.encodeUtf8(e)));m=c.create(c.Class.UNIVERSAL,c.Type.SET,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(m.type).getBytes()),
c.create(c.Class.UNIVERSAL,l,!1,e)])]);d.value.push(m)}return d}function p(a){for(var b,h=0;h<a.length;++h){b=a[h];"undefined"===typeof b.name&&(b.type&&b.type in u.oids?b.name=u.oids[b.type]:b.shortName&&b.shortName in t&&(b.name=u.oids[t[b.shortName]]));if("undefined"===typeof b.type)if(b.name&&b.name in u.oids)b.type=u.oids[b.name];else throw a=Error("Attribute type not specified."),a.attribute=b,a;"undefined"===typeof b.shortName&&b.name&&b.name in t&&(b.shortName=t[b.name]);if(b.type===g.extensionRequest&&
(b.valueConstructed=!0,b.valueTagClass=c.Type.SEQUENCE,!b.value&&b.extensions)){b.value=[];for(var d=0;d<b.extensions.length;++d)b.value.push(u.certificateExtensionToAsn1(k(b.extensions[d])))}if("undefined"===typeof b.value)throw a=Error("Attribute value not specified."),a.attribute=b,a;}}function k(b,e){e=e||{};"undefined"===typeof b.name&&b.id&&b.id in u.oids&&(b.name=u.oids[b.id]);if("undefined"===typeof b.id)if(b.name&&b.name in u.oids)b.id=u.oids[b.name];else{var h=Error("Extension ID not specified.");
h.extension=b;throw h;}if("undefined"!==typeof b.value)return b;if("keyUsage"===b.name){var m=0,f=h=0;b.digitalSignature&&(h|=128,m=7);b.nonRepudiation&&(h|=64,m=6);b.keyEncipherment&&(h|=32,m=5);b.dataEncipherment&&(h|=16,m=4);b.keyAgreement&&(h|=8,m=3);b.keyCertSign&&(h|=4,m=2);b.cRLSign&&(h|=2,m=1);b.encipherOnly&&(h|=1,m=0);b.decipherOnly&&(f|=128,m=7);m=String.fromCharCode(m);0!==f?m+=String.fromCharCode(h)+String.fromCharCode(f):0!==h&&(m+=String.fromCharCode(h));b.value=c.create(c.Class.UNIVERSAL,
c.Type.BITSTRING,!1,m)}else if("basicConstraints"===b.name)b.value=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]),b.cA&&b.value.value.push(c.create(c.Class.UNIVERSAL,c.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in b&&b.value.value.push(c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(b.pathLenConstraint).getBytes()));else if("extKeyUsage"===b.name)for(m in b.value=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]),h=b.value.value,b)!0===b[m]&&(m in g?h.push(c.create(c.Class.UNIVERSAL,
c.Type.OID,!1,c.oidToDer(g[m]).getBytes())):-1!==m.indexOf(".")&&h.push(c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(m).getBytes())));else if("nsCertType"===b.name)h=m=0,b.client&&(h|=128,m=7),b.server&&(h|=64,m=6),b.email&&(h|=32,m=5),b.objsign&&(h|=16,m=4),b.reserved&&(h|=8,m=3),b.sslCA&&(h|=4,m=2),b.emailCA&&(h|=2,m=1),b.objCA&&(h|=1,m=0),m=String.fromCharCode(m),0!==h&&(m+=String.fromCharCode(h)),b.value=c.create(c.Class.UNIVERSAL,c.Type.BITSTRING,!1,m);else if("subjectAltName"===b.name||
"issuerAltName"===b.name){b.value=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]);for(var l=0;l<b.altNames.length;++l){f=b.altNames[l];m=f.value;if(7===f.type&&f.ip){if(m=a.util.bytesFromIP(f.ip),null===m)throw h=Error('Extension "ip" value is not a valid IPv4 or IPv6 address.'),h.extension=b,h;}else 8===f.type&&(m=f.oid?c.oidToDer(c.oidToDer(f.oid)):c.oidToDer(m));b.value.value.push(c.create(c.Class.CONTEXT_SPECIFIC,f.type,!1,m))}}else if("subjectKeyIdentifier"===b.name&&e.cert)h=e.cert.generateSubjectKeyIdentifier(),
b.subjectKeyIdentifier=h.toHex(),b.value=c.create(c.Class.UNIVERSAL,c.Type.OCTETSTRING,!1,h.getBytes());else if("authorityKeyIdentifier"===b.name&&e.cert)b.value=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]),h=b.value.value,b.keyIdentifier&&(m=!0===b.keyIdentifier?e.cert.generateSubjectKeyIdentifier().getBytes():b.keyIdentifier,h.push(c.create(c.Class.CONTEXT_SPECIFIC,0,!1,m))),b.authorityCertIssuer&&(m=[c.create(c.Class.CONTEXT_SPECIFIC,4,!0,[d(!0===b.authorityCertIssuer?e.cert.issuer:b.authorityCertIssuer)])],
h.push(c.create(c.Class.CONTEXT_SPECIFIC,1,!0,m))),b.serialNumber&&(m=a.util.hexToBytes(!0===b.serialNumber?e.cert.serialNumber:b.serialNumber),h.push(c.create(c.Class.CONTEXT_SPECIFIC,2,!1,m)));else if("cRLDistributionPoints"===b.name){b.value=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]);h=b.value.value;var n=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]),k=c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[]);for(l=0;l<b.altNames.length;++l){f=b.altNames[l];m=f.value;if(7===f.type&&f.ip){if(m=a.util.bytesFromIP(f.ip),
null===m)throw h=Error('Extension "ip" value is not a valid IPv4 or IPv6 address.'),h.extension=b,h;}else 8===f.type&&(m=f.oid?c.oidToDer(c.oidToDer(f.oid)):c.oidToDer(m));k.value.push(c.create(c.Class.CONTEXT_SPECIFIC,f.type,!1,m))}n.value.push(c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[k]));h.push(n)}if("undefined"===typeof b.value)throw h=Error("Extension value not specified."),h.extension=b,h;return b}function e(a,b){switch(a){case g["RSASSA-PSS"]:var d=[];void 0!==b.hash.algorithmOid&&d.push(c.create(c.Class.CONTEXT_SPECIFIC,
0,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.hash.algorithmOid).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.NULL,!1,"")])]));void 0!==b.mgf.algorithmOid&&d.push(c.create(c.Class.CONTEXT_SPECIFIC,1,!0,[c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.mgf.algorithmOid).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.mgf.hash.algorithmOid).getBytes()),
c.create(c.Class.UNIVERSAL,c.Type.NULL,!1,"")])])]));void 0!==b.saltLength&&d.push(c.create(c.Class.CONTEXT_SPECIFIC,2,!0,[c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(b.saltLength).getBytes())]));return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,d);default:return c.create(c.Class.UNIVERSAL,c.Type.NULL,!1,"")}}function b(b){var d=c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===b.attributes.length)return d;b=b.attributes;for(var h=0;h<b.length;++h){var e=b[h],g=e.value,l=c.Type.UTF8;
"valueTagClass"in e&&(l=e.valueTagClass);l===c.Type.UTF8&&(g=a.util.encodeUtf8(g));var f=!1;"valueConstructed"in e&&(f=e.valueConstructed);e=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(e.type).getBytes()),c.create(c.Class.UNIVERSAL,c.Type.SET,!0,[c.create(c.Class.UNIVERSAL,l,f,g)])]);d.value.push(e)}return d}var c=a.asn1,u=a.pki=a.pki||{},g=u.oids,t={};t.CN=g.commonName;t.commonName="CN";t.C=g.countryName;t.countryName="C";t.L=g.localityName;
t.localityName="L";t.ST=g.stateOrProvinceName;t.stateOrProvinceName="ST";t.O=g.organizationName;t.organizationName="O";t.OU=g.organizationalUnitName;t.organizationalUnitName="OU";t.E=g.emailAddress;t.emailAddress="E";var w=a.pki.rsa.publicKeyValidator,z={name:"Certificate",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",
tagClass:c.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",
tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:c.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",
tagClass:c.Class.UNIVERSAL,type:c.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:c.Class.UNIVERSAL,type:c.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:c.Class.UNIVERSAL,type:c.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",
tagClass:c.Class.UNIVERSAL,type:c.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},w,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:c.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:c.Class.UNIVERSAL,type:c.Type.BITSTRING,constructed:!1,
capture:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:c.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:c.Class.UNIVERSAL,type:c.Type.BITSTRING,constructed:!1,capture:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:c.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:c.Class.UNIVERSAL,
type:c.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:c.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:c.Class.UNIVERSAL,type:c.Type.BITSTRING,constructed:!1,capture:"certSignature"}]},n={name:"rsapss",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,
constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:c.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:c.Class.UNIVERSAL,type:c.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:c.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",
tagClass:c.Class.UNIVERSAL,type:c.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},
{name:"rsapss.saltLength",tagClass:c.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:c.Class.UNIVERSAL,type:c.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:c.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:c.Class.UNIVERSAL,type:c.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},r={name:"CertificationRequest",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,
captureAsn1:"csr",value:[{name:"CertificationRequestInfo",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:c.Class.UNIVERSAL,type:c.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},w,{name:"CertificationRequestInfo.attributes",
tagClass:c.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:c.Class.UNIVERSAL,type:c.Type.SET,constructed:!0}]}]}]},{name:"CertificationRequest.signatureAlgorithm",
tagClass:c.Class.UNIVERSAL,type:c.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:c.Class.UNIVERSAL,type:c.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:c.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:c.Class.UNIVERSAL,type:c.Type.BITSTRING,constructed:!1,capture:"csrSignature"}]};u.RDNAttributesAsArray=function(a,
b){for(var d=[],e,f,l,n=0;n<a.value.length;++n){e=a.value[n];for(var k=0;k<e.value.length;++k)l={},f=e.value[k],l.type=c.derToOid(f.value[0].value),l.value=f.value[1].value,l.valueTagClass=f.value[1].type,l.type in g&&(l.name=g[l.type],l.name in t&&(l.shortName=t[l.name])),b&&(b.update(l.type),b.update(l.value)),d.push(l)}return d};u.CRIAttributesAsArray=function(a){for(var b=[],d=0;d<a.length;++d){var e=a[d],f=c.derToOid(e.value[0].value);e=e.value[1].value;for(var l=0;l<e.length;++l){var n={};n.type=
f;n.value=e[l].value;n.valueTagClass=e[l].type;n.type in g&&(n.name=g[n.type],n.name in t&&(n.shortName=t[n.name]));if(n.type===g.extensionRequest){n.extensions=[];for(var k=0;k<n.value.length;++k)n.extensions.push(u.certificateExtensionFromAsn1(n.value[k]))}b.push(n)}}return b};var y=function(a,b,d){var h={};if(a!==g["RSASSA-PSS"])return h;d&&(h={hash:{algorithmOid:g.sha1},mgf:{algorithmOid:g.mgf1,hash:{algorithmOid:g.sha1}},saltLength:20});d={};a=[];if(!c.validate(b,n,d,a))throw b=Error("Cannot read RSASSA-PSS parameter block."),
b.errors=a,b;void 0!==d.hashOid&&(h.hash=h.hash||{},h.hash.algorithmOid=c.derToOid(d.hashOid));void 0!==d.maskGenOid&&(h.mgf=h.mgf||{},h.mgf.algorithmOid=c.derToOid(d.maskGenOid),h.mgf.hash=h.mgf.hash||{},h.mgf.hash.algorithmOid=c.derToOid(d.maskGenHashOid));void 0!==d.saltLength&&(h.saltLength=d.saltLength.charCodeAt(0));return h};u.certificateFromPem=function(b,d,h){b=a.pem.decode(b)[0];if("CERTIFICATE"!==b.type&&"X509 CERTIFICATE"!==b.type&&"TRUSTED CERTIFICATE"!==b.type)throw d=Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".'),
d.headerType=b.type,d;if(b.procType&&"ENCRYPTED"===b.procType.type)throw Error("Could not convert certificate from PEM; PEM is encrypted.");h=c.fromDer(b.body,h);return u.certificateFromAsn1(h,d)};u.certificateToPem=function(b,d){var h={type:"CERTIFICATE",body:c.toDer(u.certificateToAsn1(b)).getBytes()};return a.pem.encode(h,{maxline:d})};u.publicKeyFromPem=function(b){b=a.pem.decode(b)[0];if("PUBLIC KEY"!==b.type&&"RSA PUBLIC KEY"!==b.type){var d=Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');
d.headerType=b.type;throw d;}if(b.procType&&"ENCRYPTED"===b.procType.type)throw Error("Could not convert public key from PEM; PEM is encrypted.");b=c.fromDer(b.body);return u.publicKeyFromAsn1(b)};u.publicKeyToPem=function(b,d){var h={type:"PUBLIC KEY",body:c.toDer(u.publicKeyToAsn1(b)).getBytes()};return a.pem.encode(h,{maxline:d})};u.publicKeyToRSAPublicKeyPem=function(b,d){var h={type:"RSA PUBLIC KEY",body:c.toDer(u.publicKeyToRSAPublicKey(b)).getBytes()};return a.pem.encode(h,{maxline:d})};u.getPublicKeyFingerprint=
function(b,d){d=d||{};var h=d.md||a.md.sha1.create();switch(d.type||"RSAPublicKey"){case "RSAPublicKey":var e=c.toDer(u.publicKeyToRSAPublicKey(b)).getBytes();break;case "SubjectPublicKeyInfo":e=c.toDer(u.publicKeyToAsn1(b)).getBytes();break;default:throw Error('Unknown fingerprint type "'+d.type+'".');}h.start();h.update(e);h=h.digest();if("hex"===d.encoding)return h=h.toHex(),d.delimiter?h.match(/.{2}/g).join(d.delimiter):h;if("binary"===d.encoding)return h.getBytes();if(d.encoding)throw Error('Unknown encoding "'+
d.encoding+'".');return h};u.certificationRequestFromPem=function(b,d,h){b=a.pem.decode(b)[0];if("CERTIFICATE REQUEST"!==b.type)throw d=Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".'),d.headerType=b.type,d;if(b.procType&&"ENCRYPTED"===b.procType.type)throw Error("Could not convert certification request from PEM; PEM is encrypted.");h=c.fromDer(b.body,h);return u.certificationRequestFromAsn1(h,d)};u.certificationRequestToPem=function(b,d){var h=
{type:"CERTIFICATE REQUEST",body:c.toDer(u.certificationRequestToAsn1(b)).getBytes()};return a.pem.encode(h,{maxline:d})};u.createCertificate=function(){var b={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};b.siginfo.algorithmOid=null;b.validity={};b.validity.notBefore=new Date;b.validity.notAfter=new Date;b.issuer={};b.issuer.getField=function(a){return f(b.issuer,a)};b.issuer.addField=function(a){p([a]);b.issuer.attributes.push(a)};b.issuer.attributes=[];b.issuer.hash=
null;b.subject={};b.subject.getField=function(a){return f(b.subject,a)};b.subject.addField=function(a){p([a]);b.subject.attributes.push(a)};b.subject.attributes=[];b.subject.hash=null;b.extensions=[];b.publicKey=null;b.md=null;b.setSubject=function(a,c){p(a);b.subject.attributes=a;delete b.subject.uniqueId;c&&(b.subject.uniqueId=c);b.subject.hash=null};b.setIssuer=function(a,c){p(a);b.issuer.attributes=a;delete b.issuer.uniqueId;c&&(b.issuer.uniqueId=c);b.issuer.hash=null};b.setExtensions=function(a){for(var c=
0;c<a.length;++c)k(a[c],{cert:b});b.extensions=a};b.getExtension=function(a){"string"===typeof a&&(a={name:a});for(var c=null,d,e=0;null===c&&e<b.extensions.length;++e)d=b.extensions[e],a.id&&d.id===a.id?c=d:a.name&&d.name===a.name&&(c=d);return c};b.sign=function(d,h){b.md=h||a.md.sha1.create();var e=g[b.md.algorithm+"WithRSAEncryption"];if(!e)throw e=Error("Could not compute certificate digest. Unknown message digest algorithm OID."),e.algorithm=b.md.algorithm,e;b.signatureOid=b.siginfo.algorithmOid=
e;b.tbsCertificate=u.getTBSCertificate(b);e=c.toDer(b.tbsCertificate);b.md.update(e.getBytes());b.signature=d.sign(b.md)};b.verify=function(d){var h=!1;if(!b.issued(d)){h=b.subject;var e=Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");e.expectedIssuer=d.issuer.attributes;e.actualIssuer=h.attributes;throw e;}e=d.md;if(null===e){if(d.signatureOid in g)switch(g[d.signatureOid]){case "sha1WithRSAEncryption":e=
a.md.sha1.create();break;case "md5WithRSAEncryption":e=a.md.md5.create();break;case "sha256WithRSAEncryption":e=a.md.sha256.create();break;case "sha512WithRSAEncryption":e=a.md.sha512.create();break;case "RSASSA-PSS":e=a.md.sha256.create()}if(null===e)throw e=Error("Could not compute certificate digest. Unknown signature OID."),e.signatureOid=d.signatureOid,e;var f=d.tbsCertificate||u.getTBSCertificate(d);f=c.toDer(f);e.update(f.getBytes())}if(null!==e){switch(d.signatureOid){case g.sha1WithRSAEncryption:var l=
void 0;break;case g["RSASSA-PSS"]:h=g[d.signatureParameters.mgf.hash.algorithmOid];if(void 0===h||void 0===a.md[h])throw e=Error("Unsupported MGF hash function."),e.oid=d.signatureParameters.mgf.hash.algorithmOid,e.name=h,e;l=g[d.signatureParameters.mgf.algorithmOid];if(void 0===l||void 0===a.mgf[l])throw e=Error("Unsupported MGF function."),e.oid=d.signatureParameters.mgf.algorithmOid,e.name=l,e;l=a.mgf[l].create(a.md[h].create());h=g[d.signatureParameters.hash.algorithmOid];if(void 0===h||void 0===
a.md[h])throw{message:"Unsupported RSASSA-PSS hash function.",oid:d.signatureParameters.hash.algorithmOid,name:h};l=a.pss.create(a.md[h].create(),l,d.signatureParameters.saltLength)}h=b.publicKey.verify(e.digest().getBytes(),d.signature,l)}return h};b.isIssuer=function(a){var c=!1,d=b.issuer;a=a.subject;if(d.hash&&a.hash)c=d.hash===a.hash;else if(d.attributes.length===a.attributes.length){c=!0;for(var e,l,g=0;c&&g<d.attributes.length;++g)if(e=d.attributes[g],l=a.attributes[g],e.type!==l.type||e.value!==
l.value)c=!1}return c};b.issued=function(a){return a.isIssuer(b)};b.generateSubjectKeyIdentifier=function(){return u.getPublicKeyFingerprint(b.publicKey,{type:"RSAPublicKey"})};b.verifySubjectKeyIdentifier=function(){for(var c=g.subjectKeyIdentifier,d=0;d<b.extensions.length;++d){var e=b.extensions[d];if(e.id===c)return c=b.generateSubjectKeyIdentifier().getBytes(),a.util.hexToBytes(e.subjectKeyIdentifier)===c}return!1};return b};u.certificateFromAsn1=function(b,d){var h={},e=[];if(!c.validate(b,
z,h,e))throw h=Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate."),h.errors=e,h;if("string"!==typeof h.certSignature){e="\x00";for(var n=0;n<h.certSignature.length;++n)e+=c.toDer(h.certSignature[n]).getBytes();h.certSignature=e}e=c.derToOid(h.publicKeyOid);if(e!==u.oids.rsaEncryption)throw Error("Cannot read public key. OID is not RSA.");var l=u.createCertificate();l.version=h.certVersion?h.certVersion.charCodeAt(0):0;e=a.util.createBuffer(h.certSerialNumber);l.serialNumber=
e.toHex();l.signatureOid=a.asn1.derToOid(h.certSignatureOid);l.signatureParameters=y(l.signatureOid,h.certSignatureParams,!0);l.siginfo.algorithmOid=a.asn1.derToOid(h.certinfoSignatureOid);l.siginfo.parameters=y(l.siginfo.algorithmOid,h.certinfoSignatureParams,!1);e=a.util.createBuffer(h.certSignature);++e.read;l.signature=e.getBytes();e=[];void 0!==h.certValidity1UTCTime&&e.push(c.utcTimeToDate(h.certValidity1UTCTime));void 0!==h.certValidity2GeneralizedTime&&e.push(c.generalizedTimeToDate(h.certValidity2GeneralizedTime));
void 0!==h.certValidity3UTCTime&&e.push(c.utcTimeToDate(h.certValidity3UTCTime));void 0!==h.certValidity4GeneralizedTime&&e.push(c.generalizedTimeToDate(h.certValidity4GeneralizedTime));if(2<e.length)throw Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(2>e.length)throw Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");l.validity.notBefore=e[0];l.validity.notAfter=e[1];
l.tbsCertificate=h.tbsCertificate;if(d){l.md=null;if(l.signatureOid in g)switch(e=g[l.signatureOid],e){case "sha1WithRSAEncryption":l.md=a.md.sha1.create();break;case "md5WithRSAEncryption":l.md=a.md.md5.create();break;case "sha256WithRSAEncryption":l.md=a.md.sha256.create();break;case "sha512WithRSAEncryption":l.md=a.md.sha512.create();break;case "RSASSA-PSS":l.md=a.md.sha256.create()}if(null===l.md)throw h=Error("Could not compute certificate digest. Unknown signature OID."),h.signatureOid=l.signatureOid,
h;e=c.toDer(l.tbsCertificate);l.md.update(e.getBytes())}e=a.md.sha1.create();l.issuer.getField=function(a){return f(l.issuer,a)};l.issuer.addField=function(a){p([a]);l.issuer.attributes.push(a)};l.issuer.attributes=u.RDNAttributesAsArray(h.certIssuer,e);h.certIssuerUniqueId&&(l.issuer.uniqueId=h.certIssuerUniqueId);l.issuer.hash=e.digest().toHex();e=a.md.sha1.create();l.subject.getField=function(a){return f(l.subject,a)};l.subject.addField=function(a){p([a]);l.subject.attributes.push(a)};l.subject.attributes=
u.RDNAttributesAsArray(h.certSubject,e);h.certSubjectUniqueId&&(l.subject.uniqueId=h.certSubjectUniqueId);l.subject.hash=e.digest().toHex();l.extensions=h.certExtensions?u.certificateExtensionsFromAsn1(h.certExtensions):[];l.publicKey=u.publicKeyFromAsn1(h.subjectPublicKeyInfo);return l};u.certificateExtensionsFromAsn1=function(a){for(var b=[],c=0;c<a.value.length;++c)for(var d=a.value[c],e=0;e<d.value.length;++e)b.push(u.certificateExtensionFromAsn1(d.value[e]));return b};u.certificateExtensionFromAsn1=
function(b){var d={};d.id=c.derToOid(b.value[0].value);d.critical=!1;b.value[1].type===c.Type.BOOLEAN?(d.critical=0!==b.value[1].value.charCodeAt(0),d.value=b.value[2].value):d.value=b.value[1].value;if(d.id in g)if(d.name=g[d.id],"keyUsage"===d.name){b=c.fromDer(d.value);var h=0,e=0;1<b.value.length&&(h=b.value.charCodeAt(1),e=2<b.value.length?b.value.charCodeAt(2):0);d.digitalSignature=128===(h&128);d.nonRepudiation=64===(h&64);d.keyEncipherment=32===(h&32);d.dataEncipherment=16===(h&16);d.keyAgreement=
8===(h&8);d.keyCertSign=4===(h&4);d.cRLSign=2===(h&2);d.encipherOnly=1===(h&1);d.decipherOnly=128===(e&128)}else if("basicConstraints"===d.name)b=c.fromDer(d.value),d.cA=0<b.value.length&&b.value[0].type===c.Type.BOOLEAN?0!==b.value[0].value.charCodeAt(0):!1,h=null,0<b.value.length&&b.value[0].type===c.Type.INTEGER?h=b.value[0].value:1<b.value.length&&(h=b.value[1].value),null!==h&&(d.pathLenConstraint=c.derToInteger(h));else if("extKeyUsage"===d.name)for(b=c.fromDer(d.value),h=0;h<b.value.length;++h)e=
c.derToOid(b.value[h].value),e in g?d[g[e]]=!0:d[e]=!0;else if("nsCertType"===d.name)b=c.fromDer(d.value),h=0,1<b.value.length&&(h=b.value.charCodeAt(1)),d.client=128===(h&128),d.server=64===(h&64),d.email=32===(h&32),d.objsign=16===(h&16),d.reserved=8===(h&8),d.sslCA=4===(h&4),d.emailCA=2===(h&2),d.objCA=1===(h&1);else if("subjectAltName"===d.name||"issuerAltName"===d.name)for(d.altNames=[],b=c.fromDer(d.value),e=0;e<b.value.length;++e){h=b.value[e];var f={type:h.type,value:h.value};d.altNames.push(f);
switch(h.type){case 7:f.ip=a.util.bytesToIP(h.value);break;case 8:f.oid=c.derToOid(h.value)}}else"subjectKeyIdentifier"===d.name&&(b=c.fromDer(d.value),d.subjectKeyIdentifier=a.util.bytesToHex(b.value));return d};u.certificationRequestFromAsn1=function(b,d){var h={},e=[];if(!c.validate(b,r,h,e))throw h=Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest."),h.errors=e,h;if("string"!==typeof h.csrSignature){e="\x00";for(var n=0;n<h.csrSignature.length;++n)e+=
c.toDer(h.csrSignature[n]).getBytes();h.csrSignature=e}e=c.derToOid(h.publicKeyOid);if(e!==u.oids.rsaEncryption)throw Error("Cannot read public key. OID is not RSA.");var l=u.createCertificationRequest();l.version=h.csrVersion?h.csrVersion.charCodeAt(0):0;l.signatureOid=a.asn1.derToOid(h.csrSignatureOid);l.signatureParameters=y(l.signatureOid,h.csrSignatureParams,!0);l.siginfo.algorithmOid=a.asn1.derToOid(h.csrSignatureOid);l.siginfo.parameters=y(l.siginfo.algorithmOid,h.csrSignatureParams,!1);e=
a.util.createBuffer(h.csrSignature);++e.read;l.signature=e.getBytes();l.certificationRequestInfo=h.certificationRequestInfo;if(d){l.md=null;if(l.signatureOid in g)switch(e=g[l.signatureOid],e){case "sha1WithRSAEncryption":l.md=a.md.sha1.create();break;case "md5WithRSAEncryption":l.md=a.md.md5.create();break;case "sha256WithRSAEncryption":l.md=a.md.sha256.create();break;case "sha512WithRSAEncryption":l.md=a.md.sha512.create();break;case "RSASSA-PSS":l.md=a.md.sha256.create()}if(null===l.md)throw h=
Error("Could not compute certification request digest. Unknown signature OID."),h.signatureOid=l.signatureOid,h;e=c.toDer(l.certificationRequestInfo);l.md.update(e.getBytes())}e=a.md.sha1.create();l.subject.getField=function(a){return f(l.subject,a)};l.subject.addField=function(a){p([a]);l.subject.attributes.push(a)};l.subject.attributes=u.RDNAttributesAsArray(h.certificationRequestInfoSubject,e);l.subject.hash=e.digest().toHex();l.publicKey=u.publicKeyFromAsn1(h.subjectPublicKeyInfo);l.getAttribute=
function(a){return f(l,a)};l.addAttribute=function(a){p([a]);l.attributes.push(a)};l.attributes=u.CRIAttributesAsArray(h.certificationRequestInfoAttributes||[]);return l};u.createCertificationRequest=function(){var b={version:0,signatureOid:null,signature:null,siginfo:{}};b.siginfo.algorithmOid=null;b.subject={};b.subject.getField=function(a){return f(b.subject,a)};b.subject.addField=function(a){p([a]);b.subject.attributes.push(a)};b.subject.attributes=[];b.subject.hash=null;b.publicKey=null;b.attributes=
[];b.getAttribute=function(a){return f(b,a)};b.addAttribute=function(a){p([a]);b.attributes.push(a)};b.md=null;b.setSubject=function(a){p(a);b.subject.attributes=a;b.subject.hash=null};b.setAttributes=function(a){p(a);b.attributes=a};b.sign=function(d,h){b.md=h||a.md.sha1.create();var e=g[b.md.algorithm+"WithRSAEncryption"];if(!e)throw e=Error("Could not compute certification request digest. Unknown message digest algorithm OID."),e.algorithm=b.md.algorithm,e;b.signatureOid=b.siginfo.algorithmOid=
e;b.certificationRequestInfo=u.getCertificationRequestInfo(b);e=c.toDer(b.certificationRequestInfo);b.md.update(e.getBytes());b.signature=d.sign(b.md)};b.verify=function(){var d=!1,e=b.md;if(null===e){if(b.signatureOid in g)switch(g[b.signatureOid]){case "sha1WithRSAEncryption":e=a.md.sha1.create();break;case "md5WithRSAEncryption":e=a.md.md5.create();break;case "sha256WithRSAEncryption":e=a.md.sha256.create();break;case "sha512WithRSAEncryption":e=a.md.sha512.create();break;case "RSASSA-PSS":e=a.md.sha256.create()}if(null===
e)throw e=Error("Could not compute certification request digest. Unknown signature OID."),e.signatureOid=b.signatureOid,e;var m=b.certificationRequestInfo||u.getCertificationRequestInfo(b);m=c.toDer(m);e.update(m.getBytes())}if(null!==e){switch(b.signatureOid){case g["RSASSA-PSS"]:d=g[b.signatureParameters.mgf.hash.algorithmOid];if(void 0===d||void 0===a.md[d])throw e=Error("Unsupported MGF hash function."),e.oid=b.signatureParameters.mgf.hash.algorithmOid,e.name=d,e;var f=g[b.signatureParameters.mgf.algorithmOid];
if(void 0===f||void 0===a.mgf[f])throw e=Error("Unsupported MGF function."),e.oid=b.signatureParameters.mgf.algorithmOid,e.name=f,e;f=a.mgf[f].create(a.md[d].create());d=g[b.signatureParameters.hash.algorithmOid];if(void 0===d||void 0===a.md[d])throw e=Error("Unsupported RSASSA-PSS hash function."),e.oid=b.signatureParameters.hash.algorithmOid,e.name=d,e;f=a.pss.create(a.md[d].create(),f,b.signatureParameters.saltLength)}d=b.publicKey.verify(e.digest().getBytes(),b.signature,f)}return d};return b};
u.getTBSCertificate=function(b){var g=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.CONTEXT_SPECIFIC,0,!0,[c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(b.version).getBytes())]),c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,a.util.hexToBytes(b.serialNumber)),c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(b.siginfo.algorithmOid).getBytes()),e(b.siginfo.algorithmOid,b.siginfo.parameters)]),d(b.issuer),c.create(c.Class.UNIVERSAL,
c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.UTCTIME,!1,c.dateToUtcTime(b.validity.notBefore)),c.create(c.Class.UNIVERSAL,c.Type.UTCTIME,!1,c.dateToUtcTime(b.validity.notAfter))]),d(b.subject),u.publicKeyToAsn1(b.publicKey)]);b.issuer.uniqueId&&g.value.push(c.create(c.Class.CONTEXT_SPECIFIC,1,!0,[c.create(c.Class.UNIVERSAL,c.Type.BITSTRING,!1,String.fromCharCode(0)+b.issuer.uniqueId)]));b.subject.uniqueId&&g.value.push(c.create(c.Class.CONTEXT_SPECIFIC,2,!0,[c.create(c.Class.UNIVERSAL,c.Type.BITSTRING,
!1,String.fromCharCode(0)+b.subject.uniqueId)]));0<b.extensions.length&&g.value.push(u.certificateExtensionsToAsn1(b.extensions));return g};u.getCertificationRequestInfo=function(a){return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.INTEGER,!1,c.integerToDer(a.version).getBytes()),d(a.subject),u.publicKeyToAsn1(a.publicKey),b(a)])};u.distinguishedNameToAsn1=function(a){return d(a)};u.certificateToAsn1=function(a){var b=a.tbsCertificate||u.getTBSCertificate(a);
return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[b,c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a.signatureOid).getBytes()),e(a.signatureOid,a.signatureParameters)]),c.create(c.Class.UNIVERSAL,c.Type.BITSTRING,!1,String.fromCharCode(0)+a.signature)])};u.certificateExtensionsToAsn1=function(a){var b=c.create(c.Class.CONTEXT_SPECIFIC,3,!0,[]),d=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]);b.value.push(d);for(var e=0;e<a.length;++e)d.value.push(u.certificateExtensionToAsn1(a[e]));
return b};u.certificateExtensionToAsn1=function(a){var b=c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[]);b.value.push(c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a.id).getBytes()));a.critical&&b.value.push(c.create(c.Class.UNIVERSAL,c.Type.BOOLEAN,!1,String.fromCharCode(255)));var d=a.value;"string"!==typeof a.value&&(d=c.toDer(d).getBytes());b.value.push(c.create(c.Class.UNIVERSAL,c.Type.OCTETSTRING,!1,d));return b};u.certificationRequestToAsn1=function(a){var b=a.certificationRequestInfo||
u.getCertificationRequestInfo(a);return c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[b,c.create(c.Class.UNIVERSAL,c.Type.SEQUENCE,!0,[c.create(c.Class.UNIVERSAL,c.Type.OID,!1,c.oidToDer(a.signatureOid).getBytes()),e(a.signatureOid,a.signatureParameters)]),c.create(c.Class.UNIVERSAL,c.Type.BITSTRING,!1,String.fromCharCode(0)+a.signature)])};u.createCaStore=function(b){function e(a){h(a);return g.certs[a.hash]||null}function h(b){if(!b.hash){var c=a.md.sha1.create();b.attributes=u.RDNAttributesAsArray(d(b),
c);b.hash=c.digest().toHex()}}var g={certs:{},getIssuer:function(a){return e(a.issuer)},addCertificate:function(b){"string"===typeof b&&(b=a.pki.certificateFromPem(b));h(b.subject);if(!g.hasCertificate(b))if(b.subject.hash in g.certs){var c=g.certs[b.subject.hash];a.util.isArray(c)||(c=[c]);c.push(b);g.certs[b.subject.hash]=c}else g.certs[b.subject.hash]=b},hasCertificate:function(b){"string"===typeof b&&(b=a.pki.certificateFromPem(b));var d=e(b.subject);if(!d)return!1;a.util.isArray(d)||(d=[d]);
b=c.toDer(u.certificateToAsn1(b)).getBytes();for(var h=0;h<d.length;++h){var l=c.toDer(u.certificateToAsn1(d[h])).getBytes();if(b===l)return!0}return!1},listAllCertificates:function(){var b=[],c;for(c in g.certs)if(g.certs.hasOwnProperty(c)){var d=g.certs[c];if(a.util.isArray(d))for(var e=0;e<d.length;++e)b.push(d[e]);else b.push(d)}return b},removeCertificate:function(b){"string"===typeof b&&(b=a.pki.certificateFromPem(b));h(b.subject);if(!g.hasCertificate(b))return null;var d=e(b.subject);if(!a.util.isArray(d)){var l=
g.certs[b.subject.hash];delete g.certs[b.subject.hash];return l}for(var m=c.toDer(u.certificateToAsn1(b)).getBytes(),f=0;f<d.length;++f){var n=c.toDer(u.certificateToAsn1(d[f])).getBytes();m===n&&(l=d[f],d.splice(f,1))}0===d.length&&delete g.certs[b.subject.hash];return l}};if(b)for(var f=0;f<b.length;++f)g.addCertificate(b[f]);return g};u.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",
certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"};u.verifyCertificateChain=function(b,c,d){c=c.slice(0);var e=c.slice(0),h=new Date,g=!0,f=null,n=0;do{var k=c.shift(),r=null,y=!1;if(h<k.validity.notBefore||h>k.validity.notAfter)f={message:"Certificate is not valid yet or has expired.",error:u.certificateError.certificate_expired,notBefore:k.validity.notBefore,notAfter:k.validity.notAfter,now:h};
if(null===f){r=c[0]||b.getIssuer(k);null===r&&k.isIssuer(k)&&(y=!0,r=k);if(r){var w=r;a.util.isArray(w)||(w=[w]);for(var v=!1;!v&&0<w.length;){r=w.shift();try{v=r.verify(k)}catch(da){}}v||(f={message:"Certificate signature is invalid.",error:u.certificateError.bad_certificate})}null!==f||r&&!y||b.hasCertificate(k)||(f={message:"Certificate is not trusted.",error:u.certificateError.unknown_ca})}null===f&&r&&!k.isIssuer(r)&&(f={message:"Certificate issuer is invalid.",error:u.certificateError.bad_certificate});
if(null===f)for(w={keyUsage:!0,basicConstraints:!0},v=0;null===f&&v<k.extensions.length;++v){var t=k.extensions[v];!t.critical||t.name in w||(f={message:"Certificate has an unsupported critical extension.",error:u.certificateError.unsupported_certificate})}null!==f||g&&(0!==c.length||r&&!y)||(g=k.getExtension("basicConstraints"),k=k.getExtension("keyUsage"),null!==k&&(k.keyCertSign&&null!==g||(f={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",
error:u.certificateError.bad_certificate})),null!==f||null===g||g.cA||(f={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:u.certificateError.bad_certificate}),null===f&&null!==k&&"pathLenConstraint"in g&&n-1>g.pathLenConstraint&&(f={message:"Certificate basicConstraints pathLenConstraint violated.",error:u.certificateError.bad_certificate}));k=null===f?!0:f.error;g=d?d(k,n,e):k;if(!0===g)f=null;else{!0===k&&(f={message:"The application rejected the certificate.",
error:u.certificateError.bad_certificate});if(g||0===g)"object"!==typeof g||a.util.isArray(g)?"string"===typeof g&&(f.error=g):(g.message&&(f.message=g.message),g.error&&(f.error=g.error));throw f;}g=!1;++n}while(0<c.length);return!0}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};
d.defined=d.defined||{};if(d.defined.x509)return d.x509;d.defined.x509=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pki}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/x509","require module ./aes ./asn1 ./des ./md ./mgf ./oids ./pem ./pss ./rsa ./util".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(a,
b,c,d){for(var e=[],g=0;g<a.length;g++)for(var f=0;f<a[g].safeBags.length;f++){var l=a[g].safeBags[f];if(void 0===d||l.type===d)null===b?e.push(l):void 0!==l.attributes[b]&&0<=l.attributes[b].indexOf(c)&&e.push(l)}return e}function d(b){if(b.composed||b.constructed){for(var c=a.util.createBuffer(),d=0;d<b.value.length;++d)c.putBytes(b.value[d].value);b.composed=b.constructed=!1;b.value=c.getBytes()}return b}function p(e,f,n,w){f=b.fromDer(f,n);if(f.tagClass!==b.Class.UNIVERSAL||f.type!==b.Type.SEQUENCE||
!0!==f.constructed)throw Error("PKCS#12 AuthenticatedSafe expected to be a SEQUENCE OF ContentInfo");for(var h=0;h<f.value.length;h++){var m={},r=[];if(!b.validate(f.value[h],g,m,r))throw e=Error("Cannot read ContentInfo."),e.errors=r,e;r={encrypted:!1};var l=m.content.value[0];switch(b.derToOid(m.contentType)){case c.oids.data:if(l.tagClass!==b.Class.UNIVERSAL||l.type!==b.Type.OCTETSTRING)throw Error("PKCS#12 SafeContents Data is not an OCTET STRING.");m=d(l).value;break;case c.oids.encryptedData:var y=
w;m={};var v=[];if(!b.validate(l,a.pkcs7.asn1.encryptedDataValidator,m,v))throw e=Error("Cannot read EncryptedContentInfo."),e.errors=v,e;l=b.derToOid(m.contentType);if(l!==c.oids.data)throw e=Error("PKCS#12 EncryptedContentInfo ContentType is not Data."),e.oid=l,e;l=b.derToOid(m.encAlgorithm);l=c.pbe.getCipher(l,m.encParameter,y);m=d(m.encryptedContentAsn1);m=a.util.createBuffer(m.value);l.update(m);if(!l.finish())throw Error("Failed to decrypt PKCS#12 SafeContents.");m=l.output.getBytes();r.encrypted=
!0;break;default:throw e=Error("Unsupported PKCS#12 contentType."),e.contentType=b.derToOid(m.contentType),e;}r.safeBags=k(m,n,w);e.safeContents.push(r)}}function k(a,d,g){if(!d&&0===a.length)return[];a=b.fromDer(a,d);if(a.tagClass!==b.Class.UNIVERSAL||a.type!==b.Type.SEQUENCE||!0!==a.constructed)throw Error("PKCS#12 SafeContents expected to be a SEQUENCE OF SafeBag.");for(var f=[],h=0;h<a.value.length;h++){var m={},k=[];if(!b.validate(a.value[h],w,m,k))throw a=Error("Cannot read SafeBag."),a.errors=
k,a;var l={type:b.derToOid(m.bagId),attributes:e(m.bagAttributes)};f.push(l);var r=m.bagValue.value[0];switch(l.type){case c.oids.pkcs8ShroudedKeyBag:if(r=c.decryptPrivateKeyInfo(r,g),null===r)throw Error("Unable to decrypt PKCS#8 ShroudedKeyBag, wrong pdw?");case c.oids.keyBag:try{l.key=c.privateKeyFromAsn1(r)}catch(P){l.key=null,l.asn1=r}continue;case c.oids.certBag:var y=n;var v=function(){if(b.derToOid(m.certId)!==c.oids.x509Certificate){var a=Error("Unsupported certificate type, only X.509 supported.");
a.oid=b.derToOid(m.certId);throw a;}a=b.fromDer(m.cert,d);try{l.cert=c.certificateFromAsn1(a,!0)}catch(M){l.cert=null,l.asn1=a}};break;default:throw a=Error("Unsupported PKCS#12 SafeBag type."),a.oid=l.type,a;}if(void 0!==y&&!b.validate(r,y,m,k))throw a=Error("Cannot read PKCS#12 "+y.name),a.errors=k,a;v()}return f}function e(a){var d={};if(void 0!==a)for(var e=0;e<a.length;++e){var g={},h=[];if(!b.validate(a[e],z,g,h))throw a=Error("Cannot read PKCS#12 BagAttribute."),a.errors=h,a;h=b.derToOid(g.oid);
if(void 0!==c.oids[h]){d[c.oids[h]]=[];for(var f=0;f<g.values.length;++f)d[c.oids[h]].push(g.values[f].value)}}return d}var b=a.asn1,c=a.pki,u=a.pkcs12=a.pkcs12||{},g={name:"ContentInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.contentType",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:b.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"content"}]},t={name:"PFX",tagClass:b.Class.UNIVERSAL,
type:b.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"version"},g,{name:"PFX.macData",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"mac",value:[{name:"PFX.macData.mac",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"PFX.macData.mac.digestAlgorithm.algorithm",
tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"macAlgorithm"},{name:"PFX.macData.mac.digestAlgorithm.parameters",tagClass:b.Class.UNIVERSAL,captureAsn1:"macAlgorithmParameters"}]},{name:"PFX.macData.mac.digest",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"macDigest"}]},{name:"PFX.macData.macSalt",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"macSalt"},{name:"PFX.macData.iterations",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,
constructed:!1,optional:!0,capture:"macIterations"}]}]},w={name:"SafeBag",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"SafeBag.bagId",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"bagId"},{name:"SafeBag.bagValue",tagClass:b.Class.CONTEXT_SPECIFIC,constructed:!0,captureAsn1:"bagValue"},{name:"SafeBag.bagAttributes",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,constructed:!0,optional:!0,capture:"bagAttributes"}]},z={name:"Attribute",tagClass:b.Class.UNIVERSAL,
type:b.Type.SEQUENCE,constructed:!0,value:[{name:"Attribute.attrId",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"oid"},{name:"Attribute.attrValues",tagClass:b.Class.UNIVERSAL,type:b.Type.SET,constructed:!0,capture:"values"}]},n={name:"CertBag",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"CertBag.certId",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"certId"},{name:"CertBag.certValue",tagClass:b.Class.CONTEXT_SPECIFIC,constructed:!0,
value:[{name:"CertBag.certValue[0]",tagClass:b.Class.UNIVERSAL,type:b.Class.OCTETSTRING,constructed:!1,capture:"cert"}]}]};u.pkcs12FromAsn1=function(e,g,n){"string"===typeof g?(n=g,g=!0):void 0===g&&(g=!0);var k={};if(!b.validate(e,t,k,[]))throw g=Error("Cannot read PKCS#12 PFX. ASN.1 object is not an PKCS#12 PFX."),g.errors=g,g;var h={version:k.version.charCodeAt(0),safeContents:[],getBags:function(b){var c={},d;"localKeyId"in b?d=b.localKeyId:"localKeyIdHex"in b&&(d=a.util.hexToBytes(b.localKeyIdHex));
void 0===d&&!("friendlyName"in b)&&"bagType"in b&&(c[b.bagType]=f(h.safeContents,null,null,b.bagType));void 0!==d&&(c.localKeyId=f(h.safeContents,"localKeyId",d,b.bagType));"friendlyName"in b&&(c.friendlyName=f(h.safeContents,"friendlyName",b.friendlyName,b.bagType));return c},getBagsByFriendlyName:function(a,b){return f(h.safeContents,"friendlyName",a,b)},getBagsByLocalKeyId:function(a,b){return f(h.safeContents,"localKeyId",a,b)}};if(3!==k.version.charCodeAt(0))throw g=Error("PKCS#12 PFX of version other than 3 not supported."),
g.version=k.version.charCodeAt(0),g;if(b.derToOid(k.contentType)!==c.oids.data)throw g=Error("Only PKCS#12 PFX in pdw integrity mode supported."),g.oid=b.derToOid(k.contentType),g;e=k.content.value[0];if(e.tagClass!==b.Class.UNIVERSAL||e.type!==b.Type.OCTETSTRING)throw Error("PKCS#12 authSafe content data is not an OCTET STRING.");e=d(e);if(k.mac){var m=null,r=0,l=b.derToOid(k.macAlgorithm);switch(l){case c.oids.sha1:m=a.md.sha1.create();r=20;break;case c.oids.sha256:m=a.md.sha256.create();r=32;break;
case c.oids.sha384:m=a.md.sha384.create();r=48;break;case c.oids.sha512:m=a.md.sha512.create();r=64;break;case c.oids.md5:m=a.md.md5.create(),r=16}if(null===m)throw Error("PKCS#12 uses unsupported MAC algorithm: "+l);l=new a.util.ByteBuffer(k.macSalt);var w="macIterations"in k?parseInt(a.util.bytesToHex(k.macIterations),16):1;r=u.generateKey(n,l,3,w,r,m);l=a.hmac.create();l.start(m,r);l.update(e.value);if(l.getMac().getBytes()!==k.macDigest)throw Error("PKCS#12 MAC could not be verified. Invalid pdw?");
}p(h,e.value,g,n);return h};u.toPkcs12Asn1=function(d,e,g,f){f=f||{};f.saltSize=f.saltSize||8;f.count=f.count||2048;f.algorithm=f.algorithm||f.encAlgorithm||"aes128";"useMac"in f||(f.useMac=!0);"localKeyId"in f||(f.localKeyId=null);"generateLocalKeyId"in f||(f.generateLocalKeyId=!0);var h=f.localKeyId,m;if(null!==h)h=a.util.hexToBytes(h);else if(f.generateLocalKeyId)if(e){var n=a.util.isArray(e)?e[0]:e;"string"===typeof n&&(n=c.certificateFromPem(n));h=a.md.sha1.create();h.update(b.toDer(c.certificateToAsn1(n)).getBytes());
h=h.digest().getBytes()}else h=a.random.getBytes(20);n=[];null!==h&&n.push(b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.localKeyId).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.SET,!0,[b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,h)])]));"friendlyName"in f&&n.push(b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.friendlyName).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.SET,
!0,[b.create(b.Class.UNIVERSAL,b.Type.BMPSTRING,!1,f.friendlyName)])]));0<n.length&&(m=b.create(b.Class.UNIVERSAL,b.Type.SET,!0,n));h=[];n=[];null!==e&&(n=a.util.isArray(e)?e:[e]);for(var l=[],k=0;k<n.length;++k){e=n[k];"string"===typeof e&&(e=c.certificateFromPem(e));var r=0===k?m:void 0;e=c.certificateToAsn1(e);e=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.certBag).getBytes()),b.create(b.Class.CONTEXT_SPECIFIC,0,!0,[b.create(b.Class.UNIVERSAL,
b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.x509Certificate).getBytes()),b.create(b.Class.CONTEXT_SPECIFIC,0,!0,[b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,b.toDer(e).getBytes())])])]),r]);l.push(e)}0<l.length&&(e=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,l),e=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.data).getBytes()),b.create(b.Class.CONTEXT_SPECIFIC,0,!0,[b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,
!1,b.toDer(e).getBytes())])]),h.push(e));null!==d&&(d=c.wrapRsaPrivateKey(c.privateKeyToAsn1(d)),d=null===g?b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.keyBag).getBytes()),b.create(b.Class.CONTEXT_SPECIFIC,0,!0,[d]),m]):b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.pkcs8ShroudedKeyBag).getBytes()),b.create(b.Class.CONTEXT_SPECIFIC,0,!0,[c.encryptPrivateKeyInfo(d,g,f)]),m]),d=b.create(b.Class.UNIVERSAL,
b.Type.SEQUENCE,!0,[d]),d=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.data).getBytes()),b.create(b.Class.CONTEXT_SPECIFIC,0,!0,[b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,b.toDer(d).getBytes())])]),h.push(d));m=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,h);if(f.useMac){h=a.md.sha1.create();var w=new a.util.ByteBuffer(a.random.getBytes(f.saltSize));f=f.count;d=u.generateKey(g,w,3,f,20);g=a.hmac.create();g.start(h,d);g.update(b.toDer(m).getBytes());
g=g.getMac();w=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.sha1).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.NULL,!1,"")]),b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,g.getBytes())]),b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,w.getBytes()),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,b.integerToDer(f).getBytes())])}return b.create(b.Class.UNIVERSAL,
b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,b.integerToDer(3).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(c.oids.data).getBytes()),b.create(b.Class.CONTEXT_SPECIFIC,0,!0,[b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,b.toDer(m).getBytes())])]),w])};u.generateKey=a.pbe.generatePkcs12Key}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===
typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.pkcs12)return d.pkcs12;d.defined.pkcs12=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pkcs12}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/pkcs12","require module ./asn1 ./hmac ./oids ./pkcs7asn1 ./pbe ./random ./rsa ./sha1 ./util ./x509".split(" "),
function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){var f=a.asn1,d=a.pki=a.pki||{};d.pemToDer=function(d){d=a.pem.decode(d)[0];if(d.procType&&"ENCRYPTED"===d.procType.type)throw Error("Could not convert PEM to DER; PEM is encrypted.");return a.util.createBuffer(d.body)};d.privateKeyFromPem=function(p){p=a.pem.decode(p)[0];if("PRIVATE KEY"!==p.type&&"RSA PRIVATE KEY"!==p.type){var k=Error('Could not convert private key from PEM; PEM header type is not "PRIVATE KEY" or "RSA PRIVATE KEY".');
k.headerType=p.type;throw k;}if(p.procType&&"ENCRYPTED"===p.procType.type)throw Error("Could not convert private key from PEM; PEM is encrypted.");p=f.fromDer(p.body);return d.privateKeyFromAsn1(p)};d.privateKeyToPem=function(p,k){var e={type:"RSA PRIVATE KEY",body:f.toDer(d.privateKeyToAsn1(p)).getBytes()};return a.pem.encode(e,{maxline:k})};d.privateKeyInfoToPem=function(d,k){var e={type:"PRIVATE KEY",body:f.toDer(d).getBytes()};return a.pem.encode(e,{maxline:k})}}if("function"!==typeof p)if("object"===
typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.pki)return d.pki;d.defined.pki=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pki}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,
Array.prototype.slice.call(arguments,0))};p("js/pki","require module ./asn1 ./oids ./pbe ./pem ./pbkdf2 ./pkcs12 ./pss ./rsa ./util ./x509".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){var f=function(b,c,d,e){var h=a.util.createBuffer(),g=b.length>>1,l=g+(b.length&1),f=b.substr(0,l);l=b.substr(g,l);b=a.util.createBuffer();g=a.hmac.create();d=c+d;var m=Math.ceil(e/16);c=Math.ceil(e/20);g.start("MD5",f);f=a.util.createBuffer();b.putBytes(d);
for(var n=0;n<m;++n)g.start(null,null),g.update(b.getBytes()),b.putBuffer(g.digest()),g.start(null,null),g.update(b.bytes()+d),f.putBuffer(g.digest());g.start("SHA1",l);l=a.util.createBuffer();b.clear();b.putBytes(d);for(n=0;n<c;++n)g.start(null,null),g.update(b.getBytes()),b.putBuffer(g.digest()),g.start(null,null),g.update(b.bytes()+d),l.putBuffer(g.digest());h.putBytes(a.util.xorBytes(f.getBytes(),l.getBytes(),e));return h},d=function(b,c,d){d=!1;try{var e=b.deflate(c.fragment.getBytes());c.fragment=
a.util.createBuffer(e);c.length=e.length;d=!0}catch(X){}return d},p=function(b,c,d){d=!1;try{var e=b.inflate(c.fragment.getBytes());c.fragment=a.util.createBuffer(e);c.length=e.length;d=!0}catch(X){}return d},k=function(b,c){var d=0;switch(c){case 1:d=b.getByte();break;case 2:d=b.getInt16();break;case 3:d=b.getInt24();break;case 4:d=b.getInt32()}return a.util.createBuffer(b.getBytes(d))},e=function(a,b,c){a.putInt(c.length(),b<<3);a.putBuffer(c)},b={Versions:{TLS_1_0:{major:3,minor:1},TLS_1_1:{major:3,
minor:2},TLS_1_2:{major:3,minor:3}}};b.SupportedVersions=[b.Versions.TLS_1_1,b.Versions.TLS_1_0];b.Version=b.SupportedVersions[0];b.MaxFragment=15360;b.ConnectionEnd={server:0,client:1};b.PRFAlgorithm={tls_prf_sha256:0};b.BulkCipherAlgorithm={none:null,rc4:0,des3:1,aes:2};b.CipherType={stream:0,block:1,aead:2};b.MACAlgorithm={none:null,hmac_md5:0,hmac_sha1:1,hmac_sha256:2,hmac_sha384:3,hmac_sha512:4};b.CompressionMethod={none:0,deflate:1};b.ContentType={change_cipher_spec:20,alert:21,handshake:22,
application_data:23,heartbeat:24};b.HandshakeType={hello_request:0,client_hello:1,server_hello:2,certificate:11,server_key_exchange:12,certificate_request:13,server_hello_done:14,certificate_verify:15,client_key_exchange:16,finished:20};b.Alert={};b.Alert.Level={warning:1,fatal:2};b.Alert.Description={close_notify:0,unexpected_message:10,bad_record_mac:20,decryption_failed:21,record_overflow:22,decompression_failure:30,handshake_failure:40,bad_certificate:42,unsupported_certificate:43,certificate_revoked:44,
certificate_expired:45,certificate_unknown:46,illegal_parameter:47,unknown_ca:48,access_denied:49,decode_error:50,decrypt_error:51,export_restriction:60,protocol_version:70,insufficient_security:71,internal_error:80,user_canceled:90,no_renegotiation:100};b.HeartbeatMessageType={heartbeat_request:1,heartbeat_response:2};b.CipherSuites={};b.getCipherSuite=function(a){var c=null,d;for(d in b.CipherSuites){var e=b.CipherSuites[d];if(e.id[0]===a.charCodeAt(0)&&e.id[1]===a.charCodeAt(1)){c=e;break}}return c};
b.handleUnexpected=function(a,c){(a.open||a.entity!==b.ConnectionEnd.client)&&a.error(a,{message:"Unexpected message. Received TLS record out of order.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unexpected_message}})};b.handleHelloRequest=function(a,c,d){!a.handshaking&&0<a.handshakes&&(b.queue(a,b.createAlert(a,{level:b.Alert.Level.warning,description:b.Alert.Description.no_renegotiation})),b.flush(a));a.process()};b.parseHelloMessage=function(c,d,e){var h=null,g=c.entity===
b.ConnectionEnd.client;if(38>e)c.error(c,{message:g?"Invalid ServerHello message. Message too short.":"Invalid ClientHello message. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});else{d=d.fragment;var l=d.length();h={version:{major:d.getByte(),minor:d.getByte()},random:a.util.createBuffer(d.getBytes(32)),session_id:k(d,1),extensions:[]};g?(h.cipher_suite=d.getBytes(2),h.compression_method=d.getByte()):(h.cipher_suites=k(d,2),h.compression_methods=
k(d,1));l=e-(l-d.length());if(0<l){for(e=k(d,2);0<e.length();)h.extensions.push({type:[e.getByte(),e.getByte()],data:k(e,2)});if(!g)for(e=0;e<h.extensions.length;++e)if(d=h.extensions[e],0===d.type[0]&&0===d.type[1])for(d=k(d.data,2);0<d.length()&&0===d.getByte();)c.session.extensions.server_name.serverNameList.push(k(d,2).getBytes())}if(c.session.version&&(h.version.major!==c.session.version.major||h.version.minor!==c.session.version.minor))return c.error(c,{message:"TLS version change is disallowed during renegotiation.",
send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.protocol_version}});if(g)c.session.cipherSuite=b.getCipherSuite(h.cipher_suite);else for(e=a.util.createBuffer(h.cipher_suites.bytes());0<e.length()&&(c.session.cipherSuite=b.getCipherSuite(e.getBytes(2)),null===c.session.cipherSuite););if(null===c.session.cipherSuite)return c.error(c,{message:"No cipher suites in common.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.handshake_failure},cipherSuite:a.util.bytesToHex(h.cipher_suite)});
c.session.compressionMethod=g?h.compression_method:b.CompressionMethod.none}return h};b.createSecurityParameters=function(a,c){var d=a.entity===b.ConnectionEnd.client,e=c.random.bytes(),h=d?a.session.sp.client_random:e;d=d?e:b.createRandom().getBytes();a.session.sp={entity:a.entity,prf_algorithm:b.PRFAlgorithm.tls_prf_sha256,bulk_cipher_algorithm:null,cipher_type:null,enc_key_length:null,block_length:null,fixed_iv_length:null,record_iv_length:null,mac_algorithm:null,mac_length:null,mac_key_length:null,
compression_algorithm:a.session.compressionMethod,pre_master_secret:null,master_secret:null,client_random:h,server_random:d}};b.handleServerHello=function(a,d,e){d=b.parseHelloMessage(a,d,e);if(!a.fail){if(d.version.minor<=a.version.minor)a.version.minor=d.version.minor;else return a.error(a,{message:"Incompatible TLS version.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.protocol_version}});a.session.version=a.version;e=d.session_id.bytes();0<e.length&&e===a.session.id?
(a.expect=w,a.session.resuming=!0,a.session.sp.server_random=d.random.bytes()):(a.expect=c,a.session.resuming=!1,b.createSecurityParameters(a,d));a.session.id=e;a.process()}};b.handleClientHello=function(c,d,e){d=b.parseHelloMessage(c,d,e);if(!c.fail){var g=d.session_id.bytes();e=null;if(c.sessionCache)if(e=c.sessionCache.getSession(g),null===e)g="";else if(e.version.major!==d.version.major||e.version.minor>d.version.minor)e=null,g="";0===g.length&&(g=a.random.getBytes(32));c.session.id=g;c.session.clientHelloVersion=
d.version;c.session.sp={};if(e)c.version=c.session.version=e.version,c.session.sp=e.sp;else{for(g=1;g<b.SupportedVersions.length;++g){var l=b.SupportedVersions[g];if(l.minor<=d.version.minor)break}c.version={major:l.major,minor:l.minor};c.session.version=c.version}null!==e?(c.expect=h,c.session.resuming=!0,c.session.sp.client_random=d.random.bytes()):(c.expect=!1!==c.verifyClient?y:v,c.session.resuming=!1,b.createSecurityParameters(c,d));c.open=!0;b.queue(c,b.createRecord(c,{type:b.ContentType.handshake,
data:b.createServerHello(c)}));c.session.resuming?(b.queue(c,b.createRecord(c,{type:b.ContentType.change_cipher_spec,data:b.createChangeCipherSpec()})),c.state.pending=b.createConnectionState(c),c.state.current.write=c.state.pending.write,b.queue(c,b.createRecord(c,{type:b.ContentType.handshake,data:b.createFinished(c)}))):(b.queue(c,b.createRecord(c,{type:b.ContentType.handshake,data:b.createCertificate(c)})),c.fail||(b.queue(c,b.createRecord(c,{type:b.ContentType.handshake,data:b.createServerKeyExchange(c)})),
!1!==c.verifyClient&&b.queue(c,b.createRecord(c,{type:b.ContentType.handshake,data:b.createCertificateRequest(c)})),b.queue(c,b.createRecord(c,{type:b.ContentType.handshake,data:b.createServerHelloDone(c)}))));b.flush(c);c.process()}};b.handleCertificate=function(c,d,e){if(3>e)return c.error(c,{message:"Invalid Certificate message. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});e=k(d.fragment,3);d=[];try{for(;0<e.length();){var h=
k(e,3);var g=a.asn1.fromDer(h);h=a.pki.certificateFromAsn1(g,!0);d.push(h)}}catch(Q){return c.error(c,{message:"Could not parse certificate list.",cause:Q,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.bad_certificate}})}h=c.entity===b.ConnectionEnd.client;!h&&!0!==c.verifyClient||0!==d.length?0===d.length?c.expect=h?u:v:(h?c.session.serverCertificate=d[0]:c.session.clientCertificate=d[0],b.verifyCertificateChain(c,d)&&(c.expect=h?u:v)):c.error(c,{message:h?"No server certificate provided.":
"No client certificate provided.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});c.process()};b.handleServerKeyExchange=function(a,c,d){if(0<d)return a.error(a,{message:"Invalid key parameters. Only RSA is supported.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unsupported_certificate}});a.expect=g;a.process()};b.handleClientKeyExchange=function(c,d,e){if(48>e)return c.error(c,{message:"Invalid key parameters. Only RSA is supported.",
send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unsupported_certificate}});d=k(d.fragment,2).getBytes();e=null;if(c.getPrivateKey)try{e=c.getPrivateKey(c,c.session.serverCertificate),e=a.pki.privateKeyFromPem(e)}catch(Q){c.error(c,{message:"Could not get private key.",cause:Q,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}})}if(null===e)return c.error(c,{message:"No private key set.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}});
try{var g=c.session.sp;g.pre_master_secret=e.decrypt(d);var l=c.session.clientHelloVersion;if(l.major!==g.pre_master_secret.charCodeAt(0)||l.minor!==g.pre_master_secret.charCodeAt(1))throw Error("TLS version rollback attack detected.");}catch(Q){g.pre_master_secret=a.random.getBytes(48)}c.expect=h;null!==c.session.clientCertificate&&(c.expect=q);c.process()};b.handleCertificateRequest=function(a,c,d){if(3>d)return a.error(a,{message:"Invalid CertificateRequest. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,
description:b.Alert.Description.illegal_parameter}});c=c.fragment;c={certificate_types:k(c,1),certificate_authorities:k(c,2)};a.session.certificateRequest=c;a.expect=t;a.process()};b.handleCertificateVerify=function(c,d,e){if(2>e)return c.error(c,{message:"Invalid CertificateVerify. Message too short.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});e=d.fragment;e.read-=4;d=e.bytes();e.read+=4;e=k(e,2).getBytes();var g=a.util.createBuffer();g.putBuffer(c.session.md5.digest());
g.putBuffer(c.session.sha1.digest());g=g.getBytes();try{if(!c.session.clientCertificate.publicKey.verify(g,e,"NONE"))throw Error("CertificateVerify signature does not match.");c.session.md5.update(d);c.session.sha1.update(d)}catch(X){return c.error(c,{message:"Bad signature in CertificateVerify.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.handshake_failure}})}c.expect=h;c.process()};b.handleServerHelloDone=function(c,d,e){if(0<e)return c.error(c,{message:"Invalid ServerHelloDone message. Invalid length.",
send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.record_overflow}});if(null===c.serverCertificate&&(d={message:"No server certificate provided. Not enough security.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.insufficient_security}},e=c.verify(c,d.alert.description,0,[]),!0!==e)){if(e||0===e)"object"!==typeof e||a.util.isArray(e)?"number"===typeof e&&(d.alert.description=e):(e.message&&(d.message=e.message),e.alert&&(d.alert.description=e.alert));
return c.error(c,d)}null!==c.session.certificateRequest&&(d=b.createRecord(c,{type:b.ContentType.handshake,data:b.createCertificate(c)}),b.queue(c,d));d=b.createRecord(c,{type:b.ContentType.handshake,data:b.createClientKeyExchange(c)});b.queue(c,d);c.expect=r;d=function(a,c){null!==a.session.certificateRequest&&null!==a.session.clientCertificate&&b.queue(a,b.createRecord(a,{type:b.ContentType.handshake,data:b.createCertificateVerify(a,c)}));b.queue(a,b.createRecord(a,{type:b.ContentType.change_cipher_spec,
data:b.createChangeCipherSpec()}));a.state.pending=b.createConnectionState(a);a.state.current.write=a.state.pending.write;b.queue(a,b.createRecord(a,{type:b.ContentType.handshake,data:b.createFinished(a)}));a.expect=w;b.flush(a);a.process()};if(null===c.session.certificateRequest||null===c.session.clientCertificate)return d(c,null);b.getClientSignature(c,d)};b.handleChangeCipherSpec=function(a,c){if(1!==c.fragment.getByte())return a.error(a,{message:"Invalid ChangeCipherSpec message received.",send:!0,
alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.illegal_parameter}});var d=a.entity===b.ConnectionEnd.client;if(a.session.resuming&&d||!a.session.resuming&&!d)a.state.pending=b.createConnectionState(a);a.state.current.read=a.state.pending.read;if(!a.session.resuming&&d||a.session.resuming&&!d)a.state.pending=null;a.expect=d?z:m;a.process()};b.handleFinished=function(c,d,e){e=d.fragment;e.read-=4;var h=e.bytes();e.read+=4;d=d.fragment.getBytes();e=a.util.createBuffer();e.putBuffer(c.session.md5.digest());
e.putBuffer(c.session.sha1.digest());var g=c.entity===b.ConnectionEnd.client;e=f(c.session.sp.master_secret,g?"server finished":"client finished",e.getBytes(),12);if(e.getBytes()!==d)return c.error(c,{message:"Invalid verify_data in Finished message.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.decrypt_error}});c.session.md5.update(h);c.session.sha1.update(h);if(c.session.resuming&&g||!c.session.resuming&&!g)b.queue(c,b.createRecord(c,{type:b.ContentType.change_cipher_spec,
data:b.createChangeCipherSpec()})),c.state.current.write=c.state.pending.write,c.state.pending=null,b.queue(c,b.createRecord(c,{type:b.ContentType.handshake,data:b.createFinished(c)}));c.expect=g?n:C;c.handshaking=!1;++c.handshakes;c.peerCertificate=g?c.session.serverCertificate:c.session.clientCertificate;b.flush(c);c.isConnected=!0;c.connected(c);c.process()};b.handleAlert=function(a,c){var d=c.fragment;d={level:d.getByte(),description:d.getByte()};switch(d.description){case b.Alert.Description.close_notify:var e=
"Connection closed.";break;case b.Alert.Description.unexpected_message:e="Unexpected message.";break;case b.Alert.Description.bad_record_mac:e="Bad record MAC.";break;case b.Alert.Description.decryption_failed:e="Decryption failed.";break;case b.Alert.Description.record_overflow:e="Record overflow.";break;case b.Alert.Description.decompression_failure:e="Decompression failed.";break;case b.Alert.Description.handshake_failure:e="Handshake failure.";break;case b.Alert.Description.bad_certificate:e=
"Bad certificate.";break;case b.Alert.Description.unsupported_certificate:e="Unsupported certificate.";break;case b.Alert.Description.certificate_revoked:e="Certificate revoked.";break;case b.Alert.Description.certificate_expired:e="Certificate expired.";break;case b.Alert.Description.certificate_unknown:e="Certificate unknown.";break;case b.Alert.Description.illegal_parameter:e="Illegal parameter.";break;case b.Alert.Description.unknown_ca:e="Unknown certificate authority.";break;case b.Alert.Description.access_denied:e=
"Access denied.";break;case b.Alert.Description.decode_error:e="Decode error.";break;case b.Alert.Description.decrypt_error:e="Decrypt error.";break;case b.Alert.Description.export_restriction:e="Export restriction.";break;case b.Alert.Description.protocol_version:e="Unsupported protocol version.";break;case b.Alert.Description.insufficient_security:e="Insufficient security.";break;case b.Alert.Description.internal_error:e="Internal error.";break;case b.Alert.Description.user_canceled:e="User canceled.";
break;case b.Alert.Description.no_renegotiation:e="Renegotiation not supported.";break;default:e="Unknown error."}if(d.description===b.Alert.Description.close_notify)return a.close();a.error(a,{message:e,send:!1,origin:a.entity===b.ConnectionEnd.client?"server":"client",alert:d});a.process()};b.handleHandshake=function(c,d){var e=d.fragment,h=e.getByte(),g=e.getInt24();if(g>e.length())return c.fragmented=d,d.fragment=a.util.createBuffer(),e.read-=4,c.process();c.fragmented=null;e.read-=4;var l=e.bytes(g+
4);e.read+=4;h in B[c.entity][c.expect]?(c.entity!==b.ConnectionEnd.server||c.open||c.fail||(c.handshaking=!0,c.session={version:null,extensions:{server_name:{serverNameList:[]}},cipherSuite:null,compressionMethod:null,serverCertificate:null,clientCertificate:null,md5:a.md.md5.create(),sha1:a.md.sha1.create()}),h!==b.HandshakeType.hello_request&&h!==b.HandshakeType.certificate_verify&&h!==b.HandshakeType.finished&&(c.session.md5.update(l),c.session.sha1.update(l)),B[c.entity][c.expect][h](c,d,g)):
b.handleUnexpected(c,d)};b.handleApplicationData=function(a,b){a.data.putBuffer(b.fragment);a.dataReady(a);a.process()};b.handleHeartbeat=function(c,d){var e=d.fragment,h=e.getByte(),g=e.getInt16();e=e.getBytes(g);if(h===b.HeartbeatMessageType.heartbeat_request){if(c.handshaking||g>e.length)return c.process();b.queue(c,b.createRecord(c,{type:b.ContentType.heartbeat,data:b.createHeartbeat(b.HeartbeatMessageType.heartbeat_response,e)}));b.flush(c)}else if(h===b.HeartbeatMessageType.heartbeat_response){if(e!==
c.expectedHeartbeatPayload)return c.process();c.heartbeatReceived&&c.heartbeatReceived(c,a.util.createBuffer(e))}c.process()};var c=1,u=2,g=3,t=4,w=5,z=6,n=7,r=8,y=1,v=2,q=3,h=4,m=5,C=6,l=b.handleUnexpected,L=b.handleChangeCipherSpec,N=b.handleAlert,J=b.handleHandshake,P=b.handleApplicationData,M=b.handleHeartbeat,x=[];x[b.ConnectionEnd.client]=[[l,N,J,l,M],[l,N,J,l,M],[l,N,J,l,M],[l,N,J,l,M],[l,N,J,l,M],[L,N,l,l,M],[l,N,J,l,M],[l,N,J,P,M],[l,N,J,l,M]];x[b.ConnectionEnd.server]=[[l,N,J,l,M],[l,N,
J,l,M],[l,N,J,l,M],[l,N,J,l,M],[L,N,l,l,M],[l,N,J,l,M],[l,N,J,P,M],[l,N,J,l,M]];L=b.handleHelloRequest;N=b.handleCertificate;J=b.handleServerKeyExchange;P=b.handleCertificateRequest;M=b.handleServerHelloDone;var A=b.handleFinished,B=[];B[b.ConnectionEnd.client]=[[l,l,b.handleServerHello,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l],[L,l,l,l,l,l,l,l,l,l,l,N,J,P,M,l,l,l,l,l,l],[L,l,l,l,l,l,l,l,l,l,l,l,J,P,M,l,l,l,l,l,l],[L,l,l,l,l,l,l,l,l,l,l,l,l,P,M,l,l,l,l,l,l],[L,l,l,l,l,l,l,l,l,l,l,l,l,l,M,l,l,l,l,l,l],
[L,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l],[L,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,A],[L,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l],[L,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l]];B[b.ConnectionEnd.server]=[[l,b.handleClientHello,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l],[l,l,l,l,l,l,l,l,l,l,l,N,l,l,l,l,l,l,l,l,l],[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,b.handleClientKeyExchange,l,l,l,l],[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,b.handleCertificateVerify,l,l,l,l,l],[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l],[l,l,l,l,l,
l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,A],[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l],[l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l,l]];b.generateKeys=function(a,c){var d=c.client_random+c.server_random;a.session.resuming||(c.master_secret=f(c.pre_master_secret,"master secret",d,48).bytes(),c.pre_master_secret=null);d=c.server_random+c.client_random;var e=2*c.mac_key_length+2*c.enc_key_length,h=a.version.major===b.Versions.TLS_1_0.major&&a.version.minor===b.Versions.TLS_1_0.minor;h&&(e+=2*c.fixed_iv_length);d=
f(c.master_secret,"key expansion",d,e);e={client_write_MAC_key:d.getBytes(c.mac_key_length),server_write_MAC_key:d.getBytes(c.mac_key_length),client_write_key:d.getBytes(c.enc_key_length),server_write_key:d.getBytes(c.enc_key_length)};h&&(e.client_write_IV=d.getBytes(c.fixed_iv_length),e.server_write_IV=d.getBytes(c.fixed_iv_length));return e};b.createConnectionState=function(a){var c=a.entity===b.ConnectionEnd.client,e=function(){var a={sequenceNumber:[0,0],macKey:null,macLength:0,macFunction:null,
cipherState:null,cipherFunction:function(a){return!0},compressionState:null,compressFunction:function(a){return!0},updateSequenceNumber:function(){4294967295===a.sequenceNumber[1]?(a.sequenceNumber[1]=0,++a.sequenceNumber[0]):++a.sequenceNumber[1]}};return a},h={read:e(),write:e()};h.read.update=function(a,c){h.read.cipherFunction(c,h.read)?h.read.compressFunction(a,c,h.read)||a.error(a,{message:"Could not decompress record.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.decompression_failure}}):
a.error(a,{message:"Could not decrypt record or bad MAC.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.bad_record_mac}});return!a.fail};h.write.update=function(a,c){h.write.compressFunction(a,c,h.write)?h.write.cipherFunction(c,h.write)||a.error(a,{message:"Could not encrypt record.",send:!1,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}}):a.error(a,{message:"Could not compress record.",send:!1,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}});
return!a.fail};if(a.session)switch(e=a.session.sp,a.session.cipherSuite.initSecurityParameters(e),e.keys=b.generateKeys(a,e),h.read.macKey=c?e.keys.server_write_MAC_key:e.keys.client_write_MAC_key,h.write.macKey=c?e.keys.client_write_MAC_key:e.keys.server_write_MAC_key,a.session.cipherSuite.initConnectionState(h,a,e),e.compression_algorithm){case b.CompressionMethod.none:break;case b.CompressionMethod.deflate:h.read.compressFunction=p;h.write.compressFunction=d;break;default:throw Error("Unsupported compression algorithm.");
}return h};b.createRandom=function(){var b=new Date;b=+b+6E4*b.getTimezoneOffset();var c=a.util.createBuffer();c.putInt32(b);c.putBytes(a.random.getBytes(28));return c};b.createRecord=function(a,b){return b.data?{type:b.type,version:{major:a.version.major,minor:a.version.minor},length:b.data.length(),fragment:b.data}:null};b.createAlert=function(c,d){var e=a.util.createBuffer();e.putByte(d.level);e.putByte(d.description);return b.createRecord(c,{type:b.ContentType.alert,data:e})};b.createClientHello=
function(c){c.session.clientHelloVersion={major:c.version.major,minor:c.version.minor};for(var d=a.util.createBuffer(),h=0;h<c.cipherSuites.length;++h){var g=c.cipherSuites[h];d.putByte(g.id[0]);d.putByte(g.id[1])}var l=d.length();h=a.util.createBuffer();h.putByte(b.CompressionMethod.none);var f=h.length();g=a.util.createBuffer();if(c.virtualHost){var m=a.util.createBuffer();m.putByte(0);m.putByte(0);var n=a.util.createBuffer();n.putByte(0);e(n,2,a.util.createBuffer(c.virtualHost));var k=a.util.createBuffer();
e(k,2,n);e(m,2,k);g.putBuffer(m)}m=g.length();0<m&&(m+=2);n=c.session.id;l=n.length+1+2+4+28+2+l+1+f+m;f=a.util.createBuffer();f.putByte(b.HandshakeType.client_hello);f.putInt24(l);f.putByte(c.version.major);f.putByte(c.version.minor);f.putBytes(c.session.sp.client_random);e(f,1,a.util.createBuffer(n));e(f,2,d);e(f,1,h);0<m&&e(f,2,g);return f};b.createServerHello=function(c){var d=c.session.id,h=d.length+1+2+4+28+2+1,g=a.util.createBuffer();g.putByte(b.HandshakeType.server_hello);g.putInt24(h);g.putByte(c.version.major);
g.putByte(c.version.minor);g.putBytes(c.session.sp.server_random);e(g,1,a.util.createBuffer(d));g.putByte(c.session.cipherSuite.id[0]);g.putByte(c.session.cipherSuite.id[1]);g.putByte(c.session.compressionMethod);return g};b.createCertificate=function(c){var d=c.entity===b.ConnectionEnd.client,h=null;c.getCertificate&&(h=c.getCertificate(c,d?c.session.certificateRequest:c.session.extensions.server_name.serverNameList));var g=a.util.createBuffer();if(null!==h)try{a.util.isArray(h)||(h=[h]);for(var l=
null,f=0;f<h.length;++f){var m=a.pem.decode(h[f])[0];if("CERTIFICATE"!==m.type&&"X509 CERTIFICATE"!==m.type&&"TRUSTED CERTIFICATE"!==m.type){var n=Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');n.headerType=m.type;throw n;}if(m.procType&&"ENCRYPTED"===m.procType.type)throw Error("Could not convert certificate from PEM; PEM is encrypted.");var k=a.util.createBuffer(m.body);null===l&&(l=a.asn1.fromDer(k.bytes(),!1));
var r=a.util.createBuffer();e(r,3,k);g.putBuffer(r)}h=a.pki.certificateFromAsn1(l);d?c.session.clientCertificate=h:c.session.serverCertificate=h}catch(ca){return c.error(c,{message:"Could not send certificate list.",cause:ca,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.bad_certificate}})}c=3+g.length();d=a.util.createBuffer();d.putByte(b.HandshakeType.certificate);d.putInt24(c);e(d,3,g);return d};b.createClientKeyExchange=function(c){var d=a.util.createBuffer();d.putByte(c.session.clientHelloVersion.major);
d.putByte(c.session.clientHelloVersion.minor);d.putBytes(a.random.getBytes(46));var e=c.session.sp;e.pre_master_secret=d.getBytes();d=c.session.serverCertificate.publicKey.encrypt(e.pre_master_secret);c=d.length+2;e=a.util.createBuffer();e.putByte(b.HandshakeType.client_key_exchange);e.putInt24(c);e.putInt16(d.length);e.putBytes(d);return e};b.createServerKeyExchange=function(b){return a.util.createBuffer()};b.getClientSignature=function(c,d){var e=a.util.createBuffer();e.putBuffer(c.session.md5.digest());
e.putBuffer(c.session.sha1.digest());e=e.getBytes();c.getSignature=c.getSignature||function(c,d,e){var h=null;if(c.getPrivateKey)try{h=c.getPrivateKey(c,c.session.clientCertificate),h=a.pki.privateKeyFromPem(h)}catch(aa){c.error(c,{message:"Could not get private key.",cause:aa,send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}})}null===h?c.error(c,{message:"No private key set.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.internal_error}}):
d=h.sign(d,null);e(c,d)};c.getSignature(c,e,d)};b.createCertificateVerify=function(c,d){var e=d.length+2,h=a.util.createBuffer();h.putByte(b.HandshakeType.certificate_verify);h.putInt24(e);h.putInt16(d.length);h.putBytes(d);return h};b.createCertificateRequest=function(c){var d=a.util.createBuffer();d.putByte(1);var h=a.util.createBuffer();for(l in c.caStore.certs){var g=a.pki.distinguishedNameToAsn1(c.caStore.certs[l].subject);g=a.asn1.toDer(g);h.putInt16(g.length());h.putBuffer(g)}c=1+d.length()+
2+h.length();var l=a.util.createBuffer();l.putByte(b.HandshakeType.certificate_request);l.putInt24(c);e(l,1,d);e(l,2,h);return l};b.createServerHelloDone=function(c){c=a.util.createBuffer();c.putByte(b.HandshakeType.server_hello_done);c.putInt24(0);return c};b.createChangeCipherSpec=function(){var b=a.util.createBuffer();b.putByte(1);return b};b.createFinished=function(c){var d=a.util.createBuffer();d.putBuffer(c.session.md5.digest());d.putBuffer(c.session.sha1.digest());d=f(c.session.sp.master_secret,
c.entity===b.ConnectionEnd.client?"client finished":"server finished",d.getBytes(),12);c=a.util.createBuffer();c.putByte(b.HandshakeType.finished);c.putInt24(d.length());c.putBuffer(d);return c};b.createHeartbeat=function(b,c,d){"undefined"===typeof d&&(d=c.length);var e=a.util.createBuffer();e.putByte(b);e.putInt16(d);e.putBytes(c);b=e.length();e.putBytes(a.random.getBytes(Math.max(16,b-d-3)));return e};b.queue=function(c,d){if(d&&(0!==d.fragment.length()||d.type!==b.ContentType.handshake&&d.type!==
b.ContentType.alert&&d.type!==b.ContentType.change_cipher_spec)){if(d.type===b.ContentType.handshake){var e=d.fragment.bytes();c.session.md5.update(e);c.session.sha1.update(e)}if(d.fragment.length()<=b.MaxFragment)e=[d];else{e=[];for(var h=d.fragment.bytes();h.length>b.MaxFragment;)e.push(b.createRecord(c,{type:d.type,data:a.util.createBuffer(h.slice(0,b.MaxFragment))})),h=h.slice(b.MaxFragment);0<h.length&&e.push(b.createRecord(c,{type:d.type,data:a.util.createBuffer(h)}))}for(h=0;h<e.length&&!c.fail;++h){var g=
e[h];c.state.current.write.update(c,g)&&c.records.push(g)}}};b.flush=function(a){for(var b=0;b<a.records.length;++b){var c=a.records[b];a.tlsData.putByte(c.type);a.tlsData.putByte(c.version.major);a.tlsData.putByte(c.version.minor);a.tlsData.putInt16(c.fragment.length());a.tlsData.putBuffer(a.records[b].fragment)}a.records=[];return a.tlsDataReady(a)};var D=function(c){switch(c){case !0:return!0;case a.pki.certificateError.bad_certificate:return b.Alert.Description.bad_certificate;case a.pki.certificateError.unsupported_certificate:return b.Alert.Description.unsupported_certificate;
case a.pki.certificateError.certificate_revoked:return b.Alert.Description.certificate_revoked;case a.pki.certificateError.certificate_expired:return b.Alert.Description.certificate_expired;case a.pki.certificateError.certificate_unknown:return b.Alert.Description.certificate_unknown;case a.pki.certificateError.unknown_ca:return b.Alert.Description.unknown_ca;default:return b.Alert.Description.bad_certificate}},U=function(c){switch(c){case !0:return!0;case b.Alert.Description.bad_certificate:return a.pki.certificateError.bad_certificate;
case b.Alert.Description.unsupported_certificate:return a.pki.certificateError.unsupported_certificate;case b.Alert.Description.certificate_revoked:return a.pki.certificateError.certificate_revoked;case b.Alert.Description.certificate_expired:return a.pki.certificateError.certificate_expired;case b.Alert.Description.certificate_unknown:return a.pki.certificateError.certificate_unknown;case b.Alert.Description.unknown_ca:return a.pki.certificateError.unknown_ca;default:return a.pki.certificateError.bad_certificate}};
b.verifyCertificateChain=function(c,d){try{a.pki.verifyCertificateChain(c.caStore,d,function(d,e,h){D(d);e=c.verify(c,d,e,h);if(!0!==e){if("object"===typeof e&&!a.util.isArray(e))throw d=Error("The application rejected the certificate."),d.send=!0,d.alert={level:b.Alert.Level.fatal,description:b.Alert.Description.bad_certificate},e.message&&(d.message=e.message),e.alert&&(d.alert.description=e.alert),d;e!==d&&(e=U(e))}return e})}catch(V){var e=V;if("object"!==typeof e||a.util.isArray(e))e={send:!0,
alert:{level:b.Alert.Level.fatal,description:D(V)}};"send"in e||(e.send=!0);"alert"in e||(e.alert={level:b.Alert.Level.fatal,description:D(e.error)});c.error(c,e)}return!c.fail};b.createSessionCache=function(b,c){var d=null;if(b&&b.getSession&&b.setSession&&b.order)d=b;else{d={};d.cache=b||{};d.capacity=Math.max(c||100,1);d.order=[];for(var e in b)d.order.length<=c?d.order.push(e):delete b[e];d.getSession=function(b){var c=null,e=null;b?e=a.util.bytesToHex(b):0<d.order.length&&(e=d.order[0]);if(null!==
e&&e in d.cache){c=d.cache[e];delete d.cache[e];for(var h in d.order)if(d.order[h]===e){d.order.splice(h,1);break}}return c};d.setSession=function(b,c){if(d.order.length===d.capacity){var e=d.order.shift();delete d.cache[e]}e=a.util.bytesToHex(b);d.order.push(e);d.cache[e]=c}}return d};b.createConnection=function(c){var d=null;d=c.caStore?a.util.isArray(c.caStore)?a.pki.createCaStore(c.caStore):c.caStore:a.pki.createCaStore();var e=c.cipherSuites||null;if(null===e){e=[];for(var h in b.CipherSuites)e.push(b.CipherSuites[h])}h=
c.server?b.ConnectionEnd.server:b.ConnectionEnd.client;var g=c.sessionCache?b.createSessionCache(c.sessionCache):null,l={version:{major:b.Version.major,minor:b.Version.minor},entity:h,sessionId:c.sessionId,caStore:d,sessionCache:g,cipherSuites:e,connected:c.connected,virtualHost:c.virtualHost||null,verifyClient:c.verifyClient||!1,verify:c.verify||function(a,b,c,d){return b},getCertificate:c.getCertificate||null,getPrivateKey:c.getPrivateKey||null,getSignature:c.getSignature||null,input:a.util.createBuffer(),
tlsData:a.util.createBuffer(),data:a.util.createBuffer(),tlsDataReady:c.tlsDataReady,dataReady:c.dataReady,heartbeatReceived:c.heartbeatReceived,closed:c.closed,error:function(a,d){d.origin=d.origin||(a.entity===b.ConnectionEnd.client?"client":"server");d.send&&(b.queue(a,b.createAlert(a,d.alert)),b.flush(a));var e=!1!==d.fatal;e&&(a.fail=!0);c.error(a,d);e&&a.close(!1)},deflate:c.deflate||null,inflate:c.inflate||null,reset:function(a){l.version={major:b.Version.major,minor:b.Version.minor};l.record=
null;l.session=null;l.peerCertificate=null;l.state={pending:null,current:null};l.expect=0;l.fragmented=null;l.records=[];l.open=!1;l.handshakes=0;l.handshaking=!1;l.isConnected=!1;l.fail=!(a||"undefined"===typeof a);l.input.clear();l.tlsData.clear();l.data.clear();l.state.current=b.createConnectionState(l)}};l.reset();l.handshake=function(c){if(l.entity!==b.ConnectionEnd.client)l.error(l,{message:"Cannot initiate handshake as a server.",fatal:!1});else if(l.handshaking)l.error(l,{message:"Handshake already in progress.",
fatal:!1});else{l.fail&&!l.open&&0===l.handshakes&&(l.fail=!1);l.handshaking=!0;c=c||"";var d=null;0<c.length&&(l.sessionCache&&(d=l.sessionCache.getSession(c)),null===d&&(c=""));0===c.length&&l.sessionCache&&(d=l.sessionCache.getSession(),null!==d&&(c=d.id));l.session={id:c,version:null,cipherSuite:null,compressionMethod:null,serverCertificate:null,certificateRequest:null,clientCertificate:null,sp:{},md5:a.md.md5.create(),sha1:a.md.sha1.create()};d&&(l.version=d.version,l.session.sp=d.sp);l.session.sp.client_random=
b.createRandom().getBytes();l.open=!0;b.queue(l,b.createRecord(l,{type:b.ContentType.handshake,data:b.createClientHello(l)}));b.flush(l)}};l.process=function(c){var d=0;c&&l.input.putBytes(c);if(!l.fail){null!==l.record&&l.record.ready&&l.record.fragment.isEmpty()&&(l.record=null);if(null===l.record){d=0;c=l.input;var e=c.length();5>e?d=5-e:(l.record={type:c.getByte(),version:{major:c.getByte(),minor:c.getByte()},length:c.getInt16(),fragment:a.util.createBuffer(),ready:!1},(c=l.record.version.major===
l.version.major)&&l.session&&l.session.version&&(c=l.record.version.minor===l.version.minor),c||l.error(l,{message:"Incompatible TLS version.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.protocol_version}}))}if(!l.fail&&null!==l.record&&!l.record.ready){d=l;c=0;e=d.input;var h=e.length();h<d.record.length?c=d.record.length-h:(d.record.fragment.putBytes(e.getBytes(d.record.length)),e.compact(),d.state.current.read.update(d,d.record)&&(null!==d.fragmented&&(d.fragmented.type===
d.record.type?(d.fragmented.fragment.putBuffer(d.record.fragment),d.record=d.fragmented):d.error(d,{message:"Invalid fragmented record.",send:!0,alert:{level:b.Alert.Level.fatal,description:b.Alert.Description.unexpected_message}})),d.record.ready=!0));d=c}if(!l.fail&&null!==l.record&&l.record.ready)if(c=l.record,e=c.type-b.ContentType.change_cipher_spec,h=x[l.entity][l.expect],e in h)h[e](l,c);else b.handleUnexpected(l,c)}return d};l.prepare=function(c){b.queue(l,b.createRecord(l,{type:b.ContentType.application_data,
data:a.util.createBuffer(c)}));return b.flush(l)};l.prepareHeartbeatRequest=function(c,d){c instanceof a.util.ByteBuffer&&(c=c.bytes());"undefined"===typeof d&&(d=c.length);l.expectedHeartbeatPayload=c;b.queue(l,b.createRecord(l,{type:b.ContentType.heartbeat,data:b.createHeartbeat(b.HeartbeatMessageType.heartbeat_request,c,d)}));return b.flush(l)};l.close=function(a){if(!l.fail&&l.sessionCache&&l.session){var c={id:l.session.id,version:l.session.version,sp:l.session.sp};c.sp.keys=null;l.sessionCache.setSession(c.id,
c)}if(l.open){l.open=!1;l.input.clear();if(l.isConnected||l.handshaking)l.isConnected=l.handshaking=!1,b.queue(l,b.createAlert(l,{level:b.Alert.Level.warning,description:b.Alert.Description.close_notify})),b.flush(l);l.closed(l)}l.reset(a)};return l};a.tls=a.tls||{};for(var Z in b)"function"!==typeof b[Z]&&(a.tls[Z]=b[Z]);a.tls.prf_tls1=f;a.tls.hmac_sha1=function(b,c,d){var e=a.hmac.create();e.start("SHA1",b);b=a.util.createBuffer();b.putInt32(c[0]);b.putInt32(c[1]);b.putByte(d.type);b.putByte(d.version.major);
b.putByte(d.version.minor);b.putInt16(d.length);b.putBytes(d.fragment.bytes());e.update(b.getBytes());return e.digest().getBytes()};a.tls.createSessionCache=b.createSessionCache;a.tls.createConnection=b.createConnection}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||
{};if(d.defined.tls)return d.tls;d.defined.tls=!0;for(var k=0;k<f.length;++k)f[k](d);return d.tls}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/tls","require module ./asn1 ./hmac ./md ./pem ./pki ./random ./util".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(c,g,f){g=g.entity===
a.tls.ConnectionEnd.client;c.read.cipherState={init:!1,cipher:a.cipher.createDecipher("AES-CBC",g?f.keys.server_write_key:f.keys.client_write_key),iv:g?f.keys.server_write_IV:f.keys.client_write_IV};c.write.cipherState={init:!1,cipher:a.cipher.createCipher("AES-CBC",g?f.keys.client_write_key:f.keys.server_write_key),iv:g?f.keys.client_write_IV:f.keys.server_write_IV};c.read.cipherFunction=e;c.write.cipherFunction=d;c.read.macLength=c.write.macLength=f.mac_length;c.read.macFunction=c.write.macFunction=
b.hmac_sha1}function d(c,d){var e=!1,g=d.macFunction(d.macKey,d.sequenceNumber,c);c.fragment.putBytes(g);d.updateSequenceNumber();g=c.version.minor===b.Versions.TLS_1_0.minor?d.cipherState.init?null:d.cipherState.iv:a.random.getBytesSync(16);d.cipherState.init=!0;var f=d.cipherState.cipher;f.start({iv:g});c.version.minor>=b.Versions.TLS_1_1.minor&&f.output.putBytes(g);f.update(c.fragment);f.finish(p)&&(c.fragment=f.output,c.length=c.fragment.length(),e=!0);return e}function p(a,b,c){c||(a-=b.length()%
a,b.fillWithByte(a-1,a));return!0}function k(a,b,c){a=!0;if(c){c=b.length();for(var d=b.last(),e=c-1-d;e<c-1;++e)a=a&&b.at(e)==d;a&&b.truncate(d+1)}return a}function e(d,e){++c;var g=d.version.minor===b.Versions.TLS_1_0.minor?e.cipherState.init?null:e.cipherState.iv:d.fragment.getBytes(16);e.cipherState.init=!0;var f=e.cipherState.cipher;f.start({iv:g});f.update(d.fragment);g=f.finish(k);var u=e.macLength,n=a.random.getBytesSync(u),r=f.output.length();r>=u?(d.fragment=f.output.getBytes(r-u),n=f.output.getBytes(u)):
d.fragment=f.output.getBytes();d.fragment=a.util.createBuffer(d.fragment);d.length=d.fragment.length();u=e.macFunction(e.macKey,e.sequenceNumber,d);e.updateSequenceNumber();f=e.macKey;r=a.hmac.create();r.start("SHA1",f);r.update(n);n=r.digest().getBytes();r.start(null,null);r.update(u);u=r.digest().getBytes();return n===u&&g}var b=a.tls;b.CipherSuites.TLS_RSA_WITH_AES_128_CBC_SHA={id:[0,47],name:"TLS_RSA_WITH_AES_128_CBC_SHA",initSecurityParameters:function(a){a.bulk_cipher_algorithm=b.BulkCipherAlgorithm.aes;
a.cipher_type=b.CipherType.block;a.enc_key_length=16;a.block_length=16;a.fixed_iv_length=16;a.record_iv_length=16;a.mac_algorithm=b.MACAlgorithm.hmac_sha1;a.mac_length=20;a.mac_key_length=20},initConnectionState:f};b.CipherSuites.TLS_RSA_WITH_AES_256_CBC_SHA={id:[0,53],name:"TLS_RSA_WITH_AES_256_CBC_SHA",initSecurityParameters:function(a){a.bulk_cipher_algorithm=b.BulkCipherAlgorithm.aes;a.cipher_type=b.CipherType.block;a.enc_key_length=32;a.block_length=16;a.fixed_iv_length=16;a.record_iv_length=
16;a.mac_algorithm=b.MACAlgorithm.hmac_sha1;a.mac_length=20;a.mac_key_length=20},initConnectionState:f};var c=0}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.aesCipherSuites)return d.aesCipherSuites;d.defined.aesCipherSuites=!0;for(var k=0;k<f.length;++k)f[k](d);
return d.aesCipherSuites}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/aesCipherSuites",["require","module","./aes","./tls"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){a.debug=a.debug||{};a.debug.storage={};a.debug.get=function(f,d){var p;"undefined"===typeof f?p=a.debug.storage:f in a.debug.storage&&
(p="undefined"===typeof d?a.debug.storage[f]:a.debug.storage[f][d]);return p};a.debug.set=function(f,d,p){f in a.debug.storage||(a.debug.storage[f]={});a.debug.storage[f][d]=p};a.debug.clear=function(f,d){"undefined"===typeof f?a.debug.storage={}:f in a.debug.storage&&("undefined"===typeof d?delete a.debug.storage[f]:delete a.debug.storage[f][d])}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge=
{}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.debug)return d.debug;d.defined.debug=!0;for(var k=0;k<f.length;++k)f[k](d);return d.debug}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/debug",["require","module"],function(){D.apply(null,Array.prototype.slice.call(arguments,
0))})})();(function(){function q(a){function f(d,f,e,b){d.generate=function(c,d){for(var g=new a.util.ByteBuffer,k=Math.ceil(d/b)+e,w=new a.util.ByteBuffer,u=e;u<k;++u){w.putInt32(u);f.start();f.update(c+w.getBytes());var n=f.digest();g.putBytes(n.getBytes(b))}g.truncate(g.length()-d);return g.getBytes()}}a.kem=a.kem||{};var d=a.jsbn.BigInteger;a.kem.rsa={};a.kem.rsa.create=function(f,k){k=k||{};var e=k.prng||a.random;return{encrypt:function(b,c){var k=Math.ceil(b.n.bitLength()/8);do var g=(new d(a.util.bytesToHex(e.getBytesSync(k)),
16)).mod(b.n);while(g.equals(d.ZERO));g=a.util.hexToBytes(g.toString(16));k-=g.length;0<k&&(g=a.util.fillString(String.fromCharCode(0),k)+g);k=b.encrypt(g,"NONE");g=f.generate(g,c);return{encapsulation:k,key:g}},decrypt:function(a,c,d){a=a.decrypt(c,"NONE");return f.generate(a,d)}}};a.kem.kdf1=function(a,d){f(this,a,0,d||a.digestLength)};a.kem.kdf2=function(a,d){f(this,a,1,d||a.digestLength)}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===
typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.kem)return d.kem;d.defined.kem=!0;for(var k=0;k<f.length;++k)f[k](d);return d.kem}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/kem",["require","module","./util","./random",
"./jsbn"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){a.log=a.log||{};a.log.levels="none error warning info debug verbose max".split(" ");var f={},d=[],p=null;a.log.LEVEL_LOCKED=2;a.log.NO_LEVEL_CHECK=4;a.log.INTERPOLATE=8;for(var k=0;k<a.log.levels.length;++k){var e=a.log.levels[k];f[e]={index:k,name:e.toUpperCase()}}a.log.logMessage=function(b){for(var c=f[b.level].index,e=0;e<d.length;++e){var k=d[e];k.flags&a.log.NO_LEVEL_CHECK?k.f(b):c<=f[k.level].index&&
k.f(k,b)}};a.log.prepareStandard=function(a){"standard"in a||(a.standard=f[a.level].name+" ["+a.category+"] "+a.message)};a.log.prepareFull=function(b){if(!("full"in b)){var c=[b.message];c=c.concat([]);b.full=a.util.format.apply(this,c)}};a.log.prepareStandardFull=function(b){"standardFull"in b||(a.log.prepareStandard(b),b.standardFull=b.standard)};e=["error","warning","info","debug","verbose"];for(k=0;k<e.length;++k)(function(b){a.log[b]=function(c,d){var e=Array.prototype.slice.call(arguments).slice(2);
a.log.logMessage({timestamp:new Date,level:b,category:c,message:d,arguments:e})}})(e[k]);a.log.makeLogger=function(b){b={flags:0,f:b};a.log.setLevel(b,"none");return b};a.log.setLevel=function(b,d){var c=!1;if(b&&!(b.flags&a.log.LEVEL_LOCKED))for(var e=0;e<a.log.levels.length;++e)if(d==a.log.levels[e]){b.level=d;c=!0;break}return c};a.log.lock=function(b,d){b.flags="undefined"===typeof d||d?b.flags|a.log.LEVEL_LOCKED:b.flags&~a.log.LEVEL_LOCKED};a.log.addLogger=function(a){d.push(a)};if("undefined"!==
typeof console&&"log"in console){if(console.error&&console.warn&&console.info&&console.debug){var b={error:console.error,warning:console.warn,info:console.info,debug:console.debug,verbose:console.debug};p=function(c,d){a.log.prepareStandard(d);var e=b[d.level],f=[d.standard];f=f.concat(d.arguments.slice());e.apply(console,f)}}else p=function(b,d){a.log.prepareStandardFull(d)};p=a.log.makeLogger(p);a.log.setLevel(p,"debug");a.log.addLogger(p)}else console={log:function(){}};null!==p&&(k=a.util.getQueryVariables(),
"console.level"in k&&a.log.setLevel(p,k["console.level"].slice(-1)[0]),"console.lock"in k&&"true"==k["console.lock"].slice(-1)[0]&&a.log.lock(p));a.log.consoleLogger=p}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.log)return d.log;d.defined.log=
!0;for(var k=0;k<f.length;++k)f[k](d);return d.log}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/log",["require","module","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(b){var c={},d=[];if(!g.validate(b,t.asn1.recipientInfoValidator,c,d))throw b=Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo."),
b.errors=d,b;return{version:c.version.charCodeAt(0),issuer:a.pki.RDNAttributesAsArray(c.issuer),serialNumber:a.util.createBuffer(c.serial).toHex(),encryptedContent:{algorithm:g.derToOid(c.encAlgorithm),parameter:c.encParameter.value,content:c.encKey}}}function d(b){return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(b.version).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[a.pki.distinguishedNameToAsn1({attributes:b.issuer}),
g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,a.util.hexToBytes(b.serialNumber))]),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.encryptedContent.algorithm).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")]),g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,b.encryptedContent.content)])}function p(a){for(var b=[],c=0;c<a.length;++c)b.push(d(a[c]));return b}function k(b){var c=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,
g.Type.INTEGER,!1,g.integerToDer(b.version).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[a.pki.distinguishedNameToAsn1({attributes:b.issuer}),g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,a.util.hexToBytes(b.serialNumber))]),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.digestAlgorithm).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")])]);b.authenticatedAttributesAsn1&&c.value.push(b.authenticatedAttributesAsn1);c.value.push(g.create(g.Class.UNIVERSAL,
g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.signatureAlgorithm).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.NULL,!1,"")]));c.value.push(g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,b.signature));if(0<b.unauthenticatedAttributes.length){for(var d=g.create(g.Class.CONTEXT_SPECIFIC,1,!0,[]),f=0;f<b.unauthenticatedAttributes.length;++f)d.values.push(e(b.unauthenticatedAttributes[f]));c.value.push(d)}return c}function e(b){if(b.type===a.pki.oids.contentType)var c=g.create(g.Class.UNIVERSAL,
g.Type.OID,!1,g.oidToDer(b.value).getBytes());else if(b.type===a.pki.oids.messageDigest)c=g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,b.value.bytes());else if(b.type===a.pki.oids.signingTime){c=new Date("1950-01-01T00:00:00Z");var d=new Date("2050-01-01T00:00:00Z"),e=b.value;if("string"===typeof e){var f=Date.parse(e);e=isNaN(f)?13===e.length?g.utcTimeToDate(e):g.generalizedTimeToDate(e):new Date(f)}c=e>=c&&e<d?g.create(g.Class.UNIVERSAL,g.Type.UTCTIME,!1,g.dateToUtcTime(e)):g.create(g.Class.UNIVERSAL,
g.Type.GENERALIZEDTIME,!1,g.dateToGeneralizedTime(e))}return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.type).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SET,!0,[c])])}function b(b){return[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(a.pki.oids.data).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.algorithm).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,
b.parameter.getBytes())]),g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,b.content.getBytes())])]}function c(b,c,d){var e={};if(!g.validate(c,d,e,[]))throw b=Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message."),b.errors=b,b;if(g.derToOid(e.contentType)!==a.pki.oids.data)throw Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(e.encryptedContent){c="";if(a.util.isArray(e.encryptedContent))for(d=
0;d<e.encryptedContent.length;++d){if(e.encryptedContent[d].type!==g.Type.OCTETSTRING)throw Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");c+=e.encryptedContent[d].value}else c=e.encryptedContent;b.encryptedContent={algorithm:g.derToOid(e.encAlgorithm),parameter:a.util.createBuffer(e.encParameter.value),content:a.util.createBuffer(c)}}if(e.content){c="";if(a.util.isArray(e.content))for(d=0;d<e.content.length;++d){if(e.content[d].type!==g.Type.OCTETSTRING)throw Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");
c+=e.content[d].value}else c=e.content;b.content=a.util.createBuffer(c)}b.version=e.version.charCodeAt(0);return b.rawCapture=e}function u(b){if(void 0===b.encryptedContent.key)throw Error("Symmetric key not available.");if(void 0===b.content){switch(b.encryptedContent.algorithm){case a.pki.oids["aes128-CBC"]:case a.pki.oids["aes192-CBC"]:case a.pki.oids["aes256-CBC"]:var c=a.aes.createDecryptionCipher(b.encryptedContent.key);break;case a.pki.oids.desCBC:case a.pki.oids["des-EDE3-CBC"]:c=a.des.createDecryptionCipher(b.encryptedContent.key);
break;default:throw Error("Unsupported symmetric cipher, OID "+b.encryptedContent.algorithm);}c.start(b.encryptedContent.parameter);c.update(b.encryptedContent.content);if(!c.finish())throw Error("Symmetric decryption failed.");b.content=c.output}}var g=a.asn1,t=a.pkcs7=a.pkcs7||{};t.messageFromPem=function(b){b=a.pem.decode(b)[0];if("PKCS7"!==b.type){var c=Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');c.headerType=b.type;throw c;}if(b.procType&&"ENCRYPTED"===
b.procType.type)throw Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");b=g.fromDer(b.body);return t.messageFromAsn1(b)};t.messageToPem=function(b,c){var d={type:"PKCS7",body:g.toDer(b.toAsn1()).getBytes()};return a.pem.encode(d,{maxline:c})};t.messageFromAsn1=function(b){var c={},d=[];if(!g.validate(b,t.asn1.contentInfoValidator,c,d))throw c=Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo."),c.errors=d,c;d=g.derToOid(c.contentType);switch(d){case a.pki.oids.envelopedData:d=
t.createEnvelopedData();break;case a.pki.oids.encryptedData:d=t.createEncryptedData();break;case a.pki.oids.signedData:d=t.createSignedData();break;default:throw Error("Cannot read PKCS#7 message. ContentType with OID "+d+" is not (yet) supported.");}d.fromAsn1(c.content.value[0]);return d};t.createSignedData=function(){var b=null;return b={type:a.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(d){c(b,
d,t.asn1.signedDataValidator);b.certificates=[];b.crls=[];b.digestAlgorithmIdentifiers=[];b.contentInfo=null;b.signerInfos=[];d=b.rawCapture.certificates.value;for(var e=0;e<d.length;++e)b.certificates.push(a.pki.certificateFromAsn1(d[e]))},toAsn1:function(){b.contentInfo||b.sign();for(var c=[],d=0;d<b.certificates.length;++d)c.push(a.pki.certificateToAsn1(b.certificates[d]));d=[];var e=g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,
g.Type.INTEGER,!1,g.integerToDer(b.version).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SET,!0,b.digestAlgorithmIdentifiers),b.contentInfo])]);0<c.length&&e.value[0].value.push(g.create(g.Class.CONTEXT_SPECIFIC,0,!0,c));0<d.length&&e.value[0].value.push(g.create(g.Class.CONTEXT_SPECIFIC,1,!0,d));e.value[0].value.push(g.create(g.Class.UNIVERSAL,g.Type.SET,!0,b.signerInfos));return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(b.type).getBytes()),
e])},addSigner:function(c){var d=c.issuer,e=c.serialNumber;c.certificate&&(e=c.certificate,"string"===typeof e&&(e=a.pki.certificateFromPem(e)),d=e.issuer.attributes,e=e.serialNumber);var g=c.key;if(!g)throw Error("Could not add PKCS#7 signer; no private key specified.");"string"===typeof g&&(g=a.pki.privateKeyFromPem(g));var f=c.digestAlgorithm||a.pki.oids.sha1;switch(f){case a.pki.oids.sha1:case a.pki.oids.sha256:case a.pki.oids.sha384:case a.pki.oids.sha512:case a.pki.oids.md5:break;default:throw Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+
f);}c=c.authenticatedAttributes||[];if(0<c.length){for(var k=!1,h=!1,m=0;m<c.length;++m){var C=c[m];if(!k&&C.type===a.pki.oids.contentType){if(k=!0,h)break}else if(!h&&C.type===a.pki.oids.messageDigest&&(h=!0,k))break}if(!k||!h)throw Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.");}b.signers.push({key:g,version:1,issuer:d,serialNumber:e,digestAlgorithm:f,
signatureAlgorithm:a.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:c,unauthenticatedAttributes:[]})},sign:function(){if("object"!==typeof b.content||null===b.contentInfo)if(b.contentInfo=g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(a.pki.oids.data).getBytes())]),"content"in b){var c;b.content instanceof a.util.ByteBuffer?c=b.content.bytes():"string"===typeof b.content&&(c=a.util.encodeUtf8(b.content));b.contentInfo.value.push(g.create(g.Class.CONTEXT_SPECIFIC,
0,!0,[g.create(g.Class.UNIVERSAL,g.Type.OCTETSTRING,!1,c)]))}if(0!==b.signers.length){c={};for(var d=0;d<b.signers.length;++d){var f=b.signers[d],y=f.digestAlgorithm;y in c||(c[y]=a.md[a.pki.oids[y]].create());f.md=0===f.authenticatedAttributes.length?c[y]:a.md[a.pki.oids[y]].create()}b.digestAlgorithmIdentifiers=[];for(y in c)b.digestAlgorithmIdentifiers.push(g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(y).getBytes()),g.create(g.Class.UNIVERSAL,
g.Type.NULL,!1,"")]));if(2>b.contentInfo.value.length)throw Error("Could not sign PKCS#7 message; there is no content to sign.");y=g.derToOid(b.contentInfo.value[0].value);d=b.contentInfo.value[1];d=d.value[0];var v=g.toDer(d);v.getByte();g.getBerValueLength(v);v=v.getBytes();for(var t in c)c[t].start().update(v);t=new Date;for(d=0;d<b.signers.length;++d){f=b.signers[d];if(0===f.authenticatedAttributes.length){if(y!==a.pki.oids.data)throw Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.");
}else{f.authenticatedAttributesAsn1=g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[]);v=g.create(g.Class.UNIVERSAL,g.Type.SET,!0,[]);for(var h=0;h<f.authenticatedAttributes.length;++h){var m=f.authenticatedAttributes[h];m.type===a.pki.oids.messageDigest?m.value=c[f.digestAlgorithm].digest():m.type!==a.pki.oids.signingTime||m.value||(m.value=t);v.value.push(e(m));f.authenticatedAttributesAsn1.value.push(e(m))}v=g.toDer(v).getBytes();f.md.start().update(v)}f.signature=f.key.sign(f.md,"RSASSA-PKCS1-V1_5")}c=
b;y=b.signers;t=[];for(d=0;d<y.length;++d)t.push(k(y[d]));c.signerInfos=t}},verify:function(){throw Error("PKCS#7 signature verification not yet implemented.");},addCertificate:function(c){"string"===typeof c&&(c=a.pki.certificateFromPem(c));b.certificates.push(c)},addCertificateRevokationList:function(a){throw Error("PKCS#7 CRL support not yet implemented.");}}};t.createEncryptedData=function(){var b=null;return b={type:a.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:a.pki.oids["aes256-CBC"]},
fromAsn1:function(a){c(b,a,t.asn1.encryptedDataValidator)},decrypt:function(a){void 0!==a&&(b.encryptedContent.key=a);u(b)}}};t.createEnvelopedData=function(){var d=null;return d={type:a.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:a.pki.oids["aes256-CBC"]},fromAsn1:function(a){var b=c(d,a,t.asn1.envelopedDataValidator);a=d;b=b.recipientInfos.value;for(var e=[],g=0;g<b.length;++g)e.push(f(b[g]));a.recipients=e},toAsn1:function(){return g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,
!0,[g.create(g.Class.UNIVERSAL,g.Type.OID,!1,g.oidToDer(d.type).getBytes()),g.create(g.Class.CONTEXT_SPECIFIC,0,!0,[g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,[g.create(g.Class.UNIVERSAL,g.Type.INTEGER,!1,g.integerToDer(d.version).getBytes()),g.create(g.Class.UNIVERSAL,g.Type.SET,!0,p(d.recipients)),g.create(g.Class.UNIVERSAL,g.Type.SEQUENCE,!0,b(d.encryptedContent))])])])},findRecipient:function(a){for(var b=a.issuer.attributes,c=0;c<d.recipients.length;++c){var e=d.recipients[c],g=e.issuer;if(e.serialNumber===
a.serialNumber&&g.length===b.length){for(var f=!0,h=0;h<b.length;++h)if(g[h].type!==b[h].type||g[h].value!==b[h].value){f=!1;break}if(f)return e}}return null},decrypt:function(b,c){if(void 0===d.encryptedContent.key&&void 0!==b&&void 0!==c)switch(b.encryptedContent.algorithm){case a.pki.oids.rsaEncryption:case a.pki.oids.desCBC:var e=c.decrypt(b.encryptedContent.content);d.encryptedContent.key=a.util.createBuffer(e);break;default:throw Error("Unsupported asymmetric cipher, OID "+b.encryptedContent.algorithm);
}u(d)},addRecipient:function(b){d.recipients.push({version:0,issuer:b.issuer.attributes,serialNumber:b.serialNumber,encryptedContent:{algorithm:a.pki.oids.rsaEncryption,key:b.publicKey}})},encrypt:function(b,c){if(void 0===d.encryptedContent.content){c=c||d.encryptedContent.algorithm;b=b||d.encryptedContent.key;var e;switch(c){case a.pki.oids["aes128-CBC"]:var g=e=16;var f=a.aes.createEncryptionCipher;break;case a.pki.oids["aes192-CBC"]:e=24;g=16;f=a.aes.createEncryptionCipher;break;case a.pki.oids["aes256-CBC"]:e=
32;g=16;f=a.aes.createEncryptionCipher;break;case a.pki.oids["des-EDE3-CBC"]:e=24;g=8;f=a.des.createEncryptionCipher;break;default:throw Error("Unsupported symmetric cipher, OID "+c);}if(void 0===b)b=a.util.createBuffer(a.random.getBytes(e));else if(b.length()!=e)throw Error("Symmetric key has wrong length; got "+b.length()+" bytes, expected "+e+".");d.encryptedContent.algorithm=c;d.encryptedContent.key=b;d.encryptedContent.parameter=a.util.createBuffer(a.random.getBytes(g));e=f(b);e.start(d.encryptedContent.parameter.copy());
e.update(d.content);if(!e.finish())throw Error("Symmetric encryption failed.");d.encryptedContent.content=e.output}for(e=0;e<d.recipients.length;++e)if(g=d.recipients[e],void 0===g.encryptedContent.content)switch(g.encryptedContent.algorithm){case a.pki.oids.rsaEncryption:g.encryptedContent.content=g.encryptedContent.key.encrypt(d.encryptedContent.key.data);break;default:throw Error("Unsupported asymmetric cipher, OID "+g.encryptedContent.algorithm);}}}}}if("function"!==typeof p)if("object"===typeof module&&
module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.pkcs7)return d.pkcs7;d.defined.pkcs7=!0;for(var k=0;k<f.length;++k)f[k](d);return d.pkcs7}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,
0))};p("js/pkcs7","require module ./aes ./asn1 ./des ./oids ./pem ./pkcs7asn1 ./random ./util ./x509".split(" "),function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){function f(d,b){var c=b.toString(16);"8"<=c[0]&&(c="00"+c);c=a.util.hexToBytes(c);d.putInt32(c.length);d.putBytes(c)}function d(a,b){a.putInt32(b.length);a.putString(b)}function p(){for(var d=a.md.sha1.create(),b=arguments.length,c=0;c<b;++c)d.update(arguments[c]);return d.digest()}var k=a.ssh=
a.ssh||{};k.privateKeyToPutty=function(e,b,c){c=c||"";b=b||"";var k=""===b?"none":"aes256-cbc";var g="PuTTY-User-Key-File-2: ssh-rsa\r\n"+("Encryption: "+k+"\r\n")+("Comment: "+c+"\r\n");var t=a.util.createBuffer();d(t,"ssh-rsa");f(t,e.e);f(t,e.n);var q=a.util.encode64(t.bytes(),64),z=Math.floor(q.length/66)+1;g+="Public-Lines: "+z+"\r\n";g+=q;q=a.util.createBuffer();f(q,e.d);f(q,e.p);f(q,e.q);f(q,e.qInv);b?(z=q.length()+16-1,z-=z%16,e=p(q.bytes()),e.truncate(e.length()-z+q.length()),q.putBuffer(e),
z=a.util.createBuffer(),z.putBuffer(p("\x00\x00\x00\x00",b)),z.putBuffer(p("\x00\x00\x00\u0001",b)),z=a.aes.createEncryptionCipher(z.truncate(8),"CBC"),z.start(a.util.createBuffer().fillWithByte(0,16)),z.update(q.copy()),z.finish(),z=z.output,z.truncate(16),e=a.util.encode64(z.bytes(),64)):e=a.util.encode64(q.bytes(),64);z=Math.floor(e.length/66)+1;g+="\r\nPrivate-Lines: "+z+"\r\n";g+=e;b=p("putty-private-key-file-mac-key",b);z=a.util.createBuffer();d(z,"ssh-rsa");d(z,k);d(z,c);z.putInt32(t.length());
z.putBuffer(t);z.putInt32(q.length());z.putBuffer(q);c=a.hmac.create();c.start("sha1",b);c.update(z.bytes());return g+="\r\nPrivate-MAC: "+c.digest().toHex()+"\r\n"};k.publicKeyToOpenSSH=function(e,b){b=b||"";var c=a.util.createBuffer();d(c,"ssh-rsa");f(c,e.e);f(c,e.n);return"ssh-rsa "+a.util.encode64(c.bytes())+" "+b};k.privateKeyToOpenSSH=function(d,b){return b?a.pki.encryptRsaPrivateKey(d,b,{legacy:!0,algorithm:"aes128"}):a.pki.privateKeyToPem(d)};k.getPublicKeyFingerprint=function(e,b){b=b||{};
var c=b.md||a.md.md5.create(),k=a.util.createBuffer();d(k,"ssh-rsa");f(k,e.e);f(k,e.n);c.start();c.update(k.getBytes());c=c.digest();if("hex"===b.encoding)return c=c.toHex(),b.delimiter?c.match(/.{2}/g).join(b.delimiter):c;if("binary"===b.encoding)return c.getBytes();if(b.encoding)throw Error('Unknown encoding "'+b.encoding+'".');return c}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);
var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.ssh)return d.ssh;d.defined.ssh=!0;for(var k=0;k<f.length;++k)f[k](d);return d.ssh}},A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/ssh","require module ./aes ./hmac ./md5 ./sha1 ./util".split(" "),function(){D.apply(null,
Array.prototype.slice.call(arguments,0))})})();(function(){function q(a){var f={},d=0;a.debug.set("forge.task","tasks",f);var p={};a.debug.set("forge.task","queues",p);var k={ready:{}};k.ready.stop="ready";k.ready.start="running";k.ready.cancel="done";k.ready.fail="error";k.running={};k.running.stop="ready";k.running.start="running";k.running.block="blocked";k.running.unblock="running";k.running.sleep="sleeping";k.running.wakeup="running";k.running.cancel="done";k.running.fail="error";k.blocked={};
k.blocked.stop="blocked";k.blocked.start="blocked";k.blocked.block="blocked";k.blocked.unblock="blocked";k.blocked.sleep="blocked";k.blocked.wakeup="blocked";k.blocked.cancel="done";k.blocked.fail="error";k.sleeping={};k.sleeping.stop="sleeping";k.sleeping.start="sleeping";k.sleeping.block="sleeping";k.sleeping.unblock="sleeping";k.sleeping.sleep="sleeping";k.sleeping.wakeup="sleeping";k.sleeping.cancel="done";k.sleeping.fail="error";k.done={};k.done.stop="done";k.done.start="done";k.done.block="done";
k.done.unblock="done";k.done.sleep="done";k.done.wakeup="done";k.done.cancel="done";k.done.fail="error";k.error={};k.error.stop="error";k.error.start="error";k.error.block="error";k.error.unblock="error";k.error.sleep="error";k.error.wakeup="error";k.error.cancel="error";k.error.fail="error";var e=function(a){this.id=-1;this.name=a.name||"?";this.parent=a.parent||null;this.run=a.run;this.subtasks=[];this.error=!1;this.state="ready";this.blocks=0;this.userData=this.swapTime=this.timeoutId=null;this.id=
d++;f[this.id]=this};e.prototype.debug=function(b){a.log.debug("forge.task",b||"","[%s][%s] task:",this.id,this.name,this,"subtasks:",this.subtasks.length,"queue:",p)};e.prototype.next=function(a,b){"function"===typeof a&&(b=a,a=this.name);var c=new e({run:b,name:a,parent:this});c.state="running";c.type=this.type;c.successCallback=this.successCallback||null;c.failureCallback=this.failureCallback||null;this.subtasks.push(c);return this};e.prototype.parallel=function(b,c){a.util.isArray(b)&&(c=b,b=
this.name);return this.next(b,function(d){d.block(c.length);for(var e=function(b,e){a.task.start({type:b,run:function(a){c[e](a)},success:function(a){d.unblock()},failure:function(a){d.unblock()}})},g=0;g<c.length;g++)e(b+"__parallel-"+d.id+"-"+g,g)})};e.prototype.stop=function(){this.state=k[this.state].stop};e.prototype.start=function(){this.error=!1;this.state=k[this.state].start;"running"===this.state&&(this.start=new Date,this.run(this),c(this,0))};e.prototype.block=function(a){this.blocks+=
"undefined"===typeof a?1:a;0<this.blocks&&(this.state=k[this.state].block)};e.prototype.unblock=function(a){this.blocks-="undefined"===typeof a?1:a;0===this.blocks&&"done"!==this.state&&(this.state="running",c(this,0));return this.blocks};e.prototype.sleep=function(a){this.state=k[this.state].sleep;var b=this;this.timeoutId=setTimeout(function(){b.timeoutId=null;b.state="running";c(b,0)},"undefined"===typeof a?0:a)};e.prototype.wait=function(a){a.wait(this)};e.prototype.wakeup=function(){"sleeping"===
this.state&&(cancelTimeout(this.timeoutId),this.timeoutId=null,this.state="running",c(this,0))};e.prototype.cancel=function(){this.state=k[this.state].cancel;this.permitsNeeded=0;null!==this.timeoutId&&(cancelTimeout(this.timeoutId),this.timeoutId=null);this.subtasks=[]};e.prototype.fail=function(a){this.error=!0;q(this,!0);if(a)a.error=this.error,a.swapTime=this.swapTime,a.userData=this.userData,c(a,0);else{if(null!==this.parent){for(a=this.parent;null!==a.parent;)a.error=this.error,a.swapTime=this.swapTime,
a.userData=this.userData,a=a.parent;q(a,!0)}this.failureCallback&&this.failureCallback(this)}};var b=function(a){a.error=!1;a.state=k[a.state].start;setTimeout(function(){"running"===a.state&&(a.swapTime=+new Date,a.run(a),c(a,0))},0)},c=function(a,b){var d=30<b||20<+new Date-a.swapTime,e=function(b){b++;if("running"===a.state)if(d&&(a.swapTime=+new Date),0<a.subtasks.length){var e=a.subtasks.shift();e.error=a.error;e.swapTime=a.swapTime;e.userData=a.userData;e.run(e);e.error||c(e,b)}else q(a),a.error||
null===a.parent||(a.parent.error=a.error,a.parent.swapTime=a.swapTime,a.parent.userData=a.userData,c(a.parent,b))};d?setTimeout(e,0):e(b)},q=function(b,c){b.state="done";delete f[b.id];null===b.parent&&(b.type in p?0===p[b.type].length?a.log.error("forge.task","[%s][%s] task queue empty [%s]",b.id,b.name,b.type):p[b.type][0]!==b?a.log.error("forge.task","[%s][%s] task not first in queue [%s]",b.id,b.name,b.type):(p[b.type].shift(),0===p[b.type].length?delete p[b.type]:p[b.type][0].start()):a.log.error("forge.task",
"[%s][%s] task queue missing [%s]",b.id,b.name,b.type),c||(b.error&&b.failureCallback?b.failureCallback(b):!b.error&&b.successCallback&&b.successCallback(b)))};a.task=a.task||{};a.task.start=function(a){var c=new e({run:a.run,name:a.name||"?"});c.type=a.type;c.successCallback=a.success||null;c.failureCallback=a.failure||null;c.type in p?p[a.type].push(c):(p[c.type]=[c],b(c))};a.task.cancel=function(a){a in p&&(p[a]=[p[a][0]])};a.task.createCondition=function(){var a={tasks:{},wait:function(b){b.id in
a.tasks||(b.block(),a.tasks[b.id]=b)},notify:function(){var b=a.tasks;a.tasks={};for(var c in b)b[c].unblock()}};return a}}if("function"!==typeof p)if("object"===typeof module&&module.exports){var B=!0;p=function(a,f){f(K,module)}}else return"undefined"===typeof forge&&(forge={}),q(forge);var x,D=function(a,f){f.exports=function(d){var f=x.map(function(d){return a(d)}).concat(q);d=d||{};d.defined=d.defined||{};if(d.defined.task)return d.task;d.defined.task=!0;for(var k=0;k<f.length;++k)f[k](d);return d.task}},
A=p;p=function(a,f){x="string"===typeof a?f.slice(2):a.slice(2);if(B)return A.apply(null,Array.prototype.slice.call(arguments,0));p=A;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/task",["require","module","./debug","./log","./util"],function(){D.apply(null,Array.prototype.slice.call(arguments,0))})})();(function(){if("function"!==typeof p)if("object"===typeof module&&module.exports){var q=!0;p=function(p,a){a(K,module)}}else{"undefined"===typeof forge&&(forge={disableNativeCode:!1});
return}var B,x=function(p,a){a.exports=function(a){var d=B.map(function(a){return p(a)});a=a||{};a.defined=a.defined||{};if(a.defined.forge)return a.forge;a.defined.forge=!0;for(var f=0;f<d.length;++f)if("function"===typeof d[f])d[f](a);return a};a.exports.disableNativeCode=!1;a.exports(a.exports)},D=p;p=function(x,a){B="string"===typeof x?a.slice(2):x.slice(2);if(q)return D.apply(null,Array.prototype.slice.call(arguments,0));p=D;return p.apply(null,Array.prototype.slice.call(arguments,0))};p("js/forge",
"require module ./aes ./aesCipherSuites ./asn1 ./cipher ./cipherModes ./debug ./des ./hmac ./kem ./log ./md ./mgf1 ./pbkdf2 ./pem ./pkcs7 ./pkcs1 ./pkcs12 ./pki ./prime ./prng ./pss ./random ./rc2 ./ssh ./task ./tls ./util".split(" "),function(){x.apply(null,Array.prototype.slice.call(arguments,0))})})();return K("js/forge")})}
(function(){function G(a){return B(">"+D("B",a.length),a)}function q(a){return B(">"+D("H",a.length),a)}function K(a){return B(">"+D("L",a.length),a)}function p(a,b,c){var d=Object.keys(a).length,e=B(">H",[d]);d=-1<["0th","1st"].indexOf(b)?12*d+6:2+12*d;var f="",p="",z;for(z in a)if("string"==typeof z&&(z=parseInt(z)),!("0th"==b&&-1<[34665,34853].indexOf(z)||"Exif"==b&&40965==z||"1st"==b&&-1<[513,514].indexOf(z))){var n=a[z],r=B(">H",[z]),y=k[b][z].type,v=B(">H",[F[y]]);"number"==typeof n&&(n=[n]);
var E,h=void 0,m=y;y=8+d+c+p.length;var C=E="";if("Byte"==m)h=n.length,4>=h?C=G(n)+D("\x00",4-h):(C=B(">L",[y]),E=G(n));else if("Short"==m)h=n.length,2>=h?C=q(n)+D("\x00\x00",2-h):(C=B(">L",[y]),E=q(n));else if("Long"==m)h=n.length,1>=h?C=K(n):(C=B(">L",[y]),E=K(n));else if("Ascii"==m)m=n+"\x00",h=m.length,4<h?(C=B(">L",[y]),E=m):C=m+D("\x00",4-h);else if("Rational"==m){if("number"==typeof n[0])h=1,C=n[0],E=n[1],m=B(">L",[C])+B(">L",[E]);else{h=n.length;m="";for(var l=0;l<h;l++)C=n[l][0],E=n[l][1],
m+=B(">L",[C])+B(">L",[E])}C=B(">L",[y]);E=m}else if("SRational"==m){if("number"==typeof n[0])h=1,C=n[0],E=n[1],m=B(">l",[C])+B(">l",[E]);else for(h=n.length,m="",l=0;l<h;l++)C=n[l][0],E=n[l][1],m+=B(">l",[C])+B(">l",[E]);C=B(">L",[y]);E=m}else"Undefined"==m&&(h=n.length,4<h?(C=B(">L",[y]),E=n):C=n+D("\x00",4-h));h=[B(">L",[h]),C,E];n=h[2];f+=r+v+h[0]+h[1];p+=n}return[e+f,p]}function O(a){if("\u00ff\u00d8"==a.slice(0,2)){a=A(a);a:{for(var b,c=0;c<a.length;c++)if(b=a[c],"\u00ff\u00e1"==b.slice(0,2)&&
"Exif\x00\x00"==b.slice(4,10)){a=b;break a}a=null}this.tiftag=a?a.slice(10):null}else if(-1<["II","MM"].indexOf(a.slice(0,2)))this.tiftag=a;else if("Exif"==a.slice(0,4))this.tiftag=a.slice(6);else throw"Given file is neither JPEG nor TIFF.";}function B(a,b){if(!(b instanceof Array))throw"'pack' error. Got invalid type argument.";if(a.length-1!=b.length)throw"'pack' error. "+(a.length-1)+" marks, "+b.length+" elements.";if("<"==a[0])var c=!0;else if(">"==a[0])c=!1;else throw"";for(var d="",e=1,f,k;k=
a[e];){if("b"==k.toLowerCase()){f=b[e-1];"b"==k&&0>f&&(f+=256);if(255<f||0>f)throw"'pack' error.";f=String.fromCharCode(f)}else if("H"==k){f=b[e-1];if(65535<f||0>f)throw"'pack' error.";f=String.fromCharCode(Math.floor(f%65536/256))+String.fromCharCode(f%256);c&&(f=f.split("").reverse().join(""))}else if("l"==k.toLowerCase()){f=b[e-1];"l"==k&&0>f&&(f+=4294967296);if(4294967295<f||0>f)throw"'pack' error.";f=String.fromCharCode(Math.floor(f/16777216))+String.fromCharCode(Math.floor(f%16777216/65536))+
String.fromCharCode(Math.floor(f%65536/256))+String.fromCharCode(f%256);c&&(f=f.split("").reverse().join(""))}else throw"'pack' error.";d+=f;e+=1}return d}function x(a,b){if("string"!=typeof b)throw"'unpack' error. Got invalid type argument.";for(var c=0,d=1;d<a.length;d++)if("b"==a[d].toLowerCase())c+=1;else if("h"==a[d].toLowerCase())c+=2;else if("l"==a[d].toLowerCase())c+=4;else throw"'unpack' error. Got invalid mark.";if(c!=b.length)throw"'unpack' error. Mismatch between symbol and string length. "+
c+":"+b.length;if("<"==a[0])c=!0;else if(">"==a[0])c=!1;else throw"'unpack' error.";d=[];for(var e=0,f=1,k,p,n;p=a[f];){if("b"==p.toLowerCase())n=1,k=b.slice(e,e+n),k=k.charCodeAt(0),"b"==p&&128<=k&&(k-=256);else if("H"==p)n=2,k=b.slice(e,e+n),c&&(k=k.split("").reverse().join("")),k=256*k.charCodeAt(0)+k.charCodeAt(1);else if("l"==p.toLowerCase())n=4,k=b.slice(e,e+n),c&&(k=k.split("").reverse().join("")),k=16777216*k.charCodeAt(0)+65536*k.charCodeAt(1)+256*k.charCodeAt(2)+k.charCodeAt(3),"l"==p&&
2147483648<=k&&(k-=4294967296);else throw"'unpack' error. "+p;d.push(k);e+=n;f+=1}return d}function D(a,b){for(var c="",d=0;d<b;d++)c+=a;return c}function A(a){if("\u00ff\u00d8"!=a.slice(0,2))throw"Given data isn't JPEG.";for(var b=2,c=["\u00ff\u00d8"];;){if("\u00ff\u00da"==a.slice(b,b+2)){c.push(a.slice(b));break}else{var d=x(">H",a.slice(b+2,b+4))[0];d=b+d+2;c.push(a.slice(b,d));b=d}if(b>=a.length)throw"Wrong JPEG data.";}return c}var a={version:"1.03",remove:function(a){var b=!1;if("\u00ff\u00d8"!=
a.slice(0,2))if("data:image/jpeg;base64,"==a.slice(0,23)||"data:image/jpg;base64,"==a.slice(0,22))a=d(a.split(",")[1]),b=!0;else throw"Given data is not jpeg.";a=A(a);if("\u00ff\u00e1"==a[1].slice(0,2)&&"Exif\x00\x00"==a[1].slice(4,10))a=[a[0]].concat(a.slice(2));else if("\u00ff\u00e1"==a[2].slice(0,2)&&"Exif\x00\x00"==a[2].slice(4,10))a=a.slice(0,2).concat(a.slice(3));else throw"Exif not found.";a=a.join("");b&&(a="data:image/jpeg;base64,"+f(a));return a},insert:function(a,b){var c=!1;if("Exif\x00\x00"!=
a.slice(0,6))throw"Given data is not exif.";if("\u00ff\u00d8"!=b.slice(0,2))if("data:image/jpeg;base64,"==b.slice(0,23)||"data:image/jpg;base64,"==b.slice(0,22))b=d(b.split(",")[1]),c=!0;else throw"Given data is not jpeg.";var e="\u00ff\u00e1"+B(">H",[a.length+2])+a,g=A(b);"\u00ff\u00e0"==g[1].slice(0,2)&&"\u00ff\u00e1"==g[2].slice(0,2)&&"Exif\x00\x00"==g[2].slice(4,10)?e?(g[2]=e,g=["\u00ff\u00d8"].concat(g.slice(2))):g=null==e?g.slice(0,2).concat(g.slice(3)):g.slice(0).concat(g.slice(2)):"\u00ff\u00e0"==
g[1].slice(0,2)?e&&(g[1]=e):"\u00ff\u00e1"==g[1].slice(0,2)&&"Exif\x00\x00"==g[1].slice(4,10)?e?g[1]=e:null==e&&(g=g.slice(0).concat(g.slice(2))):e&&(g=[g[0],e].concat(g.slice(1)));e=g.join("");c&&(e="data:image/jpeg;base64,"+f(e));return e},load:function(a){if("string"==typeof a)if("\u00ff\u00d8"==a.slice(0,2))var b=a;else if("data:image/jpeg;base64,"==a.slice(0,23)||"data:image/jpg;base64,"==a.slice(0,22))b=d(a.split(",")[1]);else if("Exif"==a.slice(0,4))b=a.slice(6);else throw"'load' gots invalid file data.";
else throw"'load' gots invalid type argument.";a={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null};b=new O(b);if(null===b.tiftag)return a;"II"==b.tiftag.slice(0,2)?b.endian_mark="<":b.endian_mark=">";var c=x(b.endian_mark+"L",b.tiftag.slice(4,8))[0];a["0th"]=b.get_ifd(c,"0th");var e=a["0th"].first_ifd_pointer;delete a["0th"].first_ifd_pointer;34665 in a["0th"]&&(c=a["0th"][34665],a.Exif=b.get_ifd(c,"Exif"));34853 in a["0th"]&&(c=a["0th"][34853],a.GPS=b.get_ifd(c,"GPS"));40965 in a.Exif&&
(c=a.Exif[40965],a.Interop=b.get_ifd(c,"Interop"));"\x00\x00\x00\x00"!=e&&(c=x(b.endian_mark+"L",e)[0],a["1st"]=b.get_ifd(c,"1st"),513 in a["1st"]&&514 in a["1st"]&&(b=b.tiftag.slice(a["1st"][513],a["1st"][513]+a["1st"][514]),a.thumbnail=b));return a},dump:function(d){var b=JSON.parse(JSON.stringify(d)),c=d=!1,e=!1,f=!1,k="0th"in b?b["0th"]:{};if("Exif"in b&&Object.keys(b.Exif).length||"Interop"in b&&Object.keys(b.Interop).length){k[34665]=1;d=!0;var q=b.Exif;if("Interop"in b&&Object.keys(b.Interop).length){q[40965]=
1;e=!0;var z=b.Interop}else-1<Object.keys(q).indexOf(a.ExifIFD.InteroperabilityTag.toString())&&delete q[40965]}else-1<Object.keys(k).indexOf(a.ImageIFD.ExifTag.toString())&&delete k[34665];if("GPS"in b&&Object.keys(b.GPS).length){k[a.ImageIFD.GPSTag]=1;c=!0;var n=b.GPS}else-1<Object.keys(k).indexOf(a.ImageIFD.GPSTag.toString())&&delete k[a.ImageIFD.GPSTag];if("1st"in b&&"thumbnail"in b&&null!=b.thumbnail){f=!0;b["1st"][513]=1;b["1st"][514]=1;var r=b["1st"]}var y=p(k,"0th",0),v=y[0].length+12*d+12*
c+4+y[1].length;k="";var E=0,h="",m=0,C="",l=0,L="",N;if(d){var J=p(q,"Exif",v);E=J[0].length+12*e+J[1].length}c&&(h=p(n,"GPS",v+E),h=h.join(""),m=h.length);e&&(C=p(z,"Interop",v+E+m),C=C.join(""),l=C.length);if(f){var P=p(r,"1st",v+E+m+l);for(N=A(b.thumbnail);"\u00ff\u00e0"<=N[1].slice(0,2)&&"\u00ff\u00ef">=N[1].slice(0,2);)N=[N[0]].concat(N.slice(2));N=N.join("");if(64E3<N.length)throw"Given thumbnail is too large. max 64kB";}r=z=b="";q="\x00\x00\x00\x00";if(d){n=B(">L",[8+v]);var M=B(">H",[34665]),
x=B(">H",[F.Long]),D=B(">L",[1]);b=M+x+D+n}c&&(n=B(">L",[8+v+E]),M=B(">H",[34853]),x=B(">H",[F.Long]),D=B(">L",[1]),z=M+x+D+n);e&&(n=B(">L",[8+v+E+m]),M=B(">H",[40965]),x=B(">H",[F.Long]),D=B(">L",[1]),r=M+x+D+n);f&&(c=8+v+E+m+l,q=B(">L",[c]),c="\u0002\u0001\x00\u0004\x00\x00\x00\u0001"+B(">L",[c+P[0].length+24+4+P[1].length]),e="\u0002\u0002\x00\u0004\x00\x00\x00\u0001"+B(">L",[N.length]),L=P[0]+c+e+"\x00\x00\x00\x00"+P[1]+N);P=y[0]+b+z+q+y[1];d&&(k=J[0]+r+J[1]);return"Exif\x00\x00MM\x00*\x00\x00\x00\b"+
P+k+h+C+L}};O.prototype={get_ifd:function(a,b){for(var c={},d=x(this.endian_mark+"H",this.tiftag.slice(a,a+2))[0],e=a+2,f=-1<["0th","1st"].indexOf(b)?"Image":b,p=0;p<d;p++){a=e+12*p;var q=x(this.endian_mark+"H",this.tiftag.slice(a,a+2))[0],n=x(this.endian_mark+"H",this.tiftag.slice(a+2,a+4))[0],r=x(this.endian_mark+"L",this.tiftag.slice(a+4,a+8))[0],y=this.tiftag.slice(a+8,a+12);n=[n,r,y];q in k[f]&&(c[q]=this.convert_value(n))}"0th"==b&&(a=e+12*d,c.first_ifd_pointer=this.tiftag.slice(a,a+4));return c},
convert_value:function(a){var b=a[0],c=a[1];a=a[2];if(1==b)4<c?(a=x(this.endian_mark+"L",a)[0],b=x(this.endian_mark+D("B",c),this.tiftag.slice(a,a+c))):b=x(this.endian_mark+D("B",c),a.slice(0,c));else if(2==b)4<c?(a=x(this.endian_mark+"L",a)[0],b=this.tiftag.slice(a,a+c-1)):b=a.slice(0,c-1);else if(3==b)2<c?(a=x(this.endian_mark+"L",a)[0],b=x(this.endian_mark+D("H",c),this.tiftag.slice(a,a+2*c))):b=x(this.endian_mark+D("H",c),a.slice(0,2*c));else if(4==b)1<c?(a=x(this.endian_mark+"L",a)[0],b=x(this.endian_mark+
D("L",c),this.tiftag.slice(a,a+4*c))):b=x(this.endian_mark+D("L",c),a);else if(5==b)if(a=x(this.endian_mark+"L",a)[0],1<c){b=[];for(var d=0;d<c;d++)b.push([x(this.endian_mark+"L",this.tiftag.slice(a+8*d,a+4+8*d))[0],x(this.endian_mark+"L",this.tiftag.slice(a+4+8*d,a+8+8*d))[0]])}else b=[x(this.endian_mark+"L",this.tiftag.slice(a,a+4))[0],x(this.endian_mark+"L",this.tiftag.slice(a+4,a+8))[0]];else if(7==b)4<c?(a=x(this.endian_mark+"L",a)[0],b=this.tiftag.slice(a,a+c)):b=a.slice(0,c);else if(10==b)if(a=
x(this.endian_mark+"L",a)[0],1<c)for(b=[],d=0;d<c;d++)b.push([x(this.endian_mark+"l",this.tiftag.slice(a+8*d,a+4+8*d))[0],x(this.endian_mark+"l",this.tiftag.slice(a+4+8*d,a+8+8*d))[0]]);else b=[x(this.endian_mark+"l",this.tiftag.slice(a,a+4))[0],x(this.endian_mark+"l",this.tiftag.slice(a+4,a+8))[0]];else throw"Exif might be wrong. Got incorrect value type to decode. type:"+b;return b instanceof Array&&1==b.length?b[0]:b}};if("undefined"!==typeof window&&"function"===typeof window.btoa)var f=window.btoa;
"undefined"===typeof f&&(f=function(a){for(var b="",c,d,e,f,k,p,n=0;n<a.length;)c=a.charCodeAt(n++),d=a.charCodeAt(n++),e=a.charCodeAt(n++),f=c>>2,c=(c&3)<<4|d>>4,k=(d&15)<<2|e>>6,p=e&63,isNaN(d)?k=p=64:isNaN(e)&&(p=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);
return b});if("undefined"!==typeof window&&"function"===typeof window.atob)var d=window.atob;"undefined"===typeof d&&(d=function(a){var b="",c=0;for(a=a.replace(/[^A-Za-z0-9\+\/=]/g,"");c<a.length;){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(c++));
d=d<<2|e>>4;e=(e&15)<<4|f>>2;var p=(f&3)<<6|k;b+=String.fromCharCode(d);64!=f&&(b+=String.fromCharCode(e));64!=k&&(b+=String.fromCharCode(p))}return b});var F={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},k={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",
type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",
type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",
type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},
334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},
351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},
531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",
type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",
type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},
50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",
type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",
type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",
type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",
type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",
type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",
type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",
type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},
34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",
type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",
type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",
type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",
type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",
type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},
12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",
type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};k["0th"]=k.Image;k["1st"]=k.Image;a.TAGS=k;a.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,
ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,
Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,
JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,
Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,
BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,
AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,
ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,
OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041};a.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,
BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,
FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,
LensModel:42036,LensSerialNumber:42037,Gamma:42240};a.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,
GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31};a.InteropIFD={InteroperabilityIndex:1};a.GPSHelper={degToDmsRational:function(a){var b=a%1*60;return[[Math.floor(a),1],[Math.floor(b),1],[Math.round(b%1*6E3),100]]},dmsRationalToDeg:function(a,b){return("S"===b||"W"===b?-1:1)*a[0][0]/a[0][1]+a[1][0]/a[1][1]/60+a[2][0]/a[2][1]/3600}};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=a),exports.piexif=
a):window.piexif=a})();var twcaLib=new twidCryptoLibSync,twcaCryptoLibAlertDialog=new TwcaCryptoLibAlertDialog,twcaDialogParams;
function twidCryptoLibSync(){function G(){if(!w)return!1;var a=!1;try{window.opener&&window.opener!=window&&window.opener.twcaLib&&window.location.hostname===window.opener.location.hostname&&(window.opener.twcaLib.setOpenWindowObject(window),a=!0)}catch(m){a=!1}return a}function q(a,c,e,l){function h(a,b,c,d,e,h){var l=forge.pkcs7.createSignedData();switch(c){case 0:l.content=forge.util.createBuffer(A(a),"raw");break;case 1:l.content=forge.util.createBuffer(a,"utf8");break;case 2:l.content="undefined"==
typeof Big5Encoding?forge.util.createBuffer(a,"utf8"):forge.util.createBuffer(Big5Encoding.getBig5Encoding(a),"raw");break;default:l.content=forge.util.createBuffer(A(a),"raw")}l.addCertificate(e);a={key:h,certificate:e,digestAlgorithm:b};k&&(a.authenticatedAttributes=[{type:forge.pki.oids.contentType,value:forge.pki.oids.data},{type:forge.pki.oids.messageDigest},{type:forge.pki.oids.signingTime}]);l.addSigner(a);l.sign();d=d?forge.pkcs7.messageToPem(l):forge.pkcs7.messageToPemWithoutContent(l);d=
d.replace(/\-----BEGIN PKCS7-----/g,"");d=d.replace(/\-----END PKCS7-----/g,"");return d=d.replace(/(?:\\[rn]|[\r\n]+)+/g,"")}var f="",g=null,m=null;if(null==b.selectedCertInfo||null!=c)O(c,e);else{switch(61440&l){case 0:c=forge.pki.oids.sha1;break;case 4096:c=forge.pki.oids.md5;break;case 8192:c=forge.pki.oids.sha256;break;case 16384:c=forge.pki.oids.sha512;break;default:c=forge.pki.oids.sha1}e=1024==(3840&l)?!1:!0;l&=15;var k=!1;g=d();m=g.oPrivateKey;g=g.oCert;if("string"===typeof a)f=h(a,c,l,e,
g,m);else if(Array.isArray(a)){f="";for(var n=0;n<a.length;n++)f=f+"||"+h(a[n],c,l,e,g,m);f=f.substring(2,f.length)}}return f}function K(a,c,e,l){function h(a,b,c,d,e){g=b.create();switch(c){case 0:g.update(A(a));break;case 1:g.update(a,"utf8");break;case 2:"undefined"==typeof Big5Encoding?g.update(a,"utf8"):g.update(Big5Encoding.getBig5Encoding(a));break;default:g.update(A(a))}return d?forge.util.bytesToHex(e.sign(g)):forge.util.encode64(e.sign(g))}var f=null,g=null;if(null==b.selectedCertInfo||
null!=c)O(c,e);else{switch(61440&l){case 0:c=forge.md.sha1;break;case 4096:c=forge.md.md5;break;case 8192:c=forge.md.sha256;break;case 16384:c=forge.md.sha512;break;default:c=forge.md.sha1}e=256==(3840&l)?!1:!0;l&=15;f=d().oPrivateKey;if("string"===typeof a)var m=h(a,c,l,e,f);else if(Array.isArray(a)){m="";for(var k=0;k<a.length;k++)m=m+"||"+h(a[k],c,l,e,f);m=m.substring(2,m.length)}}return m}function p(a,c,e){function h(a,b){var c=forge.asn1.oidToDer(forge.pki.oids[b]).getBytes(),d=forge.asn1.create(forge.asn1.Class.UNIVERSAL,
forge.asn1.Type.SEQUENCE,!0,[]),e=forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.SEQUENCE,!0,[]);e.value.push(forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.OID,!1,c));e.value.push(forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.NULL,!1,""));c=forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.OCTETSTRING,!1,forge.util.hexToBytes(a));d.value.push(e);d.value.push(c);return forge.asn1.toDer(d).getBytes()}function f(a){if(0>=a.length)return!1;for(var b=
!0,c=a[0].length,d=1;d<a.length;d++)if(a[d].length!=c){b=!1;break}return b}var g=null;do if(null==b.selectedCertInfo||null!=c)O(c,e);else{if("string"===typeof a)g=a.length;else{if(!f(a))break;g=a[0].length}switch(g){case 20:var m="md5";break;case 40:m="sha1";break;case 64:m="sha256";break;case 128:m="sha512"}g=d();if("string"===typeof a){p1Encoded=h(a,m);var k=forge.pki.rsa.encrypt(p1Encoded,g.oPrivateKey,1);k=forge.util.encode64(k)}else if(Array.isArray(a)){k="";for(var n=0;n<a.length;n++){p1Encoded=
h(a[n],m);var r=forge.pki.rsa.encrypt(p1Encoded,g.oPrivateKey,1);k=k+"||"+forge.util.encode64(r)}k=k.substring(2,k.length)}}while(0);return k}function O(b,c,d,l){var h=-1,g=[],m=null;var n=localStorage.getItem("TWCACertIdxRef");if(null==n)m={};else if(""==n)m={};else try{m=JSON.parse(n)}catch(ba){m={}}n=m;m={};var r=null,C="",p=!1,v=!1,y=!1;do{try{localStorage}catch(ba){h=5999;r=null;break}4096==(61440&d)&&(p=!0);4==(4&d)&&(v=!0);8==(8&d)&&(y=!0);var q=d&240;if(null==b||""==b)h=5005,r=null;else if("//S"!=
b.substring(0,3)&&"//I"!=b.substring(0,3)||"//"!=b.substring(b.length-2,b.length))h=5005,r=null;else if(null==c||""==c||14==c.length&&!isNaN(c)){var t=b.replace(/^\/\/|\/\/\s*$/g,"").replace(/\s*=\s*/gm,"=").split("//");for(var u=0;u<t.length;u++)g[u]=f(t[u]);if(F(g,5005)||""==g[0])h=5005,r=null;else{for(var E in n){t=n[E];t.certb64=JSON.parse(localStorage.getItem(E)).certb64;if(y)u=B(t,g);else{u=t;for(var w=g,x=a(u.certb64).subject,z=!1,A=0;A<w.length;A++){var K=!1;if(w[A].S_C==x.C&&(null==x.O||
null!=w[A].S_O&&w[A].S_O.length==x.O.length)){for(var G=0;null!=x.O&&G<x.O.length;G++)F(w[A].S_O,x.O[G])||(K=!0);if(!K&&(null==x.OU||null!=w[A].S_OU&&w[A].S_OU.length==x.OU.length)){for(G=0;null!=x.OU&&G<x.OU.length;G++)F(w[A].S_OU,x.OU[G])||(K=!0);if(!K&&w[A].S_CN==x.CN&&w[A].S_CS==u.cs){z=!0;break}}}}u=z}""!=c?t.notAfter<c&&(u=!1):v&&(w=D(new Date),t.notAfter<w&&(u=!1));u&&null!=localStorage.getItem(E)&&""!=localStorage.getItem(E)&&(m[E]=t)}for(var O in m)if(null==r)C=O,r=m[O];else switch(q){case 0:r.notBefore<=
m[O].notBefore&&(C=O,r=m[O]);break;case 16:r.notBefore<=m[O].notBefore&&(C=O,r=m[O]);break;case 32:r.notBefore>=m[O].notBefore&&(C=O,r=m[O]);break;case 64:r.notAfter<=m[O].notAfter&&(C=O,r=m[O]);break;case 128:r.notAfter>=m[O].notAfter&&(C=O,r=m[O]);break;default:r.notAfter<=m[O].notAfter&&(C=O,r=m[O])}if(null==r)h=5010,r=null;else if(r.b64P12Cert=JSON.parse(localStorage.getItem(C)).b64P12Cert,r.keySet=JSON.parse(localStorage.getItem(C)).keySet,r.certfinger=JSON.parse(localStorage.getItem(C)).certfinger,
r.certb64=JSON.parse(localStorage.getItem(C)).certb64,!p){sessionStorage.removeItem("twcaSelectedKey");if(r.b64P12Cert){q=l;t=null;try{t=forge.pkcs12.pkcs12FromAsn1(forge.asn1.fromDer(forge.util.decode64(r.b64P12Cert)),q)}catch(ba){}q=t;if(!q){h=5071;r=null;break}q=q.getBags({bagType:forge.pki.oids.pkcs8ShroudedKeyBag})[forge.pki.oids.pkcs8ShroudedKeyBag][0].key;if(!q){h=5071;r=null;break}JSON.stringify(e(q))}else if(r.keySet){q=k(r.keySet,l);if(!q){h=5071;r=null;break}JSON.stringify(e(q))}else{h=
5112;r=null;break}sessionStorage.setItem("twcaSelectedKey",forge.util.encode64(l))}}}else h=5005,rtnCodeInfo=null}while(0);return null!=r?r:h}function B(b,c){var d=a(b.certb64),e=d.subject;d=d.issuer;for(var h=!1,f=0;f<c.length;f++){var g=!0,m;for(m in c[f])if("S_SN"==m)c[f][m].toUpperCase()!=e.SN&&(g=!1);else if("S_CN"==m)0>e.CN.indexOf(c[f][m])&&(g=!1);else if("S_OU"==m)for(var k=0;k<c[f][m].length;k++)F(e.OU,c[f][m][k])||(g=!1);else if("S_O"==m)for(k=0;k<c[f][m].length;k++)F(e.O,c[f][m][k])||(g=
!1);else if("S_C"==m)c[f][m]!=e.C&&(g=!1);else if("I_CN"==m)c[f][m]!=d.CN&&(g=!1);else if("I_OU"==m)for(k=0;k<c[f][m].length;k++)F(d.OU,c[f][m][k])||(g=!1);else if("I_O"==m)for(k=0;k<c[f][m].length;k++)F(d.O,c[f][m][k])||(g=!1);else"I_C"==m?c[f][m]!=d.C&&(g=!1):"S_CS"==m&&c[f][m]!=b.cs&&(g=!1);if(h=h||g)break}return h}function x(a){return a?'"sn":"'+a.serial+'","cn":"'+a.cn+'","ntb":"'+a.notBefore+'","nta":"'+a.notAfter+'","issdn":"'+a.issuer+'","subdn":"'+a.subject+'","certfinger":"'+a.certfinger+
'","certb64":"'+a.certb64+'"':""}function D(a){var b=a.getFullYear();var c=a.getMonth()+1;var d=a.getDate();var e=a.getHours();var h=a.getMinutes();a=a.getSeconds();b="0000"+b;b=b.substring(b.length-4,b.length);c="00"+c;c=c.substring(c.length-2,c.length);d="00"+d;d=d.substring(d.length-2,d.length);e="00"+e;e=e.substring(e.length-2,e.length);h="00"+h;h=h.substring(h.length-2,h.length);a="00"+a;a=a.substring(a.length-2,a.length);return b+c+d+e+h+a}function A(a){for(var b=new Uint8Array(2*a.length),
c=0;c<a.length;c++){var d=a.charCodeAt(c);b[2*c]=d&255;b[2*c+1]=d>>8&255}a="";for(c=0;c<b.length;c++)a=16>b[c]?a+"%0":a+"%",a+=b[c].toString(16);return unescape(a)}function a(a){ret={};try{var b=forge.asn1.fromDer(forge.util.decode64(a));b=forge.pki.certificateFromAsn1(b)}catch(l){return null}ret.subject={};for(a=0;a<b.subject.attributes.length;a++){var c=b.subject.attributes[a];"C"==c.shortName&&(ret.subject.C=c.value);"O"==c.shortName&&(null==ret.subject.O&&(ret.subject.O=[]),ret.subject.O.push(c.value));
"OU"==c.shortName&&(null==ret.subject.OU&&(ret.subject.OU=[]),ret.subject.OU.push(c.value));"CN"==c.shortName&&(ret.subject.CN=c.value)}ret.subject.SN=b.serialNumber.toUpperCase();ret.issuer={};for(a=0;a<b.issuer.attributes.length;a++)c=b.issuer.attributes[a],"C"==c.shortName&&(ret.issuer.C=c.value),"O"==c.shortName&&(null==ret.issuer.O&&(ret.issuer.O=[]),ret.issuer.O.push(c.value)),"OU"==c.shortName&&(null==ret.issuer.OU&&(ret.issuer.OU=[]),ret.issuer.OU.push(c.value)),"CN"==c.shortName&&(ret.issuer.CN=
c.value);return ret}function f(a){for(var b={},c="S_CS S_CL S_SN S_CN S_OU S_O S_C I_CN I_OU I_O I_C".split(" ");0<a.length;){var d=a.substring(0,a.indexOf("="));if(!F(c,d))return 5005;a=a.substring(a.indexOf("=")+1,a.length);var e=a.length,h=a.indexOf(",S_"),f=a.indexOf(",I_");0<h&&h<e&&(e=h);0<f&&f<e&&(e=f);h=a.substring(0,e);"S_O"==d||"S_OU"==d||"I_O"==d||"I_OU"==d?(b[d]||(b[d]=[]),b[d].push(h)):b[d]=h;a=a.substring(e+1,a.length)}return b}function d(){var a={},c=sessionStorage.getItem("twcaSelectedKey");
if(b.selectedCertInfo.b64P12Cert){p12Cert=forge.pkcs12.pkcs12FromAsn1(forge.asn1.fromDer(forge.util.decode64(b.selectedCertInfo.b64P12Cert)),forge.util.decode64(c));var d=p12Cert.getBags({bagType:forge.pki.oids.pkcs8ShroudedKeyBag})[forge.pki.oids.pkcs8ShroudedKeyBag][0].key;c=p12Cert.getBags({bagType:forge.pki.oids.certBag})[forge.pki.oids.certBag];for(var e=0;e<c.length;e++){var f=c[e].cert;if(f.publicKey.n.data[0]==d.n.data[0]&&f.publicKey.n.data[1]==d.n.data[1]){oCert=p12Cert.getBags({bagType:forge.pki.oids.certBag})[forge.pki.oids.certBag][e].cert;
break}}oCert||(oCert=p12Cert.getBags({bagType:forge.pki.oids.certBag})[forge.pki.oids.certBag][0].cert)}else b.selectedCertInfo.keySet&&(oCert=forge.asn1.fromDer(forge.util.decode64(b.selectedCertInfo.certb64)),oCert=forge.pki.certificateFromAsn1(oCert),d=k(b.selectedCertInfo.keySet,forge.util.decode64(c)));a.oPrivateKey=d;a.oCert=oCert;return a}function F(a,b){for(var c in a)if(a[c]==b)return!0;return!1}function k(a,b,c){var d=null;try{if(3>arguments.length){var e=forge.md.sha256.create();e.update(b);
var h=e.digest().getBytes(),f=forge.cipher.createDecipher("AES-CBC",h);f.start({iv:""});f.update(forge.util.createBuffer(forge.util.decode64(a)));f.finish();var g=f.output.data.split("||");"TWCA"==g[8]&&(d=forge.pki.setRsaPrivateKey(new forge.jsbn.BigInteger(g[1],16),new forge.jsbn.BigInteger(g[0],16),new forge.jsbn.BigInteger(g[7],16),new forge.jsbn.BigInteger(g[2],16),new forge.jsbn.BigInteger(g[3],16),new forge.jsbn.BigInteger(g[4],16),new forge.jsbn.BigInteger(g[5],16),new forge.jsbn.BigInteger(g[6],
16)))}else d=forge.pki.setRsaPrivateKey(new forge.jsbn.BigInteger(c.n,16),new forge.jsbn.BigInteger(c.e,16),new forge.jsbn.BigInteger(c.d,16),new forge.jsbn.BigInteger(c.p,16),new forge.jsbn.BigInteger(c.q,16),new forge.jsbn.BigInteger(c.dP,16),new forge.jsbn.BigInteger(c.dQ,16),new forge.jsbn.BigInteger(c.qInv,16))}catch(M){d=null}return d}function e(a){if(a){var b={};b.n=a.n.toString(16);b.e=a.e.toString(16);b.d=a.d.toString(16);b.p=a.p.toString(16);b.q=a.q.toString(16);b.dP=a.dP.toString(16);b.dQ=
a.dQ.toString(16);b.qInv=a.qInv.toString(16);return b}}var b=this,c=null,u=null,g=null,t=!1;-1<navigator.userAgent.indexOf("TWID")&&(t=!0);var w=!0;this.SetParentDetect=function(a){w=a};this.SelectSignerEx=function(a,d,e,f,g,k,n,r,p){if(G()&&0==(k&15728640))c=[a,d,e,f,g,k,n,r,p],window.opener.twcaLib.SelectSignerEx(a,d,e,f,g,k,n,r,"oTwcaLib._childWindow.twcaLib.SelectSignerExFromChildWindowHandler");else{if(t)try{"undefined"==typeof p&&(p="ret_SelectSignerEx");var h=MobileUtils.registerFunction(p),
l=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SelectSignerEx(a,d,e,f,g,MobileUtils.toNumber(k),n,r,h),0):0<l.indexOf("iPhone")||0<l.indexOf("iPad")?(document.location="PKI::SelectSignerEx::"+encodeURI(a+separation+d+separation+e+separation+f+separation+g+separation+k+separation+n+separation+r+separation+h),0):1}catch(U){return alert(U),-1}if(4>=arguments.length)return O(a,g,k,f);h=0;l="\u6210\u529f";var m="",C=O(a,g,k,f);if("number"==typeof C)switch(C){case 5005:h=
5005;l="\u53c3\u6578\u932f\u8aa4";break;case 5010:h=5010;l="\u7121\u6191\u8b49";break;case 5071:if(null==f&&0>"oTwcaLib._childWindow.twcaLib.SelectSignerExFromChildWindowHandler".indexOf(p)){twcaCryptoLibAlertDialog.show("\u8f38\u5165\u5bc6\u78bc","\u8acb\u8f38\u5165\u6191\u8b49\u5bc6\u78bc","","\u53d6\u6d88","\u78ba\u8a8d",["SelectSignerEx",a,d,e,f,g,k,n,r,p,twcaLib]);return}h=5071;l="\u6191\u8b49\u5bc6\u78bc\u932f\u8aa4";break;case 5112:h=5112;l="\u8b80\u53d6\u6191\u8b49\u5931\u6557";break;case 5999:h=
5999;l="\u7121\u6cd5\u5b58\u53d6\u5132\u5b58\u5340";break;default:h=5001,l="\u4e00\u822c\u932f\u8aa4"}else 0==(k&61440)&&(b.selectedCertInfo=C,sessionStorage.setItem("selectedCertInfo",JSON.stringify(C))),m="{"+x(C)+"}";b.callback(p,h,l,m)}};this.SignPkcs7=function(a,d,e,f){if(G())c=[a,d,e],window.opener.twcaLib.SignPkcs7(a,d,"oTwcaLib._childWindow.twcaLib.SignPkcs7FromChildWindowHandler");else{if(t)try{"undefined"==typeof e&&(e="ret_SignPkcs7");var h=!1,l=a;if("[object Array]"===Object.prototype.toString.call(a)){h=
!0;for(index=0;index<a.length;++index){var g=forge.util.binary.raw.encode(forge.util.text.utf8.encode(a[index])),m=forge.util.binary.base64.encode(forge.util.binary.raw.decode(g));a[index]=m}l=a.join("#")}var k=MobileUtils.registerFunction(e),n=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(h?MobileUtils.androidInterface.SignPkcs7Batch(l,MobileUtils.toNumber(d),k):MobileUtils.androidInterface.SignPkcs7(l,MobileUtils.toNumber(d),k),0):0<n.indexOf("iPhone")||0<n.indexOf("iPad")?(document.location=
h?"PKI::SignPkcs7Batch::"+encodeURI(l+separation+d+separation+k):"PKI::SignPkcs7::"+encodeURI(l+separation+d+separation+k),0):1}catch(W){return alert(W),-1}if(4<=arguments.length)return q(a,d,e,f);h=0;l="\u6210\u529f";g="";if(null==a||0>=a.length)h=5005,l="\u53c3\u6578\u932f\u8aa4";else{if(m=sessionStorage.getItem("selectedCertInfo"))b.selectedCertInfo=JSON.parse(m);m=sessionStorage.getItem("twcaSelectedKey");b.selectedCertInfo&&null!=m?(m=q(a,null,null,d),null==m||""==m?(h=5061,l="\u7c3d\u7ae0\u5931\u6557"):
g="{"+x(b.selectedCertInfo)+',"signature":"'+m+'"}'):(h=5067,l="\u57f7\u884c\u7c3d\u7ae0\u6642\uff0c\u5c1a\u672a\u9078\u64c7\u7c3d\u7ae0\u6191\u8b49")}b.callback(e,h,l,g)}};this.SignPkcs1=function(a,d,e,f){if(G())c=[a,d,e],window.opener.twcaLib.SignPkcs1(a,d,"oTwcaLib._childWindow.twcaLib.SignPkcs1FromChildWindowHandler");else{if(t)try{"undefined"==typeof e&&(e="ret_SignPkcs1");var h=!1,l=a;if("[object Array]"===Object.prototype.toString.call(a)){h=!0;for(index=0;index<a.length;++index){var g=forge.util.binary.raw.encode(forge.util.text.utf8.encode(a[index])),
m=forge.util.binary.base64.encode(forge.util.binary.raw.decode(g));a[index]=m}l=a.join("#")}var k=MobileUtils.registerFunction(e),n=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(h?MobileUtils.androidInterface.SignPkcs1Batch(l,MobileUtils.toNumber(d),k):MobileUtils.androidInterface.SignPkcs1(l,MobileUtils.toNumber(d),k),0):0<n.indexOf("iPhone")||0<n.indexOf("iPad")?(document.location=h?"PKI::SignPkcs1Batch::"+encodeURI(l+separation+d+separation+k):"PKI::SignPkcs1::"+encodeURI(l+separation+
d+separation+k),0):1}catch(W){return alert(W),-1}if(4<=arguments.length)return K(a,d,e,f);h=0;l="\u6210\u529f";g="";if(null==a||0>=a.length)h=5005,l="\u53c3\u6578\u932f\u8aa4";else{if(m=sessionStorage.getItem("selectedCertInfo"))b.selectedCertInfo=JSON.parse(m);m=sessionStorage.getItem("twcaSelectedKey");b.selectedCertInfo&&null!=m?(m=K(a,null,null,d),null==m||""==m?(h=5061,l="\u7c3d\u7ae0\u5931\u6557"):g='{"signature":"'+m+'",'+x(b.selectedCertInfo)+"}"):(h=5067,l="\u57f7\u884c\u7c3d\u7ae0\u6642\uff0c\u5c1a\u672a\u9078\u64c7\u7c3d\u7ae0\u6191\u8b49")}b.callback(e,
h,l,g)}};this.SignPkcs1FromHash=function(a,d,e){if(G())c=[a,d],window.opener.twcaLib.SignPkcs1FromHash(a,"oTwcaLib._childWindow.twcaLib.SignPkcs1FromChildWindowHandler");else{if(t)try{"undefined"==typeof d&&(d="ret_SignPkcs1FromHash");var h=!1,f=a;if("[object Array]"===Object.prototype.toString.call(a)){h=!0;for(index=0;index<a.length;++index){var g=forge.util.binary.raw.encode(forge.util.text.utf8.encode(a[index])),m=forge.util.binary.base64.encode(forge.util.binary.raw.decode(g));a[index]=m}f=a.join("#")}var k=
MobileUtils.registerFunction(d),n=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(h?MobileUtils.androidInterface.SignPkcs1FromHashBatch(f,k):MobileUtils.androidInterface.SignPkcs1FromHash(f,k),0):0<n.indexOf("iPhone")||0<n.indexOf("iPad")?(document.location=h?"PKI::SignPkcs1FromHashBatch::"+encodeURI(f+separation+k):"PKI::SignPkcs1FromHash::"+encodeURI(f+separation+k),0):1}catch(T){return alert(T),-1}if(3<=arguments.length)return p(a,d,dwFlags2);h=0;f="\u6210\u529f";g="";if(null==a||
0>=a.length)h=5005,f="\u53c3\u6578\u932f\u8aa4";else{if(m=sessionStorage.getItem("selectedCertInfo"))b.selectedCertInfo=JSON.parse(m);m=sessionStorage.getItem("twcaSelectedKey");b.selectedCertInfo&&null!=m?(m=p(a,null,null),null==m||""==m?(h=5061,f="\u7c3d\u7ae0\u5931\u6557"):g=Array.isArray(m)?'{"signature":'+JSON.stringify(m)+","+x(b.selectedCertInfo)+"}":'{"signature":"'+m+'",'+x(b.selectedCertInfo)+"}"):(h=5067,f="\u57f7\u884c\u7c3d\u7ae0\u6642\uff0c\u5c1a\u672a\u9078\u64c7\u7c3d\u7ae0\u6191\u8b49")}b.callback(d,
h,f,g)}};this.ResetKey=function(a){if(G())c=[a],window.opener.twcaLib.ResetKey("oTwcaLib._childWindow.twcaLib.ResetKeyFromChildWindowHandler");else{if(t)try{"undefined"==typeof a&&(a="ret_ResetKey");var d=MobileUtils.registerFunction(a),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ResetKey(d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::ResetKey::"+encodeURI(d),0):1}catch(l){return alert(l),-1}b.selectedCertInfo=null;sessionStorage.removeItem("selectedCertInfo");
sessionStorage.removeItem("twcaSelectedKey");if(0>=arguments.length)return 0;b.callback(a,0,"\u6210\u529f","")}};this.GetVersion=function(a){if(G())c=[a],window.opener.twcaLib.GetVersion("oTwcaLib._childWindow.twcaLib.GetVersionFromChildWindowHandler");else{if(t)try{"undefined"==typeof a&&(a="ret_GetVersion");var d=MobileUtils.registerFunction(a),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.GetVersion(d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?
(document.location="PKI::GetVersion::"+encodeURI(d),0):1}catch(l){return alert(l),-1}if(0>=arguments.length)return"1.4.2.0";b.callback(a,0,"\u6210\u529f",'{"version":"1.4.2.0"}')}};this.Hash=function(a,c,d){try{"undefined"==typeof d&&(d="ret_Hash");var e=MobileUtils.registerFunction(d),h=navigator.userAgent;if(MobileUtils.supportTwidAndroid())return MobileUtils.androidInterface.Hash(a,MobileUtils.toNumber(c),e),0;if(0<h.indexOf("iPhone")||0<h.indexOf("iPad"))return document.location="PKI::Hash::"+
encodeURI(a+separation+c+separation+e),0;e=null;h="";var f=performance.now();switch(61440&c){case 0:var g=forge.md.sha1;break;case 4096:g=forge.md.md5;break;case 8192:g=forge.md.sha256;break;case 16384:g=forge.md.sha512;break;default:g=forge.md.sha1}var m=g.create();switch(15&c){case 0:m.update(A(a));break;case 1:m.update(a,"utf8");break;case 2:"undefined"==typeof Big5Encoding?m.update(a,"utf8"):m.update(Big5Encoding.getBig5Encoding(a));break;default:m.update(A(a))}e=m.digest().toHex();var k=performance.now();
h='{"hashValue":"'+e+'","time":"'+(k-f)+'","length":"'+a.length+'","length":"'+a.length+'"}';if(3<=arguments.length)b.callback(d,0,"\u6210\u529f",h);else return h}catch(T){return alert(T),-1}};this.Hmac=function(a,c,d,e){var h=0,f="\u6210\u529f",l="";switch(d){case 1:d="md5";break;case 3:d="sha256";break;default:d="sha1"}a=forge.util.binary.raw.encode(forge.util.binary.hex.decode(a));var g=forge.hmac.create();g.start(d,a);g.update(forge.util.binary.raw.encode(forge.util.text.utf16.encode(c)));(c=
forge.util.binary.base64.encode(forge.util.binary.raw.decode(g.getMac().getBytes())))?l='{"hmacValue":"'+c+'"}':(h=5001,f="\u932f\u8aa4");"string"===typeof e?b.callback(e,h,f,l):e(h,f,"",l);return 0};this.CreatePKCS7FromSignedData=function(a,c,d,e,f){var h=0,l="\u6210\u529f",m="",k=performance.now();a:{var n=null;if(a&&c&&d){switch(61440&e){case 0:var r=forge.pki.oids.sha1;break;case 4096:r=forge.pki.oids.md5;break;case 8192:r=forge.pki.oids.sha256;break;case 16384:r=forge.pki.oids.sha512;break;default:r=
forge.pki.oids.sha1}switch(15&e){case 0:var p=forge.util.createBuffer(A(a),"raw");break;case 1:p=forge.util.createBuffer(a,"utf8");break;case 2:p="undefined"==typeof Big5Encoding?forge.util.createBuffer(a,"utf8"):forge.util.createBuffer(Big5Encoding.getBig5Encoding(a),"raw");break;default:p=forge.util.createBuffer(A(a),"raw")}try{n=forge.asn1.fromDer(forge.util.decode64(c)),n=forge.pki.certificateFromAsn1(n)}catch(Z){p7Value={errCode:2,errMsg:"\u6191\u8b49\u89e3\u6790\u932f\u8aa4"};break a}if(c!=
g){var v=forge.pkcs7.createSignedData();v.content=p;v.addCertificate(n);v.addSigner({key:"-----BEGIN RSA PRIVATE KEY-----MIIEowIBAAKCAQBbE4weWXGL8ehZU2UsCeRRBcU6S09/ph5IW4QtZKic1GDnanM1Ur/ohPHQsFLg6xBFiIBGPz/96eGAlg/NjcU/D3S4OmEF9PLxOT+Vg3I+dRZjmXFRrlfkmZ4ATNbZI4gzTrPUN9CV1soNlWQ/ClAniF+mqHLYFBXUhk8BCyV8j1SNp4sdiO4fHHCRZp44ppqRyG4op5/c9DUjeAsi4qgQyvxpO5lxzBZ73IkQ2aP/DKMF8rjKxKWM3JjInadcru/aAUO5TimDUrSMCaGYo5fzjqTCGD4iuz3J3tFoh20Z7H7s/kj4YK2l+YXbemCp0F13o70Hyb21Z87YqCzber5RAgMBAAECggEAMKI7jGlOzOAcprZ1rBKMLQfbzckxZoSaXyEfb+30a+qs5GZfpvXNLKjxR/MgDqL3SWoetWRJE5m0pSl8vtMZpRbnyQjDjp7CrDVZ0skiVF/J2N2zOV7T6GpviNF/WOw0atF4DbbQV3Me6ioAIfmr27BjA2eoC+KN1bLytSfymJR8G0CktovhhkD3wUZVuTcUGbg0yyif74y9dwmnHOQbOMdSWIHuIpTzQSGelRoQCmbLmhE2hAbIlT5mz6vFZCSmgTFSPk87sonHaFrBeesu5ut8LG686s97n78oPz27U/ek7lV/Cj/UJeljuRM5tDoCJJKkTB+0xsNrfNayWEQcwQKBgQCyGWMsRw1tprYqXp7nLS/nja6qf3bIs/IwtO1wsxmmtxXcXnb+/D285mUDsEelPB0AXJcOe1SP0fDFB1HMAFlJ5hWATbUveSEk5U2L+LjeREhCDlH0MJBDBc+vixo8MoHXq3sjpe3/HP76V+fvUOSx7vtasGG1I4fGUDMxLhbLzQKBgQCC6c0L4+idGcg5P7KvHlSwYHHKbLpuDiRNnSjqgQZ7EUxohYOCOk9tLFPaxMhhzgjI5hFPY48+Kv8NCCzzNWc25VI82qFcG6a8Mw1bUXb2/8/FKhUqTdaLlOZuVZW6LobxEM4Z4hEUnLfgrFbvlMKopbynwZ82UK5rm25Y0i6glQKBgQCobAm1HZw9TaKHfuOWisz6lKnQ4qlaM5GdLfw8z6I6Xnl15H9zsuZPdTGhw1p9j9N9PBI9x7O4LjkamkloOgw2Lje3FcV6F3qYgaBL9fIdf0U18oTd/+7s8tnskAdHVhwj8C6LD6d50dnutKLJVh5vhih9Ir/DpM4JZF6E66jzIQKBgGQy8RcltJfx8NcokuoIDAgHeXDW8YZk2pJxNKzwXnZ5kgL6FeLqIHrOD8yFC14YpY6m0R7zc+LAZACkfksUV9CjiuM674AhRegMJy/61VRODce54wNDGnAxYoGWjgg3rl76XtVeu3YMUYzsO4oaUTdly1SXFPYsoKOKDtZ64OdVAoGBAK14Yk03Hr8fR3F0uqmt8uu9GN7tNfzvifRPYQ+/sfMUDG1C2+gh/roSKnHX8p1Wwtf26cv5Klq5ySxUT3NxJErf1I7voDiLVM4pmq8DKiebsl/8QbJv3e3DMbGqiRAmfRNJqb7UcQsDEWORFt7U9XcCncCzIBuO2ETzDQshlcNE-----END RSA PRIVATE KEY-----",
certificate:n,digestAlgorithm:r});v.sign();u=v;g=c}else if(v=u,v.content=p,v.contentInfo=null,v.contentInfo=forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.SEQUENCE,!0,[forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.OID,!1,forge.asn1.oidToDer(forge.pki.oids.data).getBytes())]),"content"in v){var y;v.content instanceof forge.util.ByteBuffer?y=v.content.bytes():"string"===typeof v.content&&(y=forge.util.encodeUtf8(v.content));v.contentInfo.value.push(forge.asn1.create(forge.asn1.Class.CONTEXT_SPECIFIC,
0,!0,[forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.OCTETSTRING,!1,y)]))}v.signers[0].signature=forge.util.decode64(d);n=forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.SEQUENCE,!0,[forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.INTEGER,!1,forge.asn1.integerToDer(v.signers[0].version).getBytes()),forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.SEQUENCE,!0,[forge.pki.distinguishedNameToAsn1({attributes:v.signers[0].issuer}),forge.asn1.create(forge.asn1.Class.UNIVERSAL,
forge.asn1.Type.INTEGER,!1,forge.util.hexToBytes(v.signers[0].serialNumber))]),forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.SEQUENCE,!0,[forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.OID,!1,forge.asn1.oidToDer(v.signers[0].digestAlgorithm).getBytes()),forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.NULL,!1,"")])]);v.signers[0].authenticatedAttributesAsn1&&n.value.push(v.signers[0].authenticatedAttributesAsn1);n.value.push(forge.asn1.create(forge.asn1.Class.UNIVERSAL,
forge.asn1.Type.SEQUENCE,!0,[forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.OID,!1,forge.asn1.oidToDer(v.signers[0].signatureAlgorithm).getBytes()),forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.NULL,!1,"")]));n.value.push(forge.asn1.create(forge.asn1.Class.UNIVERSAL,forge.asn1.Type.OCTETSTRING,!1,v.signers[0].signature));if(0<v.signers[0].unauthenticatedAttributes.length){r=forge.asn1.create(forge.asn1.Class.CONTEXT_SPECIFIC,1,!0,[]);for(p=0;p<v.signers[0].unauthenticatedAttributes.length;++p)r.values.push(_attributeToAsn1(v.signers[0].unauthenticatedAttributes[p]));
n.value.push(r)}v.signerInfos[0]=n;signValue=forge.pkcs7.messageToPem(v);signValue=signValue.replace(/\-----BEGIN PKCS7-----/g,"");signValue=signValue.replace(/\-----END PKCS7-----/g,"");p7Value=signValue=signValue.replace(/(?:\\[rn]|[\r\n]+)+/g,"")}else p7Value={errCode:2,errMsg:"\u53c3\u6578\u932f\u8aa4"}}v=performance.now();"string"!=typeof p7Value?(h=p7Value.errCode,l=p7Value.errMsg):m='{"p7Value":"'+p7Value+'","time":"'+(v-k)+'","length":"'+a.length+'","length":"'+a.length+'"}';if(5<=arguments.length)b.callback(f,
h,l,m);else return m};this.EncrytAESCBC=function(a,c,d){var e=0,h="\u6210\u529f";var f="";do{var g=/[^A-Fa-f0-9]/;if(64!=c.length||0>=a.length||g.test(a)||g.test(c))e=5005,h="\u53c3\u6578\u932f\u8aa4";else{try{var m=forge.util.binary.raw.encode(forge.util.binary.hex.decode(a));var k=forge.util.binary.raw.encode(forge.util.binary.hex.decode(c))}catch(W){e=5005;h="\u53c3\u6578\u932f\u8aa4";break}f=m;var n=k;g=forge.util.createBuffer(new Uint8Array(16),"raw");n=forge.cipher.createCipher("AES-CBC",n);
n.start({iv:g});n.update(forge.util.createBuffer(f,"raw"));n.finish();f=n.output.toHex();f='{"encryptedHexString":"'+f+'","key":"'+c+'","plain":"'+a+'"}'}}while(0);if(3<=arguments.length)b.callback(d,e,h,f);else return""==f?e:f};this.DecrytAESCBC=function(a,c,d){var e=0,h="\u6210\u529f",f="";do{var g=/[^A-Fa-f0-9]/;if(64!=c.length||0>=a.length||g.test(a)||g.test(c))e=5005,h="\u53c3\u6578\u932f\u8aa4";else{try{var m=forge.util.binary.raw.encode(forge.util.binary.hex.decode(a));var k=forge.util.binary.raw.encode(forge.util.binary.hex.decode(c))}catch(Y){e=
5005;h="\u53c3\u6578\u932f\u8aa4";break}g=m;var n=k,r=forge.util.createBuffer(new Uint8Array(16),"raw");n=forge.cipher.createDecipher("AES-CBC",n);n.start({iv:r});n.update(forge.util.createBuffer(g,"raw"));g=n.finish()?n.output.toHex():null;null==g?(e=5080,h="\u52a0\u89e3\u5bc6\u5931\u6557"):f='{"plainString":"'+g+'","key":"'+c+'","encrypted":"'+a+'"}'}}while(0);if(3<=arguments.length)b.callback(d,e,h,f);else return 0==e?f:e};if(t)this.CheckCert=function(a,b,c){try{"undefined"==typeof c&&(c="ret_CheckCert");
var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CheckCert(a,b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::CheckCert::"+encodeURI(a+separation+b+separation+d),0):1}catch(N){return alert(N),-1}},this.MakeCSR=function(a,b,c,d,e,f){try{"undefined"==typeof f&&(f="ret_MakeCSR");var h=MobileUtils.registerFunction(f),g=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.MakeCSR(MobileUtils.toNumber(a),
b,c,d,MobileUtils.toNumber(e),h),0):0<g.indexOf("iPhone")||0<g.indexOf("iPad")?(document.location="PKI::MakeCSR::"+encodeURI(a+separation+b+separation+c+separation+d+separation+e+separation+h),0):1}catch(M){return alert(M),-1}},this.MakeCSREx=function(a,b,c,d,e,f,g){try{"undefined"==typeof g&&(g="ret_MakeCSREx");var h=MobileUtils.registerFunction(g),l=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.MakeCSREx(MobileUtils.toNumber(a),b,c,d,MobileUtils.toNumber(e),
JSON.stringify(f),h),0):0<l.indexOf("iPhone")||0<l.indexOf("iPad")?(document.location="PKI::MakeCSREx::"+encodeURI(a+separation+b+separation+c+separation+d+separation+e+separation+JSON.stringify(f)+separation+h),0):1}catch(T){return alert(T),-1}},this.ImportCert=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_ImportCert");var h=MobileUtils.registerFunction(e),f=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ImportCert(a,b,c,d,h),0):0<f.indexOf("iPhone")||
0<f.indexOf("iPad")?(document.location="PKI::ImportCert::"+encodeURI(a+separation+b+separation+c+separation+d+separation+h),0):1}catch(P){return alert(P),-1}},this.ChangePIN=function(a,b,c,d,e,f){try{"undefined"==typeof f&&(f="ret_ChangePIN");var h=MobileUtils.registerFunction(f),g=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ChangePIN(a,b,c,d,e,h),0):0<g.indexOf("iPhone")||0<g.indexOf("iPad")?(document.location="PKI::ChangePIN::"+encodeURI(a+separation+
b+separation+c+separation+d+separation+e+separation+h),0):1}catch(M){return alert(M),-1}},this.DeleteCert=function(a,b,c){try{"undefined"==typeof c&&(c="ret_DeleteCert");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.DeleteCert(a,b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::DeleteCert::"+encodeURI(a+separation+b+separation+d),0):1}catch(N){return alert(N),-1}},this.QueryDeviceID=function(a,
b,c){try{"undefined"==typeof c&&(c="ret_QueryDeviceID");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.QueryDeviceID(a,b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::QueryDeviceID::"+encodeURI(a+separation+b+separation+d),0):1}catch(N){return alert(N),-1}},this.DeleteBrowserCert=function(a,b,c){try{var d=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.DeleteBrowserCert(a,
b,c),0):0<d.indexOf("iPhone")||0<d.indexOf("iPad")?(document.location="PKI::DeleteBrowserCert::"+encodeURI(a+separation+b+separation+c),0):1}catch(L){return alert(L),-1}},this.CertEncryptPkcs7=function(a,b,c,d){try{var e=MobileUtils.registerFunction(d),f=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CertEncryptPkcs7(a,b,MobileUtils.toNumber(c),e),0):0<f.indexOf("iPhone")||0<f.indexOf("iPad")?(document.location="PKI::CertEncryptPkcs7::"+encodeURI(a+separation+
b+separation+c+separation+e),0):1}catch(J){return alert(J),-1}},this.SymEncrypt=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_SymEncrypt");var f=MobileUtils.registerFunction(e),h=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SymEncrypt(a,b,c,MobileUtils.toNumber(d),f),0):0<h.indexOf("iPhone")||0<h.indexOf("iPad")?(document.location="PKI::SymEncrypt::"+encodeURI(a+separation+b+separation+c+separation+d+separation+f),0):1}catch(P){return alert(P),
-1}},this.SymDecrypt=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_SymDecrypt");var f=MobileUtils.registerFunction(e),h=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SymDecrypt(a,b,c,MobileUtils.toNumber(d),f),0):0<h.indexOf("iPhone")||0<h.indexOf("iPad")?(document.location="PKI::SymDecrypt::"+encodeURI(a+separation+b+separation+c+separation+d+separation+f),0):1}catch(P){return alert(P),-1}},this.ChangeWeb=function(a,b,c){try{"undefined"==typeof c&&
(c="ret_ChangeWeb");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ChangeWeb(MobileUtils.toNumber(a),b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::ChangeWeb::"+encodeURI(a+separation+b+separation+d),0):1}catch(N){return alert(N),-1}},this.SetErrorCode=function(a,b,c){try{"undefined"==typeof c&&(c="ret_SetErrorCode");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?
(MobileUtils.androidInterface.SetErrorCode(MobileUtils.toNumber(a),b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::SetErrorCode::"+encodeURI(a+separation+b+separation+d),0):1}catch(N){return alert(N),-1}},this.ExitWebview=function(){try{var a=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ExitWebview(),0):0<a.indexOf("iPhone")||0<a.indexOf("iPad")?(document.location="PKI::ExitWebview::",0):1}catch(m){return alert(m),-1}},this.ExitWebview2=
function(a){try{var b=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ExitWebview2(a),0):0<b.indexOf("iPhone")||0<b.indexOf("iPad")?(document.location="PKI::ExitWebview2::"+encodeURI(a),0):1}catch(C){return alert(C),-1}},this.CheckCert=function(a,b,c){try{"undefined"==typeof c&&(c="ret_CheckCert");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CheckCert(a,b,d),0):0<e.indexOf("iPhone")||
0<e.indexOf("iPad")?(document.location="PKI::CheckCert::"+encodeURI(a+separation+b+separation+d),0):1}catch(N){return alert(N),-1}},this.OpenBrowser=function(a,b){try{var c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(b?MobileUtils.androidInterface.OpenBrowser(a,b):MobileUtils.androidInterface.OpenBrowser(a),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location=b?"PKI::OpenBrowser::"+encodeURI(a+separation+b):"PKI::OpenBrowser::"+encodeURI(a),0):1}catch(l){return alert(l),
-1}},this.OpenBrowser2=function(a,b){try{var c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.OpenBrowser2(a,b),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location="PKI::OpenBrowser2::"+encodeURI(a+separation+b),0):1}catch(l){return alert(l),-1}},this.SetData=function(a){try{var b=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SetData(a),0):0<b.indexOf("iPhone")||0<b.indexOf("iPad")?(document.location=
"PKI::SetData::"+encodeURI(a),0):1}catch(C){return alert(C),-1}},this.GetData=function(a){try{"undefined"==typeof a&&(a="ret_GetData");var b=MobileUtils.registerFunction(a),c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.GetData(b),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location="PKI::GetData::"+encodeURI(b),0):1}catch(l){return alert(l),-1}},this.GetServerAuth=function(a){try{"undefined"==typeof a&&(a="ret_GetServerAuth");var b=MobileUtils.registerFunction(a),
c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.GetServerAuth(b),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location="PKI::GetServerAuth::"+encodeURI(b),0):1}catch(l){return alert(l),-1}},this.VerifyServerResponse=function(a,b){try{"undefined"==typeof b&&(b="ret_VerifyServerResponse");var c=MobileUtils.registerFunction(b),d=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.VerifyServerResponse(a,c),0):
0<d.indexOf("iPhone")||0<d.indexOf("iPad")?(document.location="PKI::VerifyServerResponse::"+encodeURI(a+separation+c),0):1}catch(L){return alert(L),-1}},this.ManageLocalAuth=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_ManageLocalAuth");var f=MobileUtils.registerFunction(e),h=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ManageLocalAuth(a,b,c,d,f),0):0<h.indexOf("iPhone")||0<h.indexOf("iPad")?(document.location="PKI::ManageLocalAuth::"+encodeURI(a+
separation+b+separation+c+separation+d+separation+f),0):1}catch(P){return alert(P),-1}},this.CertProcessDone=function(){try{var a=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CertProcessDone(),0):0<a.indexOf("iPhone")||0<a.indexOf("iPad")?(document.location="PKI::CertProcessDone",0):1}catch(m){return alert(m),-1}},this.DecryptAndShowPdf=function(a,b,c,d){try{"undefined"==typeof d&&(d="ret_DecryptAndShowPdf");var e=MobileUtils.registerFunction(d),f=navigator.userAgent;
return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.DecryptAndShowPdf(a,b,c,e),0):0<f.indexOf("iPhone")||0<f.indexOf("iPad")?(document.location="PKI::DecryptAndShowPdf::"+encodeURI(a+separation+b+separation+c+separation+e),0):1}catch(J){return alert(J),-1}};else{var z=function(a){var b=null;if(a){b="";if("C"==a.attributes[0].shortName)for(var c=0;c<a.attributes.length;c++)b=b+a.attributes[c].shortName+"="+a.attributes[c].value+", ";else for(c=a.attributes.length-1;0<=c;c--)b=b+a.attributes[c].shortName+
"="+a.attributes[c].value+", ";2<b.length&&(b=b.substring(0,b.length-2))}return b},n=function(a,b){var c=null;try{c=forge.pkcs12.pkcs12FromAsn1(forge.asn1.fromDer(forge.util.decode64(a)),b)}catch(l){}return c},r=function(a,b){if("undefined"===typeof localStorage)return!1;var c="TWCA"+(new Date).getTime().toString(),d=null;if(null==localStorage.getItem("TWCACertIdxRef"))d={};else if(""==localStorage.getItem("TWCACertIdxRef"))d={};else try{d=JSON.parse(localStorage.getItem("TWCACertIdxRef"))}catch(M){d=
{}}for(var e in d)if(d[e].issuer==a.issuer){var f=a.cn.replace(/^\s+|\s+$/,"").replace(/^0*/,"").toUpperCase().split("-")[0],h=d[e].cn.replace(/^\s+|\s+$/,"").replace(/^0*/,"").toUpperCase().split("-")[0],g=d[e].cs;g||(g="");b||(b="");f==h&&g===b&&(d[e]=null,delete d[e],localStorage.removeItem(e))}d[c]={cn:a.cn,issuer:a.issuer,subject:a.subject,serial:a.serial,notBefore:a.notBefore,notAfter:a.notAfter,cs:a.cs};try{localStorage.setItem("TWCACertIdxRef",JSON.stringify(d)),localStorage.setItem(c,JSON.stringify(a))}catch(M){return!1}return c},
y=function(a,b,c){if(!a)return null;var d={};d.serial=a.serialNumber.toUpperCase();d.issuer=z(a.issuer);d.subject=z(a.subject);d.notBefore=D(new Date(a.validity.notBefore));d.notAfter=D(new Date(a.validity.notAfter));if(0<d.subject.length&&0<=d.subject.indexOf("CN=")){var e=d.subject.substring(d.subject.indexOf("CN=")+3,d.subject.length),f=e.length;0<=e.indexOf(", ")&&(f=e.indexOf(", "));d.cn=e.substring(0,f)}a=forge.pki.certificateToPem(a);a=a.replace(/\-----BEGIN CERTIFICATE-----/g,"");a=a.replace(/\-----END CERTIFICATE-----/g,
"");a=a.replace(/(?:\\[rn]|[\r\n]+)+/g,"");d.certb64=a;e=forge.md.sha1.create();e.update(forge.util.decode64(a));d.certfinger=e.digest().toHex();d.b64P12Cert=b;d.cs=c?c:"";return d},v=function(a,b){for(var c=[],d=b.replace(/^\/\/|\/\/\s*$/g,"").replace(/\s*=\s*/gm,"=").split("//"),e=0;e<d.length;e++)c[e]=f(d[e]);return B(a,c)},E=function(a,b){var c=!1;if(!(b&&a&&a.subject&&a.subject.attributes))return c;for(var d=0;d<a.subject.attributes.length;d++){var e=a.subject.attributes[d];e&&e.value&&0<=e.value.indexOf(b)&&
(c=!0)}return c};this.QueryDeviceID=function(a,c,d){function e(){function a(){return Math.floor(65536*(1+getRandomValues())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function f(){if(-1<navigator.platform.indexOf("Win"))var a="PC";else-1<navigator.platform.indexOf("Mac")?a="PC":navigator.userAgent.match(/iPhone/i)?a="IP":navigator.userAgent.match(/iPad/i)?a="IA":navigator.userAgent.match(/Android/i)?(a="GP",navigator.userAgent.match(/Mobile/i)||(a="GA")):a="";return a}
a=0;var g="\u6210\u529f",h="";try{try{localStorage}catch(T){a=5999;g="\u7121\u6cd5\u5b58\u53d6\u5132\u5b58\u5340:, userAgent:"+navigator.userAgent;b.callback(d,a,g,h);return}"undefined"==typeof d&&(d="ret_QueryDeviceID");if(c){var k=localStorage.getItem("TWCAAccountUqiDeviceID");k?(k=JSON.parse(k),k[c]||(k[c]=e()+"-"+(new Date).getTime(),localStorage.setItem("TWCAAccountUqiDeviceID",JSON.stringify(k))),m=k[c]):(m=e()+"-"+(new Date).getTime(),k={},k[c]=m,localStorage.setItem("TWCAAccountUqiDeviceID",
JSON.stringify(k)))}else{var m=localStorage.getItem("TWCABrowserUqiDeviceID");m||(m=e()+"-"+(new Date).getTime(),localStorage.setItem("TWCABrowserUqiDeviceID",m))}h='{"deviceType":"'+f()+'","deviceId":"'+m+'","osVersion":"","appVersion":""}'}catch(T){console.error(T),a=5999,g="\u8b80\u53d6DeviceID\u5931\u6557:"+T.message+", userAgent:"+navigator.userAgent}b.callback(d,a,g,h)};this.MakeCSR=function(a,c,d,e,f){function g(a,c){var d=forge.pki.rsa.generateKeyPair({bits:2048,e:65537});null==d?b.callback(f,
5065,"\u7522\u751f\u91d1\u9470\u5931\u6557",""):l(d.privateKey,d.publicKey,a,c)}function h(a,b,c){a=forge.pki.privateKeyFromAsn1(forge.asn1.fromDer(forge.util.createBuffer(a)));var d=forge.pki.setRsaPublicKey(a.n,a.e);l(a,d,b,c)}function l(a,c,e,g){var h=forge.pki.encryptRsaPrivateKey(a,d),l=forge.pki.createCertificationRequest();l.publicKey=c;e&&l.setSubject([{name:"commonName",value:e}]);l.sign(a,g);l=forge.pki.certificationRequestToPem(l);h=h.replace(/(?:\\[rn]|[\r\n]+)+/g,"");h=h.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----",
"");h=h.replace("-----END ENCRYPTED PRIVATE KEY-----","");l=l.replace(/(?:\\[rn]|[\r\n]+)+/g,"");l=l.replace("-----BEGIN CERTIFICATE REQUEST-----","");l=l.replace("-----END CERTIFICATE REQUEST-----","");n='{"b64Key":"'+h+'","csr":"'+l+'"}';b.callback(f,0,"\u6210\u529f",n)}var k=0,m="\u6210\u529f",n="";if(d)if(1024!=a&&2048!=a&&4096!=a)k=5005,m="\u53c3\u6578\u932f\u8aa4\uff0c\u4e0d\u652f\u63f4\u7684\u91d1\u9470\u9577\u5ea6";else if(0!=c&&512!=c&&1024!=c)k=5005,m="\u53c3\u6578\u932f\u8aa4\uff0c\u4e0d\u652f\u63f4\u7684\u6f14\u7b97\u6cd5";
else{switch(c){case 0:c="SHA-1";var r=forge.md.sha1.create();break;case 512:c="SHA-256";r=forge.md.sha256.create();break;case 768:c="SHA-512";r=forge.md.sha512.create();break;default:c="SHA-256",r=forge.md.sha256.create()}a={name:"RSASSA-PKCS1-v1_5",modulusLength:a,publicExponent:new Uint8Array([1,0,1]),hash:{name:c}};try{if(window.crypto)if(crypto.subtle&&crypto.subtle.generateKey)crypto.subtle.generateKey(a,!0,["sign","verify"]).then(function(a){return crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(function(a){h(a,
e,r)})["catch"](function(a){console.error(a);g(e,r)});else{g(e,r);return}else if(window.msCrypto){var v=window.msCrypto.subtle.generateKey(a,!0,["sign","verify"]);v.onerror=function(a){console.log("genOp.onerror event handler fired.");g(e,r)};v.oncomplete=function(a){a=window.msCrypto.subtle.exportKey("pkcs8",a.target.result.privateKey);a.onerror=function(a){console.log("expOp.onerror event handler fired.");g(e,r)};a.oncomplete=function(a){h(a.target.result,e,r)}}}else{g(e,r);return}}catch(U){g(e,
r);return}}else k=5005,m="\u53c3\u6578\u932f\u8aa4\uff0c\u5bc6\u78bc\u4e0d\u53ef\u7a7a\u767d";0!=k&&b.callback(f,k,m,n)};this.ImportCert=function(a,c,d,e,f,g){var h=0,l="\u6210\u529f",k="";if(a&&c&&d&&e&&g){if(0<=a.indexOf("::")){a=a.split("::");var m=a[0];var n=a[1]}else m=a;0>e.indexOf("-----BEGIN CERTIFICATE-----")&&(e="-----BEGIN CERTIFICATE-----"+e);0>e.indexOf("-----END CERTIFICATE-----")&&(e+="-----END CERTIFICATE-----");0>d.indexOf("-----BEGIN ENCRYPTED PRIVATE KEY-----")&&(d="-----BEGIN ENCRYPTED PRIVATE KEY-----"+
d);0>d.indexOf("-----END ENCRYPTED PRIVATE KEY-----")&&(d+="-----END ENCRYPTED PRIVATE KEY-----");try{try{e=forge.pki.certificateFromPem(e)}catch(I){e=e.replace("CERTIFICATE","PKCS7");e=e.replace("CERTIFICATE","PKCS7");var p=forge.pkcs7.messageFromPem(e).certificates;for(a=0;a<p.length&&(e=p[a],!E(p[a],m));a++);}d=forge.pki.decryptRsaPrivateKey(d,c);p=!1;if(d&&e&&d.n.data&&e.publicKey.n.data&&d.n.data.length==e.publicKey.n.data.length){for(a=0;a<e.publicKey.n.data.length&&d.n.data[a]==e.publicKey.n.data[a];a++);
p=!0}if(p)if(E(e,m)){var q=forge.pkcs12.toPkcs12Asn1(d,e,c,{algorithm:"3des"}),t=forge.asn1.toDer(q).getBytes(),C=forge.util.encode64(t),u=y(e,C,n);v(u,f)?r(u,n)?k="{"+x(u)+"}":(h=5110,l="\u5132\u5b58\u6191\u8b49\u5931\u6557"):(h=5115,l="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u689d\u4ef6\u4e0d\u7b26")}else h=5115,l="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u8207\u4f7f\u7528\u8005\u4e0d\u7b26";else h=5115,l="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u8207\u91d1\u9470\u4e0d\u7b26"}catch(I){console.error(I),
h=5111,l="\u532f\u5165\u6191\u8b49\u5931\u6557"}}else h=5005,l="\u53c3\u6578\u932f\u8aa4";b.callback(g,h,l,k)};this.ImportCertStore=function(a,c,d,e,f){var g=0,h="\u6210\u529f",l="";do if(a&&c&&d){if(0<=a.indexOf("::")){a=a.split("::");var k=a[0];var m=a[1]}else k=a,m="";if(/.*Android.*/.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent))try{var p=piexif.load(d);if(null==p){console.error(ex);g=5005;h="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";break}d=
p["0th"]["33432"]}catch(H){console.error(H);g=5005;h="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";break}if(d)try{try{if(0>=forge.asn1.fromDer(forge.util.decode64(d)).value.length){g=5040;h="\u6191\u8b49\u683c\u5f0f\u932f\u8aa4";break}}catch(H){console.error(H);g=5040;h="\u6191\u8b49\u683c\u5f0f\u932f\u8aa4";break}pkcs12=n(d,c);if(null==pkcs12)g=5071,h="\u6191\u8b49\u5bc6\u78bc\u932f\u8aa4";else{for(var q=-1,t=pkcs12.getBags({bagType:forge.pki.oids.certBag})[forge.pki.oids.certBag],
C=0;C<t.length;C++)if(E(t[C].cert,k)){q=C;break}if(0>q)g=5115,h="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u8207\u4f7f\u7528\u8005\u4e0d\u7b26";else{var u=y(t[q].cert,d,m);v(u,e)?r(u,m)?l="{"+x(u)+"}":(g=5110,h="\u5132\u5b58\u6191\u8b49\u5931\u6557"):(g=5115,h="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u689d\u4ef6\u4e0d\u7b26")}}}catch(H){console.error(H),g=5111,h="\u532f\u5165\u6191\u8b49\u5931\u6557"}else g=5005,h="\u53c3\u6578\u932f\u8aa4"}else g=5005,h="\u53c3\u6578\u932f\u8aa4";
while(0);b.callback(f,g,h,l)};this.ExportCertStore=function(a,c,d){var e=0,f="\u6210\u529f",g="";do{var h=null,k="";if(d&&c){try{if(h=sessionStorage.getItem("selectedCertInfo"),!h){e=5067;f="\u5c1a\u672a\u9078\u64c7\u6191\u8b49";break}}catch(T){console.error(T);e=5112;f="\u8b80\u53d6\u6191\u8b49\u5931\u6557";break}h=JSON.parse(h);if(h.b64P12Cert){if(/.*Android.*/.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(!a){e=5005;f="\u53c3\u6578\u932f\u8aa4";break}try{var m=piexif.load(a);
if(null==m){console.error(ex);e=5005;f="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";break}m["0th"]["33432"]=h.b64P12Cert;k=piexif.insert(piexif.dump(m),a)}catch(T){console.error(T);e=5005;f="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";break}}else k=h.b64P12Cert;g='{"certStore":"'+k+'","userId":"'+c+'"}'}else e=5060,f="\u91d1\u9470\u4e0d\u5b58\u5728"}else e=5005,f="\u53c3\u6578\u932f\u8aa4"}while(0);b.callback(d,e,f,g)};this.ChangePIN=function(a,c,d){var e=
0,f="\u6210\u529f",g="";do try{var h=null;if(a&&c&&d){try{if(h=JSON.parse(sessionStorage.getItem("selectedCertInfo")),!h){e=5067;f="\u5c1a\u672a\u9078\u64c7\u6191\u8b49";break}}catch(X){console.error(X);e=5112;f="\u8b80\u53d6\u6191\u8b49\u5931\u6557";break}var k=h.b64P12Cert;k=n(k,a);if(null==k)e=5071,f="\u6191\u8b49\u5bc6\u78bc\u932f\u8aa4";else{for(var m=k.getBags({bagType:forge.pki.oids.certBag})[forge.pki.oids.certBag],r=k.getBags({bagType:forge.pki.oids.pkcs8ShroudedKeyBag})[forge.pki.oids.pkcs8ShroudedKeyBag][0].key,
v=[],p=0;p<m.length;p++)v.push(m[p].cert);var y=forge.pkcs12.toPkcs12Asn1(r,v,c,{algorithm:"3des"}),q=forge.asn1.toDer(y).getBytes(),t=forge.util.encode64(q);a:{v=void 0;p=h;var u=null;if(localStorage.getItem("TWCACertIdxRef")){try{u=JSON.parse(localStorage.getItem("TWCACertIdxRef"))}catch(X){var C=null;break a}for(v in u)if(u[v].issuer==p.issuer){var E=p.cn.replace(/^\s+|\s+$/,"").replace(/^0*/,"").toUpperCase().split("-")[0],w=u[v].cn.replace(/^\s+|\s+$/,"").replace(/^0*/,"").toUpperCase().split("-")[0];
if(E==w){C=v;break a}}C=void 0}else C=null}C?(h.b64P12Cert=t,localStorage.setItem(C,JSON.stringify(h)),sessionStorage.setItem("selectedCertInfo",JSON.stringify(h)),sessionStorage.setItem("twcaSelectedKey",forge.util.encode64(c)),g="{"+x(h)+"}"):(console.error(ex),e=5121,f="\u8b8a\u66f4\u5bc6\u78bc\u5931\u6557")}}else e=5005,f="\u53c3\u6578\u932f\u8aa4"}catch(X){console.error(X),e=5121,f="\u8b8a\u66f4\u5bc6\u78bc\u5931\u6557"}while(0);b.callback(d,e,f,g)}}this.GetCertSubjectCN=function(){return b.getSelectedCertFieldValue("cn")};
this.GetCertSubject=function(){return b.getSelectedCertFieldValue("subject")};this.GetCertIssuer=function(){return b.getSelectedCertFieldValue("issuer")};this.GetCertSerial=function(){return b.getSelectedCertFieldValue("serial")};this.GetCertNotBefore=function(){return b.getSelectedCertFieldValue("notBefore")};this.GetCertNotAfter=function(){return b.getSelectedCertFieldValue("notAfter")};this.getSelectedCertFieldValue=function(a){return b.selectedCertInfo&&"undefined"!=typeof b.selectedCertInfo[a]?
b.selectedCertInfo[a]:""};this.setOpenWindowObject=function(a){if("object"!=typeof a)return 5005;b._childWindow=a};this.SelectSignerExFromChildWindowHandler=function(a,d,e,f){5071==a&&null==c[3]?twcaCryptoLibAlertDialog.show("\u8f38\u5165\u5bc6\u78bc","\u8acb\u8f38\u5165\u6191\u8b49\u5bc6\u78bc","","\u53d6\u6d88","\u78ba\u8a8d",["SelectSignerExFromChild",c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],twcaLib]):(e=sessionStorage.getItem("selectedCertInfo"),e&&"null"!==e||(e=O(c[0],c[4],c[5],c[3]),"object"===
typeof e&&sessionStorage.setItem("selectedCertInfo",JSON.stringify(e))),e=c[8],c=null,b.callback(e,a,d,f))};this.SignPkcs7FromChildWindowHandler=function(a,d,e,f){e=c[2];c=null;b.callback(e,a,d,f)};this.SignPkcs1FromChildWindowHandler=function(a,d,e,f){e=c[2];c=null;b.callback(e,a,d,f)};this.ResetKeyFromChildWindowHandler=function(a,d,e,f){e=c[0];c=null;b.callback(e,a,d,f)};this.GetVersionFromChildWindowHandler=function(a,d,e,f){e=c[0];c=null;b.callback(e,a,d,f)};this.callback=function(a,c,d,e){if("string"===
typeof a&&0==a.indexOf("oTwcaLib._childWindow.twcaLib."))a=a.substring(30,a.length),b._childWindow.twcaLib[a](c,d,"",e);else if("string"===typeof a&&0==a.indexOf("twcaLib."))a=a.substring(8,a.length),b[a](c,d,"",e);else{var f={};if(a&&"[object Function]"===f.toString.call(a))a(c,d,"",e);else window[a](c,d,"",e)}}}try{support_amd=define.amd}catch(G){}
support_amd&&define(function(G){var q=require("twca/forge");return new function(){function G(){if(!z)return!1;var a=!1;try{window.opener&&window.opener!=window&&window.opener.twcaLib&&window.location.hostname===window.opener.location.hostname&&(window.opener.twcaLib.setOpenWindowObject(window),a=!0)}catch(r){a=!1}return a}function p(a,b,e,f){function g(a,b,c,e,f,g){var h=q.pkcs7.createSignedData();switch(c){case 0:h.content=q.util.createBuffer(d(a),"raw");break;case 1:h.content=q.util.createBuffer(a,
"utf8");break;case 2:h.content="undefined"==typeof Big5Encoding?q.util.createBuffer(a,"utf8"):q.util.createBuffer(Big5Encoding.getBig5Encoding(a),"raw");break;default:h.content=q.util.createBuffer(d(a),"raw")}h.addCertificate(f);a={key:g,certificate:f,digestAlgorithm:b};l&&(a.authenticatedAttributes=[{type:q.pki.oids.contentType,value:q.pki.oids.data},{type:q.pki.oids.messageDigest},{type:q.pki.oids.signingTime}]);h.addSigner(a);h.sign();e=e?q.pkcs7.messageToPem(h):q.pkcs7.messageToPemWithoutContent(h);
e=e.replace(/\-----BEGIN PKCS7-----/g,"");e=e.replace(/\-----END PKCS7-----/g,"");return e=e.replace(/(?:\\[rn]|[\r\n]+)+/g,"")}var h="",m=null,n=null;if(null==c.selectedCertInfo||null!=b)x(b,e);else{switch(61440&f){case 0:b=q.pki.oids.sha1;break;case 4096:b=q.pki.oids.md5;break;case 8192:b=q.pki.oids.sha256;break;case 16384:b=q.pki.oids.sha512;break;default:b=q.pki.oids.sha1}e=1024==(3840&f)?!1:!0;f&=15;var l=!1;m=k();n=m.oPrivateKey;m=m.oCert;if("string"===typeof a)h=g(a,b,f,e,m,n);else if(Array.isArray(a)){h=
"";for(var r=0;r<a.length;r++)h=h+"||"+g(a[r],b,f,e,m,n);h=h.substring(2,h.length)}}return h}function O(a,b,e,f){function g(a,b,c,e,f){m=b.create();switch(c){case 0:m.update(d(a));break;case 1:m.update(a,"utf8");break;case 2:"undefined"==typeof Big5Encoding?m.update(a,"utf8"):m.update(Big5Encoding.getBig5Encoding(a));break;default:m.update(d(a))}return e?q.util.bytesToHex(f.sign(m)):q.util.encode64(f.sign(m))}var h=null,m=null;if(null==c.selectedCertInfo||null!=b)x(b,e);else{switch(61440&f){case 0:b=
q.md.sha1;break;case 4096:b=q.md.md5;break;case 8192:b=q.md.sha256;break;case 16384:b=q.md.sha512;break;default:b=q.md.sha1}e=256==(3840&f)?!1:!0;f&=15;h=k().oPrivateKey;if("string"===typeof a)var n=g(a,b,f,e,h);else if(Array.isArray(a)){n="";for(var l=0;l<a.length;l++)n=n+"||"+g(a[l],b,f,e,h);n=n.substring(2,n.length)}}return n}function B(a,b,d){function e(a,b){var c=q.asn1.oidToDer(q.pki.oids[b]).getBytes(),d=q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.SEQUENCE,!0,[]),e=q.asn1.create(q.asn1.Class.UNIVERSAL,
q.asn1.Type.SEQUENCE,!0,[]);e.value.push(q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.OID,!1,c));e.value.push(q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.NULL,!1,""));c=q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.OCTETSTRING,!1,q.util.hexToBytes(a));d.value.push(e);d.value.push(c);return q.asn1.toDer(d).getBytes()}function f(a){if(0>=a.length)return!1;for(var b=!0,c=a[0].length,d=1;d<a.length;d++)if(a[d].length!=c){b=!1;break}return b}var g=null;do if(null==c.selectedCertInfo||null!=
b)x(b,d);else{if("string"===typeof a)g=a.length;else{if(!f(a))break;g=a[0].length}switch(g){case 20:var m="md5";break;case 40:m="sha1";break;case 64:m="sha256";break;case 128:m="sha512"}g=k();if("string"===typeof a){p1Encoded=e(a,m);var n=q.pki.rsa.encrypt(p1Encoded,g.oPrivateKey,1);n=q.util.encode64(n)}else if(Array.isArray(a)){n="";for(var l=0;l<a.length;l++){p1Encoded=e(a[l],m);var r=q.pki.rsa.encrypt(p1Encoded,g.oPrivateKey,1);n=n+"||"+q.util.encode64(r)}n=n.substring(2,n.length)}}while(0);return n}
function x(a,c,d,g){var k=-1,h=[],m=f("TWCACertIdxRef"),n={},l=null,r="",p=!1,v=!1,y=!1;do{try{localStorage}catch(aa){k=5999;l=null;break}4096==(61440&d)&&(p=!0);4==(4&d)&&(v=!0);8==(8&d)&&(y=!0);var t=d&240;if(null==a||""==a)k=5005,l=null;else if("//S"!=a.substring(0,3)&&"//I"!=a.substring(0,3)||"//"!=a.substring(a.length-2,a.length))k=5005,l=null;else if(null==c||""==c||14==c.length&&!isNaN(c)){var u=a.replace(/^\/\/|\/\/\s*$/g,"").replace(/\s*=\s*/gm,"=").split("//");for(var w=0;w<u.length;w++){var x=
w;a:{var z={};for(var A="S_CL S_SN S_CN S_OU S_O S_C I_CN I_OU I_O I_C".split(" "),B=u[w];0<B.length;){var H=B.substring(0,B.indexOf("="));if(!e(A,H)){z=5005;break a}B=B.substring(B.indexOf("=")+1,B.length);var I=B.length,G=B.indexOf(",S_"),K=B.indexOf(",I_");0<G&&G<I&&(I=G);0<K&&K<I&&(I=K);G=B.substring(0,I);"S_O"==H||"S_OU"==H||"I_O"==H||"I_OU"==H?(z[H]||(z[H]=[]),z[H].push(G)):z[H]=G;B=B.substring(I+1,B.length)}}h[x]=z}if(e(h,5005)||""==h[0])k=5005,l=null;else{for(var O in m){u=m[O];u.certb64=
JSON.parse(localStorage.getItem(O)).certb64;if(y){w=u;x=h;A=F(w.certb64);z=A.subject;A=A.issuer;B=!1;for(H=0;H<x.length;H++){I=!0;for(var Q in x[H])if("S_SN"==Q)x[H][Q].toUpperCase()!=z.SN&&(I=!1);else if("S_CN"==Q)0>z.CN.indexOf(x[H][Q])&&(I=!1);else if("S_OU"==Q)for(G=0;G<x[H][Q].length;G++)e(z.OU,x[H][Q][G])||(I=!1);else if("S_O"==Q)for(G=0;G<x[H][Q].length;G++)e(z.O,x[H][Q][G])||(I=!1);else if("S_C"==Q)x[H][Q]!=z.C&&(I=!1);else if("I_CN"==Q)x[H][Q]!=A.CN&&(I=!1);else if("I_OU"==Q)for(G=0;G<x[H][Q].length;G++)e(A.OU,
x[H][Q][G])||(I=!1);else if("I_O"==Q)for(G=0;G<x[H][Q].length;G++)e(A.O,x[H][Q][G])||(I=!1);else"I_C"==Q?x[H][Q]!=A.C&&(I=!1):"S_CS"==Q&&x[H][Q]!=w.cs&&(I=!1);if(B=B||I)break}w=B}else{w=u;x=h;z=F(w.certb64).subject;A=!1;for(B=0;B<x.length;B++)if(H=!1,x[B].S_C==z.C&&(null==z.O||null!=x[B].S_O&&x[B].S_O.length==z.O.length)){for(I=0;null!=z.O&&I<z.O.length;I++)e(x[B].S_O,z.O[I])||(H=!0);if(!H&&(null==z.OU||null!=x[B].S_OU&&x[B].S_OU.length==z.OU.length)){for(I=0;null!=z.OU&&I<z.OU.length;I++)e(x[B].S_OU,
z.OU[I])||(H=!0);if(!H&&x[B].S_CN==z.CN&&x[B].S_CS==w.cs){A=!0;break}}}w=A}""!=c?u.notAfter<c&&(w=!1):v&&(H=new Date,x=H.getFullYear(),z=H.getMonth()+1,H.getDate(),A=H.getHours(),B=H.getMinutes(),I=H.getSeconds(),x="0000"+x,x=x.substring(x.length-4,x.length),z="00"+z,z=z.substring(z.length-2,z.length),H="00"+z,H=H.substring(H.length-2,H.length),A="00"+A,A=A.substring(A.length-2,A.length),B="00"+B,B=B.substring(B.length-2,B.length),I="00"+I,I=I.substring(I.length-2,I.length),u.notAfter<x+z+H+A+B+I&&
(w=!1));w&&null!=localStorage.getItem(O)&&""!=localStorage.getItem(O)&&(n[O]=u)}for(var S in n)if(null==l)r=S,l=n[S];else switch(t){case 0:l.notBefore<=n[S].notBefore&&(r=S,l=n[S]);break;case 16:l.notBefore<=n[S].notBefore&&(r=S,l=n[S]);break;case 32:l.notBefore>=n[S].notBefore&&(r=S,l=n[S]);break;case 64:l.notAfter<=n[S].notAfter&&(r=S,l=n[S]);break;case 128:l.notAfter>=n[S].notAfter&&(r=S,l=n[S]);break;default:l.notAfter<=n[S].notAfter&&(r=S,l=n[S])}if(null==l)k=5010,l=null;else if(l.b64P12Cert=
JSON.parse(localStorage.getItem(r)).b64P12Cert,l.keySet=JSON.parse(localStorage.getItem(r)).keySet,l.certfinger=JSON.parse(localStorage.getItem(r)).certfinger,l.certb64=JSON.parse(localStorage.getItem(r)).certb64,!p){sessionStorage.removeItem("twcaSelectedKey");if(l.b64P12Cert){t=D(l.b64P12Cert,g);if(!t){k=5071;l=null;break}t=t.getBags({bagType:q.pki.oids.pkcs8ShroudedKeyBag})[q.pki.oids.pkcs8ShroudedKeyBag][0].key;if(!t){k=5071;l=null;break}}else if(l.keySet){if(t=b(l.keySet,g),!t){k=5071;l=null;
break}}else{k=5112;l=null;break}sessionStorage.setItem("twcaSelectedKey",q.util.encode64(g))}}}else k=5005,rtnCodeInfo=null}while(0);return null!=l?l:k}function D(a,b){var c=null;try{c=q.pkcs12.pkcs12FromAsn1(q.asn1.fromDer(q.util.decode64(a)),b)}catch(v){}return c}function A(a,b){var c="TWCA"+(new Date).getTime().toString(),d=f("TWCACertIdxRef");d[c]={cn:a.cn,issuer:a.issuer,subject:a.subject,serial:a.serial,notBefore:a.notBefore,notAfter:a.notAfter,cs:a.cs};localStorage.setItem("TWCACertIdxRef",
JSON.stringify(d));localStorage.setItem(c,JSON.stringify(a));return c}function a(a){return a?'"sn":"'+a.serial+'","cn":"'+a.cn+'","ntb":"'+a.notBefore+'","nta":"'+a.notAfter+'","issdn":"'+a.issuer+'","subdn":"'+a.subject+'","certfinger":"'+a.certfinger+'","certb64":"'+a.certb64+'","cs":"'+a.cs+'"':""}function f(a){var b=null;a=localStorage.getItem(a);if(null==a)b={};else if(""==a)b={};else try{b=JSON.parse(a)}catch(y){b={}}return b}function d(a){for(var b=new Uint8Array(2*a.length),c=0;c<a.length;c++){var d=
a.charCodeAt(c);b[2*c]=d&255;b[2*c+1]=d>>8&255}a="";for(c=0;c<b.length;c++)a=16>b[c]?a+"%0":a+"%",a+=b[c].toString(16);return unescape(a)}function F(a){ret={};try{var b=q.asn1.fromDer(q.util.decode64(a));b=q.pki.certificateFromAsn1(b)}catch(v){return null}ret.subject={};for(a=0;a<b.subject.attributes.length;a++){var c=b.subject.attributes[a];"C"==c.shortName&&(ret.subject.C=c.value);"O"==c.shortName&&(null==ret.subject.O&&(ret.subject.O=[]),ret.subject.O.push(c.value));"OU"==c.shortName&&(null==ret.subject.OU&&
(ret.subject.OU=[]),ret.subject.OU.push(c.value));"CN"==c.shortName&&(ret.subject.CN=c.value)}ret.subject.SN=b.serialNumber.toUpperCase();ret.issuer={};for(a=0;a<b.issuer.attributes.length;a++)c=b.issuer.attributes[a],"C"==c.shortName&&(ret.issuer.C=c.value),"O"==c.shortName&&(null==ret.issuer.O&&(ret.issuer.O=[]),ret.issuer.O.push(c.value)),"OU"==c.shortName&&(null==ret.issuer.OU&&(ret.issuer.OU=[]),ret.issuer.OU.push(c.value)),"CN"==c.shortName&&(ret.issuer.CN=c.value);return ret}function k(){var a=
{},d=sessionStorage.getItem("twcaSelectedKey");if(c.selectedCertInfo.b64P12Cert){p12Cert=q.pkcs12.pkcs12FromAsn1(q.asn1.fromDer(q.util.decode64(c.selectedCertInfo.b64P12Cert)),q.util.decode64(d));var e=p12Cert.getBags({bagType:q.pki.oids.pkcs8ShroudedKeyBag})[q.pki.oids.pkcs8ShroudedKeyBag][0].key;d=p12Cert.getBags({bagType:q.pki.oids.certBag})[q.pki.oids.certBag];for(var f=0;f<d.length;f++){var g=d[f].cert;if(g.publicKey.n.data[0]==e.n.data[0]&&g.publicKey.n.data[1]==e.n.data[1]){oCert=p12Cert.getBags({bagType:q.pki.oids.certBag})[q.pki.oids.certBag][f].cert;
break}}oCert||(oCert=p12Cert.getBags({bagType:q.pki.oids.certBag})[q.pki.oids.certBag][0].cert)}else c.selectedCertInfo.keySet&&(oCert=q.asn1.fromDer(q.util.decode64(c.selectedCertInfo.certb64)),oCert=q.pki.certificateFromAsn1(oCert),e=b(c.selectedCertInfo.keySet,q.util.decode64(d)));a.oPrivateKey=e;a.oCert=oCert;return a}function e(a,b){for(var c in a)if(a[c]==b)return!0;return!1}function b(a,b,c){var d=null;try{if(3>arguments.length){var e=q.md.sha256.create();e.update(b);var f=e.digest().getBytes(),
g=q.cipher.createDecipher("AES-CBC",f);g.start({iv:""});g.update(q.util.createBuffer(q.util.decode64(a)));g.finish();var k=g.output.data.split("||");"TWCA"==k[8]&&(d=q.pki.setRsaPrivateKey(new q.jsbn.BigInteger(k[1],16),new q.jsbn.BigInteger(k[0],16),new q.jsbn.BigInteger(k[7],16),new q.jsbn.BigInteger(k[2],16),new q.jsbn.BigInteger(k[3],16),new q.jsbn.BigInteger(k[4],16),new q.jsbn.BigInteger(k[5],16),new q.jsbn.BigInteger(k[6],16)))}else d=q.pki.setRsaPrivateKey(new q.jsbn.BigInteger(c.n,16),new q.jsbn.BigInteger(c.e,
16),new q.jsbn.BigInteger(c.d,16),new q.jsbn.BigInteger(c.p,16),new q.jsbn.BigInteger(c.q,16),new q.jsbn.BigInteger(c.dP,16),new q.jsbn.BigInteger(c.dQ,16),new q.jsbn.BigInteger(c.qInv,16))}catch(l){d=null}return d}var c=this;twcaLib=c;var u=null,g=null,t=null,w=!1;-1<navigator.userAgent.indexOf("TWID")&&(w=!0);var z=!0;this.SetParentDetect=function(a){z=a};this.SelectSignerEx=function(b,d,e,f,g,h,k,p,l){if(G()&&0==(h&15728640))u=[b,d,e,f,g,h,k,p,l],window.opener.twcaLib.SelectSignerEx(b,d,e,f,g,
h,k,p,"oTwcaLib._childWindow.twcaLib.SelectSignerExFromChildWindowHandler");else{if(w)try{"undefined"==typeof l&&(l="ret_SelectSignerEx");var m=MobileUtils.registerFunction(l),n=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SelectSignerEx(b,d,e,f,g,MobileUtils.toNumber(h),k,p,m),0):0<n.indexOf("iPhone")||0<n.indexOf("iPad")?(document.location="PKI::SelectSignerEx::"+encodeURI(b+separation+d+separation+e+separation+f+separation+g+separation+h+separation+
k+separation+p+separation+m),0):1}catch(M){return alert(M),-1}if(4>=arguments.length)return x(b,g,h,f);m=0;n="\u6210\u529f";var r="",v=x(b,g,h,f);if("number"==typeof v)switch(v){case 5005:m=5005;n="\u53c3\u6578\u932f\u8aa4";break;case 5010:m=5010;n="\u7121\u6191\u8b49";break;case 5071:if(null==f&&0>"oTwcaLib._childWindow.twcaLib.SelectSignerExFromChildWindowHandler".indexOf(l)){twcaCryptoLibAlertDialog.show("\u8f38\u5165\u5bc6\u78bc","\u8acb\u8f38\u5165\u6191\u8b49\u5bc6\u78bc","","\u53d6\u6d88",
"\u78ba\u8a8d",["SelectSignerEx",b,d,e,f,g,h,k,p,l,twcaLib]);return}m=5071;n="\u6191\u8b49\u5bc6\u78bc\u932f\u8aa4";break;case 5112:m=5112;n="\u8b80\u53d6\u6191\u8b49\u5931\u6557";break;case 5999:m=5999;n="\u7121\u6cd5\u5b58\u53d6\u5132\u5b58\u5340";break;default:m=5001,n="\u4e00\u822c\u932f\u8aa4"}else 0==(h&61440)&&(c.selectedCertInfo=v,sessionStorage.setItem("selectedCertInfo",JSON.stringify(v))),r="{"+a(v)+"}";c.callback(l,m,n,r)}};this.SignPkcs7=function(b,d,e,f){if(G())u=[b,d,e],window.opener.twcaLib.SignPkcs7(b,
d,"oTwcaLib._childWindow.twcaLib.SignPkcs7FromChildWindowHandler");else{if(w)try{"undefined"==typeof e&&(e="ret_SignPkcs7");var g=!1,h=b;if("[object Array]"===Object.prototype.toString.call(b)){g=!0;for(index=0;index<b.length;++index){var k=q.util.binary.raw.encode(q.util.text.utf8.encode(b[index])),n=q.util.binary.base64.encode(q.util.binary.raw.decode(k));b[index]=n}h=b.join("#")}var l=MobileUtils.registerFunction(e),r=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(g?MobileUtils.androidInterface.SignPkcs7Batch(b,
MobileUtils.toNumber(d),l):MobileUtils.androidInterface.SignPkcs7(b,MobileUtils.toNumber(d),l),0):0<r.indexOf("iPhone")||0<r.indexOf("iPad")?(document.location=g?"PKI::SignPkcs7Batch::"+encodeURI(h+separation+d+separation+l):"PKI::SignPkcs7::"+encodeURI(h+separation+d+separation+l),0):1}catch(N){return alert(N),-1}if(4<=arguments.length)return p(b,d,e,f);g=0;h="\u6210\u529f";k="";if(null==b||0>=b.length)g=5005,h="\u53c3\u6578\u932f\u8aa4";else{if(n=sessionStorage.getItem("selectedCertInfo"))c.selectedCertInfo=
JSON.parse(n);n=sessionStorage.getItem("twcaSelectedKey");c.selectedCertInfo&&null!=n?(n=p(b,null,null,d),null==n||""==n?(g=5061,h="\u7c3d\u7ae0\u5931\u6557"):k="{"+a(c.selectedCertInfo)+',"signature":"'+n+'"}'):(g=5067,h="\u57f7\u884c\u7c3d\u7ae0\u6642\uff0c\u5c1a\u672a\u9078\u64c7\u7c3d\u7ae0\u6191\u8b49")}c.callback(e,g,h,k)}};this.SignPkcs1=function(b,d,e,f){if(G())u=[b,d,e],window.opener.twcaLib.SignPkcs1(b,d,"oTwcaLib._childWindow.twcaLib.SignPkcs1FromChildWindowHandler");else{if(w)try{"undefined"==
typeof e&&(e="ret_SignPkcs1");var g=!1,h=b;if("[object Array]"===Object.prototype.toString.call(b)){g=!0;for(index=0;index<b.length;++index){var k=q.util.binary.raw.encode(q.util.text.utf8.encode(b[index])),n=q.util.binary.base64.encode(q.util.binary.raw.decode(k));b[index]=n}h=b.join("#")}var l=MobileUtils.registerFunction(e),r=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(g?MobileUtils.androidInterface.SignPkcs1Batch(h,MobileUtils.toNumber(d),l):MobileUtils.androidInterface.SignPkcs1(h,
MobileUtils.toNumber(d),l),0):0<r.indexOf("iPhone")||0<r.indexOf("iPad")?(document.location=g?"PKI::SignPkcs1Batch::"+encodeURI(h+separation+d+separation+l):"PKI::SignPkcs1::"+encodeURI(h+separation+d+separation+l),0):1}catch(N){return alert(N),-1}if(4<=arguments.length)return O(b,d,e,f);g=0;h="\u6210\u529f";k="";if(null==b||0>=b.length)g=5005,h="\u53c3\u6578\u932f\u8aa4";else{if(n=sessionStorage.getItem("selectedCertInfo"))c.selectedCertInfo=JSON.parse(n);n=sessionStorage.getItem("twcaSelectedKey");
c.selectedCertInfo&&null!=n?(n=O(b,null,null,d),null==n||""==n?(g=5061,h="\u7c3d\u7ae0\u5931\u6557"):k='{"signature":"'+n+'",'+a(c.selectedCertInfo)+"}"):(g=5067,h="\u57f7\u884c\u7c3d\u7ae0\u6642\uff0c\u5c1a\u672a\u9078\u64c7\u7c3d\u7ae0\u6191\u8b49")}c.callback(e,g,h,k)}};this.SignPkcs1FromHash=function(b,d,e){if(G())u=[b,d],window.opener.twcaLib.SignPkcs1FromHash(b,"oTwcaLib._childWindow.twcaLib.SignPkcs1FromChildWindowHandler");else{if(w)try{"undefined"==typeof d&&(d="ret_SignPkcs1FromHash");var f=
!1,g=b;if("[object Array]"===Object.prototype.toString.call(b)){f=!0;for(index=0;index<b.length;++index){var h=q.util.binary.raw.encode(q.util.text.utf8.encode(b[index])),k=q.util.binary.base64.encode(q.util.binary.raw.decode(h));b[index]=k}g=b.join("#")}var n=MobileUtils.registerFunction(d),l=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(f?MobileUtils.androidInterface.SignPkcs1FromHashBatch(g,n):MobileUtils.androidInterface.SignPkcs1FromHash(g,n),0):0<l.indexOf("iPhone")||0<l.indexOf("iPad")?
(document.location=f?"PKI::SignPkcs1FromHashBatch::"+encodeURI(g+separation+n):"PKI::SignPkcs1FromHash::"+encodeURI(g+separation+n),0):1}catch(L){return alert(L),-1}if(3<=arguments.length)return B(b,d,dwFlags2);f=0;g="\u6210\u529f";h="";if(null==b||0>=b.length)f=5005,g="\u53c3\u6578\u932f\u8aa4";else{if(k=sessionStorage.getItem("selectedCertInfo"))c.selectedCertInfo=JSON.parse(k);k=sessionStorage.getItem("twcaSelectedKey");c.selectedCertInfo&&null!=k?(k=B(b,null,null),null==k||""==k?(f=5061,g="\u7c3d\u7ae0\u5931\u6557"):
h=Array.isArray(k)?'{"signature":'+JSON.stringify(k)+","+a(c.selectedCertInfo)+"}":'{"signature":"'+k+'",'+a(c.selectedCertInfo)+"}"):(f=5067,g="\u57f7\u884c\u7c3d\u7ae0\u6642\uff0c\u5c1a\u672a\u9078\u64c7\u7c3d\u7ae0\u6191\u8b49")}c.callback(d,f,g,h)}};this.ResetKey=function(a){if(G())u=[a],window.opener.twcaLib.ResetKey("oTwcaLib._childWindow.twcaLib.ResetKeyFromChildWindowHandler");else{if(w)try{"undefined"==typeof a&&(a="ret_ResetKey");var b=MobileUtils.registerFunction(a),d=navigator.userAgent;
return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ResetKey(b),0):0<d.indexOf("iPhone")||0<d.indexOf("iPad")?(document.location="PKI::ResetKey::"+encodeURI(b),0):1}catch(v){return alert(v),-1}c.selectedCertInfo=null;sessionStorage.removeItem("selectedCertInfo");sessionStorage.removeItem("twcaSelectedKey");if(0>=arguments.length)return 0;c.callback(a,0,"\u6210\u529f","")}};this.GetVersion=function(a){if(G())u=[a],window.opener.twcaLib.GetVersion("oTwcaLib._childWindow.twcaLib.GetVersionFromChildWindowHandler");
else{if(w)try{"undefined"==typeof a&&(a="ret_GetVersion");var b=MobileUtils.registerFunction(a),d=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.GetVersion(b),0):0<d.indexOf("iPhone")||0<d.indexOf("iPad")?(document.location="PKI::GetVersion::"+encodeURI(b),0):1}catch(v){return alert(v),-1}if(0>=arguments.length)return"1.4.2.0";c.callback(a,0,"\u6210\u529f",'{"version":"1.4.2.0"}')}};this.Hash=function(a,b,e){try{"undefined"==typeof e&&(e="ret_Hash");var f=
MobileUtils.registerFunction(e),g=navigator.userAgent;if(MobileUtils.supportTwidAndroid())return MobileUtils.androidInterface.Hash(a,MobileUtils.toNumber(b),f),0;if(0<g.indexOf("iPhone")||0<g.indexOf("iPad"))return document.location="PKI::Hash::"+encodeURI(a+separation+b+separation+f),0;f=null;g="";var h=performance.now();switch(61440&b){case 0:var k=q.md.sha1;break;case 4096:k=q.md.md5;break;case 8192:k=q.md.sha256;break;case 16384:k=q.md.sha512;break;default:k=q.md.sha1}var n=k.create();switch(15&
b){case 0:n.update(d(a));break;case 1:n.update(a,"utf8");break;case 2:"undefined"==typeof Big5Encoding?n.update(a,"utf8"):n.update(Big5Encoding.getBig5Encoding(a));break;default:n.update(d(a))}f=n.digest().toHex();var l=performance.now();g='{"hashValue":"'+f+'","time":"'+(l-h)+'","length":"'+a.length+'","length":"'+a.length+'"}';if(3<=arguments.length)c.callback(e,0,"\u6210\u529f",g);else return g}catch(L){return alert(L),-1}};this.Hmac=function(a,b,d,e){var f=0,g="\u6210\u529f",k="";switch(d){case 1:d=
"md5";break;case 3:d="sha256";break;default:d="sha1"}a=q.util.binary.raw.encode(q.util.binary.hex.decode(a));var n=q.hmac.create();n.start(d,a);n.update(q.util.binary.raw.encode(q.util.text.utf16.encode(b)));(b=q.util.binary.base64.encode(q.util.binary.raw.decode(n.getMac().getBytes())))?k='{"hmacValue":"'+b+'"}':(f=5001,g="\u932f\u8aa4");"string"===typeof e?c.callback(e,f,g,k):e(f,g,"",k);return 0};this.CreatePKCS7FromSignedData=function(a,b,e,f,k){var h=0,m="\u6210\u529f",n="",l=performance.now();
a:{var r=null;if(a&&b&&e){switch(61440&f){case 0:var p=q.pki.oids.sha1;break;case 4096:p=q.pki.oids.md5;break;case 8192:p=q.pki.oids.sha256;break;case 16384:p=q.pki.oids.sha512;break;default:p=q.pki.oids.sha1}switch(15&f){case 0:var v=q.util.createBuffer(d(a),"raw");break;case 1:v=q.util.createBuffer(a,"utf8");break;case 2:v="undefined"==typeof Big5Encoding?q.util.createBuffer(a,"utf8"):q.util.createBuffer(Big5Encoding.getBig5Encoding(a),"raw");break;default:v=q.util.createBuffer(d(a),"raw")}try{r=
q.asn1.fromDer(q.util.decode64(b)),r=q.pki.certificateFromAsn1(r)}catch(T){p7Value={errCode:2,errMsg:"\u6191\u8b49\u89e3\u6790\u932f\u8aa4"};break a}if(b!=t){var y=q.pkcs7.createSignedData();y.content=v;y.addCertificate(r);y.addSigner({key:"-----BEGIN RSA PRIVATE KEY-----MIIEowIBAAKCAQBbE4weWXGL8ehZU2UsCeRRBcU6S09/ph5IW4QtZKic1GDnanM1Ur/ohPHQsFLg6xBFiIBGPz/96eGAlg/NjcU/D3S4OmEF9PLxOT+Vg3I+dRZjmXFRrlfkmZ4ATNbZI4gzTrPUN9CV1soNlWQ/ClAniF+mqHLYFBXUhk8BCyV8j1SNp4sdiO4fHHCRZp44ppqRyG4op5/c9DUjeAsi4qgQyvxpO5lxzBZ73IkQ2aP/DKMF8rjKxKWM3JjInadcru/aAUO5TimDUrSMCaGYo5fzjqTCGD4iuz3J3tFoh20Z7H7s/kj4YK2l+YXbemCp0F13o70Hyb21Z87YqCzber5RAgMBAAECggEAMKI7jGlOzOAcprZ1rBKMLQfbzckxZoSaXyEfb+30a+qs5GZfpvXNLKjxR/MgDqL3SWoetWRJE5m0pSl8vtMZpRbnyQjDjp7CrDVZ0skiVF/J2N2zOV7T6GpviNF/WOw0atF4DbbQV3Me6ioAIfmr27BjA2eoC+KN1bLytSfymJR8G0CktovhhkD3wUZVuTcUGbg0yyif74y9dwmnHOQbOMdSWIHuIpTzQSGelRoQCmbLmhE2hAbIlT5mz6vFZCSmgTFSPk87sonHaFrBeesu5ut8LG686s97n78oPz27U/ek7lV/Cj/UJeljuRM5tDoCJJKkTB+0xsNrfNayWEQcwQKBgQCyGWMsRw1tprYqXp7nLS/nja6qf3bIs/IwtO1wsxmmtxXcXnb+/D285mUDsEelPB0AXJcOe1SP0fDFB1HMAFlJ5hWATbUveSEk5U2L+LjeREhCDlH0MJBDBc+vixo8MoHXq3sjpe3/HP76V+fvUOSx7vtasGG1I4fGUDMxLhbLzQKBgQCC6c0L4+idGcg5P7KvHlSwYHHKbLpuDiRNnSjqgQZ7EUxohYOCOk9tLFPaxMhhzgjI5hFPY48+Kv8NCCzzNWc25VI82qFcG6a8Mw1bUXb2/8/FKhUqTdaLlOZuVZW6LobxEM4Z4hEUnLfgrFbvlMKopbynwZ82UK5rm25Y0i6glQKBgQCobAm1HZw9TaKHfuOWisz6lKnQ4qlaM5GdLfw8z6I6Xnl15H9zsuZPdTGhw1p9j9N9PBI9x7O4LjkamkloOgw2Lje3FcV6F3qYgaBL9fIdf0U18oTd/+7s8tnskAdHVhwj8C6LD6d50dnutKLJVh5vhih9Ir/DpM4JZF6E66jzIQKBgGQy8RcltJfx8NcokuoIDAgHeXDW8YZk2pJxNKzwXnZ5kgL6FeLqIHrOD8yFC14YpY6m0R7zc+LAZACkfksUV9CjiuM674AhRegMJy/61VRODce54wNDGnAxYoGWjgg3rl76XtVeu3YMUYzsO4oaUTdly1SXFPYsoKOKDtZ64OdVAoGBAK14Yk03Hr8fR3F0uqmt8uu9GN7tNfzvifRPYQ+/sfMUDG1C2+gh/roSKnHX8p1Wwtf26cv5Klq5ySxUT3NxJErf1I7voDiLVM4pmq8DKiebsl/8QbJv3e3DMbGqiRAmfRNJqb7UcQsDEWORFt7U9XcCncCzIBuO2ETzDQshlcNE-----END RSA PRIVATE KEY-----",
certificate:r,digestAlgorithm:p});y.sign();g=y;t=b}else if(y=g,y.content=v,y.contentInfo=null,y.contentInfo=q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.SEQUENCE,!0,[q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.OID,!1,q.asn1.oidToDer(q.pki.oids.data).getBytes())]),"content"in y){var u;y.content instanceof q.util.ByteBuffer?u=y.content.bytes():"string"===typeof y.content&&(u=q.util.encodeUtf8(y.content));y.contentInfo.value.push(q.asn1.create(q.asn1.Class.CONTEXT_SPECIFIC,0,!0,[q.asn1.create(q.asn1.Class.UNIVERSAL,
q.asn1.Type.OCTETSTRING,!1,u)]))}y.signers[0].signature=q.util.decode64(e);r=q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.SEQUENCE,!0,[q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.INTEGER,!1,q.asn1.integerToDer(y.signers[0].version).getBytes()),q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.SEQUENCE,!0,[q.pki.distinguishedNameToAsn1({attributes:y.signers[0].issuer}),q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.INTEGER,!1,q.util.hexToBytes(y.signers[0].serialNumber))]),q.asn1.create(q.asn1.Class.UNIVERSAL,
q.asn1.Type.SEQUENCE,!0,[q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.OID,!1,q.asn1.oidToDer(y.signers[0].digestAlgorithm).getBytes()),q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.NULL,!1,"")])]);y.signers[0].authenticatedAttributesAsn1&&r.value.push(y.signers[0].authenticatedAttributesAsn1);r.value.push(q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.SEQUENCE,!0,[q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.OID,!1,q.asn1.oidToDer(y.signers[0].signatureAlgorithm).getBytes()),q.asn1.create(q.asn1.Class.UNIVERSAL,
q.asn1.Type.NULL,!1,"")]));r.value.push(q.asn1.create(q.asn1.Class.UNIVERSAL,q.asn1.Type.OCTETSTRING,!1,y.signers[0].signature));if(0<y.signers[0].unauthenticatedAttributes.length){p=q.asn1.create(q.asn1.Class.CONTEXT_SPECIFIC,1,!0,[]);for(v=0;v<y.signers[0].unauthenticatedAttributes.length;++v)p.values.push(_attributeToAsn1(y.signers[0].unauthenticatedAttributes[v]));r.value.push(p)}y.signerInfos[0]=r;signValue=q.pkcs7.messageToPem(y);signValue=signValue.replace(/\-----BEGIN PKCS7-----/g,"");signValue=
signValue.replace(/\-----END PKCS7-----/g,"");p7Value=signValue=signValue.replace(/(?:\\[rn]|[\r\n]+)+/g,"")}else p7Value={errCode:2,errMsg:"\u53c3\u6578\u932f\u8aa4"}}y=performance.now();"string"!=typeof p7Value?(h=p7Value.errCode,m=p7Value.errMsg):n='{"p7Value":"'+p7Value+'","time":"'+(y-l)+'","length":"'+a.length+'","length":"'+a.length+'"}';if(5<=arguments.length)c.callback(k,h,m,n);else return n};this.EncrytAESCBC=function(a,b,d){var e=0,f="\u6210\u529f";var g="";do{var k=/[^A-Fa-f0-9]/;if(64!=
b.length||0>=a.length||k.test(a)||k.test(b))e=5005,f="\u53c3\u6578\u932f\u8aa4";else{try{var n=q.util.binary.raw.encode(q.util.binary.hex.decode(a));var l=q.util.binary.raw.encode(q.util.binary.hex.decode(b))}catch(L){e=5005;f="\u53c3\u6578\u932f\u8aa4";break}g=_encryptAESCBC(n,l);g='{"encryptedHexString":"'+g+'","key":"'+b+'","plain":"'+a+'"}'}}while(0);if(3<=arguments.length)c.callback(d,e,f,g);else return""==g?e:g};this.DecrytAESCBC=function(a,b,d){var e=0,f="\u6210\u529f",g="";do{var k=/[^A-Fa-f0-9]/;
if(64!=b.length||0>=a.length||k.test(a)||k.test(b))e=5005,f="\u53c3\u6578\u932f\u8aa4";else{try{var n=q.util.binary.raw.encode(q.util.binary.hex.decode(a));var l=q.util.binary.raw.encode(q.util.binary.hex.decode(b))}catch(L){e=5005;f="\u53c3\u6578\u932f\u8aa4";break}k=_decryptAESCBC(n,l);null==k?(e=5080,f="\u52a0\u89e3\u5bc6\u5931\u6557"):g='{"plainString":"'+k+'","key":"'+b+'","encrypted":"'+a+'"}'}}while(0);if(3<=arguments.length)c.callback(d,e,f,g);else return 0==e?g:e};w?(this.CheckCert=function(a,
b,c){try{"undefined"==typeof c&&(c="ret_CheckCert");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CheckCert(a,b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::CheckCert::"+encodeURI(a+separation+b+separation+d),0):1}catch(h){return alert(h),-1}},this.MakeCSR=function(a,b,c,d,e,f){try{"undefined"==typeof f&&(f="ret_MakeCSR");var g=MobileUtils.registerFunction(f),h=navigator.userAgent;return MobileUtils.supportTwidAndroid()?
(MobileUtils.androidInterface.MakeCSR(MobileUtils.toNumber(a),b,c,d,MobileUtils.toNumber(e),g),0):0<h.indexOf("iPhone")||0<h.indexOf("iPad")?(document.location="PKI::MakeCSR::"+encodeURI(a+separation+b+separation+c+separation+d+separation+e+separation+g),0):1}catch(l){return alert(l),-1}},this.MakeCSREx=function(a,b,c,d,e,f,g){try{"undefined"==typeof g&&(g="ret_MakeCSREx");var h=MobileUtils.registerFunction(g),k=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.MakeCSREx(MobileUtils.toNumber(a),
b,c,d,MobileUtils.toNumber(e),JSON.stringify(f),h),0):0<k.indexOf("iPhone")||0<k.indexOf("iPad")?(document.location="PKI::MakeCSREx::"+encodeURI(a+separation+b+separation+c+separation+d+separation+e+separation+JSON.stringify(f)+separation+h),0):1}catch(L){return alert(L),-1}},this.ImportCert=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_ImportCert");var f=MobileUtils.registerFunction(e),g=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ImportCert(a,
b,c,d,f),0):0<g.indexOf("iPhone")||0<g.indexOf("iPad")?(document.location="PKI::ImportCert::"+encodeURI(a+separation+b+separation+c+separation+d+separation+f),0):1}catch(C){return alert(C),-1}},this.ChangePIN=function(a,b,c,d,e,f){try{"undefined"==typeof f&&(f="ret_ChangePIN");var g=MobileUtils.registerFunction(f),h=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ChangePIN(a,b,c,d,e,g),0):0<h.indexOf("iPhone")||0<h.indexOf("iPad")?(document.location="PKI::ChangePIN::"+
encodeURI(a+separation+b+separation+c+separation+d+separation+e+separation+g),0):1}catch(l){return alert(l),-1}},this.DeleteCert=function(a,b,c){try{"undefined"==typeof c&&(c="ret_DeleteCert");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.DeleteCert(a,b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::DeleteCert::"+encodeURI(a+separation+b+separation+d),0):1}catch(h){return alert(h),-1}},this.QueryDeviceID=
function(a,b,c){try{"undefined"==typeof c&&(c="ret_QueryDeviceID");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.QueryDeviceID(a,b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::QueryDeviceID::"+encodeURI(a+separation+b+separation+d),0):1}catch(h){return alert(h),-1}},this.DeleteBrowserCert=function(a,b,c){try{var d=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.DeleteBrowserCert(a,
b,c),0):0<d.indexOf("iPhone")||0<d.indexOf("iPad")?(document.location="PKI::DeleteBrowserCert::"+encodeURI(a+separation+b+separation+c),0):1}catch(E){return alert(E),-1}},this.CertEncryptPkcs7=function(a,b,c,d){try{var e=MobileUtils.registerFunction(d),f=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CertEncryptPkcs7(a,b,MobileUtils.toNumber(c),e),0):0<f.indexOf("iPhone")||0<f.indexOf("iPad")?(document.location="PKI::CertEncryptPkcs7::"+encodeURI(a+separation+
b+separation+c+separation+e),0):1}catch(m){return alert(m),-1}},this.SymEncrypt=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_SymEncrypt");var f=MobileUtils.registerFunction(e),g=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SymEncrypt(a,b,c,MobileUtils.toNumber(d),f),0):0<g.indexOf("iPhone")||0<g.indexOf("iPad")?(document.location="PKI::SymEncrypt::"+encodeURI(a+separation+b+separation+c+separation+d+separation+f),0):1}catch(C){return alert(C),
-1}},this.SymDecrypt=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_SymDecrypt");var f=MobileUtils.registerFunction(e),g=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SymDecrypt(a,b,c,MobileUtils.toNumber(d),f),0):0<g.indexOf("iPhone")||0<g.indexOf("iPad")?(document.location="PKI::SymDecrypt::"+encodeURI(a+separation+b+separation+c+separation+d+separation+f),0):1}catch(C){return alert(C),-1}},this.ChangeWeb=function(a,b,c){try{"undefined"==typeof c&&
(c="ret_ChangeWeb");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ChangeWeb(MobileUtils.toNumber(a),b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::ChangeWeb::"+encodeURI(a+separation+b+separation+d),0):1}catch(h){return alert(h),-1}},this.SetErrorCode=function(a,b,c){try{"undefined"==typeof c&&(c="ret_SetErrorCode");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?
(MobileUtils.androidInterface.SetErrorCode(MobileUtils.toNumber(a),b,d),0):0<e.indexOf("iPhone")||0<e.indexOf("iPad")?(document.location="PKI::SetErrorCode::"+encodeURI(a+separation+b+separation+d),0):1}catch(h){return alert(h),-1}},this.ExitWebview=function(){try{var a=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ExitWebview(),0):0<a.indexOf("iPhone")||0<a.indexOf("iPad")?(document.location="PKI::ExitWebview::",0):1}catch(r){return alert(r),-1}},this.ExitWebview2=
function(a){try{var b=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ExitWebview2(a),0):0<b.indexOf("iPhone")||0<b.indexOf("iPad")?(document.location="PKI::ExitWebview2::"+encodeURI(a),0):1}catch(y){return alert(y),-1}},this.CheckCert=function(a,b,c){try{"undefined"==typeof c&&(c="ret_CheckCert");var d=MobileUtils.registerFunction(c),e=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CheckCert(a,b,d),0):0<e.indexOf("iPhone")||
0<e.indexOf("iPad")?(document.location="PKI::CheckCert::"+encodeURI(a+separation+b+separation+d),0):1}catch(h){return alert(h),-1}},this.OpenBrowser=function(a,b){try{var c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(b?MobileUtils.androidInterface.OpenBrowser(a,b):MobileUtils.androidInterface.OpenBrowser(a),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location=b?"PKI::OpenBrowser::"+encodeURI(a+separation+b):"PKI::OpenBrowser::"+encodeURI(a),0):1}catch(v){return alert(v),
-1}},this.OpenBrowser2=function(a,b){try{var c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.OpenBrowser2(a,b),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location="PKI::OpenBrowser2::"+encodeURI(a+separation+b),0):1}catch(v){return alert(v),-1}},this.SetData=function(a){try{var b=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.SetData(a),0):0<b.indexOf("iPhone")||0<b.indexOf("iPad")?(document.location=
"PKI::SetData::"+encodeURI(a),0):1}catch(y){return alert(y),-1}},this.GetData=function(a){try{"undefined"==typeof a&&(a="ret_GetData");var b=MobileUtils.registerFunction(a),c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.GetData(b),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location="PKI::GetData::"+encodeURI(b),0):1}catch(v){return alert(v),-1}},this.GetServerAuth=function(a){try{"undefined"==typeof a&&(a="ret_GetServerAuth");var b=MobileUtils.registerFunction(a),
c=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.GetServerAuth(b),0):0<c.indexOf("iPhone")||0<c.indexOf("iPad")?(document.location="PKI::GetServerAuth::"+encodeURI(b),0):1}catch(v){return alert(v),-1}},this.VerifyServerResponse=function(a,b){try{"undefined"==typeof b&&(b="ret_VerifyServerResponse");var c=MobileUtils.registerFunction(b),d=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.VerifyServerResponse(a,c),0):
0<d.indexOf("iPhone")||0<d.indexOf("iPad")?(document.location="PKI::VerifyServerResponse::"+encodeURI(a+separation+c),0):1}catch(E){return alert(E),-1}},this.ManageLocalAuth=function(a,b,c,d,e){try{"undefined"==typeof e&&(e="ret_ManageLocalAuth");var f=MobileUtils.registerFunction(e),g=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.ManageLocalAuth(a,b,c,d,f),0):0<g.indexOf("iPhone")||0<g.indexOf("iPad")?(document.location="PKI::ManageLocalAuth::"+encodeURI(a+
separation+b+separation+c+separation+d+separation+f),0):1}catch(C){return alert(C),-1}},this.CertProcessDone=function(){try{var a=navigator.userAgent;return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.CertProcessDone(),0):0<a.indexOf("iPhone")||0<a.indexOf("iPad")?(document.location="PKI::CertProcessDone",0):1}catch(r){return alert(r),-1}},this.DecryptAndShowPdf=function(a,b,c,d){try{"undefined"==typeof d&&(d="ret_DecryptAndShowPdf");var e=MobileUtils.registerFunction(d),f=navigator.userAgent;
return MobileUtils.supportTwidAndroid()?(MobileUtils.androidInterface.DecryptAndShowPdf(a,b,c,e),0):0<f.indexOf("iPhone")||0<f.indexOf("iPad")?(document.location="PKI::DecryptAndShowPdf::"+encodeURI(a+separation+b+separation+c+separation+e),0):1}catch(m){return alert(m),-1}}):(this.QueryDeviceID=function(a,b,d){function e(){function a(){return Math.floor(65536*(1+getRandomValues())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function f(){if(-1<navigator.platform.indexOf("Win"))var a=
"PC";else-1<navigator.platform.indexOf("Mac")?a="PC":navigator.userAgent.match(/iPhone/i)?a="IP":navigator.userAgent.match(/iPad/i)?a="IA":navigator.userAgent.match(/Android/i)?(a="GP",navigator.userAgent.match(/Mobile/i)||(a="GA")):a="";return a}a=0;var g="\u6210\u529f",k="";try{try{localStorage}catch(L){a=5999;g="\u7121\u6cd5\u5b58\u53d6\u5132\u5b58\u5340:, userAgent:"+navigator.userAgent;c.callback(d,a,g,k);return}"undefined"==typeof d&&(d="ret_QueryDeviceID");if(b){var n=localStorage.getItem("TWCAAccountUqiDeviceID");
n?(n=JSON.parse(n),n[b]||(n[b]=e()+"-"+(new Date).getTime(),localStorage.setItem("TWCAAccountUqiDeviceID",JSON.stringify(n))),l=n[b]):(l=e()+"-"+(new Date).getTime(),n={},n[b]=l,localStorage.setItem("TWCAAccountUqiDeviceID",JSON.stringify(n)))}else{var l=localStorage.getItem("TWCABrowserUqiDeviceID");l||(l=e()+"-"+(new Date).getTime(),localStorage.setItem("TWCABrowserUqiDeviceID",l))}k='{"deviceType":"'+f()+'","deviceId":"'+l+'","osVersion":"","appVersion":""}'}catch(L){console.error(L),a=5001,g=
"\u8b80\u53d6DeviceID\u5931\u6557:"+L.message+", userAgent:"+navigator.userAgent}c.callback(d,a,g,k)},this.MakeCSR=function(a,b,d,e,f){function g(a,b){var d=q.pki.rsa.generateKeyPair({bits:2048,e:65537});null==d?c.callback(f,5065,"\u7522\u751f\u91d1\u9470\u5931\u6557",""):n(d.privateKey,d.publicKey,a,b)}function k(a,b,c){a=q.pki.privateKeyFromAsn1(q.asn1.fromDer(q.util.createBuffer(a)));var d=q.pki.setRsaPublicKey(a.n,a.e);n(a,d,b,c)}function n(a,b,e,g){var h=q.pki.encryptRsaPrivateKey(a,d),k=q.pki.createCertificationRequest();
k.publicKey=b;e&&k.setSubject([{name:"commonName",value:e}]);k.sign(a,g);k=q.pki.certificationRequestToPem(k);h=h.replace(/(?:\\[rn]|[\r\n]+)+/g,"");h=h.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","");h=h.replace("-----END ENCRYPTED PRIVATE KEY-----","");k=k.replace(/(?:\\[rn]|[\r\n]+)+/g,"");k=k.replace("-----BEGIN CERTIFICATE REQUEST-----","");k=k.replace("-----END CERTIFICATE REQUEST-----","");r='{"b64Key":"'+h+'","csr":"'+k+'"}';c.callback(f,0,"\u6210\u529f",r)}var l=0,p="\u6210\u529f",r=
"";if(d)if(1024!=a&&2048!=a&&4096!=a)l=5005,p="\u53c3\u6578\u932f\u8aa4\uff0c\u4e0d\u652f\u63f4\u7684\u91d1\u9470\u9577\u5ea6";else if(0!=b&&512!=b&&1024!=b)l=5005,p="\u53c3\u6578\u932f\u8aa4\uff0c\u4e0d\u652f\u63f4\u7684\u6f14\u7b97\u6cd5";else{switch(b){case 0:b="SHA-1";var t=q.md.sha1.create();break;case 512:b="SHA-256";t=q.md.sha256.create();break;case 768:b="SHA-512";t=q.md.sha512.create();break;default:b="SHA-256",t=q.md.sha256.create()}a={name:"RSASSA-PKCS1-v1_5",modulusLength:a,publicExponent:new Uint8Array([1,
0,1]),hash:{name:b}};try{if(window.crypto)if(crypto.subtle&&crypto.subtle.generateKey)crypto.subtle.generateKey(a,!0,["sign","verify"]).then(function(a){return crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(function(a){k(a,e,t)})["catch"](function(a){console.error(a);g(e,t)});else{g(e,t);return}else if(window.msCrypto){var v=window.msCrypto.subtle.generateKey(a,!0,["sign","verify"]);v.onerror=function(a){console.log("genOp.onerror event handler fired.");g(e,t)};v.oncomplete=function(a){a=window.msCrypto.subtle.exportKey("pkcs8",
a.target.result.privateKey);a.onerror=function(a){console.log("expOp.onerror event handler fired.");g(e,t)};a.oncomplete=function(a){k(a.target.result,e,t)}}}else{g(e,t);return}}catch(M){g(e,t);return}}else l=5005,p="\u53c3\u6578\u932f\u8aa4\uff0c\u5bc6\u78bc\u4e0d\u53ef\u7a7a\u767d";0!=l&&c.callback(f,l,p,r)},this.ImportCert=function(b,d,e,f,g,h){var k=0,n="\u6210\u529f",l="";if(b&&d&&e&&f&&h){0>f.indexOf("-----BEGIN CERTIFICATE-----")&&(f="-----BEGIN CERTIFICATE-----"+f);0>f.indexOf("-----END CERTIFICATE-----")&&
(f+="-----END CERTIFICATE-----");0>e.indexOf("-----BEGIN ENCRYPTED PRIVATE KEY-----")&&(e="-----BEGIN ENCRYPTED PRIVATE KEY-----"+e);0>e.indexOf("-----END ENCRYPTED PRIVATE KEY-----")&&(e+="-----END ENCRYPTED PRIVATE KEY-----");try{try{f=q.pki.certificateFromPem(f)}catch(W){f=f.replace("CERTIFICATE","PKCS7");f=f.replace("CERTIFICATE","PKCS7");for(var p=q.pkcs7.messageFromPem(f).certificates,r=0;r<p.length&&(f=p[r],!isIdInSubject(p[r],b));r++);}e=q.pki.decryptRsaPrivateKey(e,d);if(isPrivateKeyMatchesCert(e,
f))if(isIdInSubject(f,b)){var t=q.pkcs12.toPkcs12Asn1(e,f,d,{algorithm:"3des"}),v=q.asn1.toDer(t).getBytes(),u=q.util.encode64(v),w=parseCertObjToCertInfo(f,u);isCertMatchesFilter(w,g)?A(w)?l="{"+a(w)+"}":(k=5110,n="\u5132\u5b58\u6191\u8b49\u5931\u6557"):(k=5115,n="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u689d\u4ef6\u4e0d\u7b26")}else k=5115,n="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u8207\u4f7f\u7528\u8005\u4e0d\u7b26";else k=5115,n="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u8207\u91d1\u9470\u4e0d\u7b26"}catch(W){console.error(W),
k=5111,n="\u532f\u5165\u6191\u8b49\u5931\u6557"}}else k=5005,n="\u53c3\u6578\u932f\u8aa4";c.callback(h,k,n,l)},this.ImportCertStore=function(b,d,e,f,g){var h=0,k="\u6210\u529f",n="";do if(b&&d&&e){if(isMobile())try{var l=piexif.load(e);if(null==l){console.error(ex);h=5005;k="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";break}e=l["0th"]["33432"]}catch(M){console.error(M);h=5005;k="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";break}if(e)try{try{if(0>=q.asn1.fromDer(q.util.decode64(e)).value.length){h=
5040;k="\u6191\u8b49\u683c\u5f0f\u932f\u8aa4";break}}catch(M){console.error(M);h=5040;k="\u6191\u8b49\u683c\u5f0f\u932f\u8aa4";break}pkcs12=D(e,d);if(null==pkcs12)h=5071,k="\u6191\u8b49\u5bc6\u78bc\u932f\u8aa4";else{for(var p=-1,r=pkcs12.getBags({bagType:q.pki.oids.certBag})[q.pki.oids.certBag],t=0;t<r.length;t++)if(isIdInSubject(r[t].cert,b)){p=t;break}if(0>p)h=5115,k="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u8207\u4f7f\u7528\u8005\u4e0d\u7b26";else{var v=parseCertObjToCertInfo(r[p].cert,
e);isCertMatchesFilter(v,f)?A(v)?n="{"+a(v)+"}":(h=5110,k="\u5132\u5b58\u6191\u8b49\u5931\u6557"):(h=5115,k="\u6191\u8b49\u9a57\u8b49\u932f\u8aa4\uff1a\u6191\u8b49\u689d\u4ef6\u4e0d\u7b26")}}}catch(M){console.error(M),h=5111,k="\u532f\u5165\u6191\u8b49\u5931\u6557"}else h=5005,k="\u53c3\u6578\u932f\u8aa4"}else h=5005,k="\u53c3\u6578\u932f\u8aa4";while(0);c.callback(g,h,k,n)},this.ExportCertStore=function(a,b,d){var e=0,f="\u6210\u529f",g="";do{var k=null,n="";if(d&&b){try{if(k=sessionStorage.getItem("selectedCertInfo"),
!k){e=5067;f="\u5c1a\u672a\u9078\u64c7\u6191\u8b49";break}}catch(L){console.error(L);e=5112;f="\u8b80\u53d6\u6191\u8b49\u5931\u6557";break}k=JSON.parse(k);if(k.b64P12Cert){if(isMobile()){if(!a){e=5005;f="\u53c3\u6578\u932f\u8aa4";break}try{var l=piexif.load(a);if(null==l){console.error(ex);e=5005;f="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";break}l["0th"]["33432"]=k.b64P12Cert;n=piexif.insert(piexif.dump(l),a)}catch(L){console.error(L);e=5005;f="\u53c3\u6578\u932f\u8aa4\uff1a\u5716\u7247\u683c\u5f0f\u932f\u8aa4";
break}}else n=k.b64P12Cert;g='{"certStore":"'+n+'","userId":"'+b+'"}'}else e=5060,f="\u91d1\u9470\u4e0d\u5b58\u5728"}else e=5005,f="\u53c3\u6578\u932f\u8aa4"}while(0);c.callback(d,e,f,g)},this.ChangePIN=function(b,d,e){var f=0,g="\u6210\u529f",h="";do try{var k=null;if(b&&d&&e){try{if(k=JSON.parse(sessionStorage.getItem("selectedCertInfo")),!k){f=5067;g="\u5c1a\u672a\u9078\u64c7\u6191\u8b49";break}}catch(Y){console.error(Y);f=5112;g="\u8b80\u53d6\u6191\u8b49\u5931\u6557";break}var n=k.b64P12Cert;
n=D(n,b);if(null==n)f=5071,g="\u6191\u8b49\u5bc6\u78bc\u932f\u8aa4";else{for(var l=n.getBags({bagType:q.pki.oids.certBag})[q.pki.oids.certBag],p=n.getBags({bagType:q.pki.oids.pkcs8ShroudedKeyBag})[q.pki.oids.pkcs8ShroudedKeyBag][0].key,r=[],t=0;t<l.length;t++)r.push(l[t].cert);var u=q.pkcs12.toPkcs12Asn1(p,r,d,{algorithm:"3des"}),w=q.asn1.toDer(u).getBytes(),y=q.util.encode64(w),x=getCertIndexByCertInfo(k);x?(k.b64P12Cert=y,localStorage.setItem(x,JSON.stringify(k)),sessionStorage.setItem("selectedCertInfo",
JSON.stringify(k)),sessionStorage.setItem("twcaSelectedKey",q.util.encode64(d)),h="{"+a(k)+"}"):(console.error(ex),f=5121,g="\u8b8a\u66f4\u5bc6\u78bc\u5931\u6557")}}else f=5005,g="\u53c3\u6578\u932f\u8aa4"}catch(Y){console.error(Y),f=5121,g="\u8b8a\u66f4\u5bc6\u78bc\u5931\u6557"}while(0);c.callback(e,f,g,h)});this.GetCertSubjectCN=function(){return c.getSelectedCertFieldValue("cn")};this.GetCertSubject=function(){return c.getSelectedCertFieldValue("subject")};this.GetCertIssuer=function(){return c.getSelectedCertFieldValue("issuer")};
this.GetCertSerial=function(){return c.getSelectedCertFieldValue("serial")};this.GetCertNotBefore=function(){return c.getSelectedCertFieldValue("notBefore")};this.GetCertNotAfter=function(){return c.getSelectedCertFieldValue("notAfter")};this.getSelectedCertFieldValue=function(a){return c.selectedCertInfo&&"undefined"!=typeof c.selectedCertInfo[a]?c.selectedCertInfo[a]:""};this.setOpenWindowObject=function(a){if("object"!=typeof a)return 5005;c._childWindow=a};this.SelectSignerExFromChildWindowHandler=
function(a,b,d,e){5071==a&&null==u[3]?twcaCryptoLibAlertDialog.show("\u8f38\u5165\u5bc6\u78bc","\u8acb\u8f38\u5165\u6191\u8b49\u5bc6\u78bc","","\u53d6\u6d88","\u78ba\u8a8d",["SelectSignerExFromChild",u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],u[8],c]):(d=sessionStorage.getItem("selectedCertInfo"),d&&"null"!==d||(d=x(u[0],u[4],u[5],u[3]),"object"===typeof d&&sessionStorage.setItem("selectedCertInfo",JSON.stringify(d))),d=u[8],u=null,c.callback(d,a,b,e))};this.SignPkcs7FromChildWindowHandler=function(a,
b,d,e){d=u[2];u=null;c.callback(d,a,b,e)};this.SignPkcs1FromChildWindowHandler=function(a,b,d,e){d=u[2];u=null;c.callback(d,a,b,e)};this.ResetKeyFromChildWindowHandler=function(a,b,d,e){d=u[0];u=null;c.callback(d,a,b,e)};this.GetVersionFromChildWindowHandler=function(a,b,d,e){d=u[0];u=null;c.callback(d,a,b,e)};this.callback=function(a,b,d,e){if("string"===typeof a&&0==a.indexOf("oTwcaLib._childWindow.twcaLib."))a=a.substring(30,a.length),c._childWindow.twcaLib[a](b,d,"",e);else if("string"===typeof a&&
0==a.indexOf("twcaLib."))a=a.substring(8,a.length),c[a](b,d,"",e);else{var f={};if(a&&"[object Function]"===f.toString.call(a))a(b,d,"",e);else window[a](b,d,"",e)}}}});
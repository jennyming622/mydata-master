package test;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Properties;


public class emsgFrontOrderCount {

	public static void main(String[] args) {
		String stime = "2020-12-01 00:00:00";
		String etime = "2020-12-30 23:59:59";
		
		String ulog_string = "159055994415710,160675255194710,160181868337810,149855092768411,160596211249610,160676535148820,160677683525620,151464365292410,160671363341520,156988313252110,160093952076210,158795419170210,160678594177920,154866951741120,159729568261610,153562060569910,156289142461520,158374421102410,160204373732310,159825405195510,159591656621710,158622933525610,160674666046510,160679147610610,160635824953520,160456487360110,159833386786410,160526042942510,160679335175010,160679339646120,160628779926510,139446745788810,160679455892120,140748062107211,160670933173920,159670246603910,160075339310310,159834917040510,160316305843210,156264004733210,147818861472911,153619463150020,160680565279510,160283266838710,160568285620410,159255235924610,140679603989121,160681096285120,159106345637610,160681205994820,153783698290310,140958074812921,139446667837210,148689125910811,160682189726720,160682211434720,160682297154220,152701322702220,160682350337720,153749873637910,160682463874920,160515539976020,147678352256111,160249800613010,160649086234520,160684128318610,160675132864510,160684870280220,149800557465410,160686567202320,160687027849210,151997938364520,160687143273810,160687165196410,160687174147610,160687276922120,160687419578110,160687570100420,160491638494610,160015474497910,155840397524810,149114821689410,156497651106420,160024716132410,160688981816720,155712810142620,158450389207910,160031158087910,155107745901010,157914128474010,160506485720510,149351684369020,157913331353810,156402454029110,159713430939110,160189465458310,158134614344310,160690083033610,158133892200010,159954558849610,160446956314510,150340971248220,146733925100711,160195467179510,140696411738821,158615255349010,160691752769110,160692032163420,140253902961911,160692284517710,159287618959110,160282395683410,160693390373710,160695706354210,160695962280220,160696340290710,156230641303010,156655033551920,159704070317710,160696762687210,158683922431710,157175167484320,140680833122921,159885524695010,160671494560020,160697634575110,160464651557910,160697711606320,156570424040920,157631654718710,159703189581110,158749524219610,160325188430310,158674394237710,160698584394320,151840670995910,160699045649410,160699450053610,158477818632810,159540663895110,160700281813910,160700348009510,160701182034120,160701309062410,160378029632810,142365687485710,143080540538621,158675853618110,156255372412010,152592449498810,140689344934911,156232153607810,159833876373910,158979938524310,160705484006210,160705766201310,156015764737210,149207606221320,160706738328310,157060677459310,158676013214610,160437343803310,146036526769811,160707218759620,160707289839010,158649630765210,160674647472310,160708933113420,160708985062620,148088924520310,145775785343810,160709750105920,160710574031720,160710653992510,158214037746120,160710726144310,140680264073021,160713111141210,157401218342510,154060913237710,160714225050210,153137662401010,160715556540210,160715616441610,160715719840420,160715860735710,160715876533910,160715885969310,149421935462910,160361325980220,160717000098320,155922161654510,160717233239910,150409276851211,156550941121810,140691725718011,140988531100721,143208089017921,160722291507220,157103653856710,157506404842610,160723366768510,150166007242410,160724690999720,149320471000010,160725550437510,160725792736820,160726040972420,160726203563610,158822042671610,159645586192120,160727668189220,147627929820811,160729701929010,158503437436310,160730302327320,160730463409020,160730823560420,160730890838210,160730895430710,159910276555710,156575126553520,160731810798720,160369668956910,160731998152920,160732204740220,159668746890610,157665141495920,151748963080710,156343470471510,147692749344310,159723683438710,158574687017610,160734019948710,149978211263310,160734210537810,159265326918410,149395978319210,159711401315010,153683426353910,144595885311020,160538854062010,159179407269010,160738363320610,158322578462110,160738720912910,160738985965310,156471391822010,160739032325410,160739082117120,160739136041210,160739139383310,160739248797110,160739259453020,150398315066110,146518324495710,160429228264210,160739957379620,160740574187210,159169214239310,156251524879510,160740775876320,153741989516910,153889578684010,160741405868120,160741670067610,160741700545810,160741897660210,160742350726610,160742532196610,160742649033010,152768393651810,157572912594410,160743845781310,160746797558110,158571590069110,160747462352410,160663582480110,158277127414010,159650417567010,160748112178420,160748235376910,160748317013020,160748361797120,160671409978020,160749090659320,160109281472510,152638922428310,160749449753220,160749590364920,160749648991420,155818231011220,160750497248310,159011916007810,160751252740010,159565977656210,159843447475320,160751764056910,160752026601110,149708232001710,159665182793110,157983092950120,160755637979320,160276867150910,160755818253120,156093797846920,148706991082710,158367306574510,151701889860410,160756468098510,160756548621710,160756588769510,160188417434510,159037299447710,160757277478310,159489239243410,160757386827510,152584236103210,145586679954720,160194460157310,160757937513910,160325195899310,153632390109810,150399249767220,160759169748720,160759375588510,160759426305910,160507823110310,160078459596110,151533860579810,153114934185010,160760369641710,150211133464710,160761330133510,160761458642510,147309892251111,160510586363820,160761793265610,160761828798120,148060219287110,160762093823610,160762723532110,160283808643410,147115279242011,153724945769920,160764888362620,156291161902010,159703954239410,159957049934610,160765912031120,160765935511910,160765946513220,160765995360810,160766074179510,160605352592710,160766557603120,144040857209510,156775248717710,160766784176420,160136286364610,160767490116920,156263951102210,160768320762410,160768361048110,160768400870210,160769184657510,152522199219220,160769625070910,158761050819510,157685853339210,160774142679210,160499627418710,160776320704110,160776475911510,160776551414310,150556043782910,146835596659310,160777218267010,160777244117810,160777435532010,160777445537110,160777766012710,160780013235010,160780474648520,160781978200210,151248146601620,146354018618220,155667915311120,149166184002510,152023297431710,160784609894310,147080389410211,160785283686410,160787082203120,160787161330510,160787572112120,160497464435020,159551603508110,160791216736010,153238427966810,160791455673820,158639305259910,160791592204710,160791717487520,160791874375910,160792641686210,160793191841810,160793204892220,160793291432510,160793581638010,160793814558310,157187423076310,160794377446910,142107049084311,160794945933320,153422829116910,160795761774620,146311111516111,160796530351020,160796539279620,160796854376310,159780925524110,160799498995220,160799877516920,160799961266110,158684587667210,154779898443010,160799999843810,160800006356210,140777037850021,156627278251010,150407727883011,160800182893210,154177548063210,157242565246220,152515821443010,142924156991710,160801316226820,160801369852310,150435378665611,160801511446410,160324938270310,160801928652810,160801936535110,148764265899420,160802978122710,160803090440110,151654106170710,160803447636510,160803627833720,160803814166020,146656771086410,160803896967320,158798380722010,160805890355510,140871764914610,160807713001120,160808562461120,159229995290310,160809503769810,160809795969420,156101753523410,160811274108610,160811589882910,140690418988711,160812654793010,160812798764810,160813621100120,160814114796710,149353458328310,150586629209010,160816669788820,160816682197120,160075609198010,160817277458310,160817359140010,141087171934010,160232750443510,159849760539210,150053692470320,160818047392610,160818470292810,160818553183220,160818574454910,156545147082410,160501513449010,158495800778520,160819179545120,160819358218010,146346401414120,160819540657320,150234386116510,146027531634411,160821816698020,160056466015220,160823276261910,147593291940910,155953095110010,145569941819110,159160622196810,160825978358410,160827009552320,158425179342910,160827125549110,160827261236120,160827301410620,160827462223510,140785521863610,160827519544610,160827607122410,160828108960010,160828241950710,160828475722820,160829992798910,140698959046610,160079481700420,160834894004110,160836719729610,160837338671010,160837552618510,148152131849511,160837929101910,151721140125410,146884466883211,160841206172810,160842606473810,154001047102910,140729463640811,155888840860210,160238080202610,160843935252220,150380529256810,149986655004010,160846795519210,160848653527120,160849158027020,155978078130420,160851062897010,160851101087110,140698891434610,140767067941621,160446239095010,149285840894110,160852168655420,141519092256421,160853269191220,160853522566410,154481760645610,160853952664720,160854024052220,159826583400810,156939376554120,158334681543920,153856728241910,160855761722520,160858053326020,160859019960420,160266413345510,156799153667610,160862046584910,160862065504210,148239255251811,155885185491410,141162880030511,160862671170510,148122091828710,159677770211310,160863656591120,160864361391120,160865370669910,160865625122510,160866594473320,160867302417920,160868580282520,160869016528920,160869499570020,160871096927920,160871573055220,144898612603110,158203819224910,160872246861520,160873665471320,160874096330920,160874129353220,141218838073311,160876924063720,160877541783120,160877592479010,160877710131320,154141278150210,160648765033310,160879155178320,160881144318620,160881529385520,160882054858020,160883604765420,160884493752720,160886091562520,160886240833120,146941157445620,160886614970510,153115296902710,160887007144420,160887545956020,160887840762120,160888418167420,152470239536420,158631690011510,154116349611310,152699359558020,160895078320720,160896370138920,157009575890620,141404948075021,147706058640810,153052666829210,160195214225620,145878329891411,140689512235911,160113602069610,158786599400910,158746777554720,160907490586120,159968860500510,160908108378020,149394651576811,160911761658320,160911854497020,160911980740020,152413934971810,160912925354620,152354541468910,160914065018920,158219108816410,160914775307610,160915259759320,160915808699820,160916114564820,160916481732420,160916744605520,160916892189020,160917144141120,160917363090420,160917540414820,160919617380820,160919660638020,160920260817020,160921393213120,151546306683720,160559577592410,160215855188510,160922778558620,160923045217220,160923640573820,160924117477920,160629678257410,153305409353010,160924817889020,160925286586920,160925548473320,160927578781520,152204064462510,160929269604820,140920458532411,160930805631720,160639470926910,160931864922720,160931966583620,160933096545120,160933312747320,160933499400420,151543177349410,160934148409220";
		String[]  ulogArray = ulog_string.split(",");
		//List<String> ulogList = new ArrayList<String>();
        String sql = "";
        String sql1= "";
        String sql2= "";
        Statement stmt = null;
        ResultSet rs = null,rs1 = null,rs2 = null,rs3 = null;
        int personal_total = 0;
        int great_total = 0;
        int total = 0;
		Properties props = new Properties();
	    props.put("user", "emsg");
	    props.put("password", "emsg@4rfv");
		try {
			Class.forName("org.postgresql.Driver");
			//Class.forName("oracle.jdbc.driver.OracleDriver");
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
			return;
 
		}
		Connection connection = null;
		try {
			connection = DriverManager.getConnection("jdbc:postgresql://117.56.68.239:5432/emsg?currentSchema=public&charSet=UTF-8&loginTimeout=10&connectTimeout=10&socketTimeout=20", props);
			//connection = DriverManager.getConnection("jdbc:oracle:thin:@117.56.68.240:1521:emsg", props);
		} catch (SQLException e) {
 
			System.out.println("Connection Failed! Check output console");
			e.printStackTrace();
			return;
 
		}
		int array_index = 0;
		if (connection != null) {
			for(String userId:ulogArray){
				array_index = array_index +1;
				if((array_index%100)==0){
					System.out.println("==array_index==:"+array_index);
				}
				try {
					stmt = connection.createStatement();
					sql = "select account from F01_MEMBER where user_id="+ userId ;
					String account = "";
					rs = stmt.executeQuery(sql);
					while(rs.next()){
						account = rs.getString("account");
					}
					rs.close();
					if(account!=null&&account.trim().length()>0){
			        	sql1 = "select count(1) from new_msg_personal_message where msg_to='"+ account +"' and update_time between to_timestamp('" + stime + "','yyyy-mm-dd HH24:MI:SS') and to_timestamp('" + etime + "','yyyy-mm-dd HH24:MI:SS')";
			        	System.out.println(sql1);
						rs = stmt.executeQuery(sql1);
						int amount = 0;
						while(rs.next()){
							amount = rs.getInt(1);
						}
						personal_total = personal_total + amount;
						rs.close();
						sql2 = "select count(1) from new_msg_member_great_message where user_id='"+ account +"' and update_date between to_timestamp('" + stime + "','yyyy-mm-dd HH24:MI:SS') and to_timestamp('" + etime + "','yyyy-mm-dd HH24:MI:SS')";
						int amount1 = 0;
						rs = stmt.executeQuery(sql2);
						while(rs.next()){
							amount1 = rs.getInt(1);
						}
						rs.close();
						great_total = great_total + amount1;
					}
				} catch (SQLException e) {
					//System.out.println("Connection Failed! Check output console");
					e.printStackTrace();
					return;
				}finally{
					try {
						stmt.close();
						rs.close();
					}catch (SQLException e) {}
				}
			}
		}
		total = personal_total + great_total;
		System.out.println("===============================================");
		System.out.println("==personal_total=="+personal_total);
		System.out.println("==great_total=="+great_total);
		System.out.println("==total=="+total);

	}

}

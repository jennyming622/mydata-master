package test;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Properties;

public class emsgF03ClickCount {

	public static void main(String[] args) {
		String stime = "2014-01-01 00:00:00";
		String etime = "2020-02-29 23:59:59";
		String ulog_string = "154581247518920,154581251363320,154581707202620,154095362021020,141127087833120,140886105550720,140783200052920,145869810764620,139567247095920,154581246816320,141295454467320,154581711519220,154581706459520,139567282888020,139567403757720,154581246266720,154581253723220,154581703831520,154581243811920,139567266554020,139567520719720,139567247358020,154581257816420,139567247380220,154581703514120,154581249032220,139567180756620,139567504136920,146149694407820,139567349041120,139567329733820,144857239830920,139567403879820,141127279373720,154581244685120,140498523264720,139567235335420,146122053085120,139567302360520,154581242639120,145759241578720,139567348837320,141251635936920,154095364879020,139567537889320,139567474059320,139567235365720,139567504098920,155002666942820,145870401169520,139567329848820,139567403743520,145757772678920,154581254193120,140446186462020,154095365661020,139567348863620,139567451675920,139567302360920,140782845928420,154581257129420,145740743437820,139567180097320,139567403743120,154095362708520,154095363038120,139567537861620,146149488148720,154095365417020,154095359449520,144853828202120,154581248608020,145870457490020,146950144172620,139567349055420,141688203802120,139567520683620,139567282881220,154095359070120,154581255399720,139567348864620,154581256857220,139567436351420,139567181249820,154581711094120,145740507263720,154581251807020,139567302327220,139567504189520,154581251504020,154581708523220,140964869232620,154581251236620,154581256589920,139567213901020,154581709090720,145742556836820,139567329943820,154581704587820,154581710097920,139567329942920,139567302345620,145283884949620,154581702887920,140542546051220,154581253317820,139567329926520,139567235316220,144558198373720,154581250958120,144853730413220,139567422911020,139567181126320,144236881074020,154581253584420,154581705900420,141399491980820,154095364180020,154581244255620,139567266574320,139567213989120,145742001254620,154581243367820,139567451668420,154581245969920,145759873306720,154095363693020,139567235522520,141242928133220,154581710392720,139567537884820,154581708817020,141111504773020,154581242351520,154581246958620,154581251946420,154581253886120,154581250042620,139567504191520,154095361039920,139567537860420,139567221932320,145870601469120,139567451628220,145879891161120,140895519087920,141188733288520,139567403745820,139567474067420,146130520819220,154581245356520,145759859514620,145853014784020,146127622032220,154581711382320,154581703654720,154581252550020,141172604396520,139567221925420,139567537867220,145742018848420,139567247019420,154095361162220,154581254324520,141260335745020,145758804802520,154581247102120,139567213987320,158359711058920,154581708956620,139567474068220,139567520713120,154581705603220,154581254872920,140938526226520,145871293145920,145869978940420,154581248881520,139567282901220,154581258089520,139567181167920,154581257268720,154581707799620,139567422908220,154095360025420,139567247256820,145372209536920,154095365926120,154581706614920,139567504191920,139567422909120,154095360666020,154581702742720,145932015600820,154581703055620,145740703048620,139567181180620,139567422907920,154581707358620,145879846043320,139567235363620,154581709819420,154581248456020,154581256735720,139567247146120,139567247238020,154581248146820,139567537829220,154581708237220,145869716412920,154581252712720,145870141213520,154581704163620,154095359670220,139567266551520,154581706908720,139567504087620,139567451612120,139567520720220,154095365296020,139567282898820,140791912663520,154581245818420,139567488550720,141696913778920,140739610176320,154581709244120,141687858504220,139567504137320,145932871784020,144236881908520,154581248742920,154581249459020,141111667910620,146942815108920,154581242485620,154581702275220,139567537887320,154581255915920,139567348866420,145741966848420,154581711818120,154581702439820,146149252031820,145853050929520,154581705752720,154095361776320,154095361388120,146130325504220,154581243666420,154581246529820,139567329943320,139567235367020,139567266554820,141696485201920,140739369139120,154581256440920,154581707520820,139567282897220,139567412915220,139567222010520,139567520710920,141421943982320,139567222033220,154581246390920,154581246668920,146130803464120,154581705297620,154581254612220,141251614180920,139567488512520,139567180126520,139567235172820,139567504098120,139567504192320,154581243516520,154581251103920,141801984095320,154581255525420,154581246129520,154581709959220,154581251653920,141421554435420,154581243967020,154581245665920,139567180757220,145283898184320,146130281607120,154581709386320,141033485512920,145757248806720,154581252862920,139567422910420,154581702594220,154581249887020,144236881144220,154581705153720,139567235364320,139567221950420,154095366041720,139567235221020,154095362917720,139567181211920,139567222032720,139567537880920,139567247066920,154581704872420,141094321905320,154581708386720,139567282896420,154581708087020,154581704729320,139567348857020,154581254463620,143746681315620,146149673020920,154581250345120,154581254055820,139567266552920,154581252232220,154581250214920,139567282893120,146127793598620,154095363943420,139567317894720,146131714234120,139567504099920,139567412869520,154581249181320,154581706327220,141190796520720,154581707047820,145741853953120,154095360150120,154581254751120,154581242928920,139567422908620,139567235470020,139567488551220,139567181039620,141172286173620,145932065615020,139567247237520,141094457916420,146130831532520,154581248009820,146148409788720,154095359314920,154581711238120,145940462515620,141033574186020,139567247290820,154581257951220,139567247182920,154095358921920,154581247706020,139567451669320,139567235366420,154095360586120,154581255149520,154095364326220,154581244909820,154581249331420,139567488514020,145854687285720,139567436350920,154581710951420,139567247202420,154581249735420,141033649030520,139567537878820,139567403745320,140965088428720,154581243072620,139567403720320,145740657359820,154581707655020,154095360341620,154581250491220,154581704309720,154581256315220,139567247378720,145743073887220,154581244542320,139567247398120,139567317837220,145757667096320,139567302361920,154095363384220,154581253173820,145283726171920,139567520720720,154581704456820,154581247861320,139567180285320,154581247378620,154095362397720,139567422909920,141690296183520,154095362142020,139567246870620,154581245509820,139567247256320,144858398871720,139567317681020,139567403746320,139567235336020,139567282895220,154581703997120,146943470869020,141127228956720,145870254370020,145283908992620,139567266550020,141260359627020,139567451707120,154581247237820,139567246894520,139567488681520,144236881828720,154581244118420,154581243226220,154095363153320,139567180801420,139567266555320,154095365547720,139567348837720,154095365795720,146137609664320,154581703209920,158359711247020,139567451684220,154581705451620,154581708680420,154581710817220,145759074921420,139567451611620,154581711661820,140938833744120,139567181278520,154581242781620,154581706762020,145757223275920,145757335042920,144558199128720,154581707949020,145759374782820,139567348860220,141172653365320,141172711315520,139567181125720,154581253008620,144236881175520,154581257686720,154581256180520,140973301800920,154581255790820,154581255273520,154581249592620,154581250648320,139567180232420,154581244397520,154581710258920,139567181112920,154581256989620,154199009154120,139567474068620,140964502419320,154581706047220,154581709680420,154581255006520,157150123686720,139567282900720,140964409181820,140941018157620,154126117949220,140747165198620,146951728618220,139567247379720,154095361660420,154581703354720,139567451683420,154581252080820,139567221962120,139567504170020,145887632588920,154581252386120,154581256044120,141172685017820,154581250804420,154581710680020,144859003380020,139567451653620,146137433408520,154581257397320,154095364736520,154095365146220,139567282892620,154581245216720,154581248296020,154095360776020,154095362814120,144858190005720,144236881184820,139567282879920,139567282892120,144236881242820,139567246982920,154095360498920,154581706191120,154581709540920,154581705013520,154581245045520,154581255663520,141034485333520,141260303342820,145283927331120,145759266398820,144857996921220,154581253446620,147434220065720,139567181005020,139567451625720,139567504137720,154581710530620,146149655519020,154581257562320,141346678048220,141346709996320,139567302358020,154095360918120,146130154379420,139567330031520";
		String[]  ulogArray = ulog_string.split(",");
        String sql = "";
        String sql1= "";
        String sql2= "";
        Statement stmt = null;
        ResultSet rs = null,rs1 = null,rs2 = null,rs3 = null;
        int personal_total = 0;
        int great_total = 0;
        int total = 0;
		Properties props = new Properties();
	    props.put("user", "root");
	    props.put("password", "riease1qaz");
		try {
			//Class.forName("org.postgresql.Driver");
			Class.forName("org.mariadb.jdbc.Driver");
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
			return;
 
		}
		Connection connection = null;
		try {
			//connection = DriverManager.getConnection("jdbc:postgresql://117.56.68.239:5432/emsg?currentSchema=public&charSet=UTF-8&loginTimeout=10&connectTimeout=10&socketTimeout=20", props);
			connection = DriverManager.getConnection("jdbc:mariadb://117.56.91.214:3306/emsg?useUnicode=true&characterEncoding=utf8", props);
		} catch (SQLException e) {
 
			System.out.println("Connection Failed! Check output console");
			e.printStackTrace();
			return;
 
		}
		int array_index = 0;
		if (connection != null) {
			for(String msgId:ulogArray){
				array_index = array_index +1;
				if((array_index%100)==0){
					System.out.println("==array_index==:"+array_index);
				}
				try {
					stmt = connection.createStatement();
					if(msgId!=null&&msgId.trim().length()>0){
						sql = "select count(1) from ulog_api where cnt_id='"+ msgId +"' and cnt_type='f03' and ctime between to_timestamp('" + stime + "','yyyy-mm-dd HH24:MI:SS') and to_timestamp('" + etime + "','yyyy-mm-dd HH24:MI:SS')";
				        	System.out.println(sql);
						rs = stmt.executeQuery(sql);
						int amount = 0;
						while(rs.next()){
							amount = rs.getInt(1);
						}
						great_total = great_total + amount;
					}
				} catch (SQLException e) {
					//System.out.println("Connection Failed! Check output console");
					e.printStackTrace();
					return;
				}finally{
					try {
						stmt.close();
						rs.close();
					}catch (SQLException e) {}
				}
			}
		}
		total = personal_total + great_total;
		System.out.println("===============================================");
		System.out.println("==total=="+total);
	}

}
